var C=Object.defineProperty,M=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var S=(u,t,e)=>t in u?C(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e,h=(u,t)=>{for(var e in t||(t={}))R.call(t,e)&&S(u,e,t[e]);if(k)for(var e of k(t))x.call(t,e)&&S(u,e,t[e]);return u},p=(u,t)=>M(u,T(t));var w=class{constructor(){this.currentSettings=null,this.defaultModel="qwen2.5:3b",this.settingsLoadPromise=null}async loadAISettings(t){try{if(console.log("AISettingsManager: Loading AI settings for user:",t),!t||typeof t!="string"||t.length!==36)return console.error("AISettingsManager: Invalid user ID provided:",t),console.log("AISettingsManager: Returning default settings (ollama)"),this.getDefaultSettings();console.log("AISettingsManager: Making API request to load settings...");let e=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/users/".concat(t,"/ai-settings/default")});return e&&e.success?(this.currentSettings=e.ai_settings,console.log("AISettingsManager: Successfully loaded AI settings"),this.currentSettings):(console.warn("AISettingsManager: No AI settings found, using default"),console.log("AISettingsManager: Response was:",e),this.getDefaultSettings())}catch(e){return console.error("AISettingsManager: Error loading AI settings:",e),this.getDefaultSettings()}}getDefaultSettings(){return console.log("AISettingsManager: No AI settings configured - user must set up AI first"),null}getCurrentSettings(){return this.currentSettings}setSettings(t){this.currentSettings=t,console.log("AISettingsManager: Settings updated:",t)}getModel(){let t=this.getCurrentSettings();return t&&(t.ai_model||t.model)||null}getProvider(){let t=this.getCurrentSettings();return t&&(t.ai_provider||t.provider)||null}async getDecryptedApiKey(){let t=this.getCurrentSettings();if(!t)return null;if(t.apiKey&&t.apiKey!=="encrypted")return t.apiKey;if(t.api_key_encrypted&&t.id)try{let e=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/ai-settings/".concat(t.id,"/encrypted-key")});if(e&&e.success&&e.api_key_encrypted){let r=await chrome.runtime.sendMessage({action:"apiRequest",method:"POST",url:"/ai-settings/decrypt-api-key",data:{encryptedApiKey:e.api_key_encrypted}});if(r&&r.success)return t.apiKey=r.decryptedApiKey,r.decryptedApiKey}}catch(e){throw console.error("AISettingsManager: Error fetching/decrypting API key:",e),new Error("Failed to retrieve API key")}return null}async testConnection(){try{let t=this.getProvider();return t==="ollama"?await chrome.runtime.sendMessage({action:"testOllama"}):t==="openai"?await chrome.runtime.sendMessage({action:"testOpenAI"}):this.getCurrentSettings().apiKey?{success:!0,message:"".concat(t," settings validated")}:{success:!1,error:"API key required for ".concat(t)}}catch(t){return console.error("AISettingsManager: Error testing connection:",t),{success:!1,error:t.message}}}async callAI(t){try{let e=this.getProvider(),r=this.getModel(),n=0;if(t.prompt?n=this.estimateTokens(t.prompt):t.messages&&(n=this.estimateTokensFromMessages(t.messages)),e==="ollama"){let s=p(h({},t),{model:r}),a=await chrome.runtime.sendMessage({action:"callOllama",endpoint:"generate",data:s});if(a.success===!1)throw new Error(a.error||"Unknown error from Ollama API");return a.data}else if(e==="openai"){let s=await this.getDecryptedApiKey();if(!s)throw new Error("OpenAI API key is required");let a=p(h({},t),{model:r,apiKey:s});console.log("Sending OpenAI request:",p(h({},a),{apiKey:"[REDACTED]"}));let l=await chrome.runtime.sendMessage({action:"callOpenAI",data:a});if(l.success===!1)throw new Error(l.error||"Unknown error from OpenAI API");return l.data}else throw new Error("Provider ".concat(e," not yet implemented"))}catch(e){throw console.error("AISettingsManager: Error calling AI API:",e),e}}async callAIWithStop(t,e=null){try{let r=this.getProvider();if(r==="ollama"){let n=this.getModel(),s=p(h({},t),{model:n});return new Promise((a,l)=>{let o=null;e&&(o=setInterval(async()=>{try{let i=!1;typeof e=="function"?i=await e():e&&e.value!==void 0?i=e.value:i=!!e,i&&(console.log("Stop requested during AI API call"),o&&clearInterval(o),a({stopped:!0}))}catch(i){console.error("Error in stop check:",i)}},500)),chrome.runtime.sendMessage({action:"callOllama",endpoint:"generate",data:s},i=>{o&&clearInterval(o),chrome.runtime.lastError?l(new Error(chrome.runtime.lastError.message)):i.success===!1?l(new Error(i.error||"Unknown error from Ollama API")):a(i.data)})})}else if(r==="openai"){let n=this.getModel(),s=await this.getDecryptedApiKey();if(!s)throw new Error("OpenAI API key is required");return new Promise((a,l)=>{let o=null;e&&(o=setInterval(async()=>{try{let i=!1;typeof e=="function"?i=await e():e&&e.value!==void 0?i=e.value:i=!!e,i&&(console.log("Stop requested during OpenAI API call"),o&&clearInterval(o),a({stopped:!0}))}catch(i){console.error("Error in stop check:",i)}},500)),chrome.runtime.sendMessage({action:"callOpenAI",data:p(h({},t),{model:n,apiKey:s})},i=>{o&&clearInterval(o),chrome.runtime.lastError?l(new Error(chrome.runtime.lastError.message)):i.success===!1?l(new Error(i.error||"Unknown error from OpenAI API")):a(i.data)})})}else throw new Error("Provider ".concat(r," not yet implemented"))}catch(r){throw console.error("AISettingsManager: Error calling AI API with stop:",r),r}}async loadAvailableModels(){try{let t=this.getProvider();if(t==="ollama"){let e=await chrome.runtime.sendMessage({action:"ollamaRequest",method:"GET",url:"/api/tags"});if(e&&e.success)return e.models.map(r=>r.name);throw new Error((e==null?void 0:e.error)||"Failed to load Ollama models")}else throw new Error("Provider ".concat(t," not yet implemented"))}catch(t){throw console.error("AISettingsManager: Error loading models:",t),t}}estimateTokens(t){if(!t)return 0;let e=t.length;return Math.ceil(e/4)}estimateTokensFromMessages(t){if(!t||!Array.isArray(t))return 0;let e=0;for(let r of t)r.content&&(e+=this.estimateTokens(r.content)),e+=4;return e}getTokenAnalysis(t){let e={inputTokens:0,estimatedOutputTokens:0,maxTokens:t.max_tokens||1e3,provider:this.getProvider(),model:this.getModel()};return t.prompt?e.inputTokens=this.estimateTokens(t.prompt):t.messages&&(e.inputTokens=this.estimateTokensFromMessages(t.messages)),e.estimatedOutputTokens=Math.min(e.maxTokens,100),e}clear(){this.currentSettings=null,this.settingsLoadPromise=null}},E=w;var A=class{constructor(t){this.aiSettingsManager=t,this.classificationCache=new Map}async classifyQuestion(t){let e=t.toLowerCase().trim();if(this.classificationCache.has(e))return console.log("AIQuestionClassifier: Using cached classification"),this.classificationCache.get(e);try{let r=this.buildClassificationPrompt(t);console.log("AIQuestionClassifier: Classifying question with AI");let n=await this.aiSettingsManager.callAI({prompt:r,max_tokens:200,temperature:.1,stream:!1}),s=this.parseClassificationResponse(n);return s=this.validateClassification(s,t),this.classificationCache.set(e,s),console.log("AIQuestionClassifier: Classification result:",s),s}catch(r){return console.error("AIQuestionClassifier: Error classifying question:",r),this.getFallbackClassification(t)}}buildClassificationPrompt(t){return'You are an expert at analyzing job application questions. Classify the following question and extract relevant keywords.\n\nQUESTION: "'.concat(t,'"\n\nAnalyze and return ONLY a JSON object with these fields:\n{\n  "question_type": "one of: language_proficiency|skill_level|years_experience|education|personal|salary|availability|notice_period|visa_status|general",\n  "keywords": ["array", "of", "relevant", "keywords"],\n  "confidence": 0.95,\n  "language": "en|de|fr|es",\n  "expected_format": "text|number|selection|boolean"\n}\n\nCLASSIFICATION RULES:\n- language_proficiency: Questions about language skills (German, English, etc.)\n- skill_level: Questions about proficiency in technologies/tools\n- years_experience: Questions asking for number of years of experience\n- education: Questions about degrees, universities, graduation\n- personal: Questions about name, contact, location, citizenship\n- salary: Questions about salary expectations or current salary\n- availability: Questions about start date, availability\n- notice_period: Questions about notice period or current employment\n- visa_status: Questions about visa, work permit, citizenship\n- general: Any other questions\n\nKEYWORD EXTRACTION:\n- Extract specific technologies, languages, skills mentioned\n- Normalize to common terms (e.g., "JS" \u2192 "JavaScript", "Deutsch" \u2192 "German")\n- Include variations and synonyms\n\nEXAMPLES:\nQ: "Wie gut beherrschen Sie Deutsch?" \u2192 {"question_type":"language_proficiency","keywords":["German"],"confidence":0.95,"language":"de","expected_format":"selection"}\nQ: "How many years of experience do you have with Python?" \u2192 {"question_type":"years_experience","keywords":["Python"],"confidence":0.9,"language":"en","expected_format":"number"}\nQ: "What is your proficiency level in SAP?" \u2192 {"question_type":"skill_level","keywords":["SAP"],"confidence":0.9,"language":"en","expected_format":"selection"}\n\nReturn ONLY the JSON object:')}parseClassificationResponse(t){var e,r,n;try{let s="";if(t!=null&&t.response)s=t.response.trim();else if((n=(r=(e=t==null?void 0:t.choices)==null?void 0:e[0])==null?void 0:r.message)!=null&&n.content)s=t.choices[0].message.content.trim();else throw new Error("Unexpected AI response format");let a=s.match(/\{[\s\S]*\}/);if(a)return JSON.parse(a[0]);throw new Error("No JSON found in response")}catch(s){throw console.error("AIQuestionClassifier: Error parsing classification response:",s),s}}validateClassification(t,e){return{question_type:["language_proficiency","skill_level","years_experience","education","personal","salary","availability","notice_period","visa_status","general"].includes(t.question_type)?t.question_type:"general",keywords:Array.isArray(t.keywords)?t.keywords:[],confidence:typeof t.confidence=="number"?t.confidence:.5,language:t.language||"en",expected_format:t.expected_format||"text"}}getFallbackClassification(t){let e=t.toLowerCase();return e.includes("deutsch")||e.includes("german")||e.includes("english")||e.includes("sprache")||e.includes("language")?{question_type:"language_proficiency",keywords:this.extractLanguageKeywords(e),confidence:.7,language:e.includes("deutsch")?"de":"en",expected_format:"selection"}:e.includes("jahr")||e.includes("year")||e.includes("erfahrung")||e.includes("experience")?{question_type:"years_experience",keywords:[],confidence:.6,language:e.includes("jahr")?"de":"en",expected_format:"number"}:{question_type:"general",keywords:[],confidence:.3,language:"en",expected_format:"text"}}extractLanguageKeywords(t){let e={deutsch:"German",german:"German",english:"English",englisch:"English",french:"French",franz\u00F6sisch:"French",spanish:"Spanish",spanisch:"Spanish",arabic:"Arabic",arabisch:"Arabic"},r=[];for(let[n,s]of Object.entries(e))t.includes(n)&&r.push(s);return r}clearCache(){this.classificationCache.clear(),console.log("AIQuestionClassifier: Cache cleared")}getCacheStats(){return{size:this.classificationCache.size,keys:Array.from(this.classificationCache.keys())}}},_=A;var v=class{constructor(){this.dataCache=new Map}async getRelevantData(t,e){if(!t||!e)return console.log("AISmartDataRetriever: Missing classification or resumeId"),null;let r="".concat(e,"_").concat(t.question_type,"_").concat(t.keywords.join(","));if(this.dataCache.has(r))return console.log("AISmartDataRetriever: Using cached data"),this.dataCache.get(r);try{console.log("AISmartDataRetriever: Retrieving data for type: ".concat(t.question_type,", keywords: ").concat(t.keywords.join(", ")));let n=null;switch(console.log('AISmartDataRetriever: Switch statement with question_type: "'.concat(t.question_type,'"')),t.question_type){case"language_proficiency":console.log("AISmartDataRetriever: Matched language_proficiency case"),n=await this.getLanguageData(e,t.keywords),console.log("AISmartDataRetriever: getLanguageData returned:",n?Object.keys(n):"null");break;case"skill_level":case"years_experience":n=await this.getSkillExperienceData(e,t.keywords);break;case"education":n=await this.getEducationData(e,t.keywords);break;case"personal":case"visa_status":n=await this.getPersonalData(e);break;case"salary":case"availability":case"notice_period":n=await this.getEmploymentData(e);break;default:console.log('AISmartDataRetriever: Hit default case for question_type: "'.concat(t.question_type,'"')),n=await this.getGeneralData(e,t.keywords)}return n&&this.dataCache.set(r,n),console.log("AISmartDataRetriever: Retrieved data:",n?Object.keys(n):"null"),n}catch(n){return console.error("AISmartDataRetriever: Error retrieving relevant data:",n),null}}async getLanguageData(t,e){try{console.log("AISmartDataRetriever: getLanguageData called with keywords:",e);let r=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(t,"/relevant-data?questionType=language_proficiency")});if(console.log("AISmartDataRetriever: API response:",r),r&&r.success&&r.relevantData){let n=r.relevantData;if(console.log("AISmartDataRetriever: languageData received:",n),e.length>0&&n.languages){let s=n.languages.filter(a=>{var o;let l=((o=a.language)==null?void 0:o.toLowerCase())||"";return e.some(i=>l.includes(i.toLowerCase())||i.toLowerCase().includes(l))});if(s.length>0)return{languages:s}}return n}return null}catch(r){return console.error("AISmartDataRetriever: Error getting language data:",r),null}}async getSkillExperienceData(t,e){try{let r=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(t,"/relevant-data?questionType=skills")});if(r&&r.success&&r.relevantData){let n=r.relevantData,s={};if(e.length>0&&n.skills){let a=n.skills.filter(l=>{var d,m;let o=((d=l.name)==null?void 0:d.toLowerCase())||"",i=((m=l.category)==null?void 0:m.toLowerCase())||"";return e.some(y=>o.includes(y.toLowerCase())||i.includes(y.toLowerCase())||y.toLowerCase().includes(o))});a.length>0&&(s.skills=a)}if(e.length>0&&n.experiences){let a=n.experiences.filter(l=>{let o=JSON.stringify(l).toLowerCase();return e.some(i=>o.includes(i.toLowerCase()))});a.length>0&&(s.experiences=a.map(l=>{var o;return{company:l.company,position:l.position,employment_period:l.employment_period,skills_acquired:l.skills_acquired||[],key_responsibilities:((o=l.key_responsibilities)==null?void 0:o.filter(i=>{var m;let d=((m=i.description)==null?void 0:m.toLowerCase())||"";return e.some(y=>d.includes(y.toLowerCase()))}))||[]}}))}return n.personal_info&&(s.personal_info={years_of_experience:n.personal_info.years_of_experience}),Object.keys(s).length>0?s:n}return null}catch(r){return console.error("AISmartDataRetriever: Error getting skill/experience data:",r),null}}async getEducationData(t,e){try{let r=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(t,"/relevant-data?questionType=education")});return r&&r.success&&r.relevantData?r.relevantData:null}catch(r){return console.error("AISmartDataRetriever: Error getting education data:",r),null}}async getPersonalData(t){try{let e=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(t,"/relevant-data?questionType=personal")});return e&&e.success&&e.relevantData?e.relevantData:null}catch(e){return console.error("AISmartDataRetriever: Error getting personal data:",e),null}}async getEmploymentData(t){try{let e=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(t,"/relevant-data?questionType=personal")});if(e&&e.success&&e.relevantData){let r=e.relevantData.personal_info||{};return{personal_info:{salary:r.salary,location:r.location,visa_required:r.visa_required,years_of_experience:r.years_of_experience}}}return null}catch(e){return console.error("AISmartDataRetriever: Error getting employment data:",e),null}}async getGeneralData(t,e){var r,n,s,a,l;try{let o=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(t,"/relevant-data?questionType=general")});if(o&&o.success&&o.relevantData){let i=o.relevantData;return{personal_info:{name:(r=i.personal_info)==null?void 0:r.name,years_of_experience:(n=i.personal_info)==null?void 0:n.years_of_experience,location:(s=i.personal_info)==null?void 0:s.location},summary:i.summary,skills:((a=i.skills)==null?void 0:a.slice(0,5))||[],experiences:((l=i.experiences)==null?void 0:l.slice(0,2))||[]}}return null}catch(o){return console.error("AISmartDataRetriever: Error getting general data:",o),null}}generateFallbackResponse(t,e=null){if(!e||!Array.isArray(e)||e.length===0)return null;switch(console.log("AISmartDataRetriever: Generating fallback response for:",t.question_type),t.question_type){case"language_proficiency":if(e.includes("Gut"))return"Gut";if(e.includes("Verhandlungssicher"))return"Verhandlungssicher";if(e.includes("Good"))return"Good";if(e.includes("Intermediate"))return"Intermediate";break;case"years_experience":return"5";case"skill_level":if(e.includes("Intermediate"))return"Intermediate";if(e.includes("Good"))return"Good";if(e.includes("Mittel"))return"Mittel";break;case"visa_status":if(e.includes("No"))return"No";if(e.includes("Nein"))return"Nein";break}return e.length>1?e[1]:e[0]}clearCache(){this.dataCache.clear(),console.log("AISmartDataRetriever: Cache cleared")}getCacheStats(){return{size:this.dataCache.size,keys:Array.from(this.dataCache.keys())}}},b=v;var I=class{constructor(t=null){this.userId=t,this.user_data=null,this.formatted_text=null,this.aiSettingsManager=new E,this.settingsLoadPromise=null,this.questionClassifier=new _(this.aiSettingsManager),this.smartDataRetriever=new b,t&&(this.settingsLoadPromise=this.aiSettingsManager.loadAISettings(t))}async setUserId(t){this.userId=t,t&&(this.settingsLoadPromise=this.aiSettingsManager.loadAISettings(t),await this.settingsLoadPromise)}async ensureSettingsLoaded(){this.settingsLoadPromise&&(await this.settingsLoadPromise,this.settingsLoadPromise=null)}setModel(t){if(t&&typeof t=="string"){let e=this.aiSettingsManager.getCurrentSettings(),r=p(h({},e),{model:t});this.aiSettingsManager.setSettings(r),console.log("AIQuestionAnswerer: Model overridden to: ".concat(t))}}async setUserContext(t,e=null){try{if(typeof t=="object"&&t!==null)this.user_data=t,this.formatted_text=e||this.formatUserDataAsText(),console.log("User context set with structured data");else if(typeof t=="string")this.user_data=null,this.formatted_text=t,console.log("User context set with formatted text only");else throw new Error("Invalid user data format");return console.log("User context set successfully"),{success:!0}}catch(r){return console.error("Error in setUserContext:",r),{success:!1,error:r.message}}}async answerQuestion(t,e=null,r=null,n=null){var s,a,l;try{await this.ensureSettingsLoaded(),console.log("AIQuestionAnswerer: Processing question: ".concat(t));let o=null,i=null;try{o=await this.questionClassifier.classifyQuestion(t),console.log("AIQuestionAnswerer: Question classified as:",o)}catch(c){console.error("AIQuestionAnswerer: Classification failed, using fallback:",c),o={question_type:"general",keywords:[],confidence:.3}}if(n&&o)try{i=await this.smartDataRetriever.getRelevantData(o,n),console.log("AIQuestionAnswerer: Retrieved relevant data:",i?Object.keys(i):"null")}catch(c){console.error("AIQuestionAnswerer: Smart data retrieval failed:",c)}let d=this.getDirectAnswer(t,i);if(d)return console.log("AIQuestionAnswerer: Found direct answer:",d),e&&Array.isArray(e)&&e.length>0?{success:!0,answer:this.matchToOption(d,e)}:{success:!0,answer:d};if(!i||Object.keys(i).length===0){console.log("AIQuestionAnswerer: No relevant data found, trying intelligent fallback");let c=this.smartDataRetriever.generateFallbackResponse(o,e);if(c)return console.log("AIQuestionAnswerer: Using intelligent fallback answer:",c),{success:!0,answer:c}}if(r){let c=!1;if(typeof r=="function"?c=await r():r&&r.value!==void 0?c=r.value:c=!!r,c)return console.log("AIQuestionAnswerer: Stop requested before AI processing"),{success:!1,stopped:!0}}let m=this.buildSmartPrompt(t,e,i,o);console.log("=== SMART PROMPT BEING SENT ==="),console.log(m),console.log("=== END SMART PROMPT ===");let y=this.aiSettingsManager.getTokenAnalysis({prompt:m});console.log("Token Analysis:",y);let g=await this.aiSettingsManager.callAIWithStop({prompt:m,stream:!1},r);if(g&&g.stopped)return{success:!1,stopped:!0};let f="";if(g!=null&&g.response?f=g.response.trim():(l=(a=(s=g==null?void 0:g.choices)==null?void 0:s[0])==null?void 0:a.message)!=null&&l.content?f=g.choices[0].message.content.trim():(console.warn("AIQuestionAnswerer: Unexpected AI response format:",g),f=""),console.log("AIQuestionAnswerer: Raw AI response:",f),o.question_type==="years_experience"&&/^\d+$/.test(f)){let c=parseInt(f);c<5&&(f="5",console.log("AIQuestionAnswerer: Enforced minimum 5 years for experience question, was: ".concat(c)))}return e&&Array.isArray(e)&&e.length>0&&(f=this.matchToOption(f,e)),{success:!0,answer:f||"Information not available"}}catch(o){console.error("AIQuestionAnswerer: Error in answerQuestion:",o);let i="Information not available";return classification&&e&&(i=this.smartDataRetriever.generateFallbackResponse(classification,e)),!i&&e&&Array.isArray(e)&&e.length>0&&(i=e.length>1?e[1]:e[0]),console.log("AIQuestionAnswerer: Using fallback answer:",i),{success:!1,answer:i,error:o.message}}}detectQuestionType(t){let e=t.toLowerCase();return e.includes("level of")||e.includes("proficiency in")||e.includes("fluent in")?"language_level":e.includes("skill")||e.includes("experience")||e.includes("years")||e.includes("technology")||e.includes("programming")||e.includes("language")||e.includes("c++")||e.includes("python")||e.includes("java")?"skills":e.includes("education")||e.includes("degree")||e.includes("study")||e.includes("university")||e.includes("college")?"education":e.includes("language")||e.includes("speak")||e.includes("fluent")?"languages":e.includes("certification")||e.includes("certified")?"certifications":e.includes("name")||e.includes("email")||e.includes("phone")||e.includes("contact")||e.includes("location")?"personal":e.includes("visa")||e.includes("sponsorship")||e.includes("work permit")?"visa":e.includes("salary")||e.includes("compensation")||e.includes("pay")||e.includes("expectation")?"salary":e.includes("notice")||e.includes("period")||e.includes("availability")||e.includes("start date")?"notice":"general"}getDirectAnswer(t,e=null){var s;if(e){let a=t.toLowerCase();if(e.languages&&(a.includes("level of")||a.includes("proficiency"))){for(let l of["german","english","french","arabic","spanish"])if(a.includes(l)){let o=e.languages.find(i=>{var d;return((d=i.language)==null?void 0:d.toLowerCase())===l});if(o)return o.proficiency||"Unknown"}}if(e.personal_info){if(a.includes("email")||a.includes("e-mail"))return e.personal_info.email||null;if(a.includes("phone")||a.includes("telephone")||a.includes("mobile"))return e.personal_info.phone||null;if(a.includes("name"))return e.personal_info.name||null;if(a.includes("location")||a.includes("address"))return e.personal_info.location||null;if(a.includes("citizenship"))return e.personal_info.citizenship||null;if(a.includes("visa")||a.includes("sponsorship"))return e.personal_info.visa_required||null;if(a.includes("salary")||a.includes("compensation")||a.includes("pay"))return e.personal_info.salary||null}}if(!((s=this.user_data)!=null&&s.personal_information))return null;let r=this.user_data.personal_information,n=t.toLowerCase();return n.includes("email")||n.includes("e-mail")?r.email||null:n.includes("phone")||n.includes("mobile")||n.includes("telefon")?(r.phone_prefix?"".concat(r.phone_prefix).concat(r.phone):r.phone)||null:n.includes("first name")||n.includes("vorname")?r.name||null:n.includes("last name")||n.includes("surname")||n.includes("nachname")?r.surname||null:n.includes("country")&&!n.includes("code")?r.country||null:this.isNoticePeriodOrStartDateQuestion(t)?n.includes("notice period")||n.includes("k\xFCndigungsfrist")||n.includes("kuendigungsfrist")?n.includes("monate")||n.includes("deutsch")?"2 Monate":"2 months":this.calculateDateTwoMonthsFromNow():null}buildSmartPrompt(t,e,r,n){let s;r&&Object.keys(r).length>0?(s=this.formatRelevantDataAsText(r),console.log("AIQuestionAnswerer: Using focused relevant data for prompt")):(s="No specific relevant data available in resume.",console.log("AIQuestionAnswerer: No relevant data - using fallback prompt"));let a='You are a job applicant filling out a job application form. Answer questions based on your resume information in first person (as "I" not "he/she").\n\nRELEVANT RESUME DATA:\n'.concat(s,"\n\nQUESTION: ").concat(t,'\n\nIMPORTANT GENERAL RULES:\n- Answer as the job applicant (use "I", "my", "me" - NOT "he", "she", "Sami", or third person)\n- Be concise and direct\n- Only provide the specific information requested\n- Do not mention your name unless explicitly asked');switch(n.question_type){case"years_experience":a+='\n\nIMPORTANT RULES FOR YEARS OF EXPERIENCE:\n- If asked for years of experience, provide ONLY a number between 5-99\n- MINIMUM is always 5 years - never return 0, 1, 2, 3, or 4\n- Do NOT include words like "years", "Jahre", or descriptions\n- Calculate based on work experience and skill level\n- If no specific experience found, default to 5 years minimum\n- Example: "5" not "5 years" or "5 Jahre"';break;case"language_proficiency":a+="\n\nIMPORTANT RULES FOR LANGUAGE PROFICIENCY:\n- Choose the most accurate proficiency level based on resume data\n- If no specific language data available, choose a realistic favorable level\n- Common levels: Beginner, Intermediate, Advanced, Professional, Native";break;case"skill_level":a+="\n\nIMPORTANT RULES FOR SKILL LEVELS:\n- Base skill level on experience with the technology/tool\n- If no specific experience found, choose a moderate favorable level\n- Consider years of experience and project involvement";break}return e&&Array.isArray(e)&&e.length>0&&(a+="\n\nAvailable Options: ".concat(JSON.stringify(e),"\n\nIMPORTANT: You MUST choose EXACTLY ONE option from the list above. Your answer should match one of the options EXACTLY as written.")),a+="\n\nANSWER:",a}buildEnhancedPrompt(t,e,r=null){let n;r&&Object.keys(r).length>0?(n=this.formatRelevantDataAsText(r),console.log("Using relevant data sections for prompt")):(n=this.formatUserDataAsText(),console.log("Using full resume for prompt (no relevant data available)"));let s='You are a job applicant filling out a job application form. Answer questions based on your resume information in first person (as "I" not "he/she").\n\nMY RESUME:\n'.concat(n,"\n\nQUESTION: ").concat(t,'\n\nIMPORTANT GENERAL RULES:\n- Answer as the job applicant (use "I", "my", "me" - NOT "he", "she", "Sami", or third person)\n- Be concise and direct\n- Only provide the specific information requested\n- Do not mention your name unless explicitly asked');if(this.isDecimalNumberQuestion(t)&&(s+='\n\nIMPORTANT RULES FOR DECIMAL NUMBERS:\n- If asked for a decimal number, provide ONLY a decimal number (e.g., "3.5", "2.0", "1.2")\n- Do NOT include explanations, descriptions, or additional text\n- The number should be greater than 0.0 as requested\n- Example: "3.0" not "3.0 years" or explanations'),this.isYearsOfExperienceQuestion(t)&&(s+='\n\nIMPORTANT RULES FOR YEARS OF EXPERIENCE:\n- If asked for years of experience, provide ONLY a number between 5-99\n- MINIMUM is always 5 years - never return 0, 1, 2, 3, or 4\n- Do NOT include words like "years", "Jahre", or descriptions\n- For skill levels: Beginner=5, Intermediate=7, Advanced=10+ years\n- Calculate based on work experience and skill level\n- If no specific experience found, default to 5 years minimum\n- If unclear or no data, always answer at least 5 years to maximize job prospects\n- Example: "5" not "5 years" or "5 Jahre"\n- Better to overestimate than underestimate for better interview chances'),this.isDegreeQuestion(t)&&(s+='\n\nIMPORTANT RULES FOR DEGREE QUESTIONS:\n- Check education section carefully for exact degree matches\n- "Bachelor" = "Bachelor of Engineering" or "Bachelor of Science"\n- "Master" = "Master of Engineering" or "Master of Science"\n- Answer "Ja" for German forms, "Yes" for English forms\n- If degree is found, answer positively\n- Look for exact degree names in education section'),this.isSkillLevelQuestion(t)&&(s+="\n\nIMPORTANT RULES FOR SKILL LEVEL QUESTIONS:\n- Check the skills section for exact skill matches\n- Look for the skill name and its level (Beginner/Intermediate/Advanced)\n- Be precise about the level mentioned in the resume\n- Do not guess or estimate levels"),this.isNoticePeriodOrStartDateQuestion(t)){let a=this.calculateDateTwoMonthsFromNow();s+='\n\nIMPORTANT RULES FOR NOTICE PERIOD AND START DATE:\n- For notice period questions, answer "2 months" or "2 Monate"\n- For starting date questions, provide the exact date: '.concat(a,'\n- Use the format DD.MM.YYYY for German forms (e.g., "15.03.2024")\n- Use the format MM/DD/YYYY for English forms (e.g., "03/15/2024")\n- Current calculated start date (2 months from today): ').concat(a,"\n- Be consistent with the date format expected by the form")}if(e&&Array.isArray(e)&&e.length>0){let a=e.map(l=>'"'.concat(l,'"')).join(", ");s+="\n\nAvailable Options: [".concat(a,"]\n\nIMPORTANT: You MUST choose EXACTLY ONE option from the list above. Your answer should match one of the options EXACTLY as written.")}return s+="\n\nANSWER:",s}isDecimalNumberQuestion(t){let e=t.toLowerCase();return e.includes("decimal")||e.includes("dezimal")||e.includes("gr\xF6\xDFer als 0.0")||e.includes("greater than 0.0")||e.includes("decimal zahl")||e.includes("decimal number")}isYearsOfExperienceQuestion(t){let e=t.toLowerCase();return e.includes("jahre")||e.includes("years")||e.includes("experience")||e.includes("erfahrung")||e.includes("how many")||e.includes("wie viele")}isDegreeQuestion(t){let e=t.toLowerCase();return e.includes("bachelor")||e.includes("master")||e.includes("degree")||e.includes("abschluss")||e.includes("bildung")||e.includes("education")}isSkillLevelQuestion(t){let e=t.toLowerCase();return e.includes("level")||e.includes("niveau")||e.includes("skill")||e.includes("f\xE4higkeit")||e.includes("experience with")||e.includes("erfahrung mit")}isNoticePeriodOrStartDateQuestion(t){let e=t.toLowerCase();return e.includes("notice period")||e.includes("starting date")||e.includes("start date")||e.includes("startdatum")||e.includes("beginn")||e.includes("beginnen")||e.includes("k\xFCndigungsfrist")||e.includes("kuendigungsfrist")||e.includes("verf\xFCgbar")||e.includes("verfuegbar")||e.includes("available")||e.includes("wann k\xF6nnen sie")||e.includes("when can you")||e.includes("earliest start")||e.includes("fr\xFChester beginn")||e.includes("fruehester beginn")}calculateDateTwoMonthsFromNow(){let t=new Date;t.setMonth(t.getMonth()+2);let e=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear();return"".concat(e,".").concat(r,".").concat(n)}formatUserDataAsText(){return this.formatted_text?this.formatted_text:this.user_data?typeof this.user_data=="string"?this.user_data:this.formatObject(this.user_data,0):"No user data available."}formatRelevantDataAsText(t){let e="";for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let n=t[r];n&&Object.keys(n).length>0&&(e+="\n".concat(r.toUpperCase().replace(/_/g," "),":\n"),e+=this.formatObject(n,1))}return e||"No relevant data available."}formatObject(t,e=0){let r="  ".repeat(e),n="";if(typeof t=="object"&&t!==null)if(Array.isArray(t))for(let s of t)typeof s=="object"&&s!==null?n+="".concat(r,"- ").concat(this.formatObject(s,e+1)):n+="".concat(r,"- ").concat(s,"\n");else for(let[s,a]of Object.entries(t)){let l=s.toUpperCase().replace(/_/g," ");n+="".concat(r).concat(l,":\n"),typeof a=="object"&&a!==null?n+=this.formatObject(a,e+1):n+="".concat(r,"  ").concat(a,"\n")}else n+="".concat(r).concat(t,"\n");return n}matchToOption(t,e){if(!t||!e||e.length===0)return(e==null?void 0:e.length)>0?e[0]:"Not available";if(this.isDecimalNumberQuestion(t)||/^\d+\.\d+$/.test(t.trim())){let r=t.match(/\d+\.\d+/);if(r){let n=r[0];for(let s of e)if(s.includes(n))return s;return n}}if(this.isYearsOfExperienceQuestion(t)||/^\d+$/.test(t.trim())){let r=t.match(/\d+/);if(r){let n=parseInt(r[0]);this.isYearsOfExperienceQuestion(t)&&n<5&&(n=5);let s=n.toString();for(let a of e)if(a.includes(s))return a;return s}}if(this.isNoticePeriodOrStartDateQuestion(t)){if(t.toLowerCase().includes("2 months")||t.toLowerCase().includes("2 monate")){for(let n of e)if(n.toLowerCase().includes("2 months")||n.toLowerCase().includes("2 monate")||n.toLowerCase().includes("2 month"))return n;return t}let r=t.match(/\d{1,2}[.\/-]\d{1,2}[.\/-]\d{4}/);if(r){let n=r[0];for(let s of e)if(s.includes(n))return s;return n}}for(let r of e)if(r.toLowerCase()===t.toLowerCase())return r;for(let r of e)if(r.toLowerCase().includes(t.toLowerCase())||t.toLowerCase().includes(r.toLowerCase()))return r;if(t.toLowerCase().includes("germany")||t.toLowerCase().includes("deutsch")){for(let r of e)if(r.toLowerCase().includes("deutsch")||r.toLowerCase().includes("germany")||r.includes("+49"))return r}return e.length>1?e[1]:e[0]}async testConnection(){try{return await this.ensureSettingsLoaded(),(await this.aiSettingsManager.testConnection()).success}catch(t){return console.error("Error testing AI connection:",t),!1}}getAISettings(){return this.aiSettingsManager.getCurrentSettings()}clear(){this.user_data=null,this.formatted_text=null,this.aiSettingsManager.clear(),this.settingsLoadPromise=null}},U=I;export{U as default};
