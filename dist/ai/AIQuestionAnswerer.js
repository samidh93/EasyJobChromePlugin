var c=class{constructor(){this.model="qwen2.5:3b",this.user_data=null}async setUserContext(t,e=null){try{if(typeof t=="object"&&t!==null)this.user_data=t,this.formatted_text=e||this.formatUserDataAsText(),console.log("User context set with structured data");else if(typeof t=="string")this.user_data=null,this.formatted_text=t,console.log("User context set with formatted text only");else throw new Error("Invalid user data format");return console.log("User context set successfully"),{success:!0}}catch(r){return console.error("Error in setUserContext:",r),{success:!1,error:r.message}}}async answerQuestion(t,e=null,r=null){var n;try{console.log("Answering question:",t),console.log("Options:",e);let s=this.getDirectAnswer(t);if(s){if(console.log("Found direct answer:",s),e&&Array.isArray(e)&&e.length>0){let o=this.matchToOption(s,e);return console.log("Matched direct answer to option:",o),{success:!0,answer:o}}return{success:!0,answer:s}}if(r){let o=!1;if(typeof r=="function"?o=await r():r&&r.value!==void 0?o=r.value:o=!!r,o)return console.log("Stop requested before AI processing"),{success:!1,stopped:!0}}let a=this.buildEnhancedPrompt(t,e),l=await this.callOllamaAPIWithStop({model:this.model,prompt:a,stream:!1},r);if(l&&l.stopped)return{success:!1,stopped:!0};let i=((n=l==null?void 0:l.response)==null?void 0:n.trim())||"";return e&&Array.isArray(e)&&e.length>0&&(i=this.matchToOption(i,e)),console.log("Final answer:",i),{success:!0,answer:i||"Information not available"}}catch(s){return console.error("Error in answerQuestion:",s),{success:!0,answer:e&&Array.isArray(e)&&e.length>0?e.length>1?e[1]:e[0]:"Information not available"}}}getDirectAnswer(t){var n;if(!((n=this.user_data)!=null&&n.personal_information))return null;let e=this.user_data.personal_information,r=t.toLowerCase();return r.includes("email")||r.includes("e-mail")?e.email||null:r.includes("phone")||r.includes("mobile")||r.includes("telefon")?(e.phone_prefix?"".concat(e.phone_prefix).concat(e.phone):e.phone)||null:r.includes("first name")||r.includes("vorname")?e.name||null:r.includes("last name")||r.includes("surname")||r.includes("nachname")?e.surname||null:r.includes("country")&&!r.includes("code")&&e.country||null}buildEnhancedPrompt(t,e){let r=this.formatUserDataAsText(),n="Based on the following resume information, please answer the question accurately and concisely:\n\nRESUME:\n".concat(r,"\n\nQUESTION: ").concat(t);if(this.isYearsOfExperienceQuestion(t)&&(n+='\n\nIMPORTANT RULES FOR YEARS OF EXPERIENCE:\n- If asked for years of experience, provide ONLY a number between 0-99\n- Do NOT include words like "years", "Jahre", or descriptions\n- For skill levels: Beginner=1, Intermediate=3, Advanced=5+ years\n- Calculate based on work experience and skill level\n- If no specific experience found, estimate based on skill level\n- Example: "3" not "3 years" or "3 Jahre"'),this.isDegreeQuestion(t)&&(n+='\n\nIMPORTANT RULES FOR DEGREE QUESTIONS:\n- Check education section carefully for exact degree matches\n- "Bachelor" = "Bachelor of Engineering" or "Bachelor of Science"\n- "Master" = "Master of Engineering" or "Master of Science"\n- Answer "Ja" for German forms, "Yes" for English forms\n- If degree is found, answer positively\n- Look for exact degree names in education section'),this.isSkillLevelQuestion(t)&&(n+="\n\nIMPORTANT RULES FOR SKILL LEVEL QUESTIONS:\n- Check the skills section for exact skill matches\n- Look for the skill name and its level (Beginner/Intermediate/Advanced)\n- Be precise about the level mentioned in the resume\n- Do not guess or estimate levels"),e&&Array.isArray(e)&&e.length>0){let s=e.map(a=>'"'.concat(a,'"')).join(", ");n+="\nAvailable Options: [".concat(s,"]\n\nIMPORTANT: You MUST choose EXACTLY ONE option from the list above. Your answer should match one of the options EXACTLY as written.")}return n+="\n\nANSWER:",n}isYearsOfExperienceQuestion(t){let e=t.toLowerCase();return e.includes("jahre")||e.includes("years")||e.includes("experience")||e.includes("erfahrung")||e.includes("how many")||e.includes("wie viele")}isDegreeQuestion(t){let e=t.toLowerCase();return e.includes("bachelor")||e.includes("master")||e.includes("degree")||e.includes("abschluss")||e.includes("bildung")||e.includes("education")}isSkillLevelQuestion(t){let e=t.toLowerCase();return e.includes("level")||e.includes("niveau")||e.includes("skill")||e.includes("f\xE4higkeit")||e.includes("experience with")||e.includes("erfahrung mit")}formatUserDataAsText(){return this.formatted_text?this.formatted_text:this.user_data?typeof this.user_data=="string"?this.user_data:this.formatObject(this.user_data,0):"No user data available."}formatObject(t,e=0){let r="  ".repeat(e),n="";if(typeof t=="object"&&t!==null)if(Array.isArray(t))for(let s of t)typeof s=="object"&&s!==null?n+="".concat(r,"- ").concat(this.formatObject(s,e+1)):n+="".concat(r,"- ").concat(s,"\n");else for(let[s,a]of Object.entries(t)){let l=s.toUpperCase().replace(/_/g," ");n+="".concat(r).concat(l,":\n"),typeof a=="object"&&a!==null?n+=this.formatObject(a,e+1):n+="".concat(r,"  ").concat(a,"\n")}else n+="".concat(r).concat(t,"\n");return n}matchToOption(t,e){if(!t||!e||e.length===0)return(e==null?void 0:e.length)>0?e[0]:"Not available";if(this.isYearsOfExperienceQuestion(t)||/^\d+$/.test(t.trim())){let r=t.match(/\d+/);if(r){let n=r[0];for(let s of e)if(s.includes(n))return s;return n}}for(let r of e)if(r.toLowerCase()===t.toLowerCase())return r;for(let r of e)if(r.toLowerCase().includes(t.toLowerCase())||t.toLowerCase().includes(r.toLowerCase()))return r;if(t.toLowerCase().includes("germany")||t.toLowerCase().includes("deutsch")){for(let r of e)if(r.toLowerCase().includes("deutsch")||r.toLowerCase().includes("germany")||r.includes("+49"))return r}return e.length>1?e[1]:e[0]}async callOllamaAPI(t){try{return new Promise((e,r)=>{chrome.runtime.sendMessage({action:"callOllama",endpoint:"generate",data:t},n=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):n.success===!1?r(new Error(n.error||"Unknown error from Ollama API")):e(n.data)})})}catch(e){throw console.error("Error calling Ollama API:",e),e}}async callOllamaAPIWithStop(t,e=null){try{return new Promise((r,n)=>{let s=null;e&&(s=setInterval(async()=>{try{let a=!1;typeof e=="function"?a=await e():e&&e.value!==void 0?a=e.value:a=!!e,a&&(console.log("Stop requested during AI API call"),s&&clearInterval(s),r({stopped:!0}))}catch(a){console.error("Error in stop check:",a)}},500)),chrome.runtime.sendMessage({action:"callOllama",endpoint:"generate",data:t},a=>{s&&clearInterval(s),chrome.runtime.lastError?n(new Error(chrome.runtime.lastError.message)):a.success===!1?n(new Error(a.error||"Unknown error from Ollama API")):r(a.data)})})}catch(r){throw console.error("Error calling Ollama API:",r),r}}async checkOllamaConnection(){try{return new Promise((t,e)=>{chrome.runtime.sendMessage({action:"testOllama"},r=>{chrome.runtime.lastError?e(new Error(chrome.runtime.lastError.message)):r&&r.success?t(!0):e(new Error((r==null?void 0:r.error)||"Failed to connect to Ollama"))})})}catch(t){throw console.error("Error checking Ollama connection:",t),t}}},f=c;export{f as default};
