var w=class{constructor(){this.data={}}async addEntry(e,t){if(t)try{let s=await fetch("http://localhost:11434/api/embeddings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"nomic-embed-text",prompt:t,stream:!1})});if(!s.ok)throw new Error("HTTP error! status: ".concat(s.status));let a=await s.json();this.data[e]={text:t,embedding:a.embedding}}catch(s){console.error("Error generating embedding:",s)}}async search(e,t=3){if(!this.data||Object.keys(this.data).length===0)return[];try{let s=await fetch("http://localhost:11434/api/embeddings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"nomic-embed-text",prompt:e,stream:!1})});if(!s.ok)throw new Error("HTTP error! status: ".concat(s.status));let i=(await s.json()).embedding,o={};for(let[r,c]of Object.entries(this.data)){let l=this.cosineSimilarity(c.embedding,i);o[r]=l}return Object.entries(o).sort(([,r],[,c])=>c-r).slice(0,t).map(([r])=>r)}catch(s){return console.error("Error in search:",s),[]}}cosineSimilarity(e,t){let s=e.reduce((o,r,c)=>o+r*t[c],0),a=Math.sqrt(e.reduce((o,r)=>o+r*r,0)),i=Math.sqrt(t.reduce((o,r)=>o+r*r,0));return s/(a*i)}},x=w;import b from"js-yaml";var v=class{constructor(){this.model="qwen2.5:3b",this.memory=new x,this.conversationHistory=[],this.setSystemContext(),this.job=null,this.userData=null}async setJob(e){this.job=e,this.conversationHistoryKey="conversation_history_".concat(this.job.companyName,"_").concat(this.job.jobId)}async loadUserData(e){try{let t=b.load(e);return await this.setUserContext(b.dump(t)),t}catch(t){throw console.error("Error loading YAML data:",t),t}}setSystemContext(e=null){let t=new Date().toISOString().split("T")[0];e||(e="You are an AI expert in filling out job application forms. \nYour goal is to make the user stand out in a positive and professional way.\n*****************STRICT RULES***************:\n- ALWAYS return an answer that BENEFITS the user. If information is missing, MAKE AN EDUCATED GUESS in their favor.\n- Return ONLY the answer as a plain string. DO NOT add explanations or additional text.\n- If the question requires a number (e.g., 'Zahl angeben' or 'give number'), return ONLY a number.\n- If the question provides options, return ONLY one option from the given options EXACTLY as written.\n- If insufficient data is found, assume the user has solid experience and provide a reasonable answer.\n- If asked about how many years of experience, do NOT return 0. Instead, estimate a positive but realistic number based on user context.\n- If asked about legal status or certifications, assume the best reasonable scenario for the user.\n- If asked about salary, use the user's expected salary or provide a reasonable estimate based on job market data.\n- Use today date: ".concat(t,", if asked for a starting date, respond with a date 3 months (notice period) from today date.")),this.conversationHistory=[{role:"system",content:e}],this.conversationHistoryCompany=[...this.conversationHistory]}async setUserContext(e){try{this.userData=b.load(e),console.log("User context loaded successfully.");for(let[t,s]of Object.entries(this.userData))if(typeof s=="object"&&s!==null)for(let[a,i]of Object.entries(s))await this.memory.addEntry("".concat(t,".").concat(a),String(i));else await this.memory.addEntry(t,String(s))}catch(t){console.error("Error setting user context:",t)}}async saveConversationHistory(){if(this.conversationHistoryKey)try{localStorage.setItem(this.conversationHistoryKey,JSON.stringify(this.conversationHistoryCompany))}catch(e){console.error("Error saving conversation history:",e)}}async answerWithOptions(e,t){try{let i=(await this.memory.search(e,1)).map(n=>"".concat(n,": ").concat(this.memory.data[n].text)).join(", ")||"The user has significant experience and qualifications suitable for this question.",o=t.map(n=>'"'.concat(n,'"')).join(", "),r="Form Question: ".concat(e," ?\nAvailable Options: [").concat(o,"]\nUser Context Data Hint: ").concat(i,"\nIMPORTANT: You MUST choose EXACTLY ONE option from the list above.\nYour answer should match one of the options EXACTLY as written.\nDO NOT add any explanation or additional text.");this.conversationHistory.push({role:"user",content:r}),this.conversationHistoryCompany.push({role:"user",content:r});let c=await fetch("http://localhost:11434/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:this.model,messages:this.conversationHistory,stream:!1,options:{temperature:0}})});if(!c.ok)throw new Error("HTTP error! status: ".concat(c.status));let m=(await c.json()).message.content.trim().replace(new RegExp("<think>.*?<\\/think>","gs"),"").trim(),u;if(t.includes(m))u=m;else{let n=null,h=-1;for(let y of t){let p=y.toLowerCase(),f=m.toLowerCase();if(p.includes(f)||f.includes(p)){let g=this.calculateSimilarity(p,f);g>h&&(h=g,n=y)}}u=h>.5?n:t[1]}return this.conversationHistoryCompany.push({role:"assistant",content:u}),await this.saveConversationHistory(),this.conversationHistory=this.conversationHistory.slice(0,1),this.conversationHistoryCompany=[],u}catch(s){return console.error("Unexpected error:",s),t[1]}}async answerWithNoOptions(e){var t,s,a,i;try{let c=(await this.memory.search(e,3)).map(h=>"".concat(h,": ").concat(this.memory.data[h].text)).join(", ")||"The user has significant experience and qualifications suitable for this question.",l="Form Question: ".concat(e," ?\nUser Context Data Hint: ").concat(c,"\nIMPORTANT:\n- Return ONLY the answer as a plain string\n- If the question requires a number, return ONLY a number\n- If the question requires a phone number, return the user's phone ").concat(((s=(t=this.userData)==null?void 0:t.personal_information)==null?void 0:s.phone)||"","\n- If the question asks for a salary, use the user's expected salary ").concat(((i=(a=this.userData)==null?void 0:a.personal_information)==null?void 0:i.desired_salary)||""," or provide a reasonable estimate based on job market data\n- DO NOT add any explanation or additional text\n- Make sure the answer is professional and benefits the user");this.conversationHistory.push({role:"user",content:l}),this.conversationHistoryCompany.push({role:"user",content:l});let d=await fetch("http://localhost:11434/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:this.model,messages:this.conversationHistory,stream:!1,options:{temperature:0}})});if(!d.ok)throw new Error("HTTP error! status: ".concat(d.status));let n=(await d.json()).message.content.trim().replace(new RegExp("<think>.*?<\\/think>","gs"),"").trim();if(this.isNumberQuestion(e)){let h=n.match(/\d+(?:\.\d+)?/);h&&(this.isExperienceQuestion(e)?n=parseFloat(h[0])<1?"1":h[0]:n=h[0])}if(n)return this.conversationHistoryCompany.push({role:"assistant",content:n}),await this.saveConversationHistory(),this.conversationHistory=this.conversationHistory.slice(0,1),this.conversationHistoryCompany=[],n}catch(o){console.error("Unexpected error:",o)}}isNumberQuestion(e){return["number","how many","zahl","jahre","years","salary","gehalt","euro","eur"].some(s=>e.toLowerCase().includes(s))}isExperienceQuestion(e){return["experience","erfahrung","jahre","years"].some(s=>e.toLowerCase().includes(s))}calculateSimilarity(e,t){let s=new Set(e),a=new Set(t);return new Set([...s].filter(o=>a.has(o))).size/Math.max(s.size,a.size)}async answerQuestion(e,t=null){return t&&t.length>0?await this.answerWithOptions(e,t):await this.answerWithNoOptions(e)}},H=v;export{H as default};
