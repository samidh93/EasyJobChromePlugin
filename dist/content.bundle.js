var z=Object.defineProperty,V=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var U=(u,e,t)=>e in u?z(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t,A=(u,e)=>{for(var t in e||(e={}))W.call(e,t)&&U(u,t,e[t]);if(F)for(var t of F(e))H.call(e,t)&&U(u,t,e[t]);return u},k=(u,e)=>V(u,X(e));var E=class{static async wait(e=1e3){await new Promise(t=>setTimeout(t,e))}static debugLog(e){console.log("[".concat(this.constructor.name,"] ").concat(e))}static errorLog(e,t){console.error("[".concat(this.constructor.name,"] ").concat(e,":"),t)}},y=E;var _=class extends y{static async getTotalJobsSearchCount(e){try{await this.wait();let t=e.querySelector(".jobs-search-results-list__subtitle");if(t){let r=t.textContent.trim(),n=parseInt(r.split(" ")[0].replace(/,/g,"").replace(/\./g,"").replace(/\+/g,""));return this.debugLog("Total jobs found: ".concat(n)),n}else return this.debugLog("No results found"),0}catch(t){return this.errorLog("Error fetching total jobs count",t),0}}static async getAvailablePages(e,t){try{await this.wait();let r=e.querySelector('ul[class*="jobs-search-pagination__pages"]');if(!r)return this.debugLog("Pagination list not found."),0;let n=r.querySelectorAll("li");if(n.length===0)return this.debugLog("No pagination items found."),0;let s=n[n.length-1];this.debugLog("Last page: ".concat(s));let o=Math.ceil(t/25);return this.debugLog("Total pages available: ".concat(o)),o}catch(r){return this.errorLog("Error fetching available pages",r),0}}static async getListOfJobsOnPage(e){try{await this.wait();let t=e.querySelector(".scaffold-layout__list");if(!t)return this.debugLog("Jobs container not found."),[];let r=t.querySelectorAll("li[class*='scaffold-layout__list-item']");return this.debugLog("Found ".concat(r.length," jobs on this page.")),Array.from(r)}catch(t){return this.errorLog("Error fetching list of jobs",t),[]}}static async goToNextPage(){try{await this.wait();let e=document.querySelector('button[aria-label="View next page"]')||document.querySelector("button.jobs-search-pagination__button--next")||document.querySelector('button[aria-label="Next"]');return e&&!e.disabled?(this.debugLog("Found next page button, clicking..."),e.click(),this.debugLog("Clicked next page button"),await this.wait(3e3),!0?(this.debugLog("Successfully navigated to next page"),!0):(this.debugLog("Jobs failed to load on next page"),!1)):(this.debugLog("Next page button not found or disabled - likely on last page"),!1)}catch(e){return this.errorLog("Error navigating to next page",e),!1}}static async isOnLastPage(){try{let e=document.querySelector('button[aria-label="View next page"]')||document.querySelector("button.jobs-search-pagination__button--next");return!e||e.disabled}catch(e){return this.errorLog("Error checking if on last page",e),!0}}},v=_;var I=class extends y{static async getJobClickableElement(e){try{await this.wait();let t=e.querySelector("a");return t||(this.debugLog("Could not find clickable element for job"),null)}catch(t){return this.errorLog("Error fetching clickable element",t),null}}static async scrollDownToLoadNextJob(e){try{await this.wait(),e.scrollIntoView({behavior:"smooth",block:"center"}),this.debugLog("Scrolled down to load next job")}catch(t){this.errorLog("Error scrolling down to load next job",t)}}static async clickOnJob(e){try{e.click(),this.debugLog("Clicked on job element")}catch(t){this.debugLog("Could not click on job element",t)}}static async isEasyButtonAvailable(){try{return document.querySelector(".jobs-s-apply button")?(this.debugLog("found easy apply button"),!0):(this.debugLog("easy apply button not found"),!1)}catch(e){return console.error("easy apply button not found error",e),!1}}static async clickEasyApply(){try{let e=document.querySelector(".jobs-s-apply button");if(e)return e.click(),this.debugLog("Clicked on easy apply button"),!0;throw new Error("Easy apply button not found")}catch(e){throw this.errorLog("Error clicking on easy apply button",e),e}}},S=I;var x=class extends y{static async getJobId(){try{let e=new URLSearchParams(window.location.search).get("currentJobId");return e?(this.debugLog("Found job ID: ".concat(e)),e):(this.debugLog("Job ID not found in URL"),null)}catch(e){return this.errorLog("Error getting job ID",e),null}}static async getJobTitle(){try{let e=document.querySelector(".job-details-jobs-unified-top-card__job-title h1");if(e){let t=e.textContent.trim();return this.debugLog("Found job title: ".concat(t)),t}return this.debugLog("Job title not found"),null}catch(e){return this.errorLog("Error getting job title",e),null}}static async getCompanyName(){try{let e=document.querySelector(".job-details-jobs-unified-top-card__company-name a");if(e){let t=e.textContent.trim();return this.debugLog("Found company name: ".concat(t)),t}return this.debugLog("Company name not found"),null}catch(e){return this.errorLog("Error getting company name",e),null}}static async getLocation(){try{let e=document.querySelector(".job-details-jobs-unified-top-card__tertiary-description-container .tvm__text");if(e){let t=e.textContent.trim();return this.debugLog("Found location: ".concat(t)),t}return this.debugLog("Location not found"),null}catch(e){return this.errorLog("Error getting location",e),null}}static async getJobType(){try{let e=document.querySelectorAll("button.job-details-preferences-and-skills .job-details-preferences-and-skills__pill");if(e.length>1){let r=e[1].querySelectorAll("span");if(r.length>0){let n=r[0].querySelectorAll("span");if(n.length>0){let s=n[0].textContent.trim();if(s)return this.debugLog("Found jobType type: ".concat(s)),s}}}return this.debugLog("jobType type not found"),null}catch(e){return this.errorLog("Error getting jobType type",e),null}}static async getRemoteType(){try{let e=document.querySelectorAll("button.job-details-preferences-and-skills .job-details-preferences-and-skills__pill");if(e.length>0){let r=e[0].querySelectorAll("span");if(r.length>0){let n=r[0].querySelectorAll("span");if(n.length>0){let s=n[0].textContent.trim();if(s)return this.debugLog("Found remote type: ".concat(s)),s}}}return this.debugLog("Remote type not found"),null}catch(e){return this.errorLog("Error getting remote type",e),null}}static async getJobDescription(){try{let e=document.querySelector(".jobs-description__content");if(e){let t=e.textContent.trim();return this.debugLog("Found job description"),t}return this.debugLog("Job description not found"),null}catch(e){return this.errorLog("Error getting job description",e),null}}static async getApplicantCount(){try{let e=document.querySelectorAll(".job-details-jobs-unified-top-card__tertiary-description-container .tvm__text"),t=e.length>0?e[e.length-1]:null;if(t){let r=t.textContent.trim();return this.debugLog("Found applicant count: ".concat(r)),r}return this.debugLog("Applicant count not found"),null}catch(e){return this.errorLog("Error getting applicant count",e),null}}static async getPostedDate(){try{let e=document.querySelectorAll(".job-details-jobs-unified-top-card__tertiary-description-container .tvm__text")[2];if(e){let t=e.textContent.trim();return this.debugLog("Found posted date: ".concat(t)),t}return this.debugLog("posted date not found"),null}catch(e){return this.errorLog("Error getting applicant count",e),null}}static async getAllJobInfo(){try{let e={jobId:await this.getJobId(),title:await this.getJobTitle(),company:await this.getCompanyName(),location:await this.getLocation(),jobType:await this.getJobType(),remoteType:await this.getRemoteType(),description:await this.getJobDescription(),applicantCount:await this.getApplicantCount(),postedDate:await this.getPostedDate()};return this.debugLog("Retrieved all job information"),e}catch(e){return this.errorLog("Error getting all job information",e),null}}},C=x;var T=class{constructor(){this.currentSettings=null,this.defaultModel="qwen2.5:3b",this.settingsLoadPromise=null}async loadAISettings(e){try{if(console.log("AISettingsManager: Loading AI settings for user:",e),!e||typeof e!="string"||e.length!==36)return console.error("AISettingsManager: Invalid user ID provided:",e),console.log("AISettingsManager: Returning default settings (ollama)"),this.getDefaultSettings();console.log("AISettingsManager: Making API request to load settings...");let t=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/users/".concat(e,"/ai-settings/default")});return t&&t.success?(this.currentSettings=t.ai_settings,console.log("AISettingsManager: Successfully loaded AI settings"),this.currentSettings):(console.warn("AISettingsManager: No AI settings found, using default"),console.log("AISettingsManager: Response was:",t),this.getDefaultSettings())}catch(t){return console.error("AISettingsManager: Error loading AI settings:",t),this.getDefaultSettings()}}getDefaultSettings(){return console.log("AISettingsManager: No AI settings configured - user must set up AI first"),null}getCurrentSettings(){return this.currentSettings}setSettings(e){this.currentSettings=e,console.log("AISettingsManager: Settings updated:",e)}getModel(){let e=this.getCurrentSettings();return e&&(e.ai_model||e.model)||null}getProvider(){let e=this.getCurrentSettings();return e&&(e.ai_provider||e.provider)||null}async getDecryptedApiKey(){let e=this.getCurrentSettings();if(!e)return null;if(e.apiKey&&e.apiKey!=="encrypted")return e.apiKey;if(e.api_key_encrypted&&e.id)try{let t=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/ai-settings/".concat(e.id,"/encrypted-key")});if(t&&t.success&&t.api_key_encrypted){let r=await chrome.runtime.sendMessage({action:"apiRequest",method:"POST",url:"/ai-settings/decrypt-api-key",data:{encryptedApiKey:t.api_key_encrypted}});if(r&&r.success)return e.apiKey=r.decryptedApiKey,r.decryptedApiKey}}catch(t){throw console.error("AISettingsManager: Error fetching/decrypting API key:",t),new Error("Failed to retrieve API key")}return null}async testConnection(){try{let e=this.getProvider();return e==="ollama"?await chrome.runtime.sendMessage({action:"testOllama"}):e==="openai"?await chrome.runtime.sendMessage({action:"testOpenAI"}):this.getCurrentSettings().apiKey?{success:!0,message:"".concat(e," settings validated")}:{success:!1,error:"API key required for ".concat(e)}}catch(e){return console.error("AISettingsManager: Error testing connection:",e),{success:!1,error:e.message}}}async callAI(e){try{let t=this.getProvider(),r=this.getModel(),n=0;if(e.prompt?n=this.estimateTokens(e.prompt):e.messages&&(n=this.estimateTokensFromMessages(e.messages)),t==="ollama"){let s=k(A({},e),{model:r}),o=await chrome.runtime.sendMessage({action:"callOllama",endpoint:"generate",data:s});if(o.success===!1)throw new Error(o.error||"Unknown error from Ollama API");return o.data}else if(t==="openai"){let s=await this.getDecryptedApiKey();if(!s)throw new Error("OpenAI API key is required");let o=k(A({},e),{model:r,apiKey:s});console.log("Sending OpenAI request:",k(A({},o),{apiKey:"[REDACTED]"}));let c=await chrome.runtime.sendMessage({action:"callOpenAI",data:o});if(c.success===!1)throw new Error(c.error||"Unknown error from OpenAI API");return c.data}else throw new Error("Provider ".concat(t," not yet implemented"))}catch(t){throw console.error("AISettingsManager: Error calling AI API:",t),t}}async callAIWithStop(e,t=null){try{let r=this.getProvider();if(r==="ollama"){let n=this.getModel(),s=k(A({},e),{model:n});return new Promise((o,c)=>{let i=null;t&&(i=setInterval(async()=>{try{let a=!1;typeof t=="function"?a=await t():t&&t.value!==void 0?a=t.value:a=!!t,a&&(console.log("Stop requested during AI API call"),i&&clearInterval(i),o({stopped:!0}))}catch(a){console.error("Error in stop check:",a)}},500)),chrome.runtime.sendMessage({action:"callOllama",endpoint:"generate",data:s},a=>{i&&clearInterval(i),chrome.runtime.lastError?c(new Error(chrome.runtime.lastError.message)):a.success===!1?c(new Error(a.error||"Unknown error from Ollama API")):o(a.data)})})}else if(r==="openai"){let n=this.getModel(),s=await this.getDecryptedApiKey();if(!s)throw new Error("OpenAI API key is required");return new Promise((o,c)=>{let i=null;t&&(i=setInterval(async()=>{try{let a=!1;typeof t=="function"?a=await t():t&&t.value!==void 0?a=t.value:a=!!t,a&&(console.log("Stop requested during OpenAI API call"),i&&clearInterval(i),o({stopped:!0}))}catch(a){console.error("Error in stop check:",a)}},500)),chrome.runtime.sendMessage({action:"callOpenAI",data:k(A({},e),{model:n,apiKey:s})},a=>{i&&clearInterval(i),chrome.runtime.lastError?c(new Error(chrome.runtime.lastError.message)):a.success===!1?c(new Error(a.error||"Unknown error from OpenAI API")):o(a.data)})})}else throw new Error("Provider ".concat(r," not yet implemented"))}catch(r){throw console.error("AISettingsManager: Error calling AI API with stop:",r),r}}async loadAvailableModels(){try{let e=this.getProvider();if(e==="ollama"){let t=await chrome.runtime.sendMessage({action:"ollamaRequest",method:"GET",url:"/api/tags"});if(t&&t.success)return t.models.map(r=>r.name);throw new Error((t==null?void 0:t.error)||"Failed to load Ollama models")}else throw new Error("Provider ".concat(e," not yet implemented"))}catch(e){throw console.error("AISettingsManager: Error loading models:",e),e}}estimateTokens(e){if(!e)return 0;let t=e.length;return Math.ceil(t/4)}estimateTokensFromMessages(e){if(!e||!Array.isArray(e))return 0;let t=0;for(let r of e)r.content&&(t+=this.estimateTokens(r.content)),t+=4;return t}getTokenAnalysis(e){let t={inputTokens:0,estimatedOutputTokens:0,maxTokens:e.max_tokens||1e3,provider:this.getProvider(),model:this.getModel()};return e.prompt?t.inputTokens=this.estimateTokens(e.prompt):e.messages&&(t.inputTokens=this.estimateTokensFromMessages(e.messages)),t.estimatedOutputTokens=Math.min(t.maxTokens,100),t}clear(){this.currentSettings=null,this.settingsLoadPromise=null}},Q=T;var q=class{constructor(e){this.aiSettingsManager=e,this.classificationCache=new Map}async classifyQuestion(e){let t=e.toLowerCase().trim();if(this.classificationCache.has(t))return console.log("AIQuestionClassifier: Using cached classification"),this.classificationCache.get(t);try{let r=this.buildClassificationPrompt(e);console.log("AIQuestionClassifier: Classifying question with AI");let n=await this.aiSettingsManager.callAI({prompt:r,max_tokens:200,temperature:.1,stream:!1}),s=this.parseClassificationResponse(n);return s=this.validateClassification(s,e),this.classificationCache.set(t,s),console.log("AIQuestionClassifier: Classification result:",s),s}catch(r){return console.error("AIQuestionClassifier: Error classifying question:",r),this.getFallbackClassification(e)}}buildClassificationPrompt(e){return'You are an expert at analyzing job application questions. Classify the following question and extract relevant keywords.\n\nQUESTION: "'.concat(e,'"\n\nAnalyze and return ONLY a JSON object with these fields:\n{\n  "question_type": "one of: language_proficiency|skill_level|years_experience|education|personal|salary|availability|notice_period|visa_status|general",\n  "keywords": ["array", "of", "relevant", "keywords"],\n  "confidence": 0.95,\n  "language": "en|de|fr|es",\n  "expected_format": "text|number|selection|boolean"\n}\n\nCLASSIFICATION RULES:\n- language_proficiency: Questions about language skills (German, English, etc.)\n- skill_level: Questions about proficiency in technologies/tools\n- years_experience: Questions asking for number of years of experience\n- education: Questions about degrees, universities, graduation\n- personal: Questions about name, contact, location, citizenship\n- salary: Questions about salary expectations or current salary\n- availability: Questions about start date, availability\n- notice_period: Questions about notice period or current employment\n- visa_status: Questions about visa, work permit, citizenship\n- general: Any other questions\n\nKEYWORD EXTRACTION:\n- Extract specific technologies, languages, skills mentioned\n- Normalize to common terms (e.g., "JS" \u2192 "JavaScript", "Deutsch" \u2192 "German")\n- Include variations and synonyms\n\nEXAMPLES:\nQ: "Wie gut beherrschen Sie Deutsch?" \u2192 {"question_type":"language_proficiency","keywords":["German"],"confidence":0.95,"language":"de","expected_format":"selection"}\nQ: "How many years of experience do you have with Python?" \u2192 {"question_type":"years_experience","keywords":["Python"],"confidence":0.9,"language":"en","expected_format":"number"}\nQ: "What is your proficiency level in SAP?" \u2192 {"question_type":"skill_level","keywords":["SAP"],"confidence":0.9,"language":"en","expected_format":"selection"}\n\nReturn ONLY the JSON object:')}parseClassificationResponse(e){var t,r,n;try{let s="";if(e!=null&&e.response)s=e.response.trim();else if((n=(r=(t=e==null?void 0:e.choices)==null?void 0:t[0])==null?void 0:r.message)!=null&&n.content)s=e.choices[0].message.content.trim();else throw new Error("Unexpected AI response format");let o=s.match(/\{[\s\S]*\}/);if(o)return JSON.parse(o[0]);throw new Error("No JSON found in response")}catch(s){throw console.error("AIQuestionClassifier: Error parsing classification response:",s),s}}validateClassification(e,t){return{question_type:["language_proficiency","skill_level","years_experience","education","personal","salary","availability","notice_period","visa_status","general"].includes(e.question_type)?e.question_type:"general",keywords:Array.isArray(e.keywords)?e.keywords:[],confidence:typeof e.confidence=="number"?e.confidence:.5,language:e.language||"en",expected_format:e.expected_format||"text"}}getFallbackClassification(e){let t=e.toLowerCase();return t.includes("deutsch")||t.includes("german")||t.includes("english")||t.includes("sprache")||t.includes("language")?{question_type:"language_proficiency",keywords:this.extractLanguageKeywords(t),confidence:.7,language:t.includes("deutsch")?"de":"en",expected_format:"selection"}:t.includes("jahr")||t.includes("year")||t.includes("erfahrung")||t.includes("experience")?{question_type:"years_experience",keywords:[],confidence:.6,language:t.includes("jahr")?"de":"en",expected_format:"number"}:{question_type:"general",keywords:[],confidence:.3,language:"en",expected_format:"text"}}extractLanguageKeywords(e){let t={deutsch:"German",german:"German",english:"English",englisch:"English",french:"French",franz\u00F6sisch:"French",spanish:"Spanish",spanisch:"Spanish",arabic:"Arabic",arabisch:"Arabic"},r=[];for(let[n,s]of Object.entries(t))e.includes(n)&&r.push(s);return r}clearCache(){this.classificationCache.clear(),console.log("AIQuestionClassifier: Cache cleared")}getCacheStats(){return{size:this.classificationCache.size,keys:Array.from(this.classificationCache.keys())}}},J=q;var R=class{constructor(){this.dataCache=new Map}async getRelevantData(e,t){if(!e||!t)return console.log("AISmartDataRetriever: Missing classification or resumeId"),null;let r="".concat(t,"_").concat(e.question_type,"_").concat(e.keywords.join(","));if(this.dataCache.has(r))return console.log("AISmartDataRetriever: Using cached data"),this.dataCache.get(r);try{console.log("AISmartDataRetriever: Retrieving data for type: ".concat(e.question_type,", keywords: ").concat(e.keywords.join(", ")));let n=null;switch(console.log('AISmartDataRetriever: Switch statement with question_type: "'.concat(e.question_type,'"')),e.question_type){case"language_proficiency":console.log("AISmartDataRetriever: Matched language_proficiency case"),n=await this.getLanguageData(t,e.keywords),console.log("AISmartDataRetriever: getLanguageData returned:",n?Object.keys(n):"null");break;case"skill_level":case"years_experience":n=await this.getSkillExperienceData(t,e.keywords);break;case"education":n=await this.getEducationData(t,e.keywords);break;case"personal":case"visa_status":n=await this.getPersonalData(t);break;case"salary":case"availability":case"notice_period":n=await this.getEmploymentData(t);break;default:console.log('AISmartDataRetriever: Hit default case for question_type: "'.concat(e.question_type,'"')),n=await this.getGeneralData(t,e.keywords)}return n&&this.dataCache.set(r,n),console.log("AISmartDataRetriever: Retrieved data:",n?Object.keys(n):"null"),n}catch(n){return console.error("AISmartDataRetriever: Error retrieving relevant data:",n),null}}async getLanguageData(e,t){try{console.log("AISmartDataRetriever: getLanguageData called with keywords:",t);let r=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(e,"/relevant-data?questionType=language_proficiency")});if(console.log("AISmartDataRetriever: API response:",r),r&&r.success&&r.relevantData){let n=r.relevantData;if(console.log("AISmartDataRetriever: languageData received:",n),t.length>0&&n.languages){let s=n.languages.filter(o=>{var i;let c=((i=o.language)==null?void 0:i.toLowerCase())||"";return t.some(a=>c.includes(a.toLowerCase())||a.toLowerCase().includes(c))});if(s.length>0)return{languages:s}}return n}return null}catch(r){return console.error("AISmartDataRetriever: Error getting language data:",r),null}}async getSkillExperienceData(e,t){try{let r=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(e,"/relevant-data?questionType=skills")});if(r&&r.success&&r.relevantData){let n=r.relevantData,s={};if(t.length>0&&n.skills){let o=n.skills.filter(c=>{var g,m;let i=((g=c.name)==null?void 0:g.toLowerCase())||"",a=((m=c.category)==null?void 0:m.toLowerCase())||"";return t.some(h=>i.includes(h.toLowerCase())||a.includes(h.toLowerCase())||h.toLowerCase().includes(i))});o.length>0&&(s.skills=o)}if(t.length>0&&n.experiences){let o=n.experiences.filter(c=>{let i=JSON.stringify(c).toLowerCase();return t.some(a=>i.includes(a.toLowerCase()))});o.length>0&&(s.experiences=o.map(c=>{var i;return{company:c.company,position:c.position,employment_period:c.employment_period,skills_acquired:c.skills_acquired||[],key_responsibilities:((i=c.key_responsibilities)==null?void 0:i.filter(a=>{var m;let g=((m=a.description)==null?void 0:m.toLowerCase())||"";return t.some(h=>g.includes(h.toLowerCase()))}))||[]}}))}return n.personal_info&&(s.personal_info={years_of_experience:n.personal_info.years_of_experience}),Object.keys(s).length>0?s:n}return null}catch(r){return console.error("AISmartDataRetriever: Error getting skill/experience data:",r),null}}async getEducationData(e,t){try{let r=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(e,"/relevant-data?questionType=education")});return r&&r.success&&r.relevantData?r.relevantData:null}catch(r){return console.error("AISmartDataRetriever: Error getting education data:",r),null}}async getPersonalData(e){try{let t=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(e,"/relevant-data?questionType=personal")});return t&&t.success&&t.relevantData?t.relevantData:null}catch(t){return console.error("AISmartDataRetriever: Error getting personal data:",t),null}}async getEmploymentData(e){try{let t=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(e,"/relevant-data?questionType=personal")});if(t&&t.success&&t.relevantData){let r=t.relevantData.personal_info||{};return{personal_info:{salary:r.salary,location:r.location,visa_required:r.visa_required,years_of_experience:r.years_of_experience}}}return null}catch(t){return console.error("AISmartDataRetriever: Error getting employment data:",t),null}}async getGeneralData(e,t){var r,n,s,o,c;try{let i=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/resumes/".concat(e,"/relevant-data?questionType=general")});if(i&&i.success&&i.relevantData){let a=i.relevantData;return{personal_info:{name:(r=a.personal_info)==null?void 0:r.name,years_of_experience:(n=a.personal_info)==null?void 0:n.years_of_experience,location:(s=a.personal_info)==null?void 0:s.location},summary:a.summary,skills:((o=a.skills)==null?void 0:o.slice(0,5))||[],experiences:((c=a.experiences)==null?void 0:c.slice(0,2))||[]}}return null}catch(i){return console.error("AISmartDataRetriever: Error getting general data:",i),null}}generateFallbackResponse(e,t=null){if(!t||!Array.isArray(t)||t.length===0)return null;switch(console.log("AISmartDataRetriever: Generating fallback response for:",e.question_type),e.question_type){case"language_proficiency":if(t.includes("Gut"))return"Gut";if(t.includes("Verhandlungssicher"))return"Verhandlungssicher";if(t.includes("Good"))return"Good";if(t.includes("Intermediate"))return"Intermediate";break;case"years_experience":return"5";case"skill_level":if(t.includes("Intermediate"))return"Intermediate";if(t.includes("Good"))return"Good";if(t.includes("Mittel"))return"Mittel";break;case"visa_status":if(t.includes("No"))return"No";if(t.includes("Nein"))return"Nein";break}return t.length>1?t[1]:t[0]}clearCache(){this.dataCache.clear(),console.log("AISmartDataRetriever: Cache cleared")}getCacheStats(){return{size:this.dataCache.size,keys:Array.from(this.dataCache.keys())}}},B=R;var P=class{constructor(e=null){this.userId=e,this.user_data=null,this.formatted_text=null,this.aiSettingsManager=new Q,this.settingsLoadPromise=null,this.questionClassifier=new J(this.aiSettingsManager),this.smartDataRetriever=new B,e&&(this.settingsLoadPromise=this.aiSettingsManager.loadAISettings(e))}async setUserId(e){this.userId=e,e&&(this.settingsLoadPromise=this.aiSettingsManager.loadAISettings(e),await this.settingsLoadPromise)}async ensureSettingsLoaded(){this.settingsLoadPromise&&(await this.settingsLoadPromise,this.settingsLoadPromise=null)}setModel(e){if(e&&typeof e=="string"){let t=this.aiSettingsManager.getCurrentSettings(),r=k(A({},t),{model:e});this.aiSettingsManager.setSettings(r),console.log("AIQuestionAnswerer: Model overridden to: ".concat(e))}}async setUserContext(e,t=null){try{if(typeof e=="object"&&e!==null)this.user_data=e,this.formatted_text=t||this.formatUserDataAsText(),console.log("User context set with structured data");else if(typeof e=="string")this.user_data=null,this.formatted_text=e,console.log("User context set with formatted text only");else throw new Error("Invalid user data format");return console.log("User context set successfully"),{success:!0}}catch(r){return console.error("Error in setUserContext:",r),{success:!1,error:r.message}}}async answerQuestion(e,t=null,r=null,n=null){var s,o,c;try{await this.ensureSettingsLoaded(),console.log("AIQuestionAnswerer: Processing question: ".concat(e));let i=null,a=null;try{i=await this.questionClassifier.classifyQuestion(e),console.log("AIQuestionAnswerer: Question classified as:",i)}catch(f){console.error("AIQuestionAnswerer: Classification failed, using fallback:",f),i={question_type:"general",keywords:[],confidence:.3}}if(n&&i)try{a=await this.smartDataRetriever.getRelevantData(i,n),console.log("AIQuestionAnswerer: Retrieved relevant data:",a?Object.keys(a):"null")}catch(f){console.error("AIQuestionAnswerer: Smart data retrieval failed:",f)}let g=this.getDirectAnswer(e,a);if(g)return console.log("AIQuestionAnswerer: Found direct answer:",g),t&&Array.isArray(t)&&t.length>0?{success:!0,answer:this.matchToOption(g,t)}:{success:!0,answer:g};if(!a||Object.keys(a).length===0){console.log("AIQuestionAnswerer: No relevant data found, trying intelligent fallback");let f=this.smartDataRetriever.generateFallbackResponse(i,t);if(f)return console.log("AIQuestionAnswerer: Using intelligent fallback answer:",f),{success:!0,answer:f}}if(r){let f=!1;if(typeof r=="function"?f=await r():r&&r.value!==void 0?f=r.value:f=!!r,f)return console.log("AIQuestionAnswerer: Stop requested before AI processing"),{success:!1,stopped:!0}}let m=this.buildSmartPrompt(e,t,a,i);console.log("=== SMART PROMPT BEING SENT ==="),console.log(m),console.log("=== END SMART PROMPT ===");let h=this.aiSettingsManager.getTokenAnalysis({prompt:m});console.log("Token Analysis:",h);let l=await this.aiSettingsManager.callAIWithStop({prompt:m,stream:!1},r);if(l&&l.stopped)return{success:!1,stopped:!0};let d="";if(l!=null&&l.response?d=l.response.trim():(c=(o=(s=l==null?void 0:l.choices)==null?void 0:s[0])==null?void 0:o.message)!=null&&c.content?d=l.choices[0].message.content.trim():(console.warn("AIQuestionAnswerer: Unexpected AI response format:",l),d=""),console.log("AIQuestionAnswerer: Raw AI response:",d),i.question_type==="years_experience"&&/^\d+$/.test(d)){let f=parseInt(d);f<5&&(d="5",console.log("AIQuestionAnswerer: Enforced minimum 5 years for experience question, was: ".concat(f)))}return t&&Array.isArray(t)&&t.length>0&&(d=this.matchToOption(d,t)),{success:!0,answer:d||"Information not available"}}catch(i){console.error("AIQuestionAnswerer: Error in answerQuestion:",i);let a="Information not available";return classification&&t&&(a=this.smartDataRetriever.generateFallbackResponse(classification,t)),!a&&t&&Array.isArray(t)&&t.length>0&&(a=t.length>1?t[1]:t[0]),console.log("AIQuestionAnswerer: Using fallback answer:",a),{success:!1,answer:a,error:i.message}}}detectQuestionType(e){let t=e.toLowerCase();return t.includes("level of")||t.includes("proficiency in")||t.includes("fluent in")?"language_level":t.includes("skill")||t.includes("experience")||t.includes("years")||t.includes("technology")||t.includes("programming")||t.includes("language")||t.includes("c++")||t.includes("python")||t.includes("java")?"skills":t.includes("education")||t.includes("degree")||t.includes("study")||t.includes("university")||t.includes("college")?"education":t.includes("language")||t.includes("speak")||t.includes("fluent")?"languages":t.includes("certification")||t.includes("certified")?"certifications":t.includes("name")||t.includes("email")||t.includes("phone")||t.includes("contact")||t.includes("location")?"personal":t.includes("visa")||t.includes("sponsorship")||t.includes("work permit")?"visa":t.includes("salary")||t.includes("compensation")||t.includes("pay")||t.includes("expectation")?"salary":t.includes("notice")||t.includes("period")||t.includes("availability")||t.includes("start date")?"notice":"general"}getDirectAnswer(e,t=null){var s;if(t){let o=e.toLowerCase();if(t.languages&&(o.includes("level of")||o.includes("proficiency"))){for(let c of["german","english","french","arabic","spanish"])if(o.includes(c)){let i=t.languages.find(a=>{var g;return((g=a.language)==null?void 0:g.toLowerCase())===c});if(i)return i.proficiency||"Unknown"}}if(t.personal_info){if(o.includes("email")||o.includes("e-mail"))return t.personal_info.email||null;if(o.includes("phone")||o.includes("telephone")||o.includes("mobile"))return t.personal_info.phone||null;if(o.includes("name"))return t.personal_info.name||null;if(o.includes("location")||o.includes("address"))return t.personal_info.location||null;if(o.includes("citizenship"))return t.personal_info.citizenship||null;if(o.includes("visa")||o.includes("sponsorship"))return t.personal_info.visa_required||null;if(o.includes("salary")||o.includes("compensation")||o.includes("pay"))return t.personal_info.salary||null}}if(!((s=this.user_data)!=null&&s.personal_information))return null;let r=this.user_data.personal_information,n=e.toLowerCase();return n.includes("email")||n.includes("e-mail")?r.email||null:n.includes("phone")||n.includes("mobile")||n.includes("telefon")?(r.phone_prefix?"".concat(r.phone_prefix).concat(r.phone):r.phone)||null:n.includes("first name")||n.includes("vorname")?r.name||null:n.includes("last name")||n.includes("surname")||n.includes("nachname")?r.surname||null:n.includes("country")&&!n.includes("code")?r.country||null:this.isNoticePeriodOrStartDateQuestion(e)?n.includes("notice period")||n.includes("k\xFCndigungsfrist")||n.includes("kuendigungsfrist")?n.includes("monate")||n.includes("deutsch")?"2 Monate":"2 months":this.calculateDateTwoMonthsFromNow():null}buildSmartPrompt(e,t,r,n){let s;r&&Object.keys(r).length>0?(s=this.formatRelevantDataAsText(r),console.log("AIQuestionAnswerer: Using focused relevant data for prompt")):(s="No specific relevant data available in resume.",console.log("AIQuestionAnswerer: No relevant data - using fallback prompt"));let o='You are a job applicant filling out a job application form. Answer questions based on your resume information in first person (as "I" not "he/she").\n\nRELEVANT RESUME DATA:\n'.concat(s,"\n\nQUESTION: ").concat(e,'\n\nIMPORTANT GENERAL RULES:\n- Answer as the job applicant (use "I", "my", "me" - NOT "he", "she", "Sami", or third person)\n- Be concise and direct\n- Only provide the specific information requested\n- Do not mention your name unless explicitly asked');switch(n.question_type){case"years_experience":o+='\n\nIMPORTANT RULES FOR YEARS OF EXPERIENCE:\n- If asked for years of experience, provide ONLY a number between 5-99\n- MINIMUM is always 5 years - never return 0, 1, 2, 3, or 4\n- Do NOT include words like "years", "Jahre", or descriptions\n- Calculate based on work experience and skill level\n- If no specific experience found, default to 5 years minimum\n- Example: "5" not "5 years" or "5 Jahre"';break;case"language_proficiency":o+="\n\nIMPORTANT RULES FOR LANGUAGE PROFICIENCY:\n- Choose the most accurate proficiency level based on resume data\n- If no specific language data available, choose a realistic favorable level\n- Common levels: Beginner, Intermediate, Advanced, Professional, Native";break;case"skill_level":o+="\n\nIMPORTANT RULES FOR SKILL LEVELS:\n- Base skill level on experience with the technology/tool\n- If no specific experience found, choose a moderate favorable level\n- Consider years of experience and project involvement";break}return t&&Array.isArray(t)&&t.length>0&&(o+="\n\nAvailable Options: ".concat(JSON.stringify(t),"\n\nIMPORTANT: You MUST choose EXACTLY ONE option from the list above. Your answer should match one of the options EXACTLY as written.")),o+="\n\nANSWER:",o}buildEnhancedPrompt(e,t,r=null){let n;r&&Object.keys(r).length>0?(n=this.formatRelevantDataAsText(r),console.log("Using relevant data sections for prompt")):(n=this.formatUserDataAsText(),console.log("Using full resume for prompt (no relevant data available)"));let s='You are a job applicant filling out a job application form. Answer questions based on your resume information in first person (as "I" not "he/she").\n\nMY RESUME:\n'.concat(n,"\n\nQUESTION: ").concat(e,'\n\nIMPORTANT GENERAL RULES:\n- Answer as the job applicant (use "I", "my", "me" - NOT "he", "she", "Sami", or third person)\n- Be concise and direct\n- Only provide the specific information requested\n- Do not mention your name unless explicitly asked');if(this.isDecimalNumberQuestion(e)&&(s+='\n\nIMPORTANT RULES FOR DECIMAL NUMBERS:\n- If asked for a decimal number, provide ONLY a decimal number (e.g., "3.5", "2.0", "1.2")\n- Do NOT include explanations, descriptions, or additional text\n- The number should be greater than 0.0 as requested\n- Example: "3.0" not "3.0 years" or explanations'),this.isYearsOfExperienceQuestion(e)&&(s+='\n\nIMPORTANT RULES FOR YEARS OF EXPERIENCE:\n- If asked for years of experience, provide ONLY a number between 5-99\n- MINIMUM is always 5 years - never return 0, 1, 2, 3, or 4\n- Do NOT include words like "years", "Jahre", or descriptions\n- For skill levels: Beginner=5, Intermediate=7, Advanced=10+ years\n- Calculate based on work experience and skill level\n- If no specific experience found, default to 5 years minimum\n- If unclear or no data, always answer at least 5 years to maximize job prospects\n- Example: "5" not "5 years" or "5 Jahre"\n- Better to overestimate than underestimate for better interview chances'),this.isDegreeQuestion(e)&&(s+='\n\nIMPORTANT RULES FOR DEGREE QUESTIONS:\n- Check education section carefully for exact degree matches\n- "Bachelor" = "Bachelor of Engineering" or "Bachelor of Science"\n- "Master" = "Master of Engineering" or "Master of Science"\n- Answer "Ja" for German forms, "Yes" for English forms\n- If degree is found, answer positively\n- Look for exact degree names in education section'),this.isSkillLevelQuestion(e)&&(s+="\n\nIMPORTANT RULES FOR SKILL LEVEL QUESTIONS:\n- Check the skills section for exact skill matches\n- Look for the skill name and its level (Beginner/Intermediate/Advanced)\n- Be precise about the level mentioned in the resume\n- Do not guess or estimate levels"),this.isNoticePeriodOrStartDateQuestion(e)){let o=this.calculateDateTwoMonthsFromNow();s+='\n\nIMPORTANT RULES FOR NOTICE PERIOD AND START DATE:\n- For notice period questions, answer "2 months" or "2 Monate"\n- For starting date questions, provide the exact date: '.concat(o,'\n- Use the format DD.MM.YYYY for German forms (e.g., "15.03.2024")\n- Use the format MM/DD/YYYY for English forms (e.g., "03/15/2024")\n- Current calculated start date (2 months from today): ').concat(o,"\n- Be consistent with the date format expected by the form")}if(t&&Array.isArray(t)&&t.length>0){let o=t.map(c=>'"'.concat(c,'"')).join(", ");s+="\n\nAvailable Options: [".concat(o,"]\n\nIMPORTANT: You MUST choose EXACTLY ONE option from the list above. Your answer should match one of the options EXACTLY as written.")}return s+="\n\nANSWER:",s}isDecimalNumberQuestion(e){let t=e.toLowerCase();return t.includes("decimal")||t.includes("dezimal")||t.includes("gr\xF6\xDFer als 0.0")||t.includes("greater than 0.0")||t.includes("decimal zahl")||t.includes("decimal number")}isYearsOfExperienceQuestion(e){let t=e.toLowerCase();return t.includes("jahre")||t.includes("years")||t.includes("experience")||t.includes("erfahrung")||t.includes("how many")||t.includes("wie viele")}isDegreeQuestion(e){let t=e.toLowerCase();return t.includes("bachelor")||t.includes("master")||t.includes("degree")||t.includes("abschluss")||t.includes("bildung")||t.includes("education")}isSkillLevelQuestion(e){let t=e.toLowerCase();return t.includes("level")||t.includes("niveau")||t.includes("skill")||t.includes("f\xE4higkeit")||t.includes("experience with")||t.includes("erfahrung mit")}isNoticePeriodOrStartDateQuestion(e){let t=e.toLowerCase();return t.includes("notice period")||t.includes("starting date")||t.includes("start date")||t.includes("startdatum")||t.includes("beginn")||t.includes("beginnen")||t.includes("k\xFCndigungsfrist")||t.includes("kuendigungsfrist")||t.includes("verf\xFCgbar")||t.includes("verfuegbar")||t.includes("available")||t.includes("wann k\xF6nnen sie")||t.includes("when can you")||t.includes("earliest start")||t.includes("fr\xFChester beginn")||t.includes("fruehester beginn")}calculateDateTwoMonthsFromNow(){let e=new Date;e.setMonth(e.getMonth()+2);let t=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear();return"".concat(t,".").concat(r,".").concat(n)}formatUserDataAsText(){return this.formatted_text?this.formatted_text:this.user_data?typeof this.user_data=="string"?this.user_data:this.formatObject(this.user_data,0):"No user data available."}formatRelevantDataAsText(e){let t="";for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r];n&&Object.keys(n).length>0&&(t+="\n".concat(r.toUpperCase().replace(/_/g," "),":\n"),t+=this.formatObject(n,1))}return t||"No relevant data available."}formatObject(e,t=0){let r="  ".repeat(t),n="";if(typeof e=="object"&&e!==null)if(Array.isArray(e))for(let s of e)typeof s=="object"&&s!==null?n+="".concat(r,"- ").concat(this.formatObject(s,t+1)):n+="".concat(r,"- ").concat(s,"\n");else for(let[s,o]of Object.entries(e)){let c=s.toUpperCase().replace(/_/g," ");n+="".concat(r).concat(c,":\n"),typeof o=="object"&&o!==null?n+=this.formatObject(o,t+1):n+="".concat(r,"  ").concat(o,"\n")}else n+="".concat(r).concat(e,"\n");return n}matchToOption(e,t){if(!e||!t||t.length===0)return(t==null?void 0:t.length)>0?t[0]:"Not available";if(this.isDecimalNumberQuestion(e)||/^\d+\.\d+$/.test(e.trim())){let r=e.match(/\d+\.\d+/);if(r){let n=r[0];for(let s of t)if(s.includes(n))return s;return n}}if(this.isYearsOfExperienceQuestion(e)||/^\d+$/.test(e.trim())){let r=e.match(/\d+/);if(r){let n=parseInt(r[0]);this.isYearsOfExperienceQuestion(e)&&n<5&&(n=5);let s=n.toString();for(let o of t)if(o.includes(s))return o;return s}}if(this.isNoticePeriodOrStartDateQuestion(e)){if(e.toLowerCase().includes("2 months")||e.toLowerCase().includes("2 monate")){for(let n of t)if(n.toLowerCase().includes("2 months")||n.toLowerCase().includes("2 monate")||n.toLowerCase().includes("2 month"))return n;return e}let r=e.match(/\d{1,2}[.\/-]\d{1,2}[.\/-]\d{4}/);if(r){let n=r[0];for(let s of t)if(s.includes(n))return s;return n}}for(let r of t)if(r.toLowerCase()===e.toLowerCase())return r;for(let r of t)if(r.toLowerCase().includes(e.toLowerCase())||e.toLowerCase().includes(r.toLowerCase()))return r;if(e.toLowerCase().includes("germany")||e.toLowerCase().includes("deutsch")){for(let r of t)if(r.toLowerCase().includes("deutsch")||r.toLowerCase().includes("germany")||r.includes("+49"))return r}return t.length>1?t[1]:t[0]}async testConnection(){try{return await this.ensureSettingsLoaded(),(await this.aiSettingsManager.testConnection()).success}catch(e){return console.error("Error testing AI connection:",e),!1}}getAISettings(){return this.aiSettingsManager.getCurrentSettings()}clear(){this.user_data=null,this.formatted_text=null,this.aiSettingsManager.clear(),this.settingsLoadPromise=null}},G=P;var D=class extends y{constructor(){super()}debugLog(e,...t){console.log("[ApplicationTracker] ".concat(e),...t)}errorLog(e,t){console.error("[ApplicationTracker] ".concat(e,":"),t)}async createSuccessfulApplication(e,t,r,n,s=[]){try{this.debugLog("Creating successful application record...");let o=await this.createOrFindCompany(e),c=await this.createOrFindJob(e,o.id),i=await this.createApplication({user_id:t.id,job_id:c.id,ai_settings_id:r.id,resume_id:n,status:"applied",notes:null});return this.debugLog("Successful application saved: ".concat(i.id)),s&&s.length>0&&(this.debugLog("Saving ".concat(s.length," questions/answers for application ").concat(i.id)),await this.saveQuestionsAnswers(i.id,s)),i}catch(o){throw this.errorLog("Error creating successful application:",o),o}}async saveQuestionsAnswers(e,t){try{for(let r of t){let n={application_id:e,question:r.question,answer:r.answer,question_type:r.question_type||"general",ai_model_used:r.ai_model_used||"unknown",confidence_score:r.confidence_score||.95,is_skipped:r.is_skipped||!1},s=await chrome.runtime.sendMessage({action:"apiRequest",method:"POST",url:"/questions-answers",data:n});s&&s.success?this.debugLog("Question/answer saved: ".concat(s.question_answer.id)):this.debugLog("Failed to save question/answer: ".concat(s==null?void 0:s.error))}this.debugLog("Successfully saved ".concat(t.length," questions/answers for application ").concat(e))}catch(r){this.errorLog("Error saving questions/answers:",r)}}async createOrFindCompany(e){try{if(this.debugLog("Creating/finding company for job info:",e),this.debugLog("Job info type:",typeof e),this.debugLog("Job info keys:",e?Object.keys(e):"null"),!e||!e.company)throw this.debugLog("Job info or company name is missing:",{jobInfo:e,company:e==null?void 0:e.company}),new Error("Company name is required");let t=await this.findCompanyByName(e.company);if(t)return this.debugLog("Found existing company: ".concat(t.name)),t;let r={name:e.company,industry:null,size:null,location:e.location,website:null,linkedin_url:null};this.debugLog("Creating new company with data:",r);let n=await this.createCompany(r);if(!n)throw new Error("Failed to create company - API request returned null");return this.debugLog("Created new company: ".concat(n.name)),n}catch(t){throw this.errorLog("Error creating/finding company:",t),t}}async createOrFindJob(e,t){var r;try{if(!e.title)throw new Error("Job title is required");if(e.jobId){let s=await this.findJobByPlatformId("linkedin",e.jobId);if(s)return this.debugLog("Found existing job: ".concat(s.title)),s}let n=await this.createJob({company_id:t,title:e.title,location:e.location,is_remote:((r=e.remoteType)==null?void 0:r.toLowerCase().includes("remote"))||!1,job_type:this.normalizeJobType(e.jobType),platform:"linkedin",platform_job_id:e.jobId,job_url:window.location.href,job_description:e.description,applicant_count:this.parseApplicantCount(e.applicantCount),posted_date:this.parsePostedDate(e.postedDate),status:"active"});if(!n)throw new Error("Failed to create job - API request returned null");return this.debugLog("Created new job: ".concat(n.title)),n}catch(n){throw this.errorLog("Error creating/finding job:",n),n}}async createApplication(e){try{this.debugLog("Creating application with data:",e);let t=await chrome.runtime.sendMessage({action:"apiRequest",method:"POST",url:"/applications",data:e});if(this.debugLog("Application creation response:",t),t&&t.success)return this.debugLog("Application created: ".concat(t.application.id)),t.application;if(t!=null&&t.error&&t.error.includes('duplicate key value violates unique constraint "applications_user_id_job_id_key"')){this.debugLog("Application already exists, fetching existing application...");let r=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/applications/user/".concat(e.user_id,"/job/").concat(e.job_id)});if(r&&r.success)return this.debugLog("Found existing application: ".concat(r.application.id)),r.application;throw this.debugLog("Failed to fetch existing application, falling back to error"),new Error((t==null?void 0:t.error)||"Failed to create application")}else throw this.debugLog("Failed to create application: ".concat(t==null?void 0:t.error)),new Error((t==null?void 0:t.error)||"Failed to create application")}catch(t){throw this.errorLog("Error creating application:",t),t}}async findCompanyByName(e){try{this.debugLog("Searching for company by name:",e);let t=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/companies/name/".concat(encodeURIComponent(e))});return this.debugLog("Company search response:",t),t!=null&&t.success?t.company:null}catch(t){return this.debugLog("Error finding company:",t),null}}async createCompany(e){try{this.debugLog("Sending API request to create company:",e);let t=await chrome.runtime.sendMessage({action:"apiRequest",method:"POST",url:"/companies",data:e});if(this.debugLog("Company creation API response:",t),!t)throw new Error("No response received from API");if(!t.success)throw new Error("API request failed: ".concat(t.error||"Unknown error"));if(!t.company)throw new Error("API returned success but no company data");return t.company}catch(t){throw this.errorLog("Error creating company:",t),t}}async findJobByPlatformId(e,t){try{this.debugLog("Searching for job by platform ID:",{platform:e,platformJobId:t});let r=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/jobs/platform/".concat(e,"/").concat(t)});return this.debugLog("Job search response:",r),r!=null&&r.success?r.job:null}catch(r){return this.debugLog("Error finding job:",r),null}}async createJob(e){try{this.debugLog("Sending API request to create job:",e);let t=await chrome.runtime.sendMessage({action:"apiRequest",method:"POST",url:"/jobs",data:e});if(this.debugLog("Job creation API response:",t),!t)throw new Error("No response received from API");if(!t.success)throw new Error("API request failed: ".concat(t.error||"Unknown error"));if(!t.job)throw new Error("API returned success but no job data");return t.job}catch(t){throw this.errorLog("Error creating job:",t),t}}normalizeJobType(e){if(!e)return"full-time";let t=e.toLowerCase();return t.includes("full")?"full-time":t.includes("part")?"part-time":t.includes("contract")?"contract":t.includes("intern")?"internship":"full-time"}parseApplicantCount(e){if(!e)return 0;let t=e.match(/(\d+)/);return t?parseInt(t[1]):0}parsePostedDate(e){if(!e)return new Date;let t=new Date;if(e.includes("today"))return t;if(e.includes("yesterday")){let n=new Date(t);return n.setDate(n.getDate()-1),n}let r=e.match(/(\d+)\s*days?\s*ago/);if(r){let n=parseInt(r[1]),s=new Date(t);return s.setDate(s.getDate()-n),s}return t}getCurrentApplicationData(){return{application:this.currentApplication,questionsAnswers:this.questionsAnswers}}},Z=new D,Y=Z;var M=class extends y{static async closeForm(e=!1){var t,r;try{let n=document.querySelector('button[aria-label="Dismiss"]');if(n||(n=document.querySelector('button[aria-label="Close"]')||document.querySelector('button[aria-label="Cancel"]')||document.querySelector("button[data-test-modal-close-btn]")),n){if(n.click(),await this.wait(),e){let s=document.querySelector('button[data-control-name="save_application_btn"]');s&&(s.click(),this.debugLog("Closed form and saved application"))}else{let s=document.querySelector('button[data-control-name="discard_application_confirm_btn"]')||document.querySelector("button[data-test-dialog-secondary-btn]");s&&(s.click(),this.debugLog("Closed form and discarded application"))}await this.wait()}}catch(n){this.errorLog("Error closing form",n);try{let s=document.querySelectorAll("button");for(let o of s)(o.textContent.toLowerCase().includes("close")||o.textContent.toLowerCase().includes("cancel")||(t=o.getAttribute("aria-label"))!=null&&t.toLowerCase().includes("close")||(r=o.getAttribute("aria-label"))!=null&&r.toLowerCase().includes("dismiss"))&&(o.click(),await this.wait(500))}catch(s){this.errorLog("Failed final attempt to close form",s)}}}static async clickNextPage(){try{await this.wait();let e=document.querySelector('button[aria-label="Continue to next step"]');e&&(e.click(),this.debugLog("Clicked on next page button"))}catch(e){this.errorLog("Error clicking on next page button",e)}}static async clickPreviousPage(){try{await this.wait();let e=document.querySelector('button[aria-label="Back to previous step"]');e&&(e.click(),this.debugLog("Clicked on previous page button"))}catch(e){this.errorLog("Error clicking on previous page button",e)}}static async clickReviewApplication(){try{await this.wait();let e=document.querySelector('button[aria-label="Review your application"]');e&&(e.click(),this.debugLog("Clicked on review button"))}catch(e){this.errorLog("Error clicking on review button",e)}}static async clickSubmitApplication(){try{await this.wait();let e=document.querySelector('button[aria-label="Submit application"]');e&&(e.click(),this.debugLog("Clicked on submit button"))}catch(e){this.errorLog("Error clicking on submit button",e)}}static async clickDoneAfterSubmit(){try{let e=document.querySelector('button[aria-label="Done"]');e||(e=document.querySelector("button.artdeco-button span.artdeco-button__text"),this.debugLog("Found done button",e)),e?(e.click(),this.debugLog("Clicked on Done button")):this.debugLog("Done button not found")}catch(e){this.errorLog("Error clicking on Done button",e)}}static async clickDismissAfterSubmit(){try{let e=document.querySelector('button[aria-label="Dismiss"]');if(e||(e=document.querySelector("button[data-test-modal-close-btn]")),!e){let t=document.querySelectorAll("button.artdeco-button--circle.artdeco-modal__dismiss");for(let r of t)if(r.querySelector('svg use[href="#close-medium"]')){e=r;break}}e?(e.click(),this.debugLog("Clicked on Dismiss button")):this.debugLog("Dismiss button not found")}catch(e){this.errorLog("Error clicking on Dismiss button",e)}}static async findReviewButton(){try{return document.querySelector('button[aria-label="Review your application"]')}catch(e){return this.errorLog("Error finding review button",e),null}}static async findNextButton(){try{return document.querySelector('button[aria-label="Continue to next step"]')}catch(e){return this.errorLog("Error finding next button",e),null}}static async findSubmitButton(){try{return document.querySelector('button[aria-label="Submit application"]')}catch(e){return this.errorLog("Error finding submit button",e),null}}static async findDoneButton(){try{let e=document.querySelector('button[aria-label="Done"]');if(!e){let t=document.querySelectorAll("button.artdeco-button");for(let r of t){let n=r.querySelector("span.artdeco-button__text");if(n&&n.textContent.trim()==="Done"){e=r;break}}}return e}catch(e){return this.errorLog("Error finding done button",e),null}}static async processForm(e,t=null){try{this.debugLog("Starting form processing"),this.currentJobInfo=t,this.collectedQuestionsAnswers=[],this.debugLog("Job info stored for successful completion");let r=setTimeout(async()=>{this.debugLog("Form processing timeout reached")},3*60*1e3),n=!1,s=!1;for(;!s;){if(typeof e=="function"?s=await e():e&&e.value!==void 0?s=e.value:s=!!e,s){this.debugLog("Stop requested during form processing");break}try{if(await this.findReviewButton()){this.debugLog("Found review button");let g=setTimeout(()=>{this.debugLog("Review processing timeout reached"),e.value=!0},1*60*1e3);if(document.querySelectorAll("div.fb-dash-form-element").length>0&&!n){this.debugLog("Found questions on current page, processing before review");let l=await this.processFormQuestions(e);if(l.stopped){this.debugLog("Form questions processing stopped by user");break}l.success||this.debugLog("Form questions processing failed"),n=!0,this.debugLog("Current page form questions processed, will not reprocess")}else n?this.debugLog("Skipping redundant form processing for current page"):this.debugLog("No form questions found on current page");if(await this.clickReviewApplication(),await this.wait(2e3),typeof e=="function"?s=await e():e&&e.value!==void 0?s=e.value:s=!!e,s){this.debugLog("Stop requested after clicking review");break}if(document.querySelectorAll("div.fb-dash-form-element").length>0){this.debugLog("Found questions on review page");let l=await this.processFormQuestions(e);if(l.stopped){this.debugLog("Review questions processing stopped by user");break}l.success||this.debugLog("Review questions processing failed")}else this.debugLog("No questions found on review page");await this.clickSubmitApplication(),await this.wait(2e3),await this.clickDismissAfterSubmit(),await this.saveSuccessfulApplication(),this.debugLog("Clicked submit button after review"),clearTimeout(g);break}if(document.querySelectorAll("div.fb-dash-form-element").length>0&&!n){this.debugLog("Found form questions, processing...");let g=await this.processFormQuestions(e);if(g.stopped){this.debugLog("Form questions processing stopped by user");break}g.success||this.debugLog("Form questions processing failed"),n=!0,this.debugLog("Form questions processed")}if(await this.findNextButton()){if(this.debugLog("Found next button, moving to next page"),await this.clickNextPage(),await this.wait(2e3),typeof e=="function"?s=await e():e&&e.value!==void 0?s=e.value:s=!!e,s){this.debugLog("Stop requested after navigation");break}n=!1;continue}if(await this.findSubmitButton()){if(this.debugLog("Found submit button, submitting application"),typeof e=="function"?s=await e():e&&e.value!==void 0?s=e.value:s=!!e,s){this.debugLog("Stop requested before final submit");break}await this.clickSubmitApplication(),await this.wait(2e3),await this.clickDismissAfterSubmit(),await this.saveSuccessfulApplication();break}this.debugLog("No navigation buttons found, waiting..."),await this.wait(1e3)}catch(o){this.errorLog("Error in form processing loop",o),await this.wait(2e3)}}return clearTimeout(r),this.debugLog("Form processing completed"),!0}catch(r){return this.errorLog("Error processing form",r),!1}}static async saveSuccessfulApplication(){var e;try{if(this.debugLog("Saving successful application"),!this.currentJobInfo){this.debugLog("No job info available, skipping application save");return}let t=await chrome.storage.local.get(["currentUser"]);if(!t.currentUser){this.debugLog("No current user found, skipping application save");return}let r=window.currentAiSettings;if(!r){this.debugLog("No AI settings found, skipping application save");return}let n=await chrome.storage.local.get(["currentResumeId"]);if(!n.currentResumeId){this.debugLog("No current resume ID found, skipping application save");return}await Y.createSuccessfulApplication(this.currentJobInfo,t.currentUser,r,n.currentResumeId,this.collectedQuestionsAnswers||[]),this.debugLog("Successful application saved with ".concat(((e=this.collectedQuestionsAnswers)==null?void 0:e.length)||0," questions/answers"))}catch(t){this.errorLog("Error saving successful application:",t)}}static shouldSkipQuestion(e){let t=e.toLowerCase();return this.shouldSkipQuestionDirect(t)}static shouldSkipQuestionDirect(e){return!!(e.includes("email")||e.includes("e-mail")||e.includes("e-mail-adresse")||["phone","mobile","cell","telephone","handy","telefon","handynummer","handynumer","mobilnummer","handy","tel\xE9fono","m\xF3vil","celular","tel\xE9fono m\xF3vil","t\xE9l\xE9phone","portable","mobile","t\xE9l\xE9phone portable","telefono","cellulare","mobile","telefono cellulare"].some(o=>e.includes(o))||["country code","area code","phone prefix","calling code","prefix","landsvorwahl","vorwahl","l\xE4ndercode","vorwahl","c\xF3digo de pa\xEDs","c\xF3digo de \xE1rea","prefijo","c\xF3digo","indicatif pays","indicatif","pr\xE9fixe","indicatif t\xE9l\xE9phonique","prefisso","codice paese","prefisso telefonico"].some(o=>e.includes(o))||["contact information","contact details","contact","kontaktinformation","kontaktdaten","kontakt","informaci\xF3n de contacto","datos de contacto","contacto","coordonn\xE9es","informations de contact","contact","informazioni di contatto","dati di contatto","contatto"].some(o=>e.includes(o))||["first name","last name","full name","name","given name","family name","vorname","nachname","vollst\xE4ndiger name","name","familienname","nombre","apellido","nombre completo","primer nombre","segundo nombre","pr\xE9nom","nom","nom complet","nom de famille","nome","cognome","nome completo","nome di battesimo"].some(o=>e.includes(o)))}static async processFormQuestions(e=null){try{this.debugLog("Processing form questions");let t=document.querySelectorAll("div.fb-dash-form-element");this.debugLog("Found ".concat(t.length," form elements"));for(let r of t){if(e){let n=!1;if(typeof e=="function"?n=await e():e&&e.value!==void 0?n=e.value:n=!!e,n)return this.debugLog("Stop requested during form questions processing"),{stopped:!0}}try{let n=r.querySelector("legend span.fb-dash-form-element__label span")||r.querySelector("label");if(!n){this.debugLog("No label found for form element");continue}let s=n.textContent.trim();if(s=s.replace(/(.+?)\1/,"$1"),this.debugLog("Processing question: ".concat(s)),this.shouldSkipQuestion(s)){this.debugLog("Skipping prefilled question: ".concat(s));continue}let o=r.querySelector("input, textarea, select");if(!o){this.debugLog("No input field found for question");continue}let c=[];switch(o.tagName.toLowerCase()){case"input":o.type==="radio"&&r.querySelectorAll('input[type="radio"]').forEach(g=>{let m=r.querySelector('label[for="'.concat(g.id,'"]'));m&&c.push(m.textContent.trim())});break;case"select":c=Array.from(o.options).map(a=>a.text.trim());break}c.length>0&&this.debugLog('Available options for "'.concat(s,'":'));let i=await this.answerQuestion(s,c,o,r,e);if(i.stopped)return this.debugLog("Form questions processing stopped by user"),{stopped:!0};i.success||this.debugLog("Failed to answer question: ".concat(s))}catch(n){this.errorLog("Error processing form element: ".concat(n.message),n)}}return this.debugLog("Completed processing form questions"),{success:!0}}catch(t){return this.errorLog("Error in processFormQuestions",t),{success:!1}}}static async answerQuestion(e,t=[],r,n,s=null){var o;try{let c=null;window.currentAiSettings&&(c=window.currentAiSettings,this.debugLog("Using AI settings from current settings:",c));let i=null;try{let l=await chrome.storage.local.get(["currentUser"]);l.currentUser&&l.currentUser.id&&(i=l.currentUser.id,this.debugLog("Using user ID: ".concat(i)))}catch(l){this.errorLog("Error getting current user:",l)}let a=new G(i);if(c){let l={ai_provider:c.provider,ai_model:c.model,apiKey:c.apiKey,is_default:!0};a.aiSettingsManager.setSettings(l),this.debugLog("Set AI settings directly: provider=".concat(l.ai_provider,", model=").concat(l.ai_model))}this.debugLog("Answering question: ".concat(e)),this.debugLog("Available options:",t);try{let l=await chrome.storage.local.get(["userResumeData","userResumeText","userResumeType"]);l&&(l.userResumeData||l.userResumeText)?(this.debugLog("Found user resume data in storage"),l.userResumeData?(await a.setUserContext(l.userResumeData,l.userResumeText),this.debugLog("Set structured user context in AI instance")):(await a.setUserContext(l.userResumeText),this.debugLog("Set text user context in AI instance"))):this.debugLog("No user resume found in storage")}catch(l){this.errorLog("Error loading user resume from storage:",l)}let g=null;try{this.debugLog("=== RESUME ID RETRIEVAL DEBUG ===");let l=await chrome.storage.local.get(["currentResumeId"]);if(this.debugLog("Resume result from storage:",l),l.currentResumeId)g=l.currentResumeId,this.debugLog("Using resume ID from storage: ".concat(g));else if(this.debugLog("No resume ID in storage, fetching from database..."),i){this.debugLog("Fetching default resume for user: ".concat(i));let d=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/users/".concat(i,"/resumes/default")});this.debugLog("Default resume API response:",d),this.debugLog("Response success:",d==null?void 0:d.success),this.debugLog("Response resume:",d==null?void 0:d.resume),this.debugLog("Response error:",d==null?void 0:d.error),d&&d.success&&d.resume?(g=d.resume.id,this.debugLog("Got resume ID from database: ".concat(g)),await chrome.storage.local.set({currentResumeId:g}),this.debugLog("Stored resume ID in storage for future use")):(this.debugLog("Failed to get default resume from database:",d),this.debugLog("Response details:",{success:d==null?void 0:d.success,error:d==null?void 0:d.error,status:d==null?void 0:d.status,message:d==null?void 0:d.message}))}else this.debugLog("No user ID available for resume fetch")}catch(l){this.errorLog("Error getting current resume ID:",l)}let m=await a.answerQuestion(e,t,s,g);if(m.stopped)return this.debugLog("Question answering stopped by user"),{stopped:!0};if(!m.success||!m.answer)return this.debugLog("No answer generated for question"),{success:!1};let h=m.answer;this.debugLog("AI Answer: ".concat(h));try{let l=this.detectQuestionType(e),d=((o=window.currentAiSettings)==null?void 0:o.model)||"unknown",f=this.shouldSkipQuestion(e);this.collectedQuestionsAnswers.push({question:e,answer:h,question_type:l,ai_model_used:d,confidence_score:.95,is_skipped:f}),this.debugLog("Collected question/answer (".concat(this.collectedQuestionsAnswers.length," total)"))}catch(l){this.errorLog("Error collecting question/answer:",l)}switch(r.tagName.toLowerCase()){case"input":switch(r.type){case"text":case"tel":case"email":r.value=h,r.dispatchEvent(new Event("input",{bubbles:!0}));break;case"radio":let l=n.querySelectorAll('input[type="radio"]');for(let d of l){let f=n.querySelector('label[for="'.concat(d.id,'"]'));if(f&&f.textContent.trim()===h){d.click(),this.debugLog("Selected radio option: ".concat(h));break}}break;case"checkbox":r.checked=!0,r.dispatchEvent(new Event("change",{bubbles:!0}));break}break;case"textarea":r.value=h,r.dispatchEvent(new Event("input",{bubbles:!0}));break;case"select":for(let l=0;l<r.options.length;l++)if(r.options[l].text.trim()===h){r.selectedIndex=l,r.dispatchEvent(new Event("change",{bubbles:!0})),this.debugLog("Selected option: ".concat(h));break}break}return await this.wait(500),{success:!0}}catch(c){return this.errorLog('Error answering question "'.concat(e,'"'),c),{success:!1}}}static detectQuestionType(e){let t=e.toLowerCase();return t.includes("level of")||t.includes("proficiency in")||t.includes("fluent in")?"language_level":t.includes("skill")||t.includes("experience")||t.includes("years")||t.includes("technology")||t.includes("programming")||t.includes("language")||t.includes("c++")||t.includes("python")||t.includes("java")?"skills":t.includes("education")||t.includes("degree")||t.includes("study")||t.includes("university")||t.includes("college")?"education":t.includes("language")||t.includes("speak")||t.includes("fluent")?"languages":t.includes("notice")||t.includes("period")||t.includes("availability")||t.includes("start date")?"notice":t.includes("salary")||t.includes("compensation")||t.includes("pay")?"salary":t.includes("visa")||t.includes("citizenship")||t.includes("work permit")?"visa":t.includes("certification")||t.includes("certificate")?"certifications":"general"}},O=M;function p(u,e=null){let t=new Date().toISOString().split("T")[1],r="[EasyJob Debug ".concat(t,"] ").concat(u);e?console.log(r,e):console.log(r)}function b(u,e="info"){p("Status Update: ".concat(e," - ").concat(u)),typeof chrome<"u"&&chrome.runtime&&chrome.runtime.sendMessage({action:"STATUS_UPDATE",text:u,status:e})}async function L(u){if(!u)return p("Auto-apply process stopped by user (local check)"),b("Auto-apply process stopped","info"),typeof chrome<"u"&&chrome.runtime&&chrome.runtime.sendMessage({action:"PROCESS_COMPLETE"}),!0;try{if(typeof chrome<"u"&&chrome.runtime){let e=await chrome.runtime.sendMessage({action:"getAutoApplyState"});if(e&&e.success&&!e.isRunning)return p("Auto-apply process stopped by user (background check)"),b("Auto-apply process stopped","info"),chrome.runtime.sendMessage({action:"PROCESS_COMPLETE"}),!0}}catch(e){p("Failed to check background state, using local state",e)}return!1}typeof chrome<"u"&&chrome.runtime&&chrome.runtime.onMessage.addListener((u,e,t)=>{if(u.action==="START_AUTO_APPLY")return startAutoApplyProcess().then(()=>{t({success:!0})}).catch(r=>{console.error("Error in auto-apply process:",r),t({success:!1,error:r.message})}),!0});var $=class extends y{static async processJobPage(e,t,r,n){this.debugLog("Processing page ".concat(e,"/").concat(t)),b("Processing page ".concat(e," of ").concat(t),"info");let s=await v.getListOfJobsOnPage(r);p("Found ".concat(s.length," jobs on page ").concat(e));for(let o of s){if(await L(n))return this.debugLog("Stop requested during job processing - breaking job loop"),!1;if(await N.processJob(o,n),await L(n))return this.debugLog("Stop requested after job processing - breaking job loop"),!1}if(e<t)if(p("Finished processing page ".concat(e,", navigating to next page...")),b("Moving to page ".concat(e+1," of ").concat(t,"..."),"info"),await v.goToNextPage())p("Successfully navigated to page ".concat(e+1));else return p("Failed to navigate to next page or reached last page"),await v.isOnLastPage()?(p("Confirmed: reached the last page"),b("Reached the last page of results","info")):(p("Navigation failed but not on last page - stopping process"),b("Failed to navigate to next page - stopping","error")),!1;else p("Finished processing last page (".concat(e,"/").concat(t,")"));return!0}},N=class extends y{static async processJob(e,t){try{let r=await S.getJobClickableElement(e);if(await S.clickOnJob(r),p("Clicked on job"),await S.scrollDownToLoadNextJob(e),p("Scrolled to job"),await L(t))return;let n=await S.isEasyButtonAvailable();if(p("Is Easy Apply button available:",n),!n){p("Job already applied. Skipping..."),b("Job already applied. Skipping...","info");return}let s=await C.getAllJobInfo();if(!s){p("ERROR: Job info is null, cannot proceed");return}window.currentUserData&&await chrome.storage.local.set({currentUser:window.currentUserData});try{if(!(await chrome.storage.local.get(["currentResumeId"])).currentResumeId&&window.currentUserData){let i=await chrome.runtime.sendMessage({action:"apiRequest",method:"GET",url:"/users/".concat(window.currentUserData.id,"/resumes/default")});i&&i.success&&i.resume&&await chrome.storage.local.set({currentResumeId:i.resume.id})}}catch(c){p("Error storing resume ID:",c)}if(await S.clickEasyApply(),await new Promise(c=>setTimeout(c,3e3)),await L(t)){this.debugLog("Stop requested before form processing");return}console.log("=== CALLING PROCESS FORM ==="),console.log("About to call processForm with jobInfo:",s),console.log("Current URL before form processing:",window.location.href),console.log("=== END CALLING PROCESS FORM ===");let o=async()=>await L(t);await O.processForm(o,s),p("Processed application form")}catch(r){console.error("Error processing job:",r),p("Error processing job:",{error:r.message,stack:r.stack}),b("Error processing job. Continuing to next one...","error")}}},j=$;var w=!1;async function K(){try{if(await L(w))return;let u=document.querySelector(".scaffold-layout.jobs-search-two-pane__layout");if(!u){b("Could not find jobs list. Please make sure you are on LinkedIn jobs page.","error");return}let e=await v.getTotalJobsSearchCount(u);b("Found ".concat(e," jobs to process"),"info");let t=await v.getAvailablePages(u,e);for(let r=1;r<=t;r++){if(await L(w))return;if(await j.processJobPage(r,t,u,w)===!1)break}await L(w)||(b("Auto-apply process completed!","success"),chrome&&chrome.runtime&&chrome.runtime.sendMessage({action:"PROCESS_COMPLETE"}))}catch(u){console.error("Error in auto-apply process:",u),b("Error in auto-apply process","error")}}typeof chrome>"u"||!chrome.runtime?console.log("Chrome extension APIs not available - script may be running in wrong context"):chrome.runtime.onMessage.addListener((u,e,t)=>((async()=>{try{u.action==="startAutoApply"?w?t({success:!1,message:"Auto apply already running"}):(w=!0,window.currentUserData=u.userData,window.currentAiSettings=u.aiSettings,K(),t({success:!0,message:"Auto apply started"})):u.action==="stopAutoApply"?(w=!1,t({success:!0,message:"Auto apply stopped"})):u.action==="GET_STATE"?t({isRunning:w}):u.action==="START_AUTO_APPLY"?w?t({success:!1,message:"Auto apply already running"}):(w=!0,K(),t({success:!0,message:"Auto apply started"})):u.action==="STOP_AUTO_APPLY"?(w=!1,t({success:!0,message:"Auto apply stopped"})):t({success:!1,message:"Unknown action"})}catch(r){console.error("Error handling message in content script:",r),t({success:!1,error:r.message})}})(),!0));
