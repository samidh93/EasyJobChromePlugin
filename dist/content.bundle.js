var ie=class{static async wait(n=1e3){await new Promise(r=>setTimeout(r,n))}static debugLog(n){console.log("[".concat(this.constructor.name,"] ").concat(n))}static errorLog(n,r){console.error("[".concat(this.constructor.name,"] ").concat(n,":"),r)}},O=ie;var ae=class extends O{static async getTotalJobsSearchCount(n){try{await this.wait();let r=n.querySelector(".jobs-search-results-list__subtitle");if(r){let o=r.textContent.trim(),t=parseInt(o.split(" ")[0].replace(/,/g,"").replace(/\./g,"").replace(/\+/g,""));return this.debugLog("Total jobs found: ".concat(t)),t}else return this.debugLog("No results found"),0}catch(r){return this.errorLog("Error fetching total jobs count",r),0}}static async getAvailablePages(n,r){try{await this.wait();let o=n.querySelector('ul[class*="jobs-search-pagination__pages"]');if(!o)return this.debugLog("Pagination list not found."),0;let t=o.querySelectorAll("li");if(t.length===0)return this.debugLog("No pagination items found."),0;let i=t[t.length-1];this.debugLog("Last page: ".concat(i));let a=Math.ceil(r/25);return this.debugLog("Total pages available: ".concat(a)),a}catch(o){return this.errorLog("Error fetching available pages",o),0}}static async getListOfJobsOnPage(n){try{await this.wait();let r=n.querySelector(".scaffold-layout__list");if(!r)return this.debugLog("Jobs container not found."),[];let o=r.querySelectorAll("li[class*='scaffold-layout__list-item']");return this.debugLog("Found ".concat(o.length," jobs on this page.")),Array.from(o)}catch(r){return this.errorLog("Error fetching list of jobs",r),[]}}static async goToNextPage(){try{await this.wait();let n=document.querySelector('button[aria-label="View next page"]')||document.querySelector("button.jobs-search-pagination__button--next")||document.querySelector('button[aria-label="Next"]');return n&&!n.disabled?(this.debugLog("Found next page button, clicking..."),n.click(),this.debugLog("Clicked next page button"),await this.wait(3e3),!0?(this.debugLog("Successfully navigated to next page"),!0):(this.debugLog("Jobs failed to load on next page"),!1)):(this.debugLog("Next page button not found or disabled - likely on last page"),!1)}catch(n){return this.errorLog("Error navigating to next page",n),!1}}static async isOnLastPage(){try{let n=document.querySelector('button[aria-label="View next page"]')||document.querySelector("button.jobs-search-pagination__button--next");return!n||n.disabled}catch(n){return this.errorLog("Error checking if on last page",n),!0}}},$=ae;var se=class extends O{static async getJobClickableElement(n){try{await this.wait();let r=n.querySelector("a");return r||(this.debugLog("Could not find clickable element for job"),null)}catch(r){return this.errorLog("Error fetching clickable element",r),null}}static async scrollDownToLoadNextJob(n){try{await this.wait(),n.scrollIntoView({behavior:"smooth",block:"center"}),this.debugLog("Scrolled down to load next job")}catch(r){this.errorLog("Error scrolling down to load next job",r)}}static async clickOnJob(n){try{n.click(),this.debugLog("Clicked on job element")}catch(r){this.debugLog("Could not click on job element",r)}}static async isEasyButtonAvailable(){try{return document.querySelector(".jobs-s-apply button")?(this.debugLog("found easy apply button"),!0):(this.debugLog("easy apply button not found"),!1)}catch(n){return console.error("easy apply button not found error",n),!1}}static async clickEasyApply(){try{let n=document.querySelector(".jobs-s-apply button");if(n)return n.click(),this.debugLog("Clicked on easy apply button"),!0;throw new Error("Easy apply button not found")}catch(n){throw this.errorLog("Error clicking on easy apply button",n),n}}},R=se;var le=class extends O{static async getJobId(){try{let n=new URLSearchParams(window.location.search).get("currentJobId");return n?(this.debugLog("Found job ID: ".concat(n)),n):(this.debugLog("Job ID not found in URL"),null)}catch(n){return this.errorLog("Error getting job ID",n),null}}static async getJobTitle(){try{let n=document.querySelector(".job-details-jobs-unified-top-card__job-title h1");if(n){let r=n.textContent.trim();return this.debugLog("Found job title: ".concat(r)),r}return this.debugLog("Job title not found"),null}catch(n){return this.errorLog("Error getting job title",n),null}}static async getCompanyName(){try{let n=document.querySelector(".job-details-jobs-unified-top-card__company-name a");if(n){let r=n.textContent.trim();return this.debugLog("Found company name: ".concat(r)),r}return this.debugLog("Company name not found"),null}catch(n){return this.errorLog("Error getting company name",n),null}}static async getLocation(){try{let n=document.querySelector(".job-details-jobs-unified-top-card__tertiary-description-container .tvm__text");if(n){let r=n.textContent.trim();return this.debugLog("Found location: ".concat(r)),r}return this.debugLog("Location not found"),null}catch(n){return this.errorLog("Error getting location",n),null}}static async getJobType(){try{let n=document.querySelectorAll("button.job-details-preferences-and-skills .job-details-preferences-and-skills__pill");if(n.length>1){let o=n[1].querySelectorAll("span");if(o.length>0){let t=o[0].querySelectorAll("span");if(t.length>0){let i=t[0].textContent.trim();if(i)return this.debugLog("Found jobType type: ".concat(i)),i}}}return this.debugLog("jobType type not found"),null}catch(n){return this.errorLog("Error getting jobType type",n),null}}static async getRemoteType(){try{let n=document.querySelectorAll("button.job-details-preferences-and-skills .job-details-preferences-and-skills__pill");if(n.length>0){let o=n[0].querySelectorAll("span");if(o.length>0){let t=o[0].querySelectorAll("span");if(t.length>0){let i=t[0].textContent.trim();if(i)return this.debugLog("Found remote type: ".concat(i)),i}}}return this.debugLog("Remote type not found"),null}catch(n){return this.errorLog("Error getting remote type",n),null}}static async getJobDescription(){try{let n=document.querySelector(".jobs-description__content");if(n){let r=n.textContent.trim();return this.debugLog("Found job description"),r}return this.debugLog("Job description not found"),null}catch(n){return this.errorLog("Error getting job description",n),null}}static async getApplicantCount(){try{let n=document.querySelectorAll(".job-details-jobs-unified-top-card__tertiary-description-container .tvm__text"),r=n.length>0?n[n.length-1]:null;if(r){let o=r.textContent.trim();return this.debugLog("Found applicant count: ".concat(o)),o}return this.debugLog("Applicant count not found"),null}catch(n){return this.errorLog("Error getting applicant count",n),null}}static async getPostedDate(){try{let n=document.querySelectorAll(".job-details-jobs-unified-top-card__tertiary-description-container .tvm__text")[2];if(n){let r=n.textContent.trim();return this.debugLog("Found posted date: ".concat(r)),r}return this.debugLog("posted date not found"),null}catch(n){return this.errorLog("Error getting applicant count",n),null}}static async getAllJobInfo(){try{let n={jobId:await this.getJobId(),title:await this.getJobTitle(),company:await this.getCompanyName(),location:await this.getLocation(),jobType:await this.getJobType(),remoteType:await this.getRemoteType(),description:await this.getJobDescription(),applicantCount:await this.getApplicantCount(),postedDate:await this.getPostedDate()};return this.debugLog("Retrieved all job information"),n}catch(n){return this.errorLog("Error getting all job information",n),null}}},ce=le;var ue=class{constructor(n=null){this.data={},this.directEmbeddingFunction=n,this.hasTriedLoading=!1,this.preloadEmbeddings()}async addEntry(n,r){if(!r)return!1;try{console.log("Adding entry for key: ".concat(n));let o=await this.getEmbedding(r);return o&&o.success&&o.data&&o.data.embedding?(this.data[n]={text:r,embedding:o.data.embedding},console.log("Successfully added embedding for key: ".concat(n," (Store size: ").concat(Object.keys(this.data).length,")")),!0):(console.warn("Failed to generate embedding for key: ".concat(n)),!1)}catch(o){return console.error("Error adding entry to memory store:",o),!1}}async loadStoredEmbeddings(){return this.hasTriedLoading?(console.log("Already tried loading embeddings. Current size: ".concat(Object.keys(this.data).length)),Object.keys(this.data).length>0):(console.log("Attempting to load stored embeddings from Chrome storage..."),new Promise(n=>{chrome.storage.local.get("storedEmbeddings",r=>{r.storedEmbeddings&&Object.keys(r.storedEmbeddings).length>0?(this.data=r.storedEmbeddings,console.log("Loaded embeddings from storage, found",Object.keys(this.data).length,"entries"),this.hasTriedLoading=!0,n(!0)):(console.log("No stored embeddings found in Chrome storage"),this.hasTriedLoading=!0,n(!1))})}))}flattenEmbeddingData(n){let r={};for(let[a,s]of Object.entries(n))if(s.embedding&&Array.isArray(s.embedding)){let l=s.embedding.map(c=>parseFloat(c.toFixed(5)));r[a]={text:s.text,embedding:l}}else r[a]=s;let o=JSON.stringify(n).length,t=JSON.stringify(r).length,i=(100-t/o*100).toFixed(2);return console.log("Flattened embeddings: ".concat(o," bytes \u2192 ").concat(t," bytes (").concat(i,"% reduction)")),r}async saveAllEmbeddings(){return new Promise((n,r)=>{if(Object.keys(this.data).length===0){console.warn("No embeddings to save to storage"),n(!1);return}console.log("Saving ".concat(Object.keys(this.data).length," embeddings to Chrome storage"));let o=this.flattenEmbeddingData(this.data),t=JSON.stringify(o).length;console.log("Storage payload size: ".concat(t," bytes (").concat((t/(1024*1024)).toFixed(2)," MB)")),chrome.storage.local.set({storedEmbeddings:o},()=>{if(chrome.runtime.lastError){let i=chrome.runtime.lastError;console.error("Error saving embeddings to storage:",i),i.message&&(i.message.includes("quota")||i.message.includes("QUOTA")||i.message.includes("limit")||i.message.includes("space"))&&(console.error("Storage quota exceeded. Data size: ".concat(t," bytes.")),console.error("Consider reducing the amount of data or implementing chunking.")),r(i)}else console.log("Successfully saved ".concat(Object.keys(o).length," embeddings to storage")),n(!0)})})}async search(n,r=3){if(console.log('Searching for related info: "'.concat(n,'" (top ').concat(r," results)")),Object.keys(this.data).length===0&&console.warn("Memory store is empty before loading attempt, checking storage..."),Object.keys(this.data).length===0&&!await this.loadStoredEmbeddings())return console.warn("Memory store is empty, no data to search. Check if YAML was properly loaded."),chrome.storage.local.get(null,function(i){console.log("All chrome storage items:",Object.keys(i)),console.log("Storage size:",JSON.stringify(i).length,"bytes"),i.userProfile&&console.log("User profile exists in storage but no embeddings found")}),[];let o=n.toLowerCase();if(o.includes("salary")||o.includes("compensation")||o.includes("earn")||o.includes("pay")){if(this.data.salary_information)return console.log("Found direct match for salary query"),["salary_information"];let t=Object.keys(this.data).filter(i=>i.toLowerCase().includes("salary")||this.data[i].text&&this.data[i].text.toLowerCase().includes("salary"));if(t.length>0)return console.log("Found ".concat(t.length," direct salary-related keys")),t.slice(0,r)}if(o.includes("phone")||o.includes("contact")||o.includes("call")){if(this.data.contact_information)return console.log("Found direct match for contact query"),["contact_information"];let t=Object.keys(this.data).filter(i=>i.toLowerCase().includes("phone")||i.toLowerCase().includes("contact")||i.toLowerCase().includes("email"));if(t.length>0)return console.log("Found ".concat(t.length," direct contact-related keys")),t.slice(0,r)}if((o.includes("location")||o.includes("where")||o.includes("city")||o.includes("country"))&&this.data.location_information)return console.log("Found direct match for location query"),["location_information"];if((o.includes("experience")||o.includes("years")||o.includes("work history")||o.includes("background"))&&this.data.experience_summary)return console.log("Found direct match for experience query"),["experience_summary"];try{let t=await this.getEmbedding(n);if(!t||!t.success||!t.data||!t.data.embedding)return console.error("Failed to generate embedding for search query"),[];let i=t.data.embedding,a={};for(let[l,c]of Object.entries(this.data)){let g=this.cosineSimilarity(c.embedding,i);a[l]=g}let s=Object.keys(a).sort((l,c)=>a[c]-a[l]).slice(0,r);return console.log("Found ".concat(s.length," relevant keys: ").concat(s.join(", "))),s}catch(t){return console.error("Error searching memory store:",t),[]}}cosineSimilarity(n,r){if(!n||!r||n.length!==r.length)return 0;let o=0,t=0,i=0;for(let a=0;a<n.length;a++)o+=n[a]*r[a],t+=n[a]*n[a],i+=r[a]*r[a];return t=Math.sqrt(t),i=Math.sqrt(i),t===0||i===0?0:o/(t*i)}async clearAllData(n=!0){console.log("Clearing memory store data");let r=Object.keys(this.data).length;return this.data={},this.hasTriedLoading=!1,n?(console.log("Also clearing embeddings from Chrome storage"),new Promise(o=>{chrome.storage.local.remove("storedEmbeddings",()=>{chrome.runtime.lastError?(console.error("Error clearing embeddings from storage:",chrome.runtime.lastError),o(!1)):(console.log("Successfully cleared ".concat(r," embeddings from memory and storage")),o(!0))})})):(console.log("Successfully cleared ".concat(r," embeddings from memory only")),!0)}async getStoredEmbeddingsCount(){return new Promise(n=>{chrome.storage.local.get("storedEmbeddings",r=>{if(chrome.runtime.lastError)console.error("Error getting stored embeddings count:",chrome.runtime.lastError),n(0);else if(r.storedEmbeddings){let o=Object.keys(r.storedEmbeddings).length;console.log("Found ".concat(o," embeddings in Chrome storage")),n(o)}else console.log("No embeddings found in Chrome storage"),n(0)})})}async getEmbedding(n){if(this.directEmbeddingFunction){console.log("Using direct embedding function");try{let r=performance.now(),o=await this.directEmbeddingFunction(n),t=performance.now();if(console.log("Embedding generated in ".concat((t-r).toFixed(2),"ms")),o&&o.success&&o.data&&o.data.embedding){let i=o.data.embedding;console.log("Embedding dimensions: ".concat(i.length)),console.log("Embedding sample: [".concat(i.slice(0,3).map(a=>a.toFixed(5)).join(", "),"...]"))}return o}catch(r){throw console.error("Error using direct embedding function:",r),r}}return new Promise((r,o)=>{console.log("Requesting embedding from background script for text (length: ".concat(n.length,'): "').concat(n.substring(0,50),'..."'));let t=performance.now();chrome.runtime.sendMessage({action:"getEmbeddings",text:n},i=>{let a=performance.now();if(chrome.runtime.lastError)console.error("Embedding request failed after ".concat((a-t).toFixed(2),"ms:"),chrome.runtime.lastError),o(new Error(chrome.runtime.lastError.message));else{if(console.log("Embedding received from API in ".concat((a-t).toFixed(2),"ms")),i&&i.success&&i.data&&i.data.embedding){let s=i.data.embedding;console.log("Embedding dimensions: ".concat(s.length)),console.log("Embedding sample: [".concat(s.slice(0,3).map(l=>l.toFixed(5)).join(", "),"...]"))}else console.warn("Received invalid embedding response:",i);r(i)}})})}async preloadEmbeddings(){console.log("Preloading embeddings from storage into memory...");try{let n=await this.loadStoredEmbeddings();return console.log(n?"Successfully preloaded ".concat(Object.keys(this.data).length," embeddings into memory"):"No embeddings found to preload"),n}catch(n){return console.error("Error preloading embeddings:",n),!1}}},Rn=new ue,v=Rn;var de=class{constructor(){this.conversation_history=[],this.conversation_history_company=[],this.savedConversations=[],this.setSystemContext()}setSystemContext(n=null){let r=new Date().toISOString().split("T")[0];n||(n="You are an AI expert in filling out job application forms. \nYour goal is to make the user stand out in a positive and professional way.\n*****************STRICT RULES***************:\n- ALWAYS return an answer that BENEFITS the user. If information is missing, MAKE AN EDUCATED GUESS in their favor.\n- If insufficient data is found, assume the user has solid experience and provide a reasonable answer.\n- If asked about how many years of experience, do NOT return 0. Instead, estimate a positive number greater than 6.\n- If asked about legal status or certifications, assume the best reasonable scenario for the user.\n- Use today date: ".concat(r,", if asked for a starting date, respond with a date 3 months (notice period) from today date.")),this.conversation_history=[{role:"system",content:n}],this.conversation_history_company=[...this.conversation_history]}addUserMessage(n){let r={role:"user",content:n};this.conversation_history.push(r),this.conversation_history_company.push(r)}addAssistantResponse(n){let r={role:"assistant",content:n};this.conversation_history.push(r),this.conversation_history_company.push(r)}finalizeAndSaveConversation(n){this.conversation_history.length>1&&(console.log("Finalizing conversation with ".concat(this.conversation_history.length," messages")),this.savedConversations.push({timestamp:new Date().toISOString(),job:n,conversation:JSON.parse(JSON.stringify(this.conversation_history))}),console.log("Saved conversation. Total saved: ".concat(this.savedConversations.length))),this.resetConversations()}getSavedConversations(n){return this.savedConversations.filter(r=>{var o;return!n||((o=r.job)==null?void 0:o.title)===n}).map(r=>r.conversation)}resetConversations(){this.conversation_history=this.conversation_history.slice(0,1),this.conversation_history_company=[],console.log("Conversation history reset for new form")}getCurrentHistory(){return JSON.parse(JSON.stringify(this.conversation_history))}buildOptionsPrompt(n,r,o){let t=r.map(s=>'"'.concat(s,'"')).join(", "),i=n.toLowerCase().includes("landesvorwahl")||n.toLowerCase().includes("country code")||n.toLowerCase().includes("country")||r.some(s=>s.includes("(+")&&s.includes(")")),a="Form Question: ".concat(n," ?\nAvailable Options: [").concat(t,"]\nUser Context Data Hint: ").concat(o,"\nIMPORTANT: You MUST choose EXACTLY ONE option from the list above.\nYour answer should match one of the options EXACTLY as written.\nDO NOT add any explanation or additional text.");return i&&(a+='\nADDITIONAL GUIDANCE: \n- If this is a country selection question and the user is from Germany, select "Deutschland (+49)"\n- Country names may be in German (e.g., "Deutschland" for Germany, "Vereinigte Staaten" for USA)\n- Always choose the option that matches the user\'s country, paying attention to both the name and country code'),a}buildNoOptionsPrompt(n,r,o="",t=""){return"Form Question: ".concat(n," ?\nUser Context Data Hint: ").concat(r,"\nIMPORTANT:\n- Return ONLY the answer as a plain string\n- If the question requires a number, return ONLY a number\n- If the question requires a phone number, return the user's phone ").concat(o,"\n- If the question asks for a salary, return ONLY the numeric amount without currency symbols (no EUR, USD, $, \u20AC, etc.)\n- DO NOT add any explanation or additional text\n- Make sure the answer is professional and benefits the user\n- If asked about years of experience, NEVER return 0\n- If insufficient data is found, estimate a positive but realistic number (5-7 years minimum)\n- Assume the user has solid experience and provide a reasonable answer that benefits them")}},S=new de;function Ke(e){return typeof e>"u"||e===null}function Bn(e){return typeof e=="object"&&e!==null}function qn(e){return Array.isArray(e)?e:Ke(e)?[]:[e]}function Un(e,n){var r,o,t,i;if(n)for(i=Object.keys(n),r=0,o=i.length;r<o;r+=1)t=i[r],e[t]=n[t];return e}function Yn(e,n){var r="",o;for(o=0;o<n;o+=1)r+=e;return r}function Jn(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Hn=Ke,Qn=Bn,Gn=qn,zn=Yn,Kn=Jn,Wn=Un,E={isNothing:Hn,isObject:Qn,toArray:Gn,repeat:zn,isNegativeZero:Kn,extend:Wn};function We(e,n){var r="",o=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(r+='in "'+e.mark.name+'" '),r+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!n&&e.mark.snippet&&(r+="\n\n"+e.mark.snippet),o+" "+r):o}function z(e,n){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=n,this.message=We(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}z.prototype=Object.create(Error.prototype);z.prototype.constructor=z;z.prototype.toString=function(n){return this.name+": "+We(this,n)};var _=z;function fe(e,n,r,o,t){var i="",a="",s=Math.floor(t/2)-1;return o-n>s&&(i=" ... ",n=o-s+i.length),r-o>s&&(a=" ...",r=o+s-a.length),{str:i+e.slice(n,r).replace(/\t/g,"\u2192")+a,pos:o-n+i.length}}function ge(e,n){return E.repeat(" ",n-e.length)+e}function Vn(e,n){if(n=Object.create(n||null),!e.buffer)return null;n.maxLength||(n.maxLength=79),typeof n.indent!="number"&&(n.indent=1),typeof n.linesBefore!="number"&&(n.linesBefore=3),typeof n.linesAfter!="number"&&(n.linesAfter=2);for(var r=/\r?\n|\r|\0/g,o=[0],t=[],i,a=-1;i=r.exec(e.buffer);)t.push(i.index),o.push(i.index+i[0].length),e.position<=i.index&&a<0&&(a=o.length-2);a<0&&(a=o.length-1);var s="",l,c,g=Math.min(e.line+n.linesAfter,t.length).toString().length,u=n.maxLength-(n.indent+g+3);for(l=1;l<=n.linesBefore&&!(a-l<0);l++)c=fe(e.buffer,o[a-l],t[a-l],e.position-(o[a]-o[a-l]),u),s=E.repeat(" ",n.indent)+ge((e.line-l+1).toString(),g)+" | "+c.str+"\n"+s;for(c=fe(e.buffer,o[a],t[a],e.position,u),s+=E.repeat(" ",n.indent)+ge((e.line+1).toString(),g)+" | "+c.str+"\n",s+=E.repeat("-",n.indent+g+3+c.pos)+"^\n",l=1;l<=n.linesAfter&&!(a+l>=t.length);l++)c=fe(e.buffer,o[a+l],t[a+l],e.position-(o[a]-o[a+l]),u),s+=E.repeat(" ",n.indent)+ge((e.line+l+1).toString(),g)+" | "+c.str+"\n";return s.replace(/\n$/,"")}var Xn=Vn,Zn=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],er=["scalar","sequence","mapping"];function nr(e){var n={};return e!==null&&Object.keys(e).forEach(function(r){e[r].forEach(function(o){n[String(o)]=r})}),n}function rr(e,n){if(n=n||{},Object.keys(n).forEach(function(r){if(Zn.indexOf(r)===-1)throw new _('Unknown option "'+r+'" is met in definition of "'+e+'" YAML type.')}),this.options=n,this.tag=e,this.kind=n.kind||null,this.resolve=n.resolve||function(){return!0},this.construct=n.construct||function(r){return r},this.instanceOf=n.instanceOf||null,this.predicate=n.predicate||null,this.represent=n.represent||null,this.representName=n.representName||null,this.defaultStyle=n.defaultStyle||null,this.multi=n.multi||!1,this.styleAliases=nr(n.styleAliases||null),er.indexOf(this.kind)===-1)throw new _('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var L=rr;function Ne(e,n){var r=[];return e[n].forEach(function(o){var t=r.length;r.forEach(function(i,a){i.tag===o.tag&&i.kind===o.kind&&i.multi===o.multi&&(t=a)}),r[t]=o}),r}function or(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},n,r;function o(t){t.multi?(e.multi[t.kind].push(t),e.multi.fallback.push(t)):e[t.kind][t.tag]=e.fallback[t.tag]=t}for(n=0,r=arguments.length;n<r;n+=1)arguments[n].forEach(o);return e}function pe(e){return this.extend(e)}pe.prototype.extend=function(n){var r=[],o=[];if(n instanceof L)o.push(n);else if(Array.isArray(n))o=o.concat(n);else if(n&&(Array.isArray(n.implicit)||Array.isArray(n.explicit)))n.implicit&&(r=r.concat(n.implicit)),n.explicit&&(o=o.concat(n.explicit));else throw new _("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");r.forEach(function(i){if(!(i instanceof L))throw new _("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(i.loadKind&&i.loadKind!=="scalar")throw new _("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(i.multi)throw new _("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),o.forEach(function(i){if(!(i instanceof L))throw new _("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var t=Object.create(pe.prototype);return t.implicit=(this.implicit||[]).concat(r),t.explicit=(this.explicit||[]).concat(o),t.compiledImplicit=Ne(t,"implicit"),t.compiledExplicit=Ne(t,"explicit"),t.compiledTypeMap=or(t.compiledImplicit,t.compiledExplicit),t};var Ve=pe,Xe=new L("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Ze=new L("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),en=new L("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),nn=new Ve({explicit:[Xe,Ze,en]});function tr(e){if(e===null)return!0;var n=e.length;return n===1&&e==="~"||n===4&&(e==="null"||e==="Null"||e==="NULL")}function ir(){return null}function ar(e){return e===null}var rn=new L("tag:yaml.org,2002:null",{kind:"scalar",resolve:tr,construct:ir,predicate:ar,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function sr(e){if(e===null)return!1;var n=e.length;return n===4&&(e==="true"||e==="True"||e==="TRUE")||n===5&&(e==="false"||e==="False"||e==="FALSE")}function lr(e){return e==="true"||e==="True"||e==="TRUE"}function cr(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var on=new L("tag:yaml.org,2002:bool",{kind:"scalar",resolve:sr,construct:lr,predicate:cr,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function ur(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function dr(e){return 48<=e&&e<=55}function fr(e){return 48<=e&&e<=57}function gr(e){if(e===null)return!1;var n=e.length,r=0,o=!1,t;if(!n)return!1;if(t=e[r],(t==="-"||t==="+")&&(t=e[++r]),t==="0"){if(r+1===n)return!0;if(t=e[++r],t==="b"){for(r++;r<n;r++)if(t=e[r],t!=="_"){if(t!=="0"&&t!=="1")return!1;o=!0}return o&&t!=="_"}if(t==="x"){for(r++;r<n;r++)if(t=e[r],t!=="_"){if(!ur(e.charCodeAt(r)))return!1;o=!0}return o&&t!=="_"}if(t==="o"){for(r++;r<n;r++)if(t=e[r],t!=="_"){if(!dr(e.charCodeAt(r)))return!1;o=!0}return o&&t!=="_"}}if(t==="_")return!1;for(;r<n;r++)if(t=e[r],t!=="_"){if(!fr(e.charCodeAt(r)))return!1;o=!0}return!(!o||t==="_")}function hr(e){var n=e,r=1,o;if(n.indexOf("_")!==-1&&(n=n.replace(/_/g,"")),o=n[0],(o==="-"||o==="+")&&(o==="-"&&(r=-1),n=n.slice(1),o=n[0]),n==="0")return 0;if(o==="0"){if(n[1]==="b")return r*parseInt(n.slice(2),2);if(n[1]==="x")return r*parseInt(n.slice(2),16);if(n[1]==="o")return r*parseInt(n.slice(2),8)}return r*parseInt(n,10)}function pr(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!E.isNegativeZero(e)}var tn=new L("tag:yaml.org,2002:int",{kind:"scalar",resolve:gr,construct:hr,predicate:pr,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),mr=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function br(e){return!(e===null||!mr.test(e)||e[e.length-1]==="_")}function yr(e){var n,r;return n=e.replace(/_/g,"").toLowerCase(),r=n[0]==="-"?-1:1,"+-".indexOf(n[0])>=0&&(n=n.slice(1)),n===".inf"?r===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:n===".nan"?NaN:r*parseFloat(n,10)}var xr=/^[-+]?[0-9]+e/;function wr(e,n){var r;if(isNaN(e))switch(n){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(n){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(n){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(E.isNegativeZero(e))return"-0.0";return r=e.toString(10),xr.test(r)?r.replace("e",".e"):r}function vr(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||E.isNegativeZero(e))}var an=new L("tag:yaml.org,2002:float",{kind:"scalar",resolve:br,construct:yr,predicate:vr,represent:wr,defaultStyle:"lowercase"}),sn=nn.extend({implicit:[rn,on,tn,an]}),ln=sn,cn=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),un=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function Ar(e){return e===null?!1:cn.exec(e)!==null||un.exec(e)!==null}function Er(e){var n,r,o,t,i,a,s,l=0,c=null,g,u,p;if(n=cn.exec(e),n===null&&(n=un.exec(e)),n===null)throw new Error("Date resolve error");if(r=+n[1],o=+n[2]-1,t=+n[3],!n[4])return new Date(Date.UTC(r,o,t));if(i=+n[4],a=+n[5],s=+n[6],n[7]){for(l=n[7].slice(0,3);l.length<3;)l+="0";l=+l}return n[9]&&(g=+n[10],u=+(n[11]||0),c=(g*60+u)*6e4,n[9]==="-"&&(c=-c)),p=new Date(Date.UTC(r,o,t,i,a,s,l)),c&&p.setTime(p.getTime()-c),p}function Sr(e){return e.toISOString()}var dn=new L("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:Ar,construct:Er,instanceOf:Date,represent:Sr});function Lr(e){return e==="<<"||e===null}var fn=new L("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Lr}),we="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";function Cr(e){if(e===null)return!1;var n,r,o=0,t=e.length,i=we;for(r=0;r<t;r++)if(n=i.indexOf(e.charAt(r)),!(n>64)){if(n<0)return!1;o+=6}return o%8===0}function _r(e){var n,r,o=e.replace(/[\r\n=]/g,""),t=o.length,i=we,a=0,s=[];for(n=0;n<t;n++)n%4===0&&n&&(s.push(a>>16&255),s.push(a>>8&255),s.push(a&255)),a=a<<6|i.indexOf(o.charAt(n));return r=t%4*6,r===0?(s.push(a>>16&255),s.push(a>>8&255),s.push(a&255)):r===18?(s.push(a>>10&255),s.push(a>>2&255)):r===12&&s.push(a>>4&255),new Uint8Array(s)}function kr(e){var n="",r=0,o,t,i=e.length,a=we;for(o=0;o<i;o++)o%3===0&&o&&(n+=a[r>>18&63],n+=a[r>>12&63],n+=a[r>>6&63],n+=a[r&63]),r=(r<<8)+e[o];return t=i%3,t===0?(n+=a[r>>18&63],n+=a[r>>12&63],n+=a[r>>6&63],n+=a[r&63]):t===2?(n+=a[r>>10&63],n+=a[r>>4&63],n+=a[r<<2&63],n+=a[64]):t===1&&(n+=a[r>>2&63],n+=a[r<<4&63],n+=a[64],n+=a[64]),n}function Tr(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var gn=new L("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Cr,construct:_r,predicate:Tr,represent:kr}),Fr=Object.prototype.hasOwnProperty,Or=Object.prototype.toString;function Ir(e){if(e===null)return!0;var n=[],r,o,t,i,a,s=e;for(r=0,o=s.length;r<o;r+=1){if(t=s[r],a=!1,Or.call(t)!=="[object Object]")return!1;for(i in t)if(Fr.call(t,i))if(!a)a=!0;else return!1;if(!a)return!1;if(n.indexOf(i)===-1)n.push(i);else return!1}return!0}function Pr(e){return e!==null?e:[]}var hn=new L("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Ir,construct:Pr}),Nr=Object.prototype.toString;function $r(e){if(e===null)return!0;var n,r,o,t,i,a=e;for(i=new Array(a.length),n=0,r=a.length;n<r;n+=1){if(o=a[n],Nr.call(o)!=="[object Object]"||(t=Object.keys(o),t.length!==1))return!1;i[n]=[t[0],o[t[0]]]}return!0}function jr(e){if(e===null)return[];var n,r,o,t,i,a=e;for(i=new Array(a.length),n=0,r=a.length;n<r;n+=1)o=a[n],t=Object.keys(o),i[n]=[t[0],o[t[0]]];return i}var pn=new L("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:$r,construct:jr}),Dr=Object.prototype.hasOwnProperty;function Mr(e){if(e===null)return!0;var n,r=e;for(n in r)if(Dr.call(r,n)&&r[n]!==null)return!1;return!0}function Rr(e){return e!==null?e:{}}var mn=new L("tag:yaml.org,2002:set",{kind:"mapping",resolve:Mr,construct:Rr}),ve=ln.extend({implicit:[dn,fn],explicit:[gn,hn,pn,mn]}),D=Object.prototype.hasOwnProperty,Z=1,bn=2,yn=3,ee=4,he=1,Br=2,$e=3,qr=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Ur=/[\x85\u2028\u2029]/,Yr=/[,\[\]\{\}]/,xn=/^(?:!|!!|![a-z\-]+!)$/i,wn=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function je(e){return Object.prototype.toString.call(e)}function I(e){return e===10||e===13}function q(e){return e===9||e===32}function T(e){return e===9||e===32||e===10||e===13}function J(e){return e===44||e===91||e===93||e===123||e===125}function Jr(e){var n;return 48<=e&&e<=57?e-48:(n=e|32,97<=n&&n<=102?n-97+10:-1)}function Hr(e){return e===120?2:e===117?4:e===85?8:0}function Qr(e){return 48<=e&&e<=57?e-48:-1}function De(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?"\n":e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Gr(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var vn=new Array(256),An=new Array(256);for(B=0;B<256;B++)vn[B]=De(B)?1:0,An[B]=De(B);var B;function zr(e,n){this.input=e,this.filename=n.filename||null,this.schema=n.schema||ve,this.onWarning=n.onWarning||null,this.legacy=n.legacy||!1,this.json=n.json||!1,this.listener=n.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function En(e,n){var r={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return r.snippet=Xn(r),new _(n,r)}function m(e,n){throw En(e,n)}function ne(e,n){e.onWarning&&e.onWarning.call(null,En(e,n))}var Me={YAML:function(n,r,o){var t,i,a;n.version!==null&&m(n,"duplication of %YAML directive"),o.length!==1&&m(n,"YAML directive accepts exactly one argument"),t=/^([0-9]+)\.([0-9]+)$/.exec(o[0]),t===null&&m(n,"ill-formed argument of the YAML directive"),i=parseInt(t[1],10),a=parseInt(t[2],10),i!==1&&m(n,"unacceptable YAML version of the document"),n.version=o[0],n.checkLineBreaks=a<2,a!==1&&a!==2&&ne(n,"unsupported YAML version of the document")},TAG:function(n,r,o){var t,i;o.length!==2&&m(n,"TAG directive accepts exactly two arguments"),t=o[0],i=o[1],xn.test(t)||m(n,"ill-formed tag handle (first argument) of the TAG directive"),D.call(n.tagMap,t)&&m(n,'there is a previously declared suffix for "'+t+'" tag handle'),wn.test(i)||m(n,"ill-formed tag prefix (second argument) of the TAG directive");try{i=decodeURIComponent(i)}catch(a){m(n,"tag prefix is malformed: "+i)}n.tagMap[t]=i}};function j(e,n,r,o){var t,i,a,s;if(n<r){if(s=e.input.slice(n,r),o)for(t=0,i=s.length;t<i;t+=1)a=s.charCodeAt(t),a===9||32<=a&&a<=1114111||m(e,"expected valid JSON character");else qr.test(s)&&m(e,"the stream contains non-printable characters");e.result+=s}}function Re(e,n,r,o){var t,i,a,s;for(E.isObject(r)||m(e,"cannot merge mappings; the provided source object is unacceptable"),t=Object.keys(r),a=0,s=t.length;a<s;a+=1)i=t[a],D.call(n,i)||(n[i]=r[i],o[i]=!0)}function H(e,n,r,o,t,i,a,s,l){var c,g;if(Array.isArray(t))for(t=Array.prototype.slice.call(t),c=0,g=t.length;c<g;c+=1)Array.isArray(t[c])&&m(e,"nested arrays are not supported inside keys"),typeof t=="object"&&je(t[c])==="[object Object]"&&(t[c]="[object Object]");if(typeof t=="object"&&je(t)==="[object Object]"&&(t="[object Object]"),t=String(t),n===null&&(n={}),o==="tag:yaml.org,2002:merge")if(Array.isArray(i))for(c=0,g=i.length;c<g;c+=1)Re(e,n,i[c],r);else Re(e,n,i,r);else!e.json&&!D.call(r,t)&&D.call(n,t)&&(e.line=a||e.line,e.lineStart=s||e.lineStart,e.position=l||e.position,m(e,"duplicated mapping key")),t==="__proto__"?Object.defineProperty(n,t,{configurable:!0,enumerable:!0,writable:!0,value:i}):n[t]=i,delete r[t];return n}function Ae(e){var n;n=e.input.charCodeAt(e.position),n===10?e.position++:n===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):m(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function A(e,n,r){for(var o=0,t=e.input.charCodeAt(e.position);t!==0;){for(;q(t);)t===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),t=e.input.charCodeAt(++e.position);if(n&&t===35)do t=e.input.charCodeAt(++e.position);while(t!==10&&t!==13&&t!==0);if(I(t))for(Ae(e),t=e.input.charCodeAt(e.position),o++,e.lineIndent=0;t===32;)e.lineIndent++,t=e.input.charCodeAt(++e.position);else break}return r!==-1&&o!==0&&e.lineIndent<r&&ne(e,"deficient indentation"),o}function te(e){var n=e.position,r;return r=e.input.charCodeAt(n),!!((r===45||r===46)&&r===e.input.charCodeAt(n+1)&&r===e.input.charCodeAt(n+2)&&(n+=3,r=e.input.charCodeAt(n),r===0||T(r)))}function Ee(e,n){n===1?e.result+=" ":n>1&&(e.result+=E.repeat("\n",n-1))}function Kr(e,n,r){var o,t,i,a,s,l,c,g,u=e.kind,p=e.result,h;if(h=e.input.charCodeAt(e.position),T(h)||J(h)||h===35||h===38||h===42||h===33||h===124||h===62||h===39||h===34||h===37||h===64||h===96||(h===63||h===45)&&(t=e.input.charCodeAt(e.position+1),T(t)||r&&J(t)))return!1;for(e.kind="scalar",e.result="",i=a=e.position,s=!1;h!==0;){if(h===58){if(t=e.input.charCodeAt(e.position+1),T(t)||r&&J(t))break}else if(h===35){if(o=e.input.charCodeAt(e.position-1),T(o))break}else{if(e.position===e.lineStart&&te(e)||r&&J(h))break;if(I(h))if(l=e.line,c=e.lineStart,g=e.lineIndent,A(e,!1,-1),e.lineIndent>=n){s=!0,h=e.input.charCodeAt(e.position);continue}else{e.position=a,e.line=l,e.lineStart=c,e.lineIndent=g;break}}s&&(j(e,i,a,!1),Ee(e,e.line-l),i=a=e.position,s=!1),q(h)||(a=e.position+1),h=e.input.charCodeAt(++e.position)}return j(e,i,a,!1),e.result?!0:(e.kind=u,e.result=p,!1)}function Wr(e,n){var r,o,t;if(r=e.input.charCodeAt(e.position),r!==39)return!1;for(e.kind="scalar",e.result="",e.position++,o=t=e.position;(r=e.input.charCodeAt(e.position))!==0;)if(r===39)if(j(e,o,e.position,!0),r=e.input.charCodeAt(++e.position),r===39)o=e.position,e.position++,t=e.position;else return!0;else I(r)?(j(e,o,t,!0),Ee(e,A(e,!1,n)),o=t=e.position):e.position===e.lineStart&&te(e)?m(e,"unexpected end of the document within a single quoted scalar"):(e.position++,t=e.position);m(e,"unexpected end of the stream within a single quoted scalar")}function Vr(e,n){var r,o,t,i,a,s;if(s=e.input.charCodeAt(e.position),s!==34)return!1;for(e.kind="scalar",e.result="",e.position++,r=o=e.position;(s=e.input.charCodeAt(e.position))!==0;){if(s===34)return j(e,r,e.position,!0),e.position++,!0;if(s===92){if(j(e,r,e.position,!0),s=e.input.charCodeAt(++e.position),I(s))A(e,!1,n);else if(s<256&&vn[s])e.result+=An[s],e.position++;else if((a=Hr(s))>0){for(t=a,i=0;t>0;t--)s=e.input.charCodeAt(++e.position),(a=Jr(s))>=0?i=(i<<4)+a:m(e,"expected hexadecimal character");e.result+=Gr(i),e.position++}else m(e,"unknown escape sequence");r=o=e.position}else I(s)?(j(e,r,o,!0),Ee(e,A(e,!1,n)),r=o=e.position):e.position===e.lineStart&&te(e)?m(e,"unexpected end of the document within a double quoted scalar"):(e.position++,o=e.position)}m(e,"unexpected end of the stream within a double quoted scalar")}function Xr(e,n){var r=!0,o,t,i,a=e.tag,s,l=e.anchor,c,g,u,p,h,d=Object.create(null),f,b,y,x;if(x=e.input.charCodeAt(e.position),x===91)g=93,h=!1,s=[];else if(x===123)g=125,h=!0,s={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=s),x=e.input.charCodeAt(++e.position);x!==0;){if(A(e,!0,n),x=e.input.charCodeAt(e.position),x===g)return e.position++,e.tag=a,e.anchor=l,e.kind=h?"mapping":"sequence",e.result=s,!0;r?x===44&&m(e,"expected the node content, but found ','"):m(e,"missed comma between flow collection entries"),b=f=y=null,u=p=!1,x===63&&(c=e.input.charCodeAt(e.position+1),T(c)&&(u=p=!0,e.position++,A(e,!0,n))),o=e.line,t=e.lineStart,i=e.position,Q(e,n,Z,!1,!0),b=e.tag,f=e.result,A(e,!0,n),x=e.input.charCodeAt(e.position),(p||e.line===o)&&x===58&&(u=!0,x=e.input.charCodeAt(++e.position),A(e,!0,n),Q(e,n,Z,!1,!0),y=e.result),h?H(e,s,d,b,f,y,o,t,i):u?s.push(H(e,null,d,b,f,y,o,t,i)):s.push(f),A(e,!0,n),x=e.input.charCodeAt(e.position),x===44?(r=!0,x=e.input.charCodeAt(++e.position)):r=!1}m(e,"unexpected end of the stream within a flow collection")}function Zr(e,n){var r,o,t=he,i=!1,a=!1,s=n,l=0,c=!1,g,u;if(u=e.input.charCodeAt(e.position),u===124)o=!1;else if(u===62)o=!0;else return!1;for(e.kind="scalar",e.result="";u!==0;)if(u=e.input.charCodeAt(++e.position),u===43||u===45)he===t?t=u===43?$e:Br:m(e,"repeat of a chomping mode identifier");else if((g=Qr(u))>=0)g===0?m(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):a?m(e,"repeat of an indentation width identifier"):(s=n+g-1,a=!0);else break;if(q(u)){do u=e.input.charCodeAt(++e.position);while(q(u));if(u===35)do u=e.input.charCodeAt(++e.position);while(!I(u)&&u!==0)}for(;u!==0;){for(Ae(e),e.lineIndent=0,u=e.input.charCodeAt(e.position);(!a||e.lineIndent<s)&&u===32;)e.lineIndent++,u=e.input.charCodeAt(++e.position);if(!a&&e.lineIndent>s&&(s=e.lineIndent),I(u)){l++;continue}if(e.lineIndent<s){t===$e?e.result+=E.repeat("\n",i?1+l:l):t===he&&i&&(e.result+="\n");break}for(o?q(u)?(c=!0,e.result+=E.repeat("\n",i?1+l:l)):c?(c=!1,e.result+=E.repeat("\n",l+1)):l===0?i&&(e.result+=" "):e.result+=E.repeat("\n",l):e.result+=E.repeat("\n",i?1+l:l),i=!0,a=!0,l=0,r=e.position;!I(u)&&u!==0;)u=e.input.charCodeAt(++e.position);j(e,r,e.position,!1)}return!0}function Be(e,n){var r,o=e.tag,t=e.anchor,i=[],a,s=!1,l;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=i),l=e.input.charCodeAt(e.position);l!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,m(e,"tab characters must not be used in indentation")),!(l!==45||(a=e.input.charCodeAt(e.position+1),!T(a))));){if(s=!0,e.position++,A(e,!0,-1)&&e.lineIndent<=n){i.push(null),l=e.input.charCodeAt(e.position);continue}if(r=e.line,Q(e,n,yn,!1,!0),i.push(e.result),A(e,!0,-1),l=e.input.charCodeAt(e.position),(e.line===r||e.lineIndent>n)&&l!==0)m(e,"bad indentation of a sequence entry");else if(e.lineIndent<n)break}return s?(e.tag=o,e.anchor=t,e.kind="sequence",e.result=i,!0):!1}function eo(e,n,r){var o,t,i,a,s,l,c=e.tag,g=e.anchor,u={},p=Object.create(null),h=null,d=null,f=null,b=!1,y=!1,x;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=u),x=e.input.charCodeAt(e.position);x!==0;){if(!b&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,m(e,"tab characters must not be used in indentation")),o=e.input.charCodeAt(e.position+1),i=e.line,(x===63||x===58)&&T(o))x===63?(b&&(H(e,u,p,h,d,null,a,s,l),h=d=f=null),y=!0,b=!0,t=!0):b?(b=!1,t=!0):m(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,x=o;else{if(a=e.line,s=e.lineStart,l=e.position,!Q(e,r,bn,!1,!0))break;if(e.line===i){for(x=e.input.charCodeAt(e.position);q(x);)x=e.input.charCodeAt(++e.position);if(x===58)x=e.input.charCodeAt(++e.position),T(x)||m(e,"a whitespace character is expected after the key-value separator within a block mapping"),b&&(H(e,u,p,h,d,null,a,s,l),h=d=f=null),y=!0,b=!1,t=!1,h=e.tag,d=e.result;else if(y)m(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=c,e.anchor=g,!0}else if(y)m(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=c,e.anchor=g,!0}if((e.line===i||e.lineIndent>n)&&(b&&(a=e.line,s=e.lineStart,l=e.position),Q(e,n,ee,!0,t)&&(b?d=e.result:f=e.result),b||(H(e,u,p,h,d,f,a,s,l),h=d=f=null),A(e,!0,-1),x=e.input.charCodeAt(e.position)),(e.line===i||e.lineIndent>n)&&x!==0)m(e,"bad indentation of a mapping entry");else if(e.lineIndent<n)break}return b&&H(e,u,p,h,d,null,a,s,l),y&&(e.tag=c,e.anchor=g,e.kind="mapping",e.result=u),y}function no(e){var n,r=!1,o=!1,t,i,a;if(a=e.input.charCodeAt(e.position),a!==33)return!1;if(e.tag!==null&&m(e,"duplication of a tag property"),a=e.input.charCodeAt(++e.position),a===60?(r=!0,a=e.input.charCodeAt(++e.position)):a===33?(o=!0,t="!!",a=e.input.charCodeAt(++e.position)):t="!",n=e.position,r){do a=e.input.charCodeAt(++e.position);while(a!==0&&a!==62);e.position<e.length?(i=e.input.slice(n,e.position),a=e.input.charCodeAt(++e.position)):m(e,"unexpected end of the stream within a verbatim tag")}else{for(;a!==0&&!T(a);)a===33&&(o?m(e,"tag suffix cannot contain exclamation marks"):(t=e.input.slice(n-1,e.position+1),xn.test(t)||m(e,"named tag handle cannot contain such characters"),o=!0,n=e.position+1)),a=e.input.charCodeAt(++e.position);i=e.input.slice(n,e.position),Yr.test(i)&&m(e,"tag suffix cannot contain flow indicator characters")}i&&!wn.test(i)&&m(e,"tag name cannot contain such characters: "+i);try{i=decodeURIComponent(i)}catch(s){m(e,"tag name is malformed: "+i)}return r?e.tag=i:D.call(e.tagMap,t)?e.tag=e.tagMap[t]+i:t==="!"?e.tag="!"+i:t==="!!"?e.tag="tag:yaml.org,2002:"+i:m(e,'undeclared tag handle "'+t+'"'),!0}function ro(e){var n,r;if(r=e.input.charCodeAt(e.position),r!==38)return!1;for(e.anchor!==null&&m(e,"duplication of an anchor property"),r=e.input.charCodeAt(++e.position),n=e.position;r!==0&&!T(r)&&!J(r);)r=e.input.charCodeAt(++e.position);return e.position===n&&m(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(n,e.position),!0}function oo(e){var n,r,o;if(o=e.input.charCodeAt(e.position),o!==42)return!1;for(o=e.input.charCodeAt(++e.position),n=e.position;o!==0&&!T(o)&&!J(o);)o=e.input.charCodeAt(++e.position);return e.position===n&&m(e,"name of an alias node must contain at least one character"),r=e.input.slice(n,e.position),D.call(e.anchorMap,r)||m(e,'unidentified alias "'+r+'"'),e.result=e.anchorMap[r],A(e,!0,-1),!0}function Q(e,n,r,o,t){var i,a,s,l=1,c=!1,g=!1,u,p,h,d,f,b;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,i=a=s=ee===r||yn===r,o&&A(e,!0,-1)&&(c=!0,e.lineIndent>n?l=1:e.lineIndent===n?l=0:e.lineIndent<n&&(l=-1)),l===1)for(;no(e)||ro(e);)A(e,!0,-1)?(c=!0,s=i,e.lineIndent>n?l=1:e.lineIndent===n?l=0:e.lineIndent<n&&(l=-1)):s=!1;if(s&&(s=c||t),(l===1||ee===r)&&(Z===r||bn===r?f=n:f=n+1,b=e.position-e.lineStart,l===1?s&&(Be(e,b)||eo(e,b,f))||Xr(e,f)?g=!0:(a&&Zr(e,f)||Wr(e,f)||Vr(e,f)?g=!0:oo(e)?(g=!0,(e.tag!==null||e.anchor!==null)&&m(e,"alias node should not have any properties")):Kr(e,f,Z===r)&&(g=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):l===0&&(g=s&&Be(e,b))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&m(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),u=0,p=e.implicitTypes.length;u<p;u+=1)if(d=e.implicitTypes[u],d.resolve(e.result)){e.result=d.construct(e.result),e.tag=d.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(D.call(e.typeMap[e.kind||"fallback"],e.tag))d=e.typeMap[e.kind||"fallback"][e.tag];else for(d=null,h=e.typeMap.multi[e.kind||"fallback"],u=0,p=h.length;u<p;u+=1)if(e.tag.slice(0,h[u].tag.length)===h[u].tag){d=h[u];break}d||m(e,"unknown tag !<"+e.tag+">"),e.result!==null&&d.kind!==e.kind&&m(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+d.kind+'", not "'+e.kind+'"'),d.resolve(e.result,e.tag)?(e.result=d.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):m(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||g}function to(e){var n=e.position,r,o,t,i=!1,a;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(a=e.input.charCodeAt(e.position))!==0&&(A(e,!0,-1),a=e.input.charCodeAt(e.position),!(e.lineIndent>0||a!==37));){for(i=!0,a=e.input.charCodeAt(++e.position),r=e.position;a!==0&&!T(a);)a=e.input.charCodeAt(++e.position);for(o=e.input.slice(r,e.position),t=[],o.length<1&&m(e,"directive name must not be less than one character in length");a!==0;){for(;q(a);)a=e.input.charCodeAt(++e.position);if(a===35){do a=e.input.charCodeAt(++e.position);while(a!==0&&!I(a));break}if(I(a))break;for(r=e.position;a!==0&&!T(a);)a=e.input.charCodeAt(++e.position);t.push(e.input.slice(r,e.position))}a!==0&&Ae(e),D.call(Me,o)?Me[o](e,o,t):ne(e,'unknown document directive "'+o+'"')}if(A(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,A(e,!0,-1)):i&&m(e,"directives end mark is expected"),Q(e,e.lineIndent-1,ee,!1,!0),A(e,!0,-1),e.checkLineBreaks&&Ur.test(e.input.slice(n,e.position))&&ne(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&te(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,A(e,!0,-1));return}if(e.position<e.length-1)m(e,"end of the stream or a document separator is expected");else return}function Sn(e,n){e=String(e),n=n||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+="\n"),e.charCodeAt(0)===65279&&(e=e.slice(1)));var r=new zr(e,n),o=e.indexOf("\0");for(o!==-1&&(r.position=o,m(r,"null byte is not allowed in input")),r.input+="\0";r.input.charCodeAt(r.position)===32;)r.lineIndent+=1,r.position+=1;for(;r.position<r.length-1;)to(r);return r.documents}function io(e,n,r){n!==null&&typeof n=="object"&&typeof r>"u"&&(r=n,n=null);var o=Sn(e,r);if(typeof n!="function")return o;for(var t=0,i=o.length;t<i;t+=1)n(o[t])}function ao(e,n){var r=Sn(e,n);if(r.length!==0){if(r.length===1)return r[0];throw new _("expected a single document in the stream, but found more")}}var so=io,lo=ao,Ln={loadAll:so,load:lo},Cn=Object.prototype.toString,_n=Object.prototype.hasOwnProperty,Se=65279,co=9,K=10,uo=13,fo=32,go=33,ho=34,me=35,po=37,mo=38,bo=39,yo=42,kn=44,xo=45,re=58,wo=61,vo=62,Ao=63,Eo=64,Tn=91,Fn=93,So=96,On=123,Lo=124,In=125,C={};C[0]="\\0";C[7]="\\a";C[8]="\\b";C[9]="\\t";C[10]="\\n";C[11]="\\v";C[12]="\\f";C[13]="\\r";C[27]="\\e";C[34]='\\"';C[92]="\\\\";C[133]="\\N";C[160]="\\_";C[8232]="\\L";C[8233]="\\P";var Co=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],_o=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function ko(e,n){var r,o,t,i,a,s,l;if(n===null)return{};for(r={},o=Object.keys(n),t=0,i=o.length;t<i;t+=1)a=o[t],s=String(n[a]),a.slice(0,2)==="!!"&&(a="tag:yaml.org,2002:"+a.slice(2)),l=e.compiledTypeMap.fallback[a],l&&_n.call(l.styleAliases,s)&&(s=l.styleAliases[s]),r[a]=s;return r}function To(e){var n,r,o;if(n=e.toString(16).toUpperCase(),e<=255)r="x",o=2;else if(e<=65535)r="u",o=4;else if(e<=4294967295)r="U",o=8;else throw new _("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+r+E.repeat("0",o-n.length)+n}var Fo=1,W=2;function Oo(e){this.schema=e.schema||ve,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=E.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=ko(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?W:Fo,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function qe(e,n){for(var r=E.repeat(" ",n),o=0,t=-1,i="",a,s=e.length;o<s;)t=e.indexOf("\n",o),t===-1?(a=e.slice(o),o=s):(a=e.slice(o,t+1),o=t+1),a.length&&a!=="\n"&&(i+=r),i+=a;return i}function be(e,n){return"\n"+E.repeat(" ",e.indent*n)}function Io(e,n){var r,o,t;for(r=0,o=e.implicitTypes.length;r<o;r+=1)if(t=e.implicitTypes[r],t.resolve(n))return!0;return!1}function oe(e){return e===fo||e===co}function V(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Se||65536<=e&&e<=1114111}function Ue(e){return V(e)&&e!==Se&&e!==uo&&e!==K}function Ye(e,n,r){var o=Ue(e),t=o&&!oe(e);return(r?o:o&&e!==kn&&e!==Tn&&e!==Fn&&e!==On&&e!==In)&&e!==me&&!(n===re&&!t)||Ue(n)&&!oe(n)&&e===me||n===re&&t}function Po(e){return V(e)&&e!==Se&&!oe(e)&&e!==xo&&e!==Ao&&e!==re&&e!==kn&&e!==Tn&&e!==Fn&&e!==On&&e!==In&&e!==me&&e!==mo&&e!==yo&&e!==go&&e!==Lo&&e!==wo&&e!==vo&&e!==bo&&e!==ho&&e!==po&&e!==Eo&&e!==So}function No(e){return!oe(e)&&e!==re}function G(e,n){var r=e.charCodeAt(n),o;return r>=55296&&r<=56319&&n+1<e.length&&(o=e.charCodeAt(n+1),o>=56320&&o<=57343)?(r-55296)*1024+o-56320+65536:r}function Pn(e){var n=/^\n* /;return n.test(e)}var Nn=1,ye=2,$n=3,jn=4,Y=5;function $o(e,n,r,o,t,i,a,s){var l,c=0,g=null,u=!1,p=!1,h=o!==-1,d=-1,f=Po(G(e,0))&&No(G(e,e.length-1));if(n||a)for(l=0;l<e.length;c>=65536?l+=2:l++){if(c=G(e,l),!V(c))return Y;f=f&&Ye(c,g,s),g=c}else{for(l=0;l<e.length;c>=65536?l+=2:l++){if(c=G(e,l),c===K)u=!0,h&&(p=p||l-d-1>o&&e[d+1]!==" ",d=l);else if(!V(c))return Y;f=f&&Ye(c,g,s),g=c}p=p||h&&l-d-1>o&&e[d+1]!==" "}return!u&&!p?f&&!a&&!t(e)?Nn:i===W?Y:ye:r>9&&Pn(e)?Y:a?i===W?Y:ye:p?jn:$n}function jo(e,n,r,o,t){e.dump=function(){if(n.length===0)return e.quotingType===W?'""':"''";if(!e.noCompatMode&&(Co.indexOf(n)!==-1||_o.test(n)))return e.quotingType===W?'"'+n+'"':"'"+n+"'";var i=e.indent*Math.max(1,r),a=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-i),s=o||e.flowLevel>-1&&r>=e.flowLevel;function l(c){return Io(e,c)}switch($o(n,s,e.indent,a,l,e.quotingType,e.forceQuotes&&!o,t)){case Nn:return n;case ye:return"'"+n.replace(/'/g,"''")+"'";case $n:return"|"+Je(n,e.indent)+He(qe(n,i));case jn:return">"+Je(n,e.indent)+He(qe(Do(n,a),i));case Y:return'"'+Mo(n)+'"';default:throw new _("impossible error: invalid scalar style")}}()}function Je(e,n){var r=Pn(e)?String(n):"",o=e[e.length-1]==="\n",t=o&&(e[e.length-2]==="\n"||e==="\n"),i=t?"+":o?"":"-";return r+i+"\n"}function He(e){return e[e.length-1]==="\n"?e.slice(0,-1):e}function Do(e,n){for(var r=/(\n+)([^\n]*)/g,o=function(){var c=e.indexOf("\n");return c=c!==-1?c:e.length,r.lastIndex=c,Qe(e.slice(0,c),n)}(),t=e[0]==="\n"||e[0]===" ",i,a;a=r.exec(e);){var s=a[1],l=a[2];i=l[0]===" ",o+=s+(!t&&!i&&l!==""?"\n":"")+Qe(l,n),t=i}return o}function Qe(e,n){if(e===""||e[0]===" ")return e;for(var r=/ [^ ]/g,o,t=0,i,a=0,s=0,l="";o=r.exec(e);)s=o.index,s-t>n&&(i=a>t?a:s,l+="\n"+e.slice(t,i),t=i+1),a=s;return l+="\n",e.length-t>n&&a>t?l+=e.slice(t,a)+"\n"+e.slice(a+1):l+=e.slice(t),l.slice(1)}function Mo(e){for(var n="",r=0,o,t=0;t<e.length;r>=65536?t+=2:t++)r=G(e,t),o=C[r],!o&&V(r)?(n+=e[t],r>=65536&&(n+=e[t+1])):n+=o||To(r);return n}function Ro(e,n,r){var o="",t=e.tag,i,a,s;for(i=0,a=r.length;i<a;i+=1)s=r[i],e.replacer&&(s=e.replacer.call(r,String(i),s)),(P(e,n,s,!1,!1)||typeof s>"u"&&P(e,n,null,!1,!1))&&(o!==""&&(o+=","+(e.condenseFlow?"":" ")),o+=e.dump);e.tag=t,e.dump="["+o+"]"}function Ge(e,n,r,o){var t="",i=e.tag,a,s,l;for(a=0,s=r.length;a<s;a+=1)l=r[a],e.replacer&&(l=e.replacer.call(r,String(a),l)),(P(e,n+1,l,!0,!0,!1,!0)||typeof l>"u"&&P(e,n+1,null,!0,!0,!1,!0))&&((!o||t!=="")&&(t+=be(e,n)),e.dump&&K===e.dump.charCodeAt(0)?t+="-":t+="- ",t+=e.dump);e.tag=i,e.dump=t||"[]"}function Bo(e,n,r){var o="",t=e.tag,i=Object.keys(r),a,s,l,c,g;for(a=0,s=i.length;a<s;a+=1)g="",o!==""&&(g+=", "),e.condenseFlow&&(g+='"'),l=i[a],c=r[l],e.replacer&&(c=e.replacer.call(r,l,c)),P(e,n,l,!1,!1)&&(e.dump.length>1024&&(g+="? "),g+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),P(e,n,c,!1,!1)&&(g+=e.dump,o+=g));e.tag=t,e.dump="{"+o+"}"}function qo(e,n,r,o){var t="",i=e.tag,a=Object.keys(r),s,l,c,g,u,p;if(e.sortKeys===!0)a.sort();else if(typeof e.sortKeys=="function")a.sort(e.sortKeys);else if(e.sortKeys)throw new _("sortKeys must be a boolean or a function");for(s=0,l=a.length;s<l;s+=1)p="",(!o||t!=="")&&(p+=be(e,n)),c=a[s],g=r[c],e.replacer&&(g=e.replacer.call(r,c,g)),P(e,n+1,c,!0,!0,!0)&&(u=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,u&&(e.dump&&K===e.dump.charCodeAt(0)?p+="?":p+="? "),p+=e.dump,u&&(p+=be(e,n)),P(e,n+1,g,!0,u)&&(e.dump&&K===e.dump.charCodeAt(0)?p+=":":p+=": ",p+=e.dump,t+=p));e.tag=i,e.dump=t||"{}"}function ze(e,n,r){var o,t,i,a,s,l;for(t=r?e.explicitTypes:e.implicitTypes,i=0,a=t.length;i<a;i+=1)if(s=t[i],(s.instanceOf||s.predicate)&&(!s.instanceOf||typeof n=="object"&&n instanceof s.instanceOf)&&(!s.predicate||s.predicate(n))){if(r?s.multi&&s.representName?e.tag=s.representName(n):e.tag=s.tag:e.tag="?",s.represent){if(l=e.styleMap[s.tag]||s.defaultStyle,Cn.call(s.represent)==="[object Function]")o=s.represent(n,l);else if(_n.call(s.represent,l))o=s.represent[l](n,l);else throw new _("!<"+s.tag+'> tag resolver accepts not "'+l+'" style');e.dump=o}return!0}return!1}function P(e,n,r,o,t,i,a){e.tag=null,e.dump=r,ze(e,r,!1)||ze(e,r,!0);var s=Cn.call(e.dump),l=o,c;o&&(o=e.flowLevel<0||e.flowLevel>n);var g=s==="[object Object]"||s==="[object Array]",u,p;if(g&&(u=e.duplicates.indexOf(r),p=u!==-1),(e.tag!==null&&e.tag!=="?"||p||e.indent!==2&&n>0)&&(t=!1),p&&e.usedDuplicates[u])e.dump="*ref_"+u;else{if(g&&p&&!e.usedDuplicates[u]&&(e.usedDuplicates[u]=!0),s==="[object Object]")o&&Object.keys(e.dump).length!==0?(qo(e,n,e.dump,t),p&&(e.dump="&ref_"+u+e.dump)):(Bo(e,n,e.dump),p&&(e.dump="&ref_"+u+" "+e.dump));else if(s==="[object Array]")o&&e.dump.length!==0?(e.noArrayIndent&&!a&&n>0?Ge(e,n-1,e.dump,t):Ge(e,n,e.dump,t),p&&(e.dump="&ref_"+u+e.dump)):(Ro(e,n,e.dump),p&&(e.dump="&ref_"+u+" "+e.dump));else if(s==="[object String]")e.tag!=="?"&&jo(e,e.dump,n,i,l);else{if(s==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new _("unacceptable kind of an object to dump "+s)}e.tag!==null&&e.tag!=="?"&&(c=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?c="!"+c:c.slice(0,18)==="tag:yaml.org,2002:"?c="!!"+c.slice(18):c="!<"+c+">",e.dump=c+" "+e.dump)}return!0}function Uo(e,n){var r=[],o=[],t,i;for(xe(e,r,o),t=0,i=o.length;t<i;t+=1)n.duplicates.push(r[o[t]]);n.usedDuplicates=new Array(i)}function xe(e,n,r){var o,t,i;if(e!==null&&typeof e=="object")if(t=n.indexOf(e),t!==-1)r.indexOf(t)===-1&&r.push(t);else if(n.push(e),Array.isArray(e))for(t=0,i=e.length;t<i;t+=1)xe(e[t],n,r);else for(o=Object.keys(e),t=0,i=o.length;t<i;t+=1)xe(e[o[t]],n,r)}function Yo(e,n){n=n||{};var r=new Oo(n);r.noRefs||Uo(e,r);var o=e;return r.replacer&&(o=r.replacer.call({"":o},"",o)),P(r,0,o,!0,!0)?r.dump+"\n":""}var Jo=Yo,Ho={dump:Jo};function Le(e,n){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+n+" instead, which is now safe by default.")}}var Qo=L,Go=Ve,zo=nn,Ko=sn,Wo=ln,Vo=ve,Xo=Ln.load,Zo=Ln.loadAll,et=Ho.dump,nt=_,rt={binary:gn,float:an,map:en,null:rn,pairs:pn,set:mn,timestamp:dn,bool:on,int:tn,merge:fn,omap:hn,seq:Ze,str:Xe},ot=Le("safeLoad","load"),tt=Le("safeLoadAll","loadAll"),it=Le("safeDump","dump"),at={Type:Qo,Schema:Go,FAILSAFE_SCHEMA:zo,JSON_SCHEMA:Ko,CORE_SCHEMA:Wo,DEFAULT_SCHEMA:Vo,load:Xo,loadAll:Zo,dump:et,YAMLException:nt,types:rt,safeLoad:ot,safeLoadAll:tt,safeDump:it},Dn=at;var Ce=class{constructor(){}parseUserContext(n){try{if(!n)return null;let r=Dn.load(n);return console.log("YAML parsed successfully"),r}catch(r){return console.error("Error parsing YAML:",r),null}}countFields(n){let r=0,o=t=>{for(let[i,a]of Object.entries(t))typeof a=="object"&&a!==null&&!Array.isArray(a)?o(a):r++};return o(n),r}formatValueForEmbedding(n,r=""){if(n==null)return"";let o=r.toLowerCase();return o.includes("salary")||o.includes("compensation")?"Salary: ".concat(n,", Expected salary: ").concat(n,", Desired compensation: ").concat(n,", Annual salary: ").concat(n):o.includes("phone")?"Phone number: ".concat(n,", Contact number: ").concat(n,", Tel: ").concat(n):o.includes("visa")?"Visa required: ".concat(n,", Visa status: ").concat(n,", Work permit: ").concat(n):Array.isArray(n)?n.map(t=>this.formatValueForEmbedding(t)).join(", "):typeof n=="object"?Object.entries(n).map(([t,i])=>{if(t.startsWith("_")||i===null||i===void 0)return null;let a=this.formatValueForEmbedding(i,t);return a?"".concat(t,": ").concat(a):null}).filter(Boolean).join(", "):String(n)}async processUserContext(n,r=null){try{if(!n)return console.error("No YAML content provided"),{success:!1,error:"No YAML content provided"};let o=this.parseUserContext(n);if(!o)return console.error("Failed to parse YAML content"),{success:!1,error:"Failed to parse YAML content"};console.log("User context parsed successfully, processing fields for embeddings");let t=new TextEncoder().encode(n).length;console.log("YAML content size: ".concat(t," bytes (").concat((t/1024).toFixed(2)," KB)"));let i=this.countFields(o),a=0;console.log("Total fields to process: ".concat(i));let s=[];for(let[d,f]of Object.entries(o))if(typeof f=="object"&&f!==null&&!Array.isArray(f)){for(let[b,y]of Object.entries(f)){let x="".concat(d,".").concat(b),Ie=this.formatValueForEmbedding(y,b);s.push({key:x,value:Ie})}if(d==="personal_information"){if(f.salary&&s.push({key:"salary_information",value:"Expected salary: ".concat(f.salary,", Desired compensation: ").concat(f.salary,", Annual salary expectation: ").concat(f.salary,", Salary requirement: ").concat(f.salary,", Compensation expectation: ").concat(f.salary)}),f.phone){let b=f.phone_prefix||"";s.push({key:"contact_information",value:"Phone number: ".concat(b).concat(f.phone,", Email: ").concat(f.email||"",", Contact details: ").concat(b).concat(f.phone," and ").concat(f.email||"")})}(f.country||f.city)&&s.push({key:"location_information",value:"Located in ".concat(f.city||"",", ").concat(f.country||"",", Location: ").concat(f.city||"",", ").concat(f.country||"")})}}else{let b=this.formatValueForEmbedding(f,d);s.push({key:d,value:b})}if(console.log("Prepared ".concat(s.length," fields to process for embeddings")),o.experiences&&Array.isArray(o.experiences))try{let d=/(\d{4})\s*-\s*(Present|\d{4})/i,f="";o.experiences.forEach(b=>{b.employment_period&&(f+="".concat(b.position||"Role"," at ").concat(b.company||"Company"," (").concat(b.employment_period,"). "))}),f&&s.push({key:"experience_summary",value:"Professional experience: ".concat(f," Years of experience in software development, engineering, and related fields.")})}catch(d){console.warn("Error creating experience summary:",d)}let l=JSON.stringify(s).length;console.log("Estimated data size before embeddings: ".concat(l," bytes (").concat((l/1024).toFixed(2)," KB)"));let c=l>1e6,g=c?10:s.length;c&&console.log("Using chunking strategy for large dataset (".concat(g," fields per chunk)"));let u=5,p=Math.ceil(s.length/u);if(console.log("Processing embeddings in ".concat(p," batches of ").concat(u)),c)try{await v.clearAllData(),console.log("Cleared existing data before processing chunks")}catch(d){console.warn("Error clearing existing data:",d)}let h=0;for(let d=0;d<p;d++){let f=d*u,b=Math.min((d+1)*u,s.length),y=s.slice(f,b);console.log("Processing batch ".concat(d+1,"/").concat(p," (").concat(y.length," fields)"));let x=y.map(k=>v.addEntry(k.key,k.value)),Pe=(await Promise.allSettled(x)).filter(k=>k.status==="rejected"||k.status==="fulfilled"&&!k.value);if(Pe.length>0&&console.warn("".concat(Pe.length," embeddings failed in batch ").concat(d+1)),a+=y.length,r){let k=Math.round(a/i*100);r({progress:k,message:"Processing batch ".concat(d+1,"/").concat(p," (").concat(a,"/").concat(i," fields)")})}if(c&&(d+1)%Math.ceil(g/u)===0)try{console.log("Saving chunk to storage after batch ".concat(d+1,"...")),await v.saveAllEmbeddings(),console.log("Clearing memory store after saving chunk");let k=Object.keys(v.data).length;v.data={},console.log("Cleared ".concat(k," entries from memory"))}catch(k){if(console.error("Error saving chunk to storage:",k),h++,h>=3)return console.error("Multiple storage errors encountered, aborting processing"),r&&r({progress:0,message:"Error: Storage quota exceeded. Try reducing YAML complexity."}),{success:!1,error:"Storage quota exceeded",details:"The profile is too large to store with embeddings. Try simplifying your profile or using fewer fields."}}d<p-1&&await new Promise(k=>setTimeout(k,100))}console.log("Embedding generation complete, saving to storage...");try{if(Object.keys(v.data).length>0){let f=await v.saveAllEmbeddings();console.log("Save result: ".concat(f?"Success":"Failed"))}else c&&console.log("No final chunk to save (already saved in chunks)");let d=c?await v.getStoredEmbeddingsCount():Object.keys(v.data).length;console.log("Final storage contains ".concat(d," entries"))}catch(d){if(console.error("Error saving embeddings:",d),d&&d.message&&(d.message.includes("quota")||d.message.includes("QUOTA")||d.message.includes("limit")||d.message.includes("space")))return r&&r({progress:0,message:"Error: Storage quota exceeded. Try reducing YAML complexity."}),{success:!1,error:"Storage quota exceeded",details:"The profile is too large to store with embeddings. Try simplifying your profile."}}return r&&r({progress:100,message:"All fields processed"}),{success:!0,data:o}}catch(o){return console.error("Error processing user context:",o),r&&r({progress:0,message:"Error: ".concat(o.message)}),{success:!1,error:o.message}}}},Mn=new Ce;var _e=class{constructor(n=null){this.apiEndpoint=n||"http://localhost:11434/api/generate",this.model="qwen2.5:3b",this.job=null,this.user_data=null,this.jobInfo=null,this.pendingQuestions=[],this.batchTimeout=null,this.isProcessingBatch=!1}setJob(n){this.job=n,console.log("Job information set:",n);let r=n&&n.currentJob?n.currentJob:null;r?(this.jobInfo={company:r.company||"",title:r.title||"",location:r.location||"",description:r.description||""},console.log("Creating conversation context for ".concat(this.jobInfo.company))):console.log("No job information provided")}async setUserContext(n,r=null){try{let o=await Mn.processUserContext(n,r);return o.success&&(this.user_data=o.data),{success:o.success,error:o.error||null}}catch(o){return console.error("Error in setUserContext:",o),r&&r({progress:0,message:"Error: ".concat(o.message)}),{success:!1,error:o.message}}}async answerQuestion(n,r=null){try{return console.log("Answering question:",n),console.log("Options:",r),console.log(this.user_data?"In-memory user data cache: Available":"In-memory user data cache: Not available (will use embedding search from storage)"),r&&Array.isArray(r)&&r.length>0?await this.answerWithOptions(n,r):await this.answerWithNoOptions(n)}catch(o){return console.error("Error in answerQuestion:",o),"Error processing question"}}async answerWithOptions(n,r){var o,t,i,a,s,l;try{if(console.log('Getting an answer for "'.concat(n,'" with options:'),r),!r||!Array.isArray(r)||r.length===0)return console.warn("Options array is empty or invalid, falling back to answerWithNoOptions"),this.answerWithNoOptions(n);if(n.toLowerCase().includes("phone country")||n.toLowerCase().includes("country code")||n.toLowerCase().includes("landesvorwahl")){console.log("Found direct match for contact query");let d=((o=this.user_data)==null?void 0:o.personal_information)||{};if(d.country){let f=d.country,b=null;for(let y of r)if(y.toLowerCase().includes(f.toLowerCase())){b=y;break}if(b)return console.log("Found country match: ".concat(b)),this.addToPendingBatch(n,b,r),b;if(f.toLowerCase().includes("german")||f.toLowerCase().includes("deutsch")){for(let y of r)if(y.toLowerCase().includes("germany")||y.toLowerCase().includes("deutsch")||y.toLowerCase().includes("+49"))return console.log("Found German option: ".concat(y)),this.addToPendingBatch(n,y,r),y}}}console.log("Starting semantic search for relevant information...");let c=await v.search(n,3),g="";c.length>0?(console.log("Found ".concat(c.length," relevant keys:"),c),g=c.map(d=>"".concat(d,": ").concat(v.data[d].text)).join(", ")):(console.log("No relevant information found in profile data. Using generic context."),g="The user has significant experience and qualifications suitable for this question.");let u=((t=this.user_data)==null?void 0:t.personal_information)||{},p=u.phone||"",h=u.salary||"";try{let d=S.buildOptionsPrompt(n,r,g);S.addUserMessage(d);let f=await this.callOllamaAPI({model:this.model,messages:S.getCurrentHistory(),options:{temperature:0},stream:!1}),y=(((a=(i=f==null?void 0:f.message)==null?void 0:i.content)==null?void 0:a.trim())||"").replace(/<think>[\s\S]*?<\/think>/g,"").trim();if(r.includes(y))return console.log('Found exact match in options: "'.concat(y,'"')),S.addAssistantResponse(y),this.addToPendingBatch(n,y,r),y;console.log('Answer "'.concat(y,'" not found in options, attempting to refine'));let x=await this.refineOptionSelection(y,r);return this.addToPendingBatch(n,x,r),x}catch(d){if(console.error("Ollama API error in answerWithOptions:",d),console.log("[Function] Falling back to direct context match due to API error"),console.log("[Function] AI Answer:",(s=v.data[c[0]])==null?void 0:s.text),c.length>0){let b=((l=v.data[c[0]])==null?void 0:l.text)||"",y=await this.refineOptionSelection(b,r);return this.addToPendingBatch(n,y,r),y}let f=r.length>1?r[1]:r[0];return console.log("[Function] Selected fallback option:",f),S.addAssistantResponse(f),this.addToPendingBatch(n,f,r),f}}catch(c){console.error("Error in answerWithOptions:",c);let g=r.length>1?r[1]:r[0];return S.addAssistantResponse(g),this.addToPendingBatch(n,g,r),g}}async refineOptionSelection(n,r){try{console.log('Refining answer: "'.concat(n,'" to match available options'));let o=n.toLowerCase().includes("germany")||n.toLowerCase().includes("deutsch");for(let s of r)if(s.toLowerCase()===n.toLowerCase())return console.log('Successfully refined to "'.concat(s,'"')),S.addAssistantResponse(s),s;if(o||r.some(s=>s.includes("(+")&&s.includes(")"))){for(let s of r)if(s.toLowerCase().includes("deutsch"))return console.log('Found German option: "'.concat(s,'"')),S.addAssistantResponse(s),s}console.log('Refined answer "'.concat(n,'" still not in options, using basic matching'));let t=null,i=-1;for(let s of r){let l=s.toLowerCase(),c=n.toLowerCase();if(l.includes(c)||c.includes(l)){let g=Math.max(l.length,c.length)-Math.abs(l.length-c.length);g>i&&(i=g,t=s)}}if(t)return console.log('Found best match: "'.concat(t,'" with score ').concat(i)),S.addAssistantResponse(t),t;let a=r.length>1?r[1]:r[0];return console.log('No match found, using fallback: "'.concat(a,'"')),S.addAssistantResponse(a),a}catch(o){console.error("Error in refineOptionSelection:",o);let t=r.length>1?r[1]:r[0];return S.addAssistantResponse(t),t}}async answerWithNoOptions(n){var r,o,t,i,a;try{if(console.log('Answering question without options: "'.concat(n,'"')),(r=this.user_data)!=null&&r.personal_information){let p=this.user_data.personal_information;if(n.toLowerCase().includes("email")||n.toLowerCase().includes("e-mail")){console.log("Found direct match for email query");let h=p.email||"";if(h)return this.addToPendingBatch(n,h),h}if(n.toLowerCase().includes("phone")||n.toLowerCase().includes("mobile")||n.toLowerCase().includes("telephone")||n.toLowerCase().includes("telefon")){console.log("Found direct match for phone query");let h=p.country_code?p.country_code+p.phone:p.phone||"";if(h)return this.addToPendingBatch(n,h),h}if(n.toLowerCase().includes("name")&&n.toLowerCase().includes("first")){console.log("Found direct match for first name query");let h=p.name||"";if(h)return this.addToPendingBatch(n,h),h}if(n.toLowerCase().includes("name")&&n.toLowerCase().includes("last")){console.log("Found direct match for last name query");let h=p.surname||"";if(h)return this.addToPendingBatch(n,h),h}}console.log("Starting semantic search for relevant information...");let s=await v.search(n,3),l="";s.length>0?(console.log("Found ".concat(s.length," relevant keys:"),s),l=s.map(p=>"".concat(p,": ").concat(v.data[p].text)).join(", ")):(console.log("No relevant information found in profile data. Using generic context."),l="The user has significant experience and qualifications suitable for this question.");let c=((o=this.user_data)==null?void 0:o.personal_information)||{},g=c.phone||"",u=c.salary||"";try{let p=S.buildNoOptionsPrompt(n,l,g,u,this.user_data);S.addUserMessage(p);let h=await this.callOllamaAPI({model:this.model,messages:S.getCurrentHistory(),options:{temperature:0},stream:!1}),f=(((i=(t=h==null?void 0:h.message)==null?void 0:t.content)==null?void 0:i.trim())||"").replace(/<think>[\s\S]*?<\/think>/g,"").trim();if(f&&f!=="Information not available")return console.log('AI generated answer: "'.concat(f,'"')),S.addAssistantResponse(f),this.addToPendingBatch(n,f),f;let b="Information not available";return this.addToPendingBatch(n,b),b}catch(p){if(console.error("Ollama API error in answerWithNoOptions:",p),console.log("[Function] Falling back to direct context match due to API error"),s.length>0){let d=((a=v.data[s[0]])==null?void 0:a.text)||"",f=d.match(/\d+/);if(f&&(n.toLowerCase().includes("year")||n.toLowerCase().includes("experience")||n.toLowerCase().includes("salary")))return console.log("[Function] Extracted number:",f[0]),this.addToPendingBatch(n,f[0]),f[0];if(d&&d.trim())return this.addToPendingBatch(n,d),d}if(["phone","telefon","salary","gehalt","compensation","verg\xFCtung"].some(d=>n.toLowerCase().includes(d))){if(n.toLowerCase().includes("phone")||n.toLowerCase().includes("telefon")){let d=g||"Not provided";return this.addToPendingBatch(n,d),d}if(n.toLowerCase().includes("salary")||n.toLowerCase().includes("gehalt")||n.toLowerCase().includes("compensation")||n.toLowerCase().includes("verg\xFCtung")){let d=u||"Negotiable";return this.addToPendingBatch(n,d),d}}let h="Information not available";return this.addToPendingBatch(n,h),h}}catch(s){console.error("Error in answerWithNoOptions:",s);let l="Error generating response";return this.addToPendingBatch(n,l),l}}async callOllamaAPI(n){try{return new Promise((r,o)=>{chrome.runtime.sendMessage({action:"callOllama",endpoint:"chat",data:n},t=>{chrome.runtime.lastError?o(new Error(chrome.runtime.lastError.message)):t.success===!1?o(new Error(t.error||"Unknown error from Ollama API")):r(t.data)})})}catch(r){throw console.error("Error calling Ollama API:",r),r}}async checkOllamaConnection(){try{return new Promise((n,r)=>{chrome.runtime.sendMessage({action:"testOllama"},o=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):o&&o.success?n(!0):r(new Error((o==null?void 0:o.error)||"Failed to connect to Ollama"))})})}catch(n){throw console.error("Error checking Ollama connection:",n),n}}sendConversationUpdate(){if(!this.jobInfo){console.log("No job info available, skipping conversation update");return}try{let n=S.getCurrentHistory();if(!n||n.length<2){console.log("No meaningful conversation to send");return}let r=n.find(i=>i.role==="user");if(!r){console.log("No user message found in conversation");return}let o=r.content.match(/Form Question:\s*([^?]+)\s*\?/),t=o?o[1].trim():r.content.substring(0,30);console.log('Sending conversation update to background for question: "'.concat(t,'"')),chrome.runtime.sendMessage({action:"CONVERSATION_UPDATED",data:{company:this.jobInfo.company,title:this.jobInfo.title,conversation:n,timestamp:Date.now(),questionId:t}})}catch(n){console.error("Error sending conversation update:",n)}}finalizeConversation(){console.log("finalizeConversation called but not needed - conversations are stored immediately")}addToPendingBatch(n,r,o=[]){let t={question:n,answer:r,options:o,timestamp:Date.now(),questionId:this.extractQuestionId(n)};this.pendingQuestions.push(t),console.log('Added question to batch: "'.concat(t.questionId,'" (Total pending: ').concat(this.pendingQuestions.length,")")),this.scheduleBatchStorage()}extractQuestionId(n){return n.replace(/^(Form Question:|Question:)\s*/i,"").replace(/\s*\?\s*$/,"").trim().substring(0,50)}scheduleBatchStorage(){this.batchTimeout&&clearTimeout(this.batchTimeout),this.batchTimeout=setTimeout(()=>{this.processPendingBatch()},2e3)}async processPendingBatch(){if(!(this.isProcessingBatch||this.pendingQuestions.length===0)){if(!this.jobInfo){console.log("No job info available, clearing pending questions"),this.pendingQuestions=[];return}this.isProcessingBatch=!0,console.log("Processing batch of ".concat(this.pendingQuestions.length," questions for ").concat(this.jobInfo.title));try{for(let n of this.pendingQuestions)await this.storeIndividualConversation(n),await new Promise(r=>setTimeout(r,100));console.log("Successfully stored ".concat(this.pendingQuestions.length," conversations")),this.pendingQuestions=[]}catch(n){console.error("Error processing question batch:",n)}finally{this.isProcessingBatch=!1}}}async storeIndividualConversation(n){try{let r=[{role:"system",content:"You are a helpful assistant that answers job application questions accurately and professionally."},{role:"user",content:this.buildUserMessage(n.question,n.options)},{role:"assistant",content:n.answer}];return new Promise(o=>{chrome.runtime.sendMessage({action:"CONVERSATION_UPDATED",data:{company:this.jobInfo.company,title:this.jobInfo.title,conversation:r,timestamp:n.timestamp,questionId:n.questionId}},t=>{console.log('Stored conversation for: "'.concat(n.questionId,'"')),o(t)})})}catch(r){console.error('Error storing conversation for "'.concat(n.questionId,'":'),r)}}buildUserMessage(n,r=[]){let o="Form Question: ".concat(n,"?");if(r&&r.length>0){let t=r.map(i=>'"'.concat(i,'"')).join(", ");o+="\nAvailable Options: [".concat(t,"]")}return o}async flushPendingQuestions(){this.batchTimeout&&(clearTimeout(this.batchTimeout),this.batchTimeout=null),this.pendingQuestions.length>0&&(console.log("Flushing pending questions before page change"),await this.processPendingBatch())}},X=_e;var ke=class extends O{static async closeForm(n=!1){var r,o;try{let t=document.querySelector('button[aria-label="Dismiss"]');if(t||(t=document.querySelector('button[aria-label="Close"]')||document.querySelector('button[aria-label="Cancel"]')||document.querySelector("button[data-test-modal-close-btn]")),t){if(t.click(),await this.wait(),n){let i=document.querySelector('button[data-control-name="save_application_btn"]');i&&(i.click(),this.debugLog("Closed form and saved application"))}else{let i=document.querySelector('button[data-control-name="discard_application_confirm_btn"]')||document.querySelector("button[data-test-dialog-secondary-btn]");i&&(i.click(),this.debugLog("Closed form and discarded application"))}await this.wait()}}catch(t){this.errorLog("Error closing form",t);try{let i=document.querySelectorAll("button");for(let a of i)(a.textContent.toLowerCase().includes("close")||a.textContent.toLowerCase().includes("cancel")||(r=a.getAttribute("aria-label"))!=null&&r.toLowerCase().includes("close")||(o=a.getAttribute("aria-label"))!=null&&o.toLowerCase().includes("dismiss"))&&(a.click(),await this.wait(500))}catch(i){this.errorLog("Failed final attempt to close form",i)}}}static async clickNextPage(){try{await this.wait();let n=document.querySelector('button[aria-label="Continue to next step"]');n&&(n.click(),this.debugLog("Clicked on next page button"))}catch(n){this.errorLog("Error clicking on next page button",n)}}static async clickPreviousPage(){try{await this.wait();let n=document.querySelector('button[aria-label="Back to previous step"]');n&&(n.click(),this.debugLog("Clicked on previous page button"))}catch(n){this.errorLog("Error clicking on previous page button",n)}}static async clickReviewApplication(){try{await this.wait();let n=document.querySelector('button[aria-label="Review your application"]');n&&(n.click(),this.debugLog("Clicked on review button"))}catch(n){this.errorLog("Error clicking on review button",n)}}static async clickSubmitApplication(){try{await this.wait();let n=document.querySelector('button[aria-label="Submit application"]');n&&(n.click(),this.debugLog("Clicked on submit button"))}catch(n){this.errorLog("Error clicking on submit button",n)}}static async clickDoneAfterSubmit(){try{let n=document.querySelector('button[aria-label="Done"]');n||(n=document.querySelector("button.artdeco-button span.artdeco-button__text"),this.debugLog("Found done button",n)),n?(n.click(),this.debugLog("Clicked on Done button")):this.debugLog("Done button not found")}catch(n){this.errorLog("Error clicking on Done button",n)}}static async clickDismissAfterSubmit(){try{let n=document.querySelector('button[aria-label="Dismiss"]');if(n||(n=document.querySelector("button[data-test-modal-close-btn]")),!n){let r=document.querySelectorAll("button.artdeco-button--circle.artdeco-modal__dismiss");for(let o of r)if(o.querySelector('svg use[href="#close-medium"]')){n=o;break}}n?(n.click(),this.debugLog("Clicked on Dismiss button")):this.debugLog("Dismiss button not found")}catch(n){this.errorLog("Error clicking on Dismiss button",n)}}static async findReviewButton(){try{return document.querySelector('button[aria-label="Review your application"]')}catch(n){return this.errorLog("Error finding review button",n),null}}static async findNextButton(){try{return document.querySelector('button[aria-label="Continue to next step"]')}catch(n){return this.errorLog("Error finding next button",n),null}}static async findSubmitButton(){try{return document.querySelector('button[aria-label="Submit application"]')}catch(n){return this.errorLog("Error finding submit button",n),null}}static async findDoneButton(){try{let n=document.querySelector('button[aria-label="Done"]');if(!n){let r=document.querySelectorAll("button.artdeco-button");for(let o of r){let t=o.querySelector("span.artdeco-button__text");if(t&&t.textContent.trim()==="Done"){n=o;break}}}return n}catch(n){return this.errorLog("Error finding done button",n),null}}static async processForm(n){try{this.debugLog("Starting form processing");let r=setTimeout(()=>{this.debugLog("Form processing timeout reached"),n.value=!0},3*60*1e3),o=!1;for(;!n.value;)try{if(await this.findReviewButton()){this.debugLog("Found review button");let l=setTimeout(()=>{this.debugLog("Review processing timeout reached"),n.value=!0},1*60*1e3);document.querySelectorAll("div.fb-dash-form-element").length>0&&!o?(this.debugLog("Found questions on current page, processing before review"),await this.processFormQuestions(),o=!0,this.debugLog("Current page form questions processed, will not reprocess")):o?this.debugLog("Skipping redundant form processing for current page"):this.debugLog("No form questions found on current page"),await this.flushPendingQuestions(),await this.clickReviewApplication(),await this.wait(2e3),document.querySelectorAll("div.fb-dash-form-element").length>0?(this.debugLog("Found questions on review page"),await this.processFormQuestions()):this.debugLog("No questions found on review page"),await this.flushPendingQuestions(),await this.clickSubmitApplication(),await this.wait(2e3),await this.clickDismissAfterSubmit(),this.debugLog("Clicked submit button after review"),clearTimeout(l);break}if(document.querySelectorAll("div.fb-dash-form-element").length>0&&!o&&(this.debugLog("Found form questions, processing..."),await this.processFormQuestions(),o=!0,this.debugLog("Form questions processed")),await this.findNextButton()){this.debugLog("Found next button, moving to next page"),await this.flushPendingQuestions(),await this.clickNextPage(),await this.wait(2e3),o=!1;continue}if(await this.findSubmitButton()){this.debugLog("Found submit button, submitting application"),await this.flushPendingQuestions(),await this.clickSubmitApplication(),await this.wait(2e3),await this.clickDismissAfterSubmit();break}this.debugLog("No navigation buttons found, waiting..."),await this.wait(1e3)}catch(t){this.errorLog("Error in form processing loop",t),await this.wait(2e3)}return clearTimeout(r),this.debugLog("Form processing completed"),!0}catch(r){return this.errorLog("Error processing form",r),!1}}static async processFormQuestions(){try{this.debugLog("Processing form questions");let n=document.querySelectorAll("div.fb-dash-form-element");this.debugLog("Found ".concat(n.length," form elements"));for(let r of n)try{let o=r.querySelector("legend span.fb-dash-form-element__label span")||r.querySelector("label");if(!o){this.debugLog("No label found for form element");continue}let t=o.textContent.trim();t=t.replace(/(.+?)\1/,"$1"),this.debugLog("Processing question: ".concat(t));let i=r.querySelector("input, textarea, select");if(!i){this.debugLog("No input field found for question");continue}let a=[];switch(i.tagName.toLowerCase()){case"input":i.type==="radio"&&r.querySelectorAll('input[type="radio"]').forEach(l=>{let c=r.querySelector('label[for="'.concat(l.id,'"]'));c&&a.push(c.textContent.trim())});break;case"select":a=Array.from(i.options).map(s=>s.text.trim());break}a.length>0&&this.debugLog('Available options for "'.concat(t,'":')),await this.answerQuestion(t,a,i,r)}catch(o){this.errorLog("Error processing form element: ".concat(o.message),o)}return this.debugLog("Completed processing form questions"),!0}catch(n){return this.errorLog("Error in processFormQuestions",n),!1}}static async answerQuestion(n,r=[],o,t){try{let i=new X;this.debugLog("Answering question: ".concat(n)),this.debugLog("Available options:",r);try{let l=await chrome.storage.local.get("userProfileYaml");l&&l.userProfileYaml?(this.debugLog("Found user profile YAML in storage"),await i.setUserContext(l.userProfileYaml),this.debugLog("Set user context in AI instance")):this.debugLog("No user profile found in storage")}catch(l){this.errorLog("Error loading user profile from storage:",l)}let a=await chrome.storage.local.get("currentJob");i.setJob(a);let s=await i.answerQuestion(n,r);if(!s)return this.debugLog("No answer generated for question"),!1;switch(this.debugLog("AI Answer: ".concat(s)),o.tagName.toLowerCase()){case"input":switch(o.type){case"text":case"tel":case"email":o.value=s,o.dispatchEvent(new Event("input",{bubbles:!0}));break;case"radio":let l=t.querySelectorAll('input[type="radio"]');for(let c of l){let g=t.querySelector('label[for="'.concat(c.id,'"]'));if(g&&g.textContent.trim()===s){c.click(),this.debugLog("Selected radio option: ".concat(s));break}}break;case"checkbox":o.checked=!0,o.dispatchEvent(new Event("change",{bubbles:!0}));break}break;case"textarea":o.value=s,o.dispatchEvent(new Event("input",{bubbles:!0}));break;case"select":for(let l=0;l<o.options.length;l++)if(o.options[l].text.trim()===s){o.selectedIndex=l,o.dispatchEvent(new Event("change",{bubbles:!0})),this.debugLog("Selected option: ".concat(s));break}break}return await this.wait(500),!0}catch(i){return this.errorLog('Error answering question "'.concat(n,'"'),i),!1}}static async flushPendingQuestions(){try{let n=new X,r=await chrome.storage.local.get("currentJob");n.setJob(r),await n.flushPendingQuestions(),this.debugLog("Flushed pending questions")}catch(n){this.errorLog("Error flushing pending questions",n)}}static async finalizePageConversation(){try{this.debugLog("Finalizing page conversation"),await this.flushPendingQuestions(),this.debugLog("Page conversation finalized")}catch(n){this.errorLog("Error finalizing page conversation",n)}}},U=ke;function w(e,n=null){let r=new Date().toISOString().split("T")[1],o="[EasyJob Debug ".concat(r,"] ").concat(e);n?console.log(o,n):console.log(o)}function F(e,n="info"){w("Status Update: ".concat(n," - ").concat(e)),chrome.runtime.sendMessage({type:"STATUS_UPDATE",text:e,status:n})}async function N(e){return e?!1:(w("Auto-apply process stopped by user"),F("Auto-apply process stopped","info"),chrome.runtime.sendMessage({type:"PROCESS_COMPLETE"}),!0)}chrome.runtime.onMessage.addListener((e,n,r)=>{if(e.action==="START_AUTO_APPLY")return st().then(()=>{r({success:!0})}).catch(o=>{console.error("Error in auto-apply process:",o),r({success:!1,error:o.message})}),!0});async function st(){}var Te=class extends O{static async processJobPage(n,r,o,t){this.debugLog("Processing page ".concat(n,"/").concat(r)),F("Processing page ".concat(n," of ").concat(r),"info");let i=await $.getListOfJobsOnPage(o);w("Found ".concat(i.length," jobs on page ").concat(n));for(let a of i){if(await N(t))return;await Fe.processJob(a,t)}if(n<r)if(w("Finished processing page ".concat(n,", navigating to next page...")),F("Moving to page ".concat(n+1," of ").concat(r,"..."),"info"),await $.goToNextPage())w("Successfully navigated to page ".concat(n+1));else return w("Failed to navigate to next page or reached last page"),await $.isOnLastPage()?(w("Confirmed: reached the last page"),F("Reached the last page of results","info")):(w("Navigation failed but not on last page - stopping process"),F("Failed to navigate to next page - stopping","error")),!1;else w("Finished processing last page (".concat(n,"/").concat(r,")"));return!0}},Fe=class extends O{static async processJob(n,r){try{let o=await R.getJobClickableElement(n);if(await R.clickOnJob(o),w("Clicked on job"),await R.scrollDownToLoadNextJob(n),w("Scrolled to job"),await N(r))return;let t=await R.isEasyButtonAvailable();if(w("Is Easy Apply button available:",t),!t){w("Job already applied. Skipping..."),F("Job already applied. Skipping...","info");return}let i=await ce.getAllJobInfo();if(w("Job info:",i),await chrome.storage.local.set({currentJob:i}),await R.clickEasyApply(),w("Attempted to click Easy Apply"),await new Promise(a=>setTimeout(a,2e3)),await N(r)){await U.closeForm(!1);return}await U.processForm(()=>N(r)),w("Processed application form"),await chrome.storage.local.remove("currentJob"),w("Removed current job from storage")}catch(o){console.error("Error processing job:",o),w("Error processing job:",{error:o.message,stack:o.stack}),F("Error processing job. Continuing to next one...","error"),await U.closeForm(!1)}}},Oe=Te;var M=!1;async function lt(){try{if(w("Starting auto-apply process"),w("Current URL:",window.location.href),await N(M))return;let e=document.querySelector(".scaffold-layout.jobs-search-two-pane__layout");if(w("Search element found:",!!e),!e){w("Available elements on page:",{body:document.body.innerHTML.substring(0,500)+"...",possibleSelectors:{scaffold:document.querySelector(".scaffold-layout"),jobsSearch:document.querySelector(".jobs-search-two-pane__layout"),anyJobsRelated:document.querySelectorAll('[class*="jobs-"]')}}),F("Could not find jobs list. Please make sure you are on LinkedIn jobs page.","error");return}w("Getting total jobs count");let n=await $.getTotalJobsSearchCount(e);w("Total jobs found:",n),F("Found ".concat(n," jobs to process"),"info"),w("Getting available pages");let r=await $.getAvailablePages(e,n);w("Total pages found:",r);for(let o=1;o<=r;o++){if(await N(M))return;if(await Oe.processJobPage(o,r,e,M)===!1){w("Page processing failed or reached end, stopping at page ".concat(o));break}}await N(M)||(w("Auto-apply process completed"),F("Auto-apply process completed!","success"),chrome.runtime.sendMessage({type:"PROCESS_COMPLETE"}))}catch(e){console.error("Error in auto-apply process:",e),w("Fatal error in auto-apply process:",{error:e.message,stack:e.stack}),F("Error in auto-apply process","error"),await U.closeForm(!1)}}chrome.runtime.onMessage.addListener((e,n,r)=>(w("Received message in content script:",e),e.action==="START_AUTO_APPLY"?M||(M=!0,w("Starting auto-apply process"),lt()):e.action==="STOP_AUTO_APPLY"?(w("Stopping auto-apply process"),M=!1):e.action==="GET_STATE"&&(w("Getting current state"),r({isRunning:M})),!0));console.log("Initializing EasyJob AI systems...");async function ct(){try{console.log("-----------------------------------"),console.log("\u{1F504} EasyJob AI System Initialization"),console.log("-----------------------------------"),console.log("Preloading embeddings into memory..."),await v.preloadEmbeddings();let e=Object.keys(v.data).length,n=await v.getStoredEmbeddingsCount();if(console.log("Memory status:",{memoryStoreSize:e,storageCount:n,hasLoadedFromStorage:v.hasTriedLoading}),e>0){console.log("\u2705 Embeddings successfully loaded into memory");let r=new X;console.log("\u2705 AI question answerer initialized and ready")}else console.log("\u26A0\uFE0F No embeddings found in memory. Checking storage and profile status..."),await new Promise(o=>{chrome.storage.local.get("userProfile",t=>{o(!!t.userProfile)})})?(console.log("\u{1F50D} User profile exists but embeddings are not generated or failed to load."),console.log("\u{1F4A1} Please open the extension popup and reload the profile to generate embeddings."),chrome.storage.local.get(null,function(o){console.log("\u{1F4CA} Storage overview:",{totalItems:Object.keys(o).length,hasProfile:!!o.userProfile,hasEmbeddings:!!o.storedEmbeddings,profileSize:o.userProfile?JSON.stringify(o.userProfile).length:0,embeddingsSize:o.storedEmbeddings?JSON.stringify(o.storedEmbeddings).length:0})})):(console.log("\u274C No user profile found in storage."),console.log("\u{1F4A1} Please upload a profile through the extension popup."));console.log("-----------------------------------")}catch(e){console.error("\u274C Error initializing AI:",e)}}ct();
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
