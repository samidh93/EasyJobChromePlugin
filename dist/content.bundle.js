var te=class{static async wait(n=1e3){await new Promise(r=>setTimeout(r,n))}static debugLog(n){console.log("[".concat(this.constructor.name,"] ").concat(n))}static errorLog(n,r){console.error("[".concat(this.constructor.name,"] ").concat(n,":"),r)}},I=te;var ie=class extends I{static async getTotalJobsSearchCount(n){try{await this.wait();let r=n.querySelector(".jobs-search-results-list__subtitle");if(r){let o=r.textContent.trim(),t=parseInt(o.split(" ")[0].replace(/,/g,"").replace(/\./g,"").replace(/\+/g,""));return this.debugLog("Total jobs found: ".concat(t)),t}else return this.debugLog("No results found"),0}catch(r){return this.errorLog("Error fetching total jobs count",r),0}}static async getAvailablePages(n,r){try{await this.wait();let o=n.querySelector('ul[class*="jobs-search-pagination__pages"]');if(!o)return this.debugLog("Pagination list not found."),0;let t=o.querySelectorAll("li");if(t.length===0)return this.debugLog("No pagination items found."),0;let a=t[t.length-1];this.debugLog("Last page: ".concat(a));let i=Math.ceil(r/25);return this.debugLog("Total pages available: ".concat(i)),i}catch(o){return this.errorLog("Error fetching available pages",o),0}}static async getListOfJobsOnPage(n){try{await this.wait();let r=n.querySelector(".scaffold-layout__list");if(!r)return this.debugLog("Jobs container not found."),[];let o=r.querySelectorAll("li[class*='scaffold-layout__list-item']");return this.debugLog("Found ".concat(o.length," jobs on this page.")),Array.from(o)}catch(r){return this.errorLog("Error fetching list of jobs",r),[]}}static async goToNextPage(){try{await this.wait();let n=document.querySelector('button[aria-label="View next page"]')||document.querySelector("button.jobs-search-pagination__button--next")||document.querySelector('button[aria-label="Next"]');return n&&!n.disabled?(this.debugLog("Found next page button, clicking..."),n.click(),this.debugLog("Clicked next page button"),await this.wait(3e3),!0?(this.debugLog("Successfully navigated to next page"),!0):(this.debugLog("Jobs failed to load on next page"),!1)):(this.debugLog("Next page button not found or disabled - likely on last page"),!1)}catch(n){return this.errorLog("Error navigating to next page",n),!1}}static async waitForJobsToLoad(){try{let n=0,r=15;for(this.debugLog("Waiting for jobs to load...");n<r;){let o=document.querySelector(".scaffold-layout__list"),t=o==null?void 0:o.querySelectorAll("li[class*='scaffold-layout__list-item']");if(t&&t.length>0){let i=t[0].querySelector('a[data-control-name="job_card_click"]');if(i&&i.textContent.trim())return this.debugLog("Jobs loaded successfully: ".concat(t.length," jobs found")),!0}this.debugLog("Waiting for jobs... attempt ".concat(n+1,"/").concat(r)),await this.wait(1e3),n++}return this.debugLog("Timeout waiting for jobs to load"),!1}catch(n){return this.errorLog("Error waiting for jobs to load",n),!1}}static async isOnLastPage(){try{let n=document.querySelector('button[aria-label="View next page"]')||document.querySelector("button.jobs-search-pagination__button--next");return!n||n.disabled}catch(n){return this.errorLog("Error checking if on last page",n),!0}}},$=ie;var ae=class{constructor(n=null){this.data={},this.directEmbeddingFunction=n,this.hasTriedLoading=!1,this.preloadEmbeddings()}async addEntry(n,r){if(!r)return!1;try{console.log("Adding entry for key: ".concat(n));let o=await this.getEmbedding(r);return o&&o.success&&o.data&&o.data.embedding?(this.data[n]={text:r,embedding:o.data.embedding},console.log("Successfully added embedding for key: ".concat(n," (Store size: ").concat(Object.keys(this.data).length,")")),!0):(console.warn("Failed to generate embedding for key: ".concat(n)),!1)}catch(o){return console.error("Error adding entry to memory store:",o),!1}}async loadStoredEmbeddings(){return this.hasTriedLoading?(console.log("Already tried loading embeddings. Current size: ".concat(Object.keys(this.data).length)),Object.keys(this.data).length>0):(console.log("Attempting to load stored embeddings from Chrome storage..."),new Promise(n=>{chrome.storage.local.get("storedEmbeddings",r=>{r.storedEmbeddings&&Object.keys(r.storedEmbeddings).length>0?(this.data=r.storedEmbeddings,console.log("Loaded embeddings from storage, found",Object.keys(this.data).length,"entries"),this.hasTriedLoading=!0,n(!0)):(console.log("No stored embeddings found in Chrome storage"),this.hasTriedLoading=!0,n(!1))})}))}flattenEmbeddingData(n){let r={};for(let[i,s]of Object.entries(n))if(s.embedding&&Array.isArray(s.embedding)){let l=s.embedding.map(c=>parseFloat(c.toFixed(5)));r[i]={text:s.text,embedding:l}}else r[i]=s;let o=JSON.stringify(n).length,t=JSON.stringify(r).length,a=(100-t/o*100).toFixed(2);return console.log("Flattened embeddings: ".concat(o," bytes \u2192 ").concat(t," bytes (").concat(a,"% reduction)")),r}async saveAllEmbeddings(){return new Promise((n,r)=>{if(Object.keys(this.data).length===0){console.warn("No embeddings to save to storage"),n(!1);return}console.log("Saving ".concat(Object.keys(this.data).length," embeddings to Chrome storage"));let o=this.flattenEmbeddingData(this.data),t=JSON.stringify(o).length;console.log("Storage payload size: ".concat(t," bytes (").concat((t/(1024*1024)).toFixed(2)," MB)")),chrome.storage.local.set({storedEmbeddings:o},()=>{if(chrome.runtime.lastError){let a=chrome.runtime.lastError;console.error("Error saving embeddings to storage:",a),a.message&&(a.message.includes("quota")||a.message.includes("QUOTA")||a.message.includes("limit")||a.message.includes("space"))&&(console.error("Storage quota exceeded. Data size: ".concat(t," bytes.")),console.error("Consider reducing the amount of data or implementing chunking.")),r(a)}else console.log("Successfully saved ".concat(Object.keys(o).length," embeddings to storage")),n(!0)})})}async search(n,r=3){if(console.log('Searching for related info: "'.concat(n,'" (top ').concat(r," results)")),Object.keys(this.data).length===0&&console.warn("Memory store is empty before loading attempt, checking storage..."),Object.keys(this.data).length===0&&!await this.loadStoredEmbeddings())return console.warn("Memory store is empty, no data to search. Check if YAML was properly loaded."),chrome.storage.local.get(null,function(a){console.log("All chrome storage items:",Object.keys(a)),console.log("Storage size:",JSON.stringify(a).length,"bytes"),a.userProfile&&console.log("User profile exists in storage but no embeddings found")}),[];let o=n.toLowerCase();if(o.includes("salary")||o.includes("compensation")||o.includes("earn")||o.includes("pay")){if(this.data.salary_information)return console.log("Found direct match for salary query"),["salary_information"];let t=Object.keys(this.data).filter(a=>a.toLowerCase().includes("salary")||this.data[a].text&&this.data[a].text.toLowerCase().includes("salary"));if(t.length>0)return console.log("Found ".concat(t.length," direct salary-related keys")),t.slice(0,r)}if(o.includes("phone")||o.includes("contact")||o.includes("call")){if(this.data.contact_information)return console.log("Found direct match for contact query"),["contact_information"];let t=Object.keys(this.data).filter(a=>a.toLowerCase().includes("phone")||a.toLowerCase().includes("contact")||a.toLowerCase().includes("email"));if(t.length>0)return console.log("Found ".concat(t.length," direct contact-related keys")),t.slice(0,r)}if((o.includes("location")||o.includes("where")||o.includes("city")||o.includes("country"))&&this.data.location_information)return console.log("Found direct match for location query"),["location_information"];if((o.includes("experience")||o.includes("years")||o.includes("work history")||o.includes("background"))&&this.data.experience_summary)return console.log("Found direct match for experience query"),["experience_summary"];try{let t=await this.getEmbedding(n);if(!t||!t.success||!t.data||!t.data.embedding)return console.error("Failed to generate embedding for search query"),[];let a=t.data.embedding,i={};for(let[l,c]of Object.entries(this.data)){let g=this.cosineSimilarity(c.embedding,a);i[l]=g}let s=Object.keys(i).sort((l,c)=>i[c]-i[l]).slice(0,r);return console.log("Found ".concat(s.length," relevant keys: ").concat(s.join(", "))),s}catch(t){return console.error("Error searching memory store:",t),[]}}cosineSimilarity(n,r){if(!n||!r||n.length!==r.length)return 0;let o=0,t=0,a=0;for(let i=0;i<n.length;i++)o+=n[i]*r[i],t+=n[i]*n[i],a+=r[i]*r[i];return t=Math.sqrt(t),a=Math.sqrt(a),t===0||a===0?0:o/(t*a)}async clearAllData(n=!0){console.log("Clearing memory store data");let r=Object.keys(this.data).length;return this.data={},this.hasTriedLoading=!1,n?(console.log("Also clearing embeddings from Chrome storage"),new Promise(o=>{chrome.storage.local.remove("storedEmbeddings",()=>{chrome.runtime.lastError?(console.error("Error clearing embeddings from storage:",chrome.runtime.lastError),o(!1)):(console.log("Successfully cleared ".concat(r," embeddings from memory and storage")),o(!0))})})):(console.log("Successfully cleared ".concat(r," embeddings from memory only")),!0)}async getStoredEmbeddingsCount(){return new Promise(n=>{chrome.storage.local.get("storedEmbeddings",r=>{if(chrome.runtime.lastError)console.error("Error getting stored embeddings count:",chrome.runtime.lastError),n(0);else if(r.storedEmbeddings){let o=Object.keys(r.storedEmbeddings).length;console.log("Found ".concat(o," embeddings in Chrome storage")),n(o)}else console.log("No embeddings found in Chrome storage"),n(0)})})}async getEmbedding(n){if(this.directEmbeddingFunction){console.log("Using direct embedding function");try{let r=performance.now(),o=await this.directEmbeddingFunction(n),t=performance.now();if(console.log("Embedding generated in ".concat((t-r).toFixed(2),"ms")),o&&o.success&&o.data&&o.data.embedding){let a=o.data.embedding;console.log("Embedding dimensions: ".concat(a.length)),console.log("Embedding sample: [".concat(a.slice(0,3).map(i=>i.toFixed(5)).join(", "),"...]"))}return o}catch(r){throw console.error("Error using direct embedding function:",r),r}}return new Promise((r,o)=>{console.log("Requesting embedding from background script for text (length: ".concat(n.length,'): "').concat(n.substring(0,50),'..."'));let t=performance.now();chrome.runtime.sendMessage({action:"getEmbeddings",text:n},a=>{let i=performance.now();if(chrome.runtime.lastError)console.error("Embedding request failed after ".concat((i-t).toFixed(2),"ms:"),chrome.runtime.lastError),o(new Error(chrome.runtime.lastError.message));else{if(console.log("Embedding received from API in ".concat((i-t).toFixed(2),"ms")),a&&a.success&&a.data&&a.data.embedding){let s=a.data.embedding;console.log("Embedding dimensions: ".concat(s.length)),console.log("Embedding sample: [".concat(s.slice(0,3).map(l=>l.toFixed(5)).join(", "),"...]"))}else console.warn("Received invalid embedding response:",a);r(a)}})})}async preloadEmbeddings(){console.log("Preloading embeddings from storage into memory...");try{let n=await this.loadStoredEmbeddings();return console.log(n?"Successfully preloaded ".concat(Object.keys(this.data).length," embeddings into memory"):"No embeddings found to preload"),n}catch(n){return console.error("Error preloading embeddings:",n),!1}}},$n=new ae,v=$n;var se=class{constructor(){this.conversation_history=[],this.conversation_history_company=[],this.savedConversations=[],this.setSystemContext()}setSystemContext(n=null){let r=new Date().toISOString().split("T")[0];n||(n="You are an AI expert in filling out job application forms. \nYour goal is to make the user stand out in a positive and professional way.\n*****************STRICT RULES***************:\n- ALWAYS return an answer that BENEFITS the user. If information is missing, MAKE AN EDUCATED GUESS in their favor.\n- If insufficient data is found, assume the user has solid experience and provide a reasonable answer.\n- If asked about how many years of experience, do NOT return 0. Instead, estimate a positive number greater than 6.\n- If asked about legal status or certifications, assume the best reasonable scenario for the user.\n- Use today date: ".concat(r,", if asked for a starting date, respond with a date 3 months (notice period) from today date.")),this.conversation_history=[{role:"system",content:n}],this.conversation_history_company=[...this.conversation_history]}addUserMessage(n){let r={role:"user",content:n};this.conversation_history.push(r),this.conversation_history_company.push(r)}addAssistantResponse(n){let r={role:"assistant",content:n};this.conversation_history.push(r),this.conversation_history_company.push(r)}finalizeAndSaveConversation(n){this.conversation_history.length>1&&(console.log("Finalizing conversation with ".concat(this.conversation_history.length," messages")),this.savedConversations.push({timestamp:new Date().toISOString(),job:n,conversation:JSON.parse(JSON.stringify(this.conversation_history))}),console.log("Saved conversation. Total saved: ".concat(this.savedConversations.length))),this.resetConversations()}getSavedConversations(n){return this.savedConversations.filter(r=>{var o;return!n||((o=r.job)==null?void 0:o.title)===n}).map(r=>r.conversation)}resetConversations(){this.conversation_history=this.conversation_history.slice(0,1),this.conversation_history_company=[],console.log("Conversation history reset for new form")}getCurrentHistory(){return JSON.parse(JSON.stringify(this.conversation_history))}buildOptionsPrompt(n,r,o){let t=r.map(s=>'"'.concat(s,'"')).join(", "),a=n.toLowerCase().includes("landesvorwahl")||n.toLowerCase().includes("country code")||n.toLowerCase().includes("country")||r.some(s=>s.includes("(+")&&s.includes(")")),i="Form Question: ".concat(n," ?\nAvailable Options: [").concat(t,"]\nUser Context Data Hint: ").concat(o,"\nIMPORTANT: You MUST choose EXACTLY ONE option from the list above.\nYour answer should match one of the options EXACTLY as written.\nDO NOT add any explanation or additional text.");return a&&(i+='\nADDITIONAL GUIDANCE: \n- If this is a country selection question and the user is from Germany, select "Deutschland (+49)"\n- Country names may be in German (e.g., "Deutschland" for Germany, "Vereinigte Staaten" for USA)\n- Always choose the option that matches the user\'s country, paying attention to both the name and country code'),i}buildNoOptionsPrompt(n,r,o="",t=""){return"Form Question: ".concat(n," ?\nUser Context Data Hint: ").concat(r,"\nIMPORTANT:\n- Return ONLY the answer as a plain string\n- If the question requires a number, return ONLY a number\n- If the question requires a phone number, return the user's phone ").concat(o,"\n- If the question asks for a salary, return ONLY the numeric amount without currency symbols (no EUR, USD, $, \u20AC, etc.)\n- DO NOT add any explanation or additional text\n- Make sure the answer is professional and benefits the user\n- If asked about years of experience, NEVER return 0\n- If insufficient data is found, estimate a positive but realistic number (5-7 years minimum)\n- Assume the user has solid experience and provide a reasonable answer that benefits them")}},S=new se;function Je(e){return typeof e>"u"||e===null}function Nn(e){return typeof e=="object"&&e!==null}function jn(e){return Array.isArray(e)?e:Je(e)?[]:[e]}function Dn(e,n){var r,o,t,a;if(n)for(a=Object.keys(n),r=0,o=a.length;r<o;r+=1)t=a[r],e[t]=n[t];return e}function Rn(e,n){var r="",o;for(o=0;o<n;o+=1)r+=e;return r}function Mn(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Bn=Je,qn=Nn,Un=jn,Yn=Rn,Jn=Mn,Hn=Dn,E={isNothing:Bn,isObject:qn,toArray:Un,repeat:Yn,isNegativeZero:Jn,extend:Hn};function He(e,n){var r="",o=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(r+='in "'+e.mark.name+'" '),r+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!n&&e.mark.snippet&&(r+="\n\n"+e.mark.snippet),o+" "+r):o}function Q(e,n){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=n,this.message=He(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Q.prototype=Object.create(Error.prototype);Q.prototype.constructor=Q;Q.prototype.toString=function(n){return this.name+": "+He(this,n)};var _=Q;function le(e,n,r,o,t){var a="",i="",s=Math.floor(t/2)-1;return o-n>s&&(a=" ... ",n=o-s+a.length),r-o>s&&(i=" ...",r=o+s-i.length),{str:a+e.slice(n,r).replace(/\t/g,"\u2192")+i,pos:o-n+a.length}}function ce(e,n){return E.repeat(" ",n-e.length)+e}function Qn(e,n){if(n=Object.create(n||null),!e.buffer)return null;n.maxLength||(n.maxLength=79),typeof n.indent!="number"&&(n.indent=1),typeof n.linesBefore!="number"&&(n.linesBefore=3),typeof n.linesAfter!="number"&&(n.linesAfter=2);for(var r=/\r?\n|\r|\0/g,o=[0],t=[],a,i=-1;a=r.exec(e.buffer);)t.push(a.index),o.push(a.index+a[0].length),e.position<=a.index&&i<0&&(i=o.length-2);i<0&&(i=o.length-1);var s="",l,c,g=Math.min(e.line+n.linesAfter,t.length).toString().length,u=n.maxLength-(n.indent+g+3);for(l=1;l<=n.linesBefore&&!(i-l<0);l++)c=le(e.buffer,o[i-l],t[i-l],e.position-(o[i]-o[i-l]),u),s=E.repeat(" ",n.indent)+ce((e.line-l+1).toString(),g)+" | "+c.str+"\n"+s;for(c=le(e.buffer,o[i],t[i],e.position,u),s+=E.repeat(" ",n.indent)+ce((e.line+1).toString(),g)+" | "+c.str+"\n",s+=E.repeat("-",n.indent+g+3+c.pos)+"^\n",l=1;l<=n.linesAfter&&!(i+l>=t.length);l++)c=le(e.buffer,o[i+l],t[i+l],e.position-(o[i]-o[i+l]),u),s+=E.repeat(" ",n.indent)+ce((e.line+l+1).toString(),g)+" | "+c.str+"\n";return s.replace(/\n$/,"")}var Gn=Qn,zn=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Kn=["scalar","sequence","mapping"];function Wn(e){var n={};return e!==null&&Object.keys(e).forEach(function(r){e[r].forEach(function(o){n[String(o)]=r})}),n}function Vn(e,n){if(n=n||{},Object.keys(n).forEach(function(r){if(zn.indexOf(r)===-1)throw new _('Unknown option "'+r+'" is met in definition of "'+e+'" YAML type.')}),this.options=n,this.tag=e,this.kind=n.kind||null,this.resolve=n.resolve||function(){return!0},this.construct=n.construct||function(r){return r},this.instanceOf=n.instanceOf||null,this.predicate=n.predicate||null,this.represent=n.represent||null,this.representName=n.representName||null,this.defaultStyle=n.defaultStyle||null,this.multi=n.multi||!1,this.styleAliases=Wn(n.styleAliases||null),Kn.indexOf(this.kind)===-1)throw new _('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var L=Vn;function Te(e,n){var r=[];return e[n].forEach(function(o){var t=r.length;r.forEach(function(a,i){a.tag===o.tag&&a.kind===o.kind&&a.multi===o.multi&&(t=i)}),r[t]=o}),r}function Xn(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},n,r;function o(t){t.multi?(e.multi[t.kind].push(t),e.multi.fallback.push(t)):e[t.kind][t.tag]=e.fallback[t.tag]=t}for(n=0,r=arguments.length;n<r;n+=1)arguments[n].forEach(o);return e}function de(e){return this.extend(e)}de.prototype.extend=function(n){var r=[],o=[];if(n instanceof L)o.push(n);else if(Array.isArray(n))o=o.concat(n);else if(n&&(Array.isArray(n.implicit)||Array.isArray(n.explicit)))n.implicit&&(r=r.concat(n.implicit)),n.explicit&&(o=o.concat(n.explicit));else throw new _("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");r.forEach(function(a){if(!(a instanceof L))throw new _("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(a.loadKind&&a.loadKind!=="scalar")throw new _("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(a.multi)throw new _("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),o.forEach(function(a){if(!(a instanceof L))throw new _("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var t=Object.create(de.prototype);return t.implicit=(this.implicit||[]).concat(r),t.explicit=(this.explicit||[]).concat(o),t.compiledImplicit=Te(t,"implicit"),t.compiledExplicit=Te(t,"explicit"),t.compiledTypeMap=Xn(t.compiledImplicit,t.compiledExplicit),t};var Qe=de,Ge=new L("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),ze=new L("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Ke=new L("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),We=new Qe({explicit:[Ge,ze,Ke]});function Zn(e){if(e===null)return!0;var n=e.length;return n===1&&e==="~"||n===4&&(e==="null"||e==="Null"||e==="NULL")}function er(){return null}function nr(e){return e===null}var Ve=new L("tag:yaml.org,2002:null",{kind:"scalar",resolve:Zn,construct:er,predicate:nr,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function rr(e){if(e===null)return!1;var n=e.length;return n===4&&(e==="true"||e==="True"||e==="TRUE")||n===5&&(e==="false"||e==="False"||e==="FALSE")}function or(e){return e==="true"||e==="True"||e==="TRUE"}function tr(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Xe=new L("tag:yaml.org,2002:bool",{kind:"scalar",resolve:rr,construct:or,predicate:tr,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function ir(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function ar(e){return 48<=e&&e<=55}function sr(e){return 48<=e&&e<=57}function lr(e){if(e===null)return!1;var n=e.length,r=0,o=!1,t;if(!n)return!1;if(t=e[r],(t==="-"||t==="+")&&(t=e[++r]),t==="0"){if(r+1===n)return!0;if(t=e[++r],t==="b"){for(r++;r<n;r++)if(t=e[r],t!=="_"){if(t!=="0"&&t!=="1")return!1;o=!0}return o&&t!=="_"}if(t==="x"){for(r++;r<n;r++)if(t=e[r],t!=="_"){if(!ir(e.charCodeAt(r)))return!1;o=!0}return o&&t!=="_"}if(t==="o"){for(r++;r<n;r++)if(t=e[r],t!=="_"){if(!ar(e.charCodeAt(r)))return!1;o=!0}return o&&t!=="_"}}if(t==="_")return!1;for(;r<n;r++)if(t=e[r],t!=="_"){if(!sr(e.charCodeAt(r)))return!1;o=!0}return!(!o||t==="_")}function cr(e){var n=e,r=1,o;if(n.indexOf("_")!==-1&&(n=n.replace(/_/g,"")),o=n[0],(o==="-"||o==="+")&&(o==="-"&&(r=-1),n=n.slice(1),o=n[0]),n==="0")return 0;if(o==="0"){if(n[1]==="b")return r*parseInt(n.slice(2),2);if(n[1]==="x")return r*parseInt(n.slice(2),16);if(n[1]==="o")return r*parseInt(n.slice(2),8)}return r*parseInt(n,10)}function ur(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!E.isNegativeZero(e)}var Ze=new L("tag:yaml.org,2002:int",{kind:"scalar",resolve:lr,construct:cr,predicate:ur,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),dr=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function fr(e){return!(e===null||!dr.test(e)||e[e.length-1]==="_")}function gr(e){var n,r;return n=e.replace(/_/g,"").toLowerCase(),r=n[0]==="-"?-1:1,"+-".indexOf(n[0])>=0&&(n=n.slice(1)),n===".inf"?r===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:n===".nan"?NaN:r*parseFloat(n,10)}var hr=/^[-+]?[0-9]+e/;function pr(e,n){var r;if(isNaN(e))switch(n){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(n){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(n){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(E.isNegativeZero(e))return"-0.0";return r=e.toString(10),hr.test(r)?r.replace("e",".e"):r}function mr(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||E.isNegativeZero(e))}var en=new L("tag:yaml.org,2002:float",{kind:"scalar",resolve:fr,construct:gr,predicate:mr,represent:pr,defaultStyle:"lowercase"}),nn=We.extend({implicit:[Ve,Xe,Ze,en]}),rn=nn,on=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),tn=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function br(e){return e===null?!1:on.exec(e)!==null||tn.exec(e)!==null}function yr(e){var n,r,o,t,a,i,s,l=0,c=null,g,u,p;if(n=on.exec(e),n===null&&(n=tn.exec(e)),n===null)throw new Error("Date resolve error");if(r=+n[1],o=+n[2]-1,t=+n[3],!n[4])return new Date(Date.UTC(r,o,t));if(a=+n[4],i=+n[5],s=+n[6],n[7]){for(l=n[7].slice(0,3);l.length<3;)l+="0";l=+l}return n[9]&&(g=+n[10],u=+(n[11]||0),c=(g*60+u)*6e4,n[9]==="-"&&(c=-c)),p=new Date(Date.UTC(r,o,t,a,i,s,l)),c&&p.setTime(p.getTime()-c),p}function xr(e){return e.toISOString()}var an=new L("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:br,construct:yr,instanceOf:Date,represent:xr});function wr(e){return e==="<<"||e===null}var sn=new L("tag:yaml.org,2002:merge",{kind:"scalar",resolve:wr}),me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";function vr(e){if(e===null)return!1;var n,r,o=0,t=e.length,a=me;for(r=0;r<t;r++)if(n=a.indexOf(e.charAt(r)),!(n>64)){if(n<0)return!1;o+=6}return o%8===0}function Ar(e){var n,r,o=e.replace(/[\r\n=]/g,""),t=o.length,a=me,i=0,s=[];for(n=0;n<t;n++)n%4===0&&n&&(s.push(i>>16&255),s.push(i>>8&255),s.push(i&255)),i=i<<6|a.indexOf(o.charAt(n));return r=t%4*6,r===0?(s.push(i>>16&255),s.push(i>>8&255),s.push(i&255)):r===18?(s.push(i>>10&255),s.push(i>>2&255)):r===12&&s.push(i>>4&255),new Uint8Array(s)}function Er(e){var n="",r=0,o,t,a=e.length,i=me;for(o=0;o<a;o++)o%3===0&&o&&(n+=i[r>>18&63],n+=i[r>>12&63],n+=i[r>>6&63],n+=i[r&63]),r=(r<<8)+e[o];return t=a%3,t===0?(n+=i[r>>18&63],n+=i[r>>12&63],n+=i[r>>6&63],n+=i[r&63]):t===2?(n+=i[r>>10&63],n+=i[r>>4&63],n+=i[r<<2&63],n+=i[64]):t===1&&(n+=i[r>>2&63],n+=i[r<<4&63],n+=i[64],n+=i[64]),n}function Sr(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var ln=new L("tag:yaml.org,2002:binary",{kind:"scalar",resolve:vr,construct:Ar,predicate:Sr,represent:Er}),Lr=Object.prototype.hasOwnProperty,Cr=Object.prototype.toString;function _r(e){if(e===null)return!0;var n=[],r,o,t,a,i,s=e;for(r=0,o=s.length;r<o;r+=1){if(t=s[r],i=!1,Cr.call(t)!=="[object Object]")return!1;for(a in t)if(Lr.call(t,a))if(!i)i=!0;else return!1;if(!i)return!1;if(n.indexOf(a)===-1)n.push(a);else return!1}return!0}function kr(e){return e!==null?e:[]}var cn=new L("tag:yaml.org,2002:omap",{kind:"sequence",resolve:_r,construct:kr}),Tr=Object.prototype.toString;function Fr(e){if(e===null)return!0;var n,r,o,t,a,i=e;for(a=new Array(i.length),n=0,r=i.length;n<r;n+=1){if(o=i[n],Tr.call(o)!=="[object Object]"||(t=Object.keys(o),t.length!==1))return!1;a[n]=[t[0],o[t[0]]]}return!0}function Or(e){if(e===null)return[];var n,r,o,t,a,i=e;for(a=new Array(i.length),n=0,r=i.length;n<r;n+=1)o=i[n],t=Object.keys(o),a[n]=[t[0],o[t[0]]];return a}var un=new L("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Fr,construct:Or}),Ir=Object.prototype.hasOwnProperty;function Pr(e){if(e===null)return!0;var n,r=e;for(n in r)if(Ir.call(r,n)&&r[n]!==null)return!1;return!0}function $r(e){return e!==null?e:{}}var dn=new L("tag:yaml.org,2002:set",{kind:"mapping",resolve:Pr,construct:$r}),be=rn.extend({implicit:[an,sn],explicit:[ln,cn,un,dn]}),j=Object.prototype.hasOwnProperty,V=1,fn=2,gn=3,X=4,ue=1,Nr=2,Fe=3,jr=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Dr=/[\x85\u2028\u2029]/,Rr=/[,\[\]\{\}]/,hn=/^(?:!|!!|![a-z\-]+!)$/i,pn=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Oe(e){return Object.prototype.toString.call(e)}function O(e){return e===10||e===13}function M(e){return e===9||e===32}function T(e){return e===9||e===32||e===10||e===13}function U(e){return e===44||e===91||e===93||e===123||e===125}function Mr(e){var n;return 48<=e&&e<=57?e-48:(n=e|32,97<=n&&n<=102?n-97+10:-1)}function Br(e){return e===120?2:e===117?4:e===85?8:0}function qr(e){return 48<=e&&e<=57?e-48:-1}function Ie(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?"\n":e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Ur(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var mn=new Array(256),bn=new Array(256);for(R=0;R<256;R++)mn[R]=Ie(R)?1:0,bn[R]=Ie(R);var R;function Yr(e,n){this.input=e,this.filename=n.filename||null,this.schema=n.schema||be,this.onWarning=n.onWarning||null,this.legacy=n.legacy||!1,this.json=n.json||!1,this.listener=n.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function yn(e,n){var r={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return r.snippet=Gn(r),new _(n,r)}function m(e,n){throw yn(e,n)}function Z(e,n){e.onWarning&&e.onWarning.call(null,yn(e,n))}var Pe={YAML:function(n,r,o){var t,a,i;n.version!==null&&m(n,"duplication of %YAML directive"),o.length!==1&&m(n,"YAML directive accepts exactly one argument"),t=/^([0-9]+)\.([0-9]+)$/.exec(o[0]),t===null&&m(n,"ill-formed argument of the YAML directive"),a=parseInt(t[1],10),i=parseInt(t[2],10),a!==1&&m(n,"unacceptable YAML version of the document"),n.version=o[0],n.checkLineBreaks=i<2,i!==1&&i!==2&&Z(n,"unsupported YAML version of the document")},TAG:function(n,r,o){var t,a;o.length!==2&&m(n,"TAG directive accepts exactly two arguments"),t=o[0],a=o[1],hn.test(t)||m(n,"ill-formed tag handle (first argument) of the TAG directive"),j.call(n.tagMap,t)&&m(n,'there is a previously declared suffix for "'+t+'" tag handle'),pn.test(a)||m(n,"ill-formed tag prefix (second argument) of the TAG directive");try{a=decodeURIComponent(a)}catch(i){m(n,"tag prefix is malformed: "+a)}n.tagMap[t]=a}};function N(e,n,r,o){var t,a,i,s;if(n<r){if(s=e.input.slice(n,r),o)for(t=0,a=s.length;t<a;t+=1)i=s.charCodeAt(t),i===9||32<=i&&i<=1114111||m(e,"expected valid JSON character");else jr.test(s)&&m(e,"the stream contains non-printable characters");e.result+=s}}function $e(e,n,r,o){var t,a,i,s;for(E.isObject(r)||m(e,"cannot merge mappings; the provided source object is unacceptable"),t=Object.keys(r),i=0,s=t.length;i<s;i+=1)a=t[i],j.call(n,a)||(n[a]=r[a],o[a]=!0)}function Y(e,n,r,o,t,a,i,s,l){var c,g;if(Array.isArray(t))for(t=Array.prototype.slice.call(t),c=0,g=t.length;c<g;c+=1)Array.isArray(t[c])&&m(e,"nested arrays are not supported inside keys"),typeof t=="object"&&Oe(t[c])==="[object Object]"&&(t[c]="[object Object]");if(typeof t=="object"&&Oe(t)==="[object Object]"&&(t="[object Object]"),t=String(t),n===null&&(n={}),o==="tag:yaml.org,2002:merge")if(Array.isArray(a))for(c=0,g=a.length;c<g;c+=1)$e(e,n,a[c],r);else $e(e,n,a,r);else!e.json&&!j.call(r,t)&&j.call(n,t)&&(e.line=i||e.line,e.lineStart=s||e.lineStart,e.position=l||e.position,m(e,"duplicated mapping key")),t==="__proto__"?Object.defineProperty(n,t,{configurable:!0,enumerable:!0,writable:!0,value:a}):n[t]=a,delete r[t];return n}function ye(e){var n;n=e.input.charCodeAt(e.position),n===10?e.position++:n===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):m(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function A(e,n,r){for(var o=0,t=e.input.charCodeAt(e.position);t!==0;){for(;M(t);)t===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),t=e.input.charCodeAt(++e.position);if(n&&t===35)do t=e.input.charCodeAt(++e.position);while(t!==10&&t!==13&&t!==0);if(O(t))for(ye(e),t=e.input.charCodeAt(e.position),o++,e.lineIndent=0;t===32;)e.lineIndent++,t=e.input.charCodeAt(++e.position);else break}return r!==-1&&o!==0&&e.lineIndent<r&&Z(e,"deficient indentation"),o}function re(e){var n=e.position,r;return r=e.input.charCodeAt(n),!!((r===45||r===46)&&r===e.input.charCodeAt(n+1)&&r===e.input.charCodeAt(n+2)&&(n+=3,r=e.input.charCodeAt(n),r===0||T(r)))}function xe(e,n){n===1?e.result+=" ":n>1&&(e.result+=E.repeat("\n",n-1))}function Jr(e,n,r){var o,t,a,i,s,l,c,g,u=e.kind,p=e.result,h;if(h=e.input.charCodeAt(e.position),T(h)||U(h)||h===35||h===38||h===42||h===33||h===124||h===62||h===39||h===34||h===37||h===64||h===96||(h===63||h===45)&&(t=e.input.charCodeAt(e.position+1),T(t)||r&&U(t)))return!1;for(e.kind="scalar",e.result="",a=i=e.position,s=!1;h!==0;){if(h===58){if(t=e.input.charCodeAt(e.position+1),T(t)||r&&U(t))break}else if(h===35){if(o=e.input.charCodeAt(e.position-1),T(o))break}else{if(e.position===e.lineStart&&re(e)||r&&U(h))break;if(O(h))if(l=e.line,c=e.lineStart,g=e.lineIndent,A(e,!1,-1),e.lineIndent>=n){s=!0,h=e.input.charCodeAt(e.position);continue}else{e.position=i,e.line=l,e.lineStart=c,e.lineIndent=g;break}}s&&(N(e,a,i,!1),xe(e,e.line-l),a=i=e.position,s=!1),M(h)||(i=e.position+1),h=e.input.charCodeAt(++e.position)}return N(e,a,i,!1),e.result?!0:(e.kind=u,e.result=p,!1)}function Hr(e,n){var r,o,t;if(r=e.input.charCodeAt(e.position),r!==39)return!1;for(e.kind="scalar",e.result="",e.position++,o=t=e.position;(r=e.input.charCodeAt(e.position))!==0;)if(r===39)if(N(e,o,e.position,!0),r=e.input.charCodeAt(++e.position),r===39)o=e.position,e.position++,t=e.position;else return!0;else O(r)?(N(e,o,t,!0),xe(e,A(e,!1,n)),o=t=e.position):e.position===e.lineStart&&re(e)?m(e,"unexpected end of the document within a single quoted scalar"):(e.position++,t=e.position);m(e,"unexpected end of the stream within a single quoted scalar")}function Qr(e,n){var r,o,t,a,i,s;if(s=e.input.charCodeAt(e.position),s!==34)return!1;for(e.kind="scalar",e.result="",e.position++,r=o=e.position;(s=e.input.charCodeAt(e.position))!==0;){if(s===34)return N(e,r,e.position,!0),e.position++,!0;if(s===92){if(N(e,r,e.position,!0),s=e.input.charCodeAt(++e.position),O(s))A(e,!1,n);else if(s<256&&mn[s])e.result+=bn[s],e.position++;else if((i=Br(s))>0){for(t=i,a=0;t>0;t--)s=e.input.charCodeAt(++e.position),(i=Mr(s))>=0?a=(a<<4)+i:m(e,"expected hexadecimal character");e.result+=Ur(a),e.position++}else m(e,"unknown escape sequence");r=o=e.position}else O(s)?(N(e,r,o,!0),xe(e,A(e,!1,n)),r=o=e.position):e.position===e.lineStart&&re(e)?m(e,"unexpected end of the document within a double quoted scalar"):(e.position++,o=e.position)}m(e,"unexpected end of the stream within a double quoted scalar")}function Gr(e,n){var r=!0,o,t,a,i=e.tag,s,l=e.anchor,c,g,u,p,h,d=Object.create(null),f,b,y,x;if(x=e.input.charCodeAt(e.position),x===91)g=93,h=!1,s=[];else if(x===123)g=125,h=!0,s={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=s),x=e.input.charCodeAt(++e.position);x!==0;){if(A(e,!0,n),x=e.input.charCodeAt(e.position),x===g)return e.position++,e.tag=i,e.anchor=l,e.kind=h?"mapping":"sequence",e.result=s,!0;r?x===44&&m(e,"expected the node content, but found ','"):m(e,"missed comma between flow collection entries"),b=f=y=null,u=p=!1,x===63&&(c=e.input.charCodeAt(e.position+1),T(c)&&(u=p=!0,e.position++,A(e,!0,n))),o=e.line,t=e.lineStart,a=e.position,J(e,n,V,!1,!0),b=e.tag,f=e.result,A(e,!0,n),x=e.input.charCodeAt(e.position),(p||e.line===o)&&x===58&&(u=!0,x=e.input.charCodeAt(++e.position),A(e,!0,n),J(e,n,V,!1,!0),y=e.result),h?Y(e,s,d,b,f,y,o,t,a):u?s.push(Y(e,null,d,b,f,y,o,t,a)):s.push(f),A(e,!0,n),x=e.input.charCodeAt(e.position),x===44?(r=!0,x=e.input.charCodeAt(++e.position)):r=!1}m(e,"unexpected end of the stream within a flow collection")}function zr(e,n){var r,o,t=ue,a=!1,i=!1,s=n,l=0,c=!1,g,u;if(u=e.input.charCodeAt(e.position),u===124)o=!1;else if(u===62)o=!0;else return!1;for(e.kind="scalar",e.result="";u!==0;)if(u=e.input.charCodeAt(++e.position),u===43||u===45)ue===t?t=u===43?Fe:Nr:m(e,"repeat of a chomping mode identifier");else if((g=qr(u))>=0)g===0?m(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):i?m(e,"repeat of an indentation width identifier"):(s=n+g-1,i=!0);else break;if(M(u)){do u=e.input.charCodeAt(++e.position);while(M(u));if(u===35)do u=e.input.charCodeAt(++e.position);while(!O(u)&&u!==0)}for(;u!==0;){for(ye(e),e.lineIndent=0,u=e.input.charCodeAt(e.position);(!i||e.lineIndent<s)&&u===32;)e.lineIndent++,u=e.input.charCodeAt(++e.position);if(!i&&e.lineIndent>s&&(s=e.lineIndent),O(u)){l++;continue}if(e.lineIndent<s){t===Fe?e.result+=E.repeat("\n",a?1+l:l):t===ue&&a&&(e.result+="\n");break}for(o?M(u)?(c=!0,e.result+=E.repeat("\n",a?1+l:l)):c?(c=!1,e.result+=E.repeat("\n",l+1)):l===0?a&&(e.result+=" "):e.result+=E.repeat("\n",l):e.result+=E.repeat("\n",a?1+l:l),a=!0,i=!0,l=0,r=e.position;!O(u)&&u!==0;)u=e.input.charCodeAt(++e.position);N(e,r,e.position,!1)}return!0}function Ne(e,n){var r,o=e.tag,t=e.anchor,a=[],i,s=!1,l;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=a),l=e.input.charCodeAt(e.position);l!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,m(e,"tab characters must not be used in indentation")),!(l!==45||(i=e.input.charCodeAt(e.position+1),!T(i))));){if(s=!0,e.position++,A(e,!0,-1)&&e.lineIndent<=n){a.push(null),l=e.input.charCodeAt(e.position);continue}if(r=e.line,J(e,n,gn,!1,!0),a.push(e.result),A(e,!0,-1),l=e.input.charCodeAt(e.position),(e.line===r||e.lineIndent>n)&&l!==0)m(e,"bad indentation of a sequence entry");else if(e.lineIndent<n)break}return s?(e.tag=o,e.anchor=t,e.kind="sequence",e.result=a,!0):!1}function Kr(e,n,r){var o,t,a,i,s,l,c=e.tag,g=e.anchor,u={},p=Object.create(null),h=null,d=null,f=null,b=!1,y=!1,x;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=u),x=e.input.charCodeAt(e.position);x!==0;){if(!b&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,m(e,"tab characters must not be used in indentation")),o=e.input.charCodeAt(e.position+1),a=e.line,(x===63||x===58)&&T(o))x===63?(b&&(Y(e,u,p,h,d,null,i,s,l),h=d=f=null),y=!0,b=!0,t=!0):b?(b=!1,t=!0):m(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,x=o;else{if(i=e.line,s=e.lineStart,l=e.position,!J(e,r,fn,!1,!0))break;if(e.line===a){for(x=e.input.charCodeAt(e.position);M(x);)x=e.input.charCodeAt(++e.position);if(x===58)x=e.input.charCodeAt(++e.position),T(x)||m(e,"a whitespace character is expected after the key-value separator within a block mapping"),b&&(Y(e,u,p,h,d,null,i,s,l),h=d=f=null),y=!0,b=!1,t=!1,h=e.tag,d=e.result;else if(y)m(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=c,e.anchor=g,!0}else if(y)m(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=c,e.anchor=g,!0}if((e.line===a||e.lineIndent>n)&&(b&&(i=e.line,s=e.lineStart,l=e.position),J(e,n,X,!0,t)&&(b?d=e.result:f=e.result),b||(Y(e,u,p,h,d,f,i,s,l),h=d=f=null),A(e,!0,-1),x=e.input.charCodeAt(e.position)),(e.line===a||e.lineIndent>n)&&x!==0)m(e,"bad indentation of a mapping entry");else if(e.lineIndent<n)break}return b&&Y(e,u,p,h,d,null,i,s,l),y&&(e.tag=c,e.anchor=g,e.kind="mapping",e.result=u),y}function Wr(e){var n,r=!1,o=!1,t,a,i;if(i=e.input.charCodeAt(e.position),i!==33)return!1;if(e.tag!==null&&m(e,"duplication of a tag property"),i=e.input.charCodeAt(++e.position),i===60?(r=!0,i=e.input.charCodeAt(++e.position)):i===33?(o=!0,t="!!",i=e.input.charCodeAt(++e.position)):t="!",n=e.position,r){do i=e.input.charCodeAt(++e.position);while(i!==0&&i!==62);e.position<e.length?(a=e.input.slice(n,e.position),i=e.input.charCodeAt(++e.position)):m(e,"unexpected end of the stream within a verbatim tag")}else{for(;i!==0&&!T(i);)i===33&&(o?m(e,"tag suffix cannot contain exclamation marks"):(t=e.input.slice(n-1,e.position+1),hn.test(t)||m(e,"named tag handle cannot contain such characters"),o=!0,n=e.position+1)),i=e.input.charCodeAt(++e.position);a=e.input.slice(n,e.position),Rr.test(a)&&m(e,"tag suffix cannot contain flow indicator characters")}a&&!pn.test(a)&&m(e,"tag name cannot contain such characters: "+a);try{a=decodeURIComponent(a)}catch(s){m(e,"tag name is malformed: "+a)}return r?e.tag=a:j.call(e.tagMap,t)?e.tag=e.tagMap[t]+a:t==="!"?e.tag="!"+a:t==="!!"?e.tag="tag:yaml.org,2002:"+a:m(e,'undeclared tag handle "'+t+'"'),!0}function Vr(e){var n,r;if(r=e.input.charCodeAt(e.position),r!==38)return!1;for(e.anchor!==null&&m(e,"duplication of an anchor property"),r=e.input.charCodeAt(++e.position),n=e.position;r!==0&&!T(r)&&!U(r);)r=e.input.charCodeAt(++e.position);return e.position===n&&m(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(n,e.position),!0}function Xr(e){var n,r,o;if(o=e.input.charCodeAt(e.position),o!==42)return!1;for(o=e.input.charCodeAt(++e.position),n=e.position;o!==0&&!T(o)&&!U(o);)o=e.input.charCodeAt(++e.position);return e.position===n&&m(e,"name of an alias node must contain at least one character"),r=e.input.slice(n,e.position),j.call(e.anchorMap,r)||m(e,'unidentified alias "'+r+'"'),e.result=e.anchorMap[r],A(e,!0,-1),!0}function J(e,n,r,o,t){var a,i,s,l=1,c=!1,g=!1,u,p,h,d,f,b;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,a=i=s=X===r||gn===r,o&&A(e,!0,-1)&&(c=!0,e.lineIndent>n?l=1:e.lineIndent===n?l=0:e.lineIndent<n&&(l=-1)),l===1)for(;Wr(e)||Vr(e);)A(e,!0,-1)?(c=!0,s=a,e.lineIndent>n?l=1:e.lineIndent===n?l=0:e.lineIndent<n&&(l=-1)):s=!1;if(s&&(s=c||t),(l===1||X===r)&&(V===r||fn===r?f=n:f=n+1,b=e.position-e.lineStart,l===1?s&&(Ne(e,b)||Kr(e,b,f))||Gr(e,f)?g=!0:(i&&zr(e,f)||Hr(e,f)||Qr(e,f)?g=!0:Xr(e)?(g=!0,(e.tag!==null||e.anchor!==null)&&m(e,"alias node should not have any properties")):Jr(e,f,V===r)&&(g=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):l===0&&(g=s&&Ne(e,b))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&m(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),u=0,p=e.implicitTypes.length;u<p;u+=1)if(d=e.implicitTypes[u],d.resolve(e.result)){e.result=d.construct(e.result),e.tag=d.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(j.call(e.typeMap[e.kind||"fallback"],e.tag))d=e.typeMap[e.kind||"fallback"][e.tag];else for(d=null,h=e.typeMap.multi[e.kind||"fallback"],u=0,p=h.length;u<p;u+=1)if(e.tag.slice(0,h[u].tag.length)===h[u].tag){d=h[u];break}d||m(e,"unknown tag !<"+e.tag+">"),e.result!==null&&d.kind!==e.kind&&m(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+d.kind+'", not "'+e.kind+'"'),d.resolve(e.result,e.tag)?(e.result=d.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):m(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||g}function Zr(e){var n=e.position,r,o,t,a=!1,i;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(i=e.input.charCodeAt(e.position))!==0&&(A(e,!0,-1),i=e.input.charCodeAt(e.position),!(e.lineIndent>0||i!==37));){for(a=!0,i=e.input.charCodeAt(++e.position),r=e.position;i!==0&&!T(i);)i=e.input.charCodeAt(++e.position);for(o=e.input.slice(r,e.position),t=[],o.length<1&&m(e,"directive name must not be less than one character in length");i!==0;){for(;M(i);)i=e.input.charCodeAt(++e.position);if(i===35){do i=e.input.charCodeAt(++e.position);while(i!==0&&!O(i));break}if(O(i))break;for(r=e.position;i!==0&&!T(i);)i=e.input.charCodeAt(++e.position);t.push(e.input.slice(r,e.position))}i!==0&&ye(e),j.call(Pe,o)?Pe[o](e,o,t):Z(e,'unknown document directive "'+o+'"')}if(A(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,A(e,!0,-1)):a&&m(e,"directives end mark is expected"),J(e,e.lineIndent-1,X,!1,!0),A(e,!0,-1),e.checkLineBreaks&&Dr.test(e.input.slice(n,e.position))&&Z(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&re(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,A(e,!0,-1));return}if(e.position<e.length-1)m(e,"end of the stream or a document separator is expected");else return}function xn(e,n){e=String(e),n=n||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+="\n"),e.charCodeAt(0)===65279&&(e=e.slice(1)));var r=new Yr(e,n),o=e.indexOf("\0");for(o!==-1&&(r.position=o,m(r,"null byte is not allowed in input")),r.input+="\0";r.input.charCodeAt(r.position)===32;)r.lineIndent+=1,r.position+=1;for(;r.position<r.length-1;)Zr(r);return r.documents}function eo(e,n,r){n!==null&&typeof n=="object"&&typeof r>"u"&&(r=n,n=null);var o=xn(e,r);if(typeof n!="function")return o;for(var t=0,a=o.length;t<a;t+=1)n(o[t])}function no(e,n){var r=xn(e,n);if(r.length!==0){if(r.length===1)return r[0];throw new _("expected a single document in the stream, but found more")}}var ro=eo,oo=no,wn={loadAll:ro,load:oo},vn=Object.prototype.toString,An=Object.prototype.hasOwnProperty,we=65279,to=9,G=10,io=13,ao=32,so=33,lo=34,fe=35,co=37,uo=38,fo=39,go=42,En=44,ho=45,ee=58,po=61,mo=62,bo=63,yo=64,Sn=91,Ln=93,xo=96,Cn=123,wo=124,_n=125,C={};C[0]="\\0";C[7]="\\a";C[8]="\\b";C[9]="\\t";C[10]="\\n";C[11]="\\v";C[12]="\\f";C[13]="\\r";C[27]="\\e";C[34]='\\"';C[92]="\\\\";C[133]="\\N";C[160]="\\_";C[8232]="\\L";C[8233]="\\P";var vo=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Ao=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Eo(e,n){var r,o,t,a,i,s,l;if(n===null)return{};for(r={},o=Object.keys(n),t=0,a=o.length;t<a;t+=1)i=o[t],s=String(n[i]),i.slice(0,2)==="!!"&&(i="tag:yaml.org,2002:"+i.slice(2)),l=e.compiledTypeMap.fallback[i],l&&An.call(l.styleAliases,s)&&(s=l.styleAliases[s]),r[i]=s;return r}function So(e){var n,r,o;if(n=e.toString(16).toUpperCase(),e<=255)r="x",o=2;else if(e<=65535)r="u",o=4;else if(e<=4294967295)r="U",o=8;else throw new _("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+r+E.repeat("0",o-n.length)+n}var Lo=1,z=2;function Co(e){this.schema=e.schema||be,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=E.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Eo(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?z:Lo,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function je(e,n){for(var r=E.repeat(" ",n),o=0,t=-1,a="",i,s=e.length;o<s;)t=e.indexOf("\n",o),t===-1?(i=e.slice(o),o=s):(i=e.slice(o,t+1),o=t+1),i.length&&i!=="\n"&&(a+=r),a+=i;return a}function ge(e,n){return"\n"+E.repeat(" ",e.indent*n)}function _o(e,n){var r,o,t;for(r=0,o=e.implicitTypes.length;r<o;r+=1)if(t=e.implicitTypes[r],t.resolve(n))return!0;return!1}function ne(e){return e===ao||e===to}function K(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==we||65536<=e&&e<=1114111}function De(e){return K(e)&&e!==we&&e!==io&&e!==G}function Re(e,n,r){var o=De(e),t=o&&!ne(e);return(r?o:o&&e!==En&&e!==Sn&&e!==Ln&&e!==Cn&&e!==_n)&&e!==fe&&!(n===ee&&!t)||De(n)&&!ne(n)&&e===fe||n===ee&&t}function ko(e){return K(e)&&e!==we&&!ne(e)&&e!==ho&&e!==bo&&e!==ee&&e!==En&&e!==Sn&&e!==Ln&&e!==Cn&&e!==_n&&e!==fe&&e!==uo&&e!==go&&e!==so&&e!==wo&&e!==po&&e!==mo&&e!==fo&&e!==lo&&e!==co&&e!==yo&&e!==xo}function To(e){return!ne(e)&&e!==ee}function H(e,n){var r=e.charCodeAt(n),o;return r>=55296&&r<=56319&&n+1<e.length&&(o=e.charCodeAt(n+1),o>=56320&&o<=57343)?(r-55296)*1024+o-56320+65536:r}function kn(e){var n=/^\n* /;return n.test(e)}var Tn=1,he=2,Fn=3,On=4,q=5;function Fo(e,n,r,o,t,a,i,s){var l,c=0,g=null,u=!1,p=!1,h=o!==-1,d=-1,f=ko(H(e,0))&&To(H(e,e.length-1));if(n||i)for(l=0;l<e.length;c>=65536?l+=2:l++){if(c=H(e,l),!K(c))return q;f=f&&Re(c,g,s),g=c}else{for(l=0;l<e.length;c>=65536?l+=2:l++){if(c=H(e,l),c===G)u=!0,h&&(p=p||l-d-1>o&&e[d+1]!==" ",d=l);else if(!K(c))return q;f=f&&Re(c,g,s),g=c}p=p||h&&l-d-1>o&&e[d+1]!==" "}return!u&&!p?f&&!i&&!t(e)?Tn:a===z?q:he:r>9&&kn(e)?q:i?a===z?q:he:p?On:Fn}function Oo(e,n,r,o,t){e.dump=function(){if(n.length===0)return e.quotingType===z?'""':"''";if(!e.noCompatMode&&(vo.indexOf(n)!==-1||Ao.test(n)))return e.quotingType===z?'"'+n+'"':"'"+n+"'";var a=e.indent*Math.max(1,r),i=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-a),s=o||e.flowLevel>-1&&r>=e.flowLevel;function l(c){return _o(e,c)}switch(Fo(n,s,e.indent,i,l,e.quotingType,e.forceQuotes&&!o,t)){case Tn:return n;case he:return"'"+n.replace(/'/g,"''")+"'";case Fn:return"|"+Me(n,e.indent)+Be(je(n,a));case On:return">"+Me(n,e.indent)+Be(je(Io(n,i),a));case q:return'"'+Po(n)+'"';default:throw new _("impossible error: invalid scalar style")}}()}function Me(e,n){var r=kn(e)?String(n):"",o=e[e.length-1]==="\n",t=o&&(e[e.length-2]==="\n"||e==="\n"),a=t?"+":o?"":"-";return r+a+"\n"}function Be(e){return e[e.length-1]==="\n"?e.slice(0,-1):e}function Io(e,n){for(var r=/(\n+)([^\n]*)/g,o=function(){var c=e.indexOf("\n");return c=c!==-1?c:e.length,r.lastIndex=c,qe(e.slice(0,c),n)}(),t=e[0]==="\n"||e[0]===" ",a,i;i=r.exec(e);){var s=i[1],l=i[2];a=l[0]===" ",o+=s+(!t&&!a&&l!==""?"\n":"")+qe(l,n),t=a}return o}function qe(e,n){if(e===""||e[0]===" ")return e;for(var r=/ [^ ]/g,o,t=0,a,i=0,s=0,l="";o=r.exec(e);)s=o.index,s-t>n&&(a=i>t?i:s,l+="\n"+e.slice(t,a),t=a+1),i=s;return l+="\n",e.length-t>n&&i>t?l+=e.slice(t,i)+"\n"+e.slice(i+1):l+=e.slice(t),l.slice(1)}function Po(e){for(var n="",r=0,o,t=0;t<e.length;r>=65536?t+=2:t++)r=H(e,t),o=C[r],!o&&K(r)?(n+=e[t],r>=65536&&(n+=e[t+1])):n+=o||So(r);return n}function $o(e,n,r){var o="",t=e.tag,a,i,s;for(a=0,i=r.length;a<i;a+=1)s=r[a],e.replacer&&(s=e.replacer.call(r,String(a),s)),(P(e,n,s,!1,!1)||typeof s>"u"&&P(e,n,null,!1,!1))&&(o!==""&&(o+=","+(e.condenseFlow?"":" ")),o+=e.dump);e.tag=t,e.dump="["+o+"]"}function Ue(e,n,r,o){var t="",a=e.tag,i,s,l;for(i=0,s=r.length;i<s;i+=1)l=r[i],e.replacer&&(l=e.replacer.call(r,String(i),l)),(P(e,n+1,l,!0,!0,!1,!0)||typeof l>"u"&&P(e,n+1,null,!0,!0,!1,!0))&&((!o||t!=="")&&(t+=ge(e,n)),e.dump&&G===e.dump.charCodeAt(0)?t+="-":t+="- ",t+=e.dump);e.tag=a,e.dump=t||"[]"}function No(e,n,r){var o="",t=e.tag,a=Object.keys(r),i,s,l,c,g;for(i=0,s=a.length;i<s;i+=1)g="",o!==""&&(g+=", "),e.condenseFlow&&(g+='"'),l=a[i],c=r[l],e.replacer&&(c=e.replacer.call(r,l,c)),P(e,n,l,!1,!1)&&(e.dump.length>1024&&(g+="? "),g+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),P(e,n,c,!1,!1)&&(g+=e.dump,o+=g));e.tag=t,e.dump="{"+o+"}"}function jo(e,n,r,o){var t="",a=e.tag,i=Object.keys(r),s,l,c,g,u,p;if(e.sortKeys===!0)i.sort();else if(typeof e.sortKeys=="function")i.sort(e.sortKeys);else if(e.sortKeys)throw new _("sortKeys must be a boolean or a function");for(s=0,l=i.length;s<l;s+=1)p="",(!o||t!=="")&&(p+=ge(e,n)),c=i[s],g=r[c],e.replacer&&(g=e.replacer.call(r,c,g)),P(e,n+1,c,!0,!0,!0)&&(u=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,u&&(e.dump&&G===e.dump.charCodeAt(0)?p+="?":p+="? "),p+=e.dump,u&&(p+=ge(e,n)),P(e,n+1,g,!0,u)&&(e.dump&&G===e.dump.charCodeAt(0)?p+=":":p+=": ",p+=e.dump,t+=p));e.tag=a,e.dump=t||"{}"}function Ye(e,n,r){var o,t,a,i,s,l;for(t=r?e.explicitTypes:e.implicitTypes,a=0,i=t.length;a<i;a+=1)if(s=t[a],(s.instanceOf||s.predicate)&&(!s.instanceOf||typeof n=="object"&&n instanceof s.instanceOf)&&(!s.predicate||s.predicate(n))){if(r?s.multi&&s.representName?e.tag=s.representName(n):e.tag=s.tag:e.tag="?",s.represent){if(l=e.styleMap[s.tag]||s.defaultStyle,vn.call(s.represent)==="[object Function]")o=s.represent(n,l);else if(An.call(s.represent,l))o=s.represent[l](n,l);else throw new _("!<"+s.tag+'> tag resolver accepts not "'+l+'" style');e.dump=o}return!0}return!1}function P(e,n,r,o,t,a,i){e.tag=null,e.dump=r,Ye(e,r,!1)||Ye(e,r,!0);var s=vn.call(e.dump),l=o,c;o&&(o=e.flowLevel<0||e.flowLevel>n);var g=s==="[object Object]"||s==="[object Array]",u,p;if(g&&(u=e.duplicates.indexOf(r),p=u!==-1),(e.tag!==null&&e.tag!=="?"||p||e.indent!==2&&n>0)&&(t=!1),p&&e.usedDuplicates[u])e.dump="*ref_"+u;else{if(g&&p&&!e.usedDuplicates[u]&&(e.usedDuplicates[u]=!0),s==="[object Object]")o&&Object.keys(e.dump).length!==0?(jo(e,n,e.dump,t),p&&(e.dump="&ref_"+u+e.dump)):(No(e,n,e.dump),p&&(e.dump="&ref_"+u+" "+e.dump));else if(s==="[object Array]")o&&e.dump.length!==0?(e.noArrayIndent&&!i&&n>0?Ue(e,n-1,e.dump,t):Ue(e,n,e.dump,t),p&&(e.dump="&ref_"+u+e.dump)):($o(e,n,e.dump),p&&(e.dump="&ref_"+u+" "+e.dump));else if(s==="[object String]")e.tag!=="?"&&Oo(e,e.dump,n,a,l);else{if(s==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new _("unacceptable kind of an object to dump "+s)}e.tag!==null&&e.tag!=="?"&&(c=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?c="!"+c:c.slice(0,18)==="tag:yaml.org,2002:"?c="!!"+c.slice(18):c="!<"+c+">",e.dump=c+" "+e.dump)}return!0}function Do(e,n){var r=[],o=[],t,a;for(pe(e,r,o),t=0,a=o.length;t<a;t+=1)n.duplicates.push(r[o[t]]);n.usedDuplicates=new Array(a)}function pe(e,n,r){var o,t,a;if(e!==null&&typeof e=="object")if(t=n.indexOf(e),t!==-1)r.indexOf(t)===-1&&r.push(t);else if(n.push(e),Array.isArray(e))for(t=0,a=e.length;t<a;t+=1)pe(e[t],n,r);else for(o=Object.keys(e),t=0,a=o.length;t<a;t+=1)pe(e[o[t]],n,r)}function Ro(e,n){n=n||{};var r=new Co(n);r.noRefs||Do(e,r);var o=e;return r.replacer&&(o=r.replacer.call({"":o},"",o)),P(r,0,o,!0,!0)?r.dump+"\n":""}var Mo=Ro,Bo={dump:Mo};function ve(e,n){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+n+" instead, which is now safe by default.")}}var qo=L,Uo=Qe,Yo=We,Jo=nn,Ho=rn,Qo=be,Go=wn.load,zo=wn.loadAll,Ko=Bo.dump,Wo=_,Vo={binary:ln,float:en,map:Ke,null:Ve,pairs:un,set:dn,timestamp:an,bool:Xe,int:Ze,merge:sn,omap:cn,seq:ze,str:Ge},Xo=ve("safeLoad","load"),Zo=ve("safeLoadAll","loadAll"),et=ve("safeDump","dump"),nt={Type:qo,Schema:Uo,FAILSAFE_SCHEMA:Yo,JSON_SCHEMA:Jo,CORE_SCHEMA:Ho,DEFAULT_SCHEMA:Qo,load:Go,loadAll:zo,dump:Ko,YAMLException:Wo,types:Vo,safeLoad:Xo,safeLoadAll:Zo,safeDump:et},In=nt;var Ae=class{constructor(){}parseUserContext(n){try{if(!n)return null;let r=In.load(n);return console.log("YAML parsed successfully"),r}catch(r){return console.error("Error parsing YAML:",r),null}}countFields(n){let r=0,o=t=>{for(let[a,i]of Object.entries(t))typeof i=="object"&&i!==null&&!Array.isArray(i)?o(i):r++};return o(n),r}formatValueForEmbedding(n,r=""){if(n==null)return"";let o=r.toLowerCase();return o.includes("salary")||o.includes("compensation")?"Salary: ".concat(n,", Expected salary: ").concat(n,", Desired compensation: ").concat(n,", Annual salary: ").concat(n):o.includes("phone")?"Phone number: ".concat(n,", Contact number: ").concat(n,", Tel: ").concat(n):o.includes("visa")?"Visa required: ".concat(n,", Visa status: ").concat(n,", Work permit: ").concat(n):Array.isArray(n)?n.map(t=>this.formatValueForEmbedding(t)).join(", "):typeof n=="object"?Object.entries(n).map(([t,a])=>{if(t.startsWith("_")||a===null||a===void 0)return null;let i=this.formatValueForEmbedding(a,t);return i?"".concat(t,": ").concat(i):null}).filter(Boolean).join(", "):String(n)}async processUserContext(n,r=null){try{if(!n)return console.error("No YAML content provided"),{success:!1,error:"No YAML content provided"};let o=this.parseUserContext(n);if(!o)return console.error("Failed to parse YAML content"),{success:!1,error:"Failed to parse YAML content"};console.log("User context parsed successfully, processing fields for embeddings");let t=new TextEncoder().encode(n).length;console.log("YAML content size: ".concat(t," bytes (").concat((t/1024).toFixed(2)," KB)"));let a=this.countFields(o),i=0;console.log("Total fields to process: ".concat(a));let s=[];for(let[d,f]of Object.entries(o))if(typeof f=="object"&&f!==null&&!Array.isArray(f)){for(let[b,y]of Object.entries(f)){let x="".concat(d,".").concat(b),_e=this.formatValueForEmbedding(y,b);s.push({key:x,value:_e})}if(d==="personal_information"){if(f.salary&&s.push({key:"salary_information",value:"Expected salary: ".concat(f.salary,", Desired compensation: ").concat(f.salary,", Annual salary expectation: ").concat(f.salary,", Salary requirement: ").concat(f.salary,", Compensation expectation: ").concat(f.salary)}),f.phone){let b=f.phone_prefix||"";s.push({key:"contact_information",value:"Phone number: ".concat(b).concat(f.phone,", Email: ").concat(f.email||"",", Contact details: ").concat(b).concat(f.phone," and ").concat(f.email||"")})}(f.country||f.city)&&s.push({key:"location_information",value:"Located in ".concat(f.city||"",", ").concat(f.country||"",", Location: ").concat(f.city||"",", ").concat(f.country||"")})}}else{let b=this.formatValueForEmbedding(f,d);s.push({key:d,value:b})}if(console.log("Prepared ".concat(s.length," fields to process for embeddings")),o.experiences&&Array.isArray(o.experiences))try{let d=/(\d{4})\s*-\s*(Present|\d{4})/i,f="";o.experiences.forEach(b=>{b.employment_period&&(f+="".concat(b.position||"Role"," at ").concat(b.company||"Company"," (").concat(b.employment_period,"). "))}),f&&s.push({key:"experience_summary",value:"Professional experience: ".concat(f," Years of experience in software development, engineering, and related fields.")})}catch(d){console.warn("Error creating experience summary:",d)}let l=JSON.stringify(s).length;console.log("Estimated data size before embeddings: ".concat(l," bytes (").concat((l/1024).toFixed(2)," KB)"));let c=l>1e6,g=c?10:s.length;c&&console.log("Using chunking strategy for large dataset (".concat(g," fields per chunk)"));let u=5,p=Math.ceil(s.length/u);if(console.log("Processing embeddings in ".concat(p," batches of ").concat(u)),c)try{await v.clearAllData(),console.log("Cleared existing data before processing chunks")}catch(d){console.warn("Error clearing existing data:",d)}let h=0;for(let d=0;d<p;d++){let f=d*u,b=Math.min((d+1)*u,s.length),y=s.slice(f,b);console.log("Processing batch ".concat(d+1,"/").concat(p," (").concat(y.length," fields)"));let x=y.map(k=>v.addEntry(k.key,k.value)),ke=(await Promise.allSettled(x)).filter(k=>k.status==="rejected"||k.status==="fulfilled"&&!k.value);if(ke.length>0&&console.warn("".concat(ke.length," embeddings failed in batch ").concat(d+1)),i+=y.length,r){let k=Math.round(i/a*100);r({progress:k,message:"Processing batch ".concat(d+1,"/").concat(p," (").concat(i,"/").concat(a," fields)")})}if(c&&(d+1)%Math.ceil(g/u)===0)try{console.log("Saving chunk to storage after batch ".concat(d+1,"...")),await v.saveAllEmbeddings(),console.log("Clearing memory store after saving chunk");let k=Object.keys(v.data).length;v.data={},console.log("Cleared ".concat(k," entries from memory"))}catch(k){if(console.error("Error saving chunk to storage:",k),h++,h>=3)return console.error("Multiple storage errors encountered, aborting processing"),r&&r({progress:0,message:"Error: Storage quota exceeded. Try reducing YAML complexity."}),{success:!1,error:"Storage quota exceeded",details:"The profile is too large to store with embeddings. Try simplifying your profile or using fewer fields."}}d<p-1&&await new Promise(k=>setTimeout(k,100))}console.log("Embedding generation complete, saving to storage...");try{if(Object.keys(v.data).length>0){let f=await v.saveAllEmbeddings();console.log("Save result: ".concat(f?"Success":"Failed"))}else c&&console.log("No final chunk to save (already saved in chunks)");let d=c?await v.getStoredEmbeddingsCount():Object.keys(v.data).length;console.log("Final storage contains ".concat(d," entries"))}catch(d){if(console.error("Error saving embeddings:",d),d&&d.message&&(d.message.includes("quota")||d.message.includes("QUOTA")||d.message.includes("limit")||d.message.includes("space")))return r&&r({progress:0,message:"Error: Storage quota exceeded. Try reducing YAML complexity."}),{success:!1,error:"Storage quota exceeded",details:"The profile is too large to store with embeddings. Try simplifying your profile."}}return r&&r({progress:100,message:"All fields processed"}),{success:!0,data:o}}catch(o){return console.error("Error processing user context:",o),r&&r({progress:0,message:"Error: ".concat(o.message)}),{success:!1,error:o.message}}}},Pn=new Ae;var Ee=class{constructor(n=null){this.apiEndpoint=n||"http://localhost:11434/api/generate",this.model="qwen2.5:3b",this.job=null,this.user_data=null,this.jobInfo=null,this.pendingQuestions=[],this.batchTimeout=null,this.isProcessingBatch=!1}setJob(n){this.job=n,console.log("Job information set:",n);let r=n&&n.currentJob?n.currentJob:null;r?(this.jobInfo={company:r.company||"",title:r.title||"",location:r.location||"",description:r.description||""},console.log("Creating conversation context for ".concat(this.jobInfo.company))):console.log("No job information provided")}async setUserContext(n,r=null){try{let o=await Pn.processUserContext(n,r);return o.success&&(this.user_data=o.data),{success:o.success,error:o.error||null}}catch(o){return console.error("Error in setUserContext:",o),r&&r({progress:0,message:"Error: ".concat(o.message)}),{success:!1,error:o.message}}}async answerQuestion(n,r=null){try{return console.log("Answering question:",n),console.log("Options:",r),console.log(this.user_data?"In-memory user data cache: Available":"In-memory user data cache: Not available (will use embedding search from storage)"),r&&Array.isArray(r)&&r.length>0?await this.answerWithOptions(n,r):await this.answerWithNoOptions(n)}catch(o){return console.error("Error in answerQuestion:",o),"Error processing question"}}async answerWithOptions(n,r){var o,t,a,i,s,l;try{if(console.log('Getting an answer for "'.concat(n,'" with options:'),r),!r||!Array.isArray(r)||r.length===0)return console.warn("Options array is empty or invalid, falling back to answerWithNoOptions"),this.answerWithNoOptions(n);if(n.toLowerCase().includes("phone country")||n.toLowerCase().includes("country code")||n.toLowerCase().includes("landesvorwahl")){console.log("Found direct match for contact query");let d=((o=this.user_data)==null?void 0:o.personal_information)||{};if(d.country){let f=d.country,b=null;for(let y of r)if(y.toLowerCase().includes(f.toLowerCase())){b=y;break}if(b)return console.log("Found country match: ".concat(b)),this.addToPendingBatch(n,b,r),b;if(f.toLowerCase().includes("german")||f.toLowerCase().includes("deutsch")){for(let y of r)if(y.toLowerCase().includes("germany")||y.toLowerCase().includes("deutsch")||y.toLowerCase().includes("+49"))return console.log("Found German option: ".concat(y)),this.addToPendingBatch(n,y,r),y}}}console.log("Starting semantic search for relevant information...");let c=await v.search(n,3),g="";c.length>0?(console.log("Found ".concat(c.length," relevant keys:"),c),g=c.map(d=>"".concat(d,": ").concat(v.data[d].text)).join(", ")):(console.log("No relevant information found in profile data. Using generic context."),g="The user has significant experience and qualifications suitable for this question.");let u=((t=this.user_data)==null?void 0:t.personal_information)||{},p=u.phone||"",h=u.salary||"";try{let d=S.buildOptionsPrompt(n,r,g);S.addUserMessage(d);let f=await this.callOllamaAPI({model:this.model,messages:S.getCurrentHistory(),options:{temperature:0},stream:!1}),y=(((i=(a=f==null?void 0:f.message)==null?void 0:a.content)==null?void 0:i.trim())||"").replace(/<think>[\s\S]*?<\/think>/g,"").trim();if(r.includes(y))return console.log('Found exact match in options: "'.concat(y,'"')),S.addAssistantResponse(y),this.addToPendingBatch(n,y,r),y;console.log('Answer "'.concat(y,'" not found in options, attempting to refine'));let x=await this.refineOptionSelection(y,r);return this.addToPendingBatch(n,x,r),x}catch(d){if(console.error("Ollama API error in answerWithOptions:",d),console.log("[Function] Falling back to direct context match due to API error"),console.log("[Function] AI Answer:",(s=v.data[c[0]])==null?void 0:s.text),c.length>0){let b=((l=v.data[c[0]])==null?void 0:l.text)||"",y=await this.refineOptionSelection(b,r);return this.addToPendingBatch(n,y,r),y}let f=r.length>1?r[1]:r[0];return console.log("[Function] Selected fallback option:",f),S.addAssistantResponse(f),this.addToPendingBatch(n,f,r),f}}catch(c){console.error("Error in answerWithOptions:",c);let g=r.length>1?r[1]:r[0];return S.addAssistantResponse(g),this.addToPendingBatch(n,g,r),g}}async refineOptionSelection(n,r){try{console.log('Refining answer: "'.concat(n,'" to match available options'));let o=n.toLowerCase().includes("germany")||n.toLowerCase().includes("deutsch");for(let s of r)if(s.toLowerCase()===n.toLowerCase())return console.log('Successfully refined to "'.concat(s,'"')),S.addAssistantResponse(s),s;if(o||r.some(s=>s.includes("(+")&&s.includes(")"))){for(let s of r)if(s.toLowerCase().includes("deutsch"))return console.log('Found German option: "'.concat(s,'"')),S.addAssistantResponse(s),s}console.log('Refined answer "'.concat(n,'" still not in options, using basic matching'));let t=null,a=-1;for(let s of r){let l=s.toLowerCase(),c=n.toLowerCase();if(l.includes(c)||c.includes(l)){let g=Math.max(l.length,c.length)-Math.abs(l.length-c.length);g>a&&(a=g,t=s)}}if(t)return console.log('Found best match: "'.concat(t,'" with score ').concat(a)),S.addAssistantResponse(t),t;let i=r.length>1?r[1]:r[0];return console.log('No match found, using fallback: "'.concat(i,'"')),S.addAssistantResponse(i),i}catch(o){console.error("Error in refineOptionSelection:",o);let t=r.length>1?r[1]:r[0];return S.addAssistantResponse(t),t}}async answerWithNoOptions(n){var r,o,t,a,i;try{if(console.log('Answering question without options: "'.concat(n,'"')),(r=this.user_data)!=null&&r.personal_information){let p=this.user_data.personal_information;if(n.toLowerCase().includes("email")||n.toLowerCase().includes("e-mail")){console.log("Found direct match for email query");let h=p.email||"";if(h)return this.addToPendingBatch(n,h),h}if(n.toLowerCase().includes("phone")||n.toLowerCase().includes("mobile")||n.toLowerCase().includes("telephone")||n.toLowerCase().includes("telefon")){console.log("Found direct match for phone query");let h=p.country_code?p.country_code+p.phone:p.phone||"";if(h)return this.addToPendingBatch(n,h),h}if(n.toLowerCase().includes("name")&&n.toLowerCase().includes("first")){console.log("Found direct match for first name query");let h=p.name||"";if(h)return this.addToPendingBatch(n,h),h}if(n.toLowerCase().includes("name")&&n.toLowerCase().includes("last")){console.log("Found direct match for last name query");let h=p.surname||"";if(h)return this.addToPendingBatch(n,h),h}}console.log("Starting semantic search for relevant information...");let s=await v.search(n,3),l="";s.length>0?(console.log("Found ".concat(s.length," relevant keys:"),s),l=s.map(p=>"".concat(p,": ").concat(v.data[p].text)).join(", ")):(console.log("No relevant information found in profile data. Using generic context."),l="The user has significant experience and qualifications suitable for this question.");let c=((o=this.user_data)==null?void 0:o.personal_information)||{},g=c.phone||"",u=c.salary||"";try{let p=S.buildNoOptionsPrompt(n,l,g,u,this.user_data);S.addUserMessage(p);let h=await this.callOllamaAPI({model:this.model,messages:S.getCurrentHistory(),options:{temperature:0},stream:!1}),f=(((a=(t=h==null?void 0:h.message)==null?void 0:t.content)==null?void 0:a.trim())||"").replace(/<think>[\s\S]*?<\/think>/g,"").trim();if(f&&f!=="Information not available")return console.log('AI generated answer: "'.concat(f,'"')),S.addAssistantResponse(f),this.addToPendingBatch(n,f),f;let b="Information not available";return this.addToPendingBatch(n,b),b}catch(p){if(console.error("Ollama API error in answerWithNoOptions:",p),console.log("[Function] Falling back to direct context match due to API error"),s.length>0){let d=((i=v.data[s[0]])==null?void 0:i.text)||"",f=d.match(/\d+/);if(f&&(n.toLowerCase().includes("year")||n.toLowerCase().includes("experience")||n.toLowerCase().includes("salary")))return console.log("[Function] Extracted number:",f[0]),this.addToPendingBatch(n,f[0]),f[0];if(d&&d.trim())return this.addToPendingBatch(n,d),d}if(["phone","telefon","salary","gehalt","compensation","verg\xFCtung"].some(d=>n.toLowerCase().includes(d))){if(n.toLowerCase().includes("phone")||n.toLowerCase().includes("telefon")){let d=g||"Not provided";return this.addToPendingBatch(n,d),d}if(n.toLowerCase().includes("salary")||n.toLowerCase().includes("gehalt")||n.toLowerCase().includes("compensation")||n.toLowerCase().includes("verg\xFCtung")){let d=u||"Negotiable";return this.addToPendingBatch(n,d),d}}let h="Information not available";return this.addToPendingBatch(n,h),h}}catch(s){console.error("Error in answerWithNoOptions:",s);let l="Error generating response";return this.addToPendingBatch(n,l),l}}async callOllamaAPI(n){try{return new Promise((r,o)=>{chrome.runtime.sendMessage({action:"callOllama",endpoint:"chat",data:n},t=>{chrome.runtime.lastError?o(new Error(chrome.runtime.lastError.message)):t.success===!1?o(new Error(t.error||"Unknown error from Ollama API")):r(t.data)})})}catch(r){throw console.error("Error calling Ollama API:",r),r}}async checkOllamaConnection(){try{return new Promise((n,r)=>{chrome.runtime.sendMessage({action:"testOllama"},o=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):o&&o.success?n(!0):r(new Error((o==null?void 0:o.error)||"Failed to connect to Ollama"))})})}catch(n){throw console.error("Error checking Ollama connection:",n),n}}sendConversationUpdate(){if(!this.jobInfo){console.log("No job info available, skipping conversation update");return}try{let n=S.getCurrentHistory();if(!n||n.length<2){console.log("No meaningful conversation to send");return}let r=n.find(a=>a.role==="user");if(!r){console.log("No user message found in conversation");return}let o=r.content.match(/Form Question:\s*([^?]+)\s*\?/),t=o?o[1].trim():r.content.substring(0,30);console.log('Sending conversation update to background for question: "'.concat(t,'"')),chrome.runtime.sendMessage({action:"CONVERSATION_UPDATED",data:{company:this.jobInfo.company,title:this.jobInfo.title,conversation:n,timestamp:Date.now(),questionId:t}})}catch(n){console.error("Error sending conversation update:",n)}}finalizeConversation(){console.log("finalizeConversation called but not needed - conversations are stored immediately")}addToPendingBatch(n,r,o=[]){let t={question:n,answer:r,options:o,timestamp:Date.now(),questionId:this.extractQuestionId(n)};this.pendingQuestions.push(t),console.log('Added question to batch: "'.concat(t.questionId,'" (Total pending: ').concat(this.pendingQuestions.length,")")),this.scheduleBatchStorage()}extractQuestionId(n){return n.replace(/^(Form Question:|Question:)\s*/i,"").replace(/\s*\?\s*$/,"").trim().substring(0,50)}scheduleBatchStorage(){this.batchTimeout&&clearTimeout(this.batchTimeout),this.batchTimeout=setTimeout(()=>{this.processPendingBatch()},2e3)}async processPendingBatch(){if(!(this.isProcessingBatch||this.pendingQuestions.length===0)){if(!this.jobInfo){console.log("No job info available, clearing pending questions"),this.pendingQuestions=[];return}this.isProcessingBatch=!0,console.log("Processing batch of ".concat(this.pendingQuestions.length," questions for ").concat(this.jobInfo.title));try{for(let n of this.pendingQuestions)await this.storeIndividualConversation(n),await new Promise(r=>setTimeout(r,100));console.log("Successfully stored ".concat(this.pendingQuestions.length," conversations")),this.pendingQuestions=[]}catch(n){console.error("Error processing question batch:",n)}finally{this.isProcessingBatch=!1}}}async storeIndividualConversation(n){try{let r=[{role:"system",content:"You are a helpful assistant that answers job application questions accurately and professionally."},{role:"user",content:this.buildUserMessage(n.question,n.options)},{role:"assistant",content:n.answer}];return new Promise(o=>{chrome.runtime.sendMessage({action:"CONVERSATION_UPDATED",data:{company:this.jobInfo.company,title:this.jobInfo.title,conversation:r,timestamp:n.timestamp,questionId:n.questionId}},t=>{console.log('Stored conversation for: "'.concat(n.questionId,'"')),o(t)})})}catch(r){console.error('Error storing conversation for "'.concat(n.questionId,'":'),r)}}buildUserMessage(n,r=[]){let o="Form Question: ".concat(n,"?");if(r&&r.length>0){let t=r.map(a=>'"'.concat(a,'"')).join(", ");o+="\nAvailable Options: [".concat(t,"]")}return o}async flushPendingQuestions(){this.batchTimeout&&(clearTimeout(this.batchTimeout),this.batchTimeout=null),this.pendingQuestions.length>0&&(console.log("Flushing pending questions before page change"),await this.processPendingBatch())}},W=Ee;var Se=class extends I{static async closeForm(n=!1){var r,o;try{let t=document.querySelector('button[aria-label="Dismiss"]');if(t||(t=document.querySelector('button[aria-label="Close"]')||document.querySelector('button[aria-label="Cancel"]')||document.querySelector("button[data-test-modal-close-btn]")),t){if(t.click(),await this.wait(),n){let a=document.querySelector('button[data-control-name="save_application_btn"]');a&&(a.click(),this.debugLog("Closed form and saved application"))}else{let a=document.querySelector('button[data-control-name="discard_application_confirm_btn"]')||document.querySelector("button[data-test-dialog-secondary-btn]");a&&(a.click(),this.debugLog("Closed form and discarded application"))}await this.wait()}}catch(t){this.errorLog("Error closing form",t);try{let a=document.querySelectorAll("button");for(let i of a)(i.textContent.toLowerCase().includes("close")||i.textContent.toLowerCase().includes("cancel")||(r=i.getAttribute("aria-label"))!=null&&r.toLowerCase().includes("close")||(o=i.getAttribute("aria-label"))!=null&&o.toLowerCase().includes("dismiss"))&&(i.click(),await this.wait(500))}catch(a){this.errorLog("Failed final attempt to close form",a)}}}static async clickNextPage(){try{await this.wait();let n=document.querySelector('button[aria-label="Continue to next step"]');n&&(n.click(),this.debugLog("Clicked on next page button"))}catch(n){this.errorLog("Error clicking on next page button",n)}}static async clickPreviousPage(){try{await this.wait();let n=document.querySelector('button[aria-label="Back to previous step"]');n&&(n.click(),this.debugLog("Clicked on previous page button"))}catch(n){this.errorLog("Error clicking on previous page button",n)}}static async clickReviewApplication(){try{await this.wait();let n=document.querySelector('button[aria-label="Review your application"]');n&&(n.click(),this.debugLog("Clicked on review button"))}catch(n){this.errorLog("Error clicking on review button",n)}}static async clickSubmitApplication(){try{await this.wait();let n=document.querySelector('button[aria-label="Submit application"]');n&&(n.click(),this.debugLog("Clicked on submit button"))}catch(n){this.errorLog("Error clicking on submit button",n)}}static async clickDoneAfterSubmit(){try{let n=document.querySelector('button[aria-label="Done"]');n||(n=document.querySelector("button.artdeco-button span.artdeco-button__text"),this.debugLog("Found done button",n)),n?(n.click(),this.debugLog("Clicked on Done button")):this.debugLog("Done button not found")}catch(n){this.errorLog("Error clicking on Done button",n)}}static async clickDismissAfterSubmit(){try{let n=document.querySelector('button[aria-label="Dismiss"]');if(n||(n=document.querySelector("button[data-test-modal-close-btn]")),!n){let r=document.querySelectorAll("button.artdeco-button--circle.artdeco-modal__dismiss");for(let o of r)if(o.querySelector('svg use[href="#close-medium"]')){n=o;break}}n?(n.click(),this.debugLog("Clicked on Dismiss button")):this.debugLog("Dismiss button not found")}catch(n){this.errorLog("Error clicking on Dismiss button",n)}}static async findReviewButton(){try{return document.querySelector('button[aria-label="Review your application"]')}catch(n){return this.errorLog("Error finding review button",n),null}}static async findNextButton(){try{return document.querySelector('button[aria-label="Continue to next step"]')}catch(n){return this.errorLog("Error finding next button",n),null}}static async findSubmitButton(){try{return document.querySelector('button[aria-label="Submit application"]')}catch(n){return this.errorLog("Error finding submit button",n),null}}static async findDoneButton(){try{let n=document.querySelector('button[aria-label="Done"]');if(!n){let r=document.querySelectorAll("button.artdeco-button");for(let o of r){let t=o.querySelector("span.artdeco-button__text");if(t&&t.textContent.trim()==="Done"){n=o;break}}}return n}catch(n){return this.errorLog("Error finding done button",n),null}}static async processForm(n){try{this.debugLog("Starting form processing");let r=setTimeout(()=>{this.debugLog("Form processing timeout reached"),n.value=!0},3*60*1e3),o=!1;for(;!n.value;)try{if(await this.findReviewButton()){this.debugLog("Found review button");let l=setTimeout(()=>{this.debugLog("Review processing timeout reached"),n.value=!0},1*60*1e3);document.querySelectorAll("div.fb-dash-form-element").length>0&&!o?(this.debugLog("Found questions on current page, processing before review"),await this.processFormQuestions(),o=!0,this.debugLog("Current page form questions processed, will not reprocess")):o?this.debugLog("Skipping redundant form processing for current page"):this.debugLog("No form questions found on current page"),await this.flushPendingQuestions(),await this.clickReviewApplication(),await this.wait(2e3),document.querySelectorAll("div.fb-dash-form-element").length>0?(this.debugLog("Found questions on review page"),await this.processFormQuestions()):this.debugLog("No questions found on review page"),await this.flushPendingQuestions(),await this.clickSubmitApplication(),await this.wait(2e3),await this.clickDismissAfterSubmit(),this.debugLog("Clicked submit button after review"),clearTimeout(l);break}if(document.querySelectorAll("div.fb-dash-form-element").length>0&&!o&&(this.debugLog("Found form questions, processing..."),await this.processFormQuestions(),o=!0,this.debugLog("Form questions processed")),await this.findNextButton()){this.debugLog("Found next button, moving to next page"),await this.flushPendingQuestions(),await this.clickNextPage(),await this.wait(2e3),o=!1;continue}if(await this.findSubmitButton()){this.debugLog("Found submit button, submitting application"),await this.flushPendingQuestions(),await this.clickSubmitApplication(),await this.wait(2e3),await this.clickDismissAfterSubmit();break}this.debugLog("No navigation buttons found, waiting..."),await this.wait(1e3)}catch(t){this.errorLog("Error in form processing loop",t),await this.wait(2e3)}return clearTimeout(r),this.debugLog("Form processing completed"),!0}catch(r){return this.errorLog("Error processing form",r),!1}}static async processFormQuestions(){try{this.debugLog("Processing form questions");let n=document.querySelectorAll("div.fb-dash-form-element");this.debugLog("Found ".concat(n.length," form elements"));for(let r of n)try{let o=r.querySelector("legend span.fb-dash-form-element__label span")||r.querySelector("label");if(!o){this.debugLog("No label found for form element");continue}let t=o.textContent.trim();t=t.replace(/(.+?)\1/,"$1"),this.debugLog("Processing question: ".concat(t));let a=r.querySelector("input, textarea, select");if(!a){this.debugLog("No input field found for question");continue}let i=[];switch(a.tagName.toLowerCase()){case"input":a.type==="radio"&&r.querySelectorAll('input[type="radio"]').forEach(l=>{let c=r.querySelector('label[for="'.concat(l.id,'"]'));c&&i.push(c.textContent.trim())});break;case"select":i=Array.from(a.options).map(s=>s.text.trim());break}i.length>0&&this.debugLog('Available options for "'.concat(t,'":')),await this.answerQuestion(t,i,a,r)}catch(o){this.errorLog("Error processing form element: ".concat(o.message),o)}return this.debugLog("Completed processing form questions"),!0}catch(n){return this.errorLog("Error in processFormQuestions",n),!1}}static async answerQuestion(n,r=[],o,t){try{let a=new W;this.debugLog("Answering question: ".concat(n)),this.debugLog("Available options:",r);try{let l=await chrome.storage.local.get("userProfileYaml");l&&l.userProfileYaml?(this.debugLog("Found user profile YAML in storage"),await a.setUserContext(l.userProfileYaml),this.debugLog("Set user context in AI instance")):this.debugLog("No user profile found in storage")}catch(l){this.errorLog("Error loading user profile from storage:",l)}let i=await chrome.storage.local.get("currentJob");a.setJob(i);let s=await a.answerQuestion(n,r);if(!s)return this.debugLog("No answer generated for question"),!1;switch(this.debugLog("AI Answer: ".concat(s)),o.tagName.toLowerCase()){case"input":switch(o.type){case"text":case"tel":case"email":o.value=s,o.dispatchEvent(new Event("input",{bubbles:!0}));break;case"radio":let l=t.querySelectorAll('input[type="radio"]');for(let c of l){let g=t.querySelector('label[for="'.concat(c.id,'"]'));if(g&&g.textContent.trim()===s){c.click(),this.debugLog("Selected radio option: ".concat(s));break}}break;case"checkbox":o.checked=!0,o.dispatchEvent(new Event("change",{bubbles:!0}));break}break;case"textarea":o.value=s,o.dispatchEvent(new Event("input",{bubbles:!0}));break;case"select":for(let l=0;l<o.options.length;l++)if(o.options[l].text.trim()===s){o.selectedIndex=l,o.dispatchEvent(new Event("change",{bubbles:!0})),this.debugLog("Selected option: ".concat(s));break}break}return await this.wait(500),!0}catch(a){return this.errorLog('Error answering question "'.concat(n,'"'),a),!1}}static async flushPendingQuestions(){try{let n=new W,r=await chrome.storage.local.get("currentJob");n.setJob(r),await n.flushPendingQuestions(),this.debugLog("Flushed pending questions")}catch(n){this.errorLog("Error flushing pending questions",n)}}static async finalizePageConversation(){try{this.debugLog("Finalizing page conversation"),await this.flushPendingQuestions(),this.debugLog("Page conversation finalized")}catch(n){this.errorLog("Error finalizing page conversation",n)}}},oe=Se;function w(e,n=null){let r=new Date().toISOString().split("T")[1],o="[EasyJob Debug ".concat(r,"] ").concat(e);n?console.log(o,n):console.log(o)}function F(e,n="info"){w("Status Update: ".concat(n," - ").concat(e)),chrome.runtime.sendMessage({type:"STATUS_UPDATE",text:e,status:n})}async function B(e){return e?!1:(w("Auto-apply process stopped by user"),F("Auto-apply process stopped","info"),chrome.runtime.sendMessage({type:"PROCESS_COMPLETE"}),!0)}chrome.runtime.onMessage.addListener((e,n,r)=>{if(e.action==="START_AUTO_APPLY")return rt().then(()=>{r({success:!0})}).catch(o=>{console.error("Error in auto-apply process:",o),r({success:!1,error:o.message})}),!0});async function rt(){}var Le=class extends I{static async processJobPage(n,r,o,t){this.debugLog("Processing page ".concat(n,"/").concat(r)),F("Processing page ".concat(n," of ").concat(r),"info");let a=await $.getListOfJobsOnPage(o);w("Found ".concat(a.length," jobs on page ").concat(n));for(let i of a){if(await B(t))return;await B(t)||(await new Promise(s=>setTimeout(s,3e3)),w("Waited cooldown period"))}if(n<r)if(w("Finished processing page ".concat(n,", navigating to next page...")),F("Moving to page ".concat(n+1," of ").concat(r,"..."),"info"),await $.goToNextPage())w("Successfully navigated to page ".concat(n+1));else return w("Failed to navigate to next page or reached last page"),await $.isOnLastPage()?(w("Confirmed: reached the last page"),F("Reached the last page of results","info")):(w("Navigation failed but not on last page - stopping process"),F("Failed to navigate to next page - stopping","error")),!1;else w("Finished processing last page (".concat(n,"/").concat(r,")"));return!0}};var Ce=Le;var D=!1;async function it(){try{if(w("Starting auto-apply process"),w("Current URL:",window.location.href),await B(D))return;let e=document.querySelector(".scaffold-layout.jobs-search-two-pane__layout");if(w("Search element found:",!!e),!e){w("Available elements on page:",{body:document.body.innerHTML.substring(0,500)+"...",possibleSelectors:{scaffold:document.querySelector(".scaffold-layout"),jobsSearch:document.querySelector(".jobs-search-two-pane__layout"),anyJobsRelated:document.querySelectorAll('[class*="jobs-"]')}}),F("Could not find jobs list. Please make sure you are on LinkedIn jobs page.","error");return}w("Getting total jobs count");let n=await $.getTotalJobsSearchCount(e);w("Total jobs found:",n),F("Found ".concat(n," jobs to process"),"info"),w("Getting available pages");let r=await $.getAvailablePages(e,n);w("Total pages found:",r);for(let o=1;o<=r;o++){if(await B(D))return;if(await Ce.processJobPage(o,r,e,D)===!1){w("Page processing failed or reached end, stopping at page ".concat(o));break}}await B(D)||(w("Auto-apply process completed"),F("Auto-apply process completed!","success"),chrome.runtime.sendMessage({type:"PROCESS_COMPLETE"}))}catch(e){console.error("Error in auto-apply process:",e),w("Fatal error in auto-apply process:",{error:e.message,stack:e.stack}),F("Error in auto-apply process","error"),await oe.closeForm(!1)}}chrome.runtime.onMessage.addListener((e,n,r)=>(w("Received message in content script:",e),e.action==="START_AUTO_APPLY"?D||(D=!0,w("Starting auto-apply process"),it()):e.action==="STOP_AUTO_APPLY"?(w("Stopping auto-apply process"),D=!1):e.action==="GET_STATE"&&(w("Getting current state"),r({isRunning:D})),!0));console.log("Initializing EasyJob AI systems...");async function at(){try{console.log("-----------------------------------"),console.log("\u{1F504} EasyJob AI System Initialization"),console.log("-----------------------------------"),console.log("Preloading embeddings into memory..."),await v.preloadEmbeddings();let e=Object.keys(v.data).length,n=await v.getStoredEmbeddingsCount();if(console.log("Memory status:",{memoryStoreSize:e,storageCount:n,hasLoadedFromStorage:v.hasTriedLoading}),e>0){console.log("\u2705 Embeddings successfully loaded into memory");let r=new W;console.log("\u2705 AI question answerer initialized and ready")}else console.log("\u26A0\uFE0F No embeddings found in memory. Checking storage and profile status..."),await new Promise(o=>{chrome.storage.local.get("userProfile",t=>{o(!!t.userProfile)})})?(console.log("\u{1F50D} User profile exists but embeddings are not generated or failed to load."),console.log("\u{1F4A1} Please open the extension popup and reload the profile to generate embeddings."),chrome.storage.local.get(null,function(o){console.log("\u{1F4CA} Storage overview:",{totalItems:Object.keys(o).length,hasProfile:!!o.userProfile,hasEmbeddings:!!o.storedEmbeddings,profileSize:o.userProfile?JSON.stringify(o.userProfile).length:0,embeddingsSize:o.storedEmbeddings?JSON.stringify(o.storedEmbeddings).length:0})})):(console.log("\u274C No user profile found in storage."),console.log("\u{1F4A1} Please upload a profile through the extension popup."));console.log("-----------------------------------")}catch(e){console.error("\u274C Error initializing AI:",e)}}at();
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
