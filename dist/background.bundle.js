var Nn=Object.defineProperty,$n=Object.defineProperties;var Mn=Object.getOwnPropertyDescriptors;var ye=Object.getOwnPropertySymbols;var Dn=Object.prototype.hasOwnProperty,Pn=Object.prototype.propertyIsEnumerable;var xe=(e,n,r)=>n in e?Nn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,J=(e,n)=>{for(var r in n||(n={}))Dn.call(n,r)&&xe(e,r,n[r]);if(ye)for(var r of ye(n))Pn.call(n,r)&&xe(e,r,n[r]);return e},W=(e,n)=>$n(e,Mn(n));var U=class{constructor(n=null){this.data={},this.directEmbeddingFunction=n,this.hasTriedLoading=!1,this.preloadEmbeddings()}async addEntry(n,r){if(!r)return!1;try{console.log("Adding entry for key: ".concat(n));let o=await this.getEmbedding(r);return o&&o.success&&o.data&&o.data.embedding?(this.data[n]={text:r,embedding:o.data.embedding},console.log("Successfully added embedding for key: ".concat(n," (Store size: ").concat(Object.keys(this.data).length,")")),!0):(console.warn("Failed to generate embedding for key: ".concat(n)),!1)}catch(o){return console.error("Error adding entry to memory store:",o),!1}}async loadStoredEmbeddings(){return this.hasTriedLoading?(console.log("Already tried loading embeddings. Current size: ".concat(Object.keys(this.data).length)),Object.keys(this.data).length>0):(console.log("Attempting to load stored embeddings from Chrome storage..."),new Promise(n=>{chrome.storage.local.get("storedEmbeddings",r=>{r.storedEmbeddings&&Object.keys(r.storedEmbeddings).length>0?(this.data=r.storedEmbeddings,console.log("Loaded embeddings from storage, found",Object.keys(this.data).length,"entries"),this.hasTriedLoading=!0,n(!0)):(console.log("No stored embeddings found in Chrome storage"),this.hasTriedLoading=!0,n(!1))})}))}flattenEmbeddingData(n){let r={};for(let[l,a]of Object.entries(n))if(a.embedding&&Array.isArray(a.embedding)){let s=a.embedding.map(c=>parseFloat(c.toFixed(5)));r[l]={text:a.text,embedding:s}}else r[l]=a;let o=JSON.stringify(n).length,i=JSON.stringify(r).length,t=(100-i/o*100).toFixed(2);return console.log("Flattened embeddings: ".concat(o," bytes \u2192 ").concat(i," bytes (").concat(t,"% reduction)")),r}async saveAllEmbeddings(){return new Promise((n,r)=>{if(Object.keys(this.data).length===0){console.warn("No embeddings to save to storage"),n(!1);return}console.log("Saving ".concat(Object.keys(this.data).length," embeddings to Chrome storage"));let o=this.flattenEmbeddingData(this.data),i=JSON.stringify(o).length;console.log("Storage payload size: ".concat(i," bytes (").concat((i/(1024*1024)).toFixed(2)," MB)")),chrome.storage.local.set({storedEmbeddings:o},()=>{if(chrome.runtime.lastError){let t=chrome.runtime.lastError;console.error("Error saving embeddings to storage:",t),t.message&&(t.message.includes("quota")||t.message.includes("QUOTA")||t.message.includes("limit")||t.message.includes("space"))&&(console.error("Storage quota exceeded. Data size: ".concat(i," bytes.")),console.error("Consider reducing the amount of data or implementing chunking.")),r(t)}else console.log("Successfully saved ".concat(Object.keys(o).length," embeddings to storage")),n(!0)})})}async search(n,r=3){if(console.log('Searching for related info: "'.concat(n,'" (top ').concat(r," results)")),Object.keys(this.data).length===0&&console.warn("Memory store is empty before loading attempt, checking storage..."),Object.keys(this.data).length===0&&!await this.loadStoredEmbeddings())return console.warn("Memory store is empty, no data to search. Check if YAML was properly loaded."),chrome.storage.local.get(null,function(t){console.log("All chrome storage items:",Object.keys(t)),console.log("Storage size:",JSON.stringify(t).length,"bytes"),t.userProfile&&console.log("User profile exists in storage but no embeddings found")}),[];let o=n.toLowerCase();if(o.includes("salary")||o.includes("compensation")||o.includes("earn")||o.includes("pay")){if(this.data.salary_information)return console.log("Found direct match for salary query"),["salary_information"];let i=Object.keys(this.data).filter(t=>t.toLowerCase().includes("salary")||this.data[t].text&&this.data[t].text.toLowerCase().includes("salary"));if(i.length>0)return console.log("Found ".concat(i.length," direct salary-related keys")),i.slice(0,r)}if(o.includes("phone")||o.includes("contact")||o.includes("call")){if(this.data.contact_information)return console.log("Found direct match for contact query"),["contact_information"];let i=Object.keys(this.data).filter(t=>t.toLowerCase().includes("phone")||t.toLowerCase().includes("contact")||t.toLowerCase().includes("email"));if(i.length>0)return console.log("Found ".concat(i.length," direct contact-related keys")),i.slice(0,r)}if((o.includes("location")||o.includes("where")||o.includes("city")||o.includes("country"))&&this.data.location_information)return console.log("Found direct match for location query"),["location_information"];if((o.includes("experience")||o.includes("years")||o.includes("work history")||o.includes("background"))&&this.data.experience_summary)return console.log("Found direct match for experience query"),["experience_summary"];try{let i=await this.getEmbedding(n);if(!i||!i.success||!i.data||!i.data.embedding)return console.error("Failed to generate embedding for search query"),[];let t=i.data.embedding,l={};for(let[s,c]of Object.entries(this.data)){let f=this.cosineSimilarity(c.embedding,t);l[s]=f}let a=Object.keys(l).sort((s,c)=>l[c]-l[s]).slice(0,r);return console.log("Found ".concat(a.length," relevant keys: ").concat(a.join(", "))),a}catch(i){return console.error("Error searching memory store:",i),[]}}cosineSimilarity(n,r){if(!n||!r||n.length!==r.length)return 0;let o=0,i=0,t=0;for(let l=0;l<n.length;l++)o+=n[l]*r[l],i+=n[l]*n[l],t+=r[l]*r[l];return i=Math.sqrt(i),t=Math.sqrt(t),i===0||t===0?0:o/(i*t)}async clearAllData(n=!0){console.log("Clearing memory store data");let r=Object.keys(this.data).length;return this.data={},this.hasTriedLoading=!1,n?(console.log("Also clearing embeddings from Chrome storage"),new Promise(o=>{chrome.storage.local.remove("storedEmbeddings",()=>{chrome.runtime.lastError?(console.error("Error clearing embeddings from storage:",chrome.runtime.lastError),o(!1)):(console.log("Successfully cleared ".concat(r," embeddings from memory and storage")),o(!0))})})):(console.log("Successfully cleared ".concat(r," embeddings from memory only")),!0)}async getStoredEmbeddingsCount(){return new Promise(n=>{chrome.storage.local.get("storedEmbeddings",r=>{if(chrome.runtime.lastError)console.error("Error getting stored embeddings count:",chrome.runtime.lastError),n(0);else if(r.storedEmbeddings){let o=Object.keys(r.storedEmbeddings).length;console.log("Found ".concat(o," embeddings in Chrome storage")),n(o)}else console.log("No embeddings found in Chrome storage"),n(0)})})}async getEmbedding(n){if(this.directEmbeddingFunction){console.log("Using direct embedding function");try{let r=performance.now(),o=await this.directEmbeddingFunction(n),i=performance.now();if(console.log("Embedding generated in ".concat((i-r).toFixed(2),"ms")),o&&o.success&&o.data&&o.data.embedding){let t=o.data.embedding;console.log("Embedding dimensions: ".concat(t.length)),console.log("Embedding sample: [".concat(t.slice(0,3).map(l=>l.toFixed(5)).join(", "),"...]"))}return o}catch(r){throw console.error("Error using direct embedding function:",r),r}}return new Promise((r,o)=>{console.log("Requesting embedding from background script for text (length: ".concat(n.length,'): "').concat(n.substring(0,50),'..."'));let i=performance.now();chrome.runtime.sendMessage({action:"getEmbeddings",text:n},t=>{let l=performance.now();if(chrome.runtime.lastError)console.error("Embedding request failed after ".concat((l-i).toFixed(2),"ms:"),chrome.runtime.lastError),o(new Error(chrome.runtime.lastError.message));else{if(console.log("Embedding received from API in ".concat((l-i).toFixed(2),"ms")),t&&t.success&&t.data&&t.data.embedding){let a=t.data.embedding;console.log("Embedding dimensions: ".concat(a.length)),console.log("Embedding sample: [".concat(a.slice(0,3).map(s=>s.toFixed(5)).join(", "),"...]"))}else console.warn("Received invalid embedding response:",t);r(t)}})})}async preloadEmbeddings(){console.log("Preloading embeddings from storage into memory...");try{let n=await this.loadStoredEmbeddings();return console.log(n?"Successfully preloaded ".concat(Object.keys(this.data).length," embeddings into memory"):"No embeddings found to preload"),n}catch(n){return console.error("Error preloading embeddings:",n),!1}}},jn=new U,_=jn;function $e(e){return typeof e>"u"||e===null}function Rn(e){return typeof e=="object"&&e!==null}function Yn(e){return Array.isArray(e)?e:$e(e)?[]:[e]}function Bn(e,n){var r,o,i,t;if(n)for(t=Object.keys(n),r=0,o=t.length;r<o;r+=1)i=t[r],e[i]=n[i];return e}function Un(e,n){var r="",o;for(o=0;o<n;o+=1)r+=e;return r}function Hn(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var qn=$e,Kn=Rn,zn=Yn,Gn=Un,Jn=Hn,Wn=Bn,E={isNothing:qn,isObject:Kn,toArray:zn,repeat:Gn,isNegativeZero:Jn,extend:Wn};function Me(e,n){var r="",o=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(r+='in "'+e.mark.name+'" '),r+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!n&&e.mark.snippet&&(r+="\n\n"+e.mark.snippet),o+" "+r):o}function q(e,n){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=n,this.message=Me(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}q.prototype=Object.create(Error.prototype);q.prototype.constructor=q;q.prototype.toString=function(n){return this.name+": "+Me(this,n)};var C=q;function re(e,n,r,o,i){var t="",l="",a=Math.floor(i/2)-1;return o-n>a&&(t=" ... ",n=o-a+t.length),r-o>a&&(l=" ...",r=o+a-l.length),{str:t+e.slice(n,r).replace(/\t/g,"\u2192")+l,pos:o-n+t.length}}function ie(e,n){return E.repeat(" ",n-e.length)+e}function Vn(e,n){if(n=Object.create(n||null),!e.buffer)return null;n.maxLength||(n.maxLength=79),typeof n.indent!="number"&&(n.indent=1),typeof n.linesBefore!="number"&&(n.linesBefore=3),typeof n.linesAfter!="number"&&(n.linesAfter=2);for(var r=/\r?\n|\r|\0/g,o=[0],i=[],t,l=-1;t=r.exec(e.buffer);)i.push(t.index),o.push(t.index+t[0].length),e.position<=t.index&&l<0&&(l=o.length-2);l<0&&(l=o.length-1);var a="",s,c,f=Math.min(e.line+n.linesAfter,i.length).toString().length,u=n.maxLength-(n.indent+f+3);for(s=1;s<=n.linesBefore&&!(l-s<0);s++)c=re(e.buffer,o[l-s],i[l-s],e.position-(o[l]-o[l-s]),u),a=E.repeat(" ",n.indent)+ie((e.line-s+1).toString(),f)+" | "+c.str+"\n"+a;for(c=re(e.buffer,o[l],i[l],e.position,u),a+=E.repeat(" ",n.indent)+ie((e.line+1).toString(),f)+" | "+c.str+"\n",a+=E.repeat("-",n.indent+f+3+c.pos)+"^\n",s=1;s<=n.linesAfter&&!(l+s>=i.length);s++)c=re(e.buffer,o[l+s],i[l+s],e.position-(o[l]-o[l+s]),u),a+=E.repeat(" ",n.indent)+ie((e.line+s+1).toString(),f)+" | "+c.str+"\n";return a.replace(/\n$/,"")}var Qn=Vn,Xn=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Zn=["scalar","sequence","mapping"];function er(e){var n={};return e!==null&&Object.keys(e).forEach(function(r){e[r].forEach(function(o){n[String(o)]=r})}),n}function nr(e,n){if(n=n||{},Object.keys(n).forEach(function(r){if(Xn.indexOf(r)===-1)throw new C('Unknown option "'+r+'" is met in definition of "'+e+'" YAML type.')}),this.options=n,this.tag=e,this.kind=n.kind||null,this.resolve=n.resolve||function(){return!0},this.construct=n.construct||function(r){return r},this.instanceOf=n.instanceOf||null,this.predicate=n.predicate||null,this.represent=n.represent||null,this.representName=n.representName||null,this.defaultStyle=n.defaultStyle||null,this.multi=n.multi||!1,this.styleAliases=er(n.styleAliases||null),Zn.indexOf(this.kind)===-1)throw new C('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var w=nr;function be(e,n){var r=[];return e[n].forEach(function(o){var i=r.length;r.forEach(function(t,l){t.tag===o.tag&&t.kind===o.kind&&t.multi===o.multi&&(i=l)}),r[i]=o}),r}function rr(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},n,r;function o(i){i.multi?(e.multi[i.kind].push(i),e.multi.fallback.push(i)):e[i.kind][i.tag]=e.fallback[i.tag]=i}for(n=0,r=arguments.length;n<r;n+=1)arguments[n].forEach(o);return e}function le(e){return this.extend(e)}le.prototype.extend=function(n){var r=[],o=[];if(n instanceof w)o.push(n);else if(Array.isArray(n))o=o.concat(n);else if(n&&(Array.isArray(n.implicit)||Array.isArray(n.explicit)))n.implicit&&(r=r.concat(n.implicit)),n.explicit&&(o=o.concat(n.explicit));else throw new C("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");r.forEach(function(t){if(!(t instanceof w))throw new C("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(t.loadKind&&t.loadKind!=="scalar")throw new C("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(t.multi)throw new C("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),o.forEach(function(t){if(!(t instanceof w))throw new C("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var i=Object.create(le.prototype);return i.implicit=(this.implicit||[]).concat(r),i.explicit=(this.explicit||[]).concat(o),i.compiledImplicit=be(i,"implicit"),i.compiledExplicit=be(i,"explicit"),i.compiledTypeMap=rr(i.compiledImplicit,i.compiledExplicit),i};var De=le,Pe=new w("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),je=new w("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Re=new w("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Ye=new De({explicit:[Pe,je,Re]});function ir(e){if(e===null)return!0;var n=e.length;return n===1&&e==="~"||n===4&&(e==="null"||e==="Null"||e==="NULL")}function or(){return null}function lr(e){return e===null}var Be=new w("tag:yaml.org,2002:null",{kind:"scalar",resolve:ir,construct:or,predicate:lr,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function tr(e){if(e===null)return!1;var n=e.length;return n===4&&(e==="true"||e==="True"||e==="TRUE")||n===5&&(e==="false"||e==="False"||e==="FALSE")}function ar(e){return e==="true"||e==="True"||e==="TRUE"}function sr(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Ue=new w("tag:yaml.org,2002:bool",{kind:"scalar",resolve:tr,construct:ar,predicate:sr,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function cr(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function ur(e){return 48<=e&&e<=55}function fr(e){return 48<=e&&e<=57}function dr(e){if(e===null)return!1;var n=e.length,r=0,o=!1,i;if(!n)return!1;if(i=e[r],(i==="-"||i==="+")&&(i=e[++r]),i==="0"){if(r+1===n)return!0;if(i=e[++r],i==="b"){for(r++;r<n;r++)if(i=e[r],i!=="_"){if(i!=="0"&&i!=="1")return!1;o=!0}return o&&i!=="_"}if(i==="x"){for(r++;r<n;r++)if(i=e[r],i!=="_"){if(!cr(e.charCodeAt(r)))return!1;o=!0}return o&&i!=="_"}if(i==="o"){for(r++;r<n;r++)if(i=e[r],i!=="_"){if(!ur(e.charCodeAt(r)))return!1;o=!0}return o&&i!=="_"}}if(i==="_")return!1;for(;r<n;r++)if(i=e[r],i!=="_"){if(!fr(e.charCodeAt(r)))return!1;o=!0}return!(!o||i==="_")}function pr(e){var n=e,r=1,o;if(n.indexOf("_")!==-1&&(n=n.replace(/_/g,"")),o=n[0],(o==="-"||o==="+")&&(o==="-"&&(r=-1),n=n.slice(1),o=n[0]),n==="0")return 0;if(o==="0"){if(n[1]==="b")return r*parseInt(n.slice(2),2);if(n[1]==="x")return r*parseInt(n.slice(2),16);if(n[1]==="o")return r*parseInt(n.slice(2),8)}return r*parseInt(n,10)}function mr(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!E.isNegativeZero(e)}var He=new w("tag:yaml.org,2002:int",{kind:"scalar",resolve:dr,construct:pr,predicate:mr,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),gr=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function hr(e){return!(e===null||!gr.test(e)||e[e.length-1]==="_")}function yr(e){var n,r;return n=e.replace(/_/g,"").toLowerCase(),r=n[0]==="-"?-1:1,"+-".indexOf(n[0])>=0&&(n=n.slice(1)),n===".inf"?r===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:n===".nan"?NaN:r*parseFloat(n,10)}var xr=/^[-+]?[0-9]+e/;function br(e,n){var r;if(isNaN(e))switch(n){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(n){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(n){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(E.isNegativeZero(e))return"-0.0";return r=e.toString(10),xr.test(r)?r.replace("e",".e"):r}function Ar(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||E.isNegativeZero(e))}var qe=new w("tag:yaml.org,2002:float",{kind:"scalar",resolve:hr,construct:yr,predicate:Ar,represent:br,defaultStyle:"lowercase"}),Ke=Ye.extend({implicit:[Be,Ue,He,qe]}),ze=Ke,Ge=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Je=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function vr(e){return e===null?!1:Ge.exec(e)!==null||Je.exec(e)!==null}function Er(e){var n,r,o,i,t,l,a,s=0,c=null,f,u,m;if(n=Ge.exec(e),n===null&&(n=Je.exec(e)),n===null)throw new Error("Date resolve error");if(r=+n[1],o=+n[2]-1,i=+n[3],!n[4])return new Date(Date.UTC(r,o,i));if(t=+n[4],l=+n[5],a=+n[6],n[7]){for(s=n[7].slice(0,3);s.length<3;)s+="0";s=+s}return n[9]&&(f=+n[10],u=+(n[11]||0),c=(f*60+u)*6e4,n[9]==="-"&&(c=-c)),m=new Date(Date.UTC(r,o,i,t,l,a,s)),c&&m.setTime(m.getTime()-c),m}function wr(e){return e.toISOString()}var We=new w("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:vr,construct:Er,instanceOf:Date,represent:wr});function Sr(e){return e==="<<"||e===null}var Ve=new w("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Sr}),ue="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";function Cr(e){if(e===null)return!1;var n,r,o=0,i=e.length,t=ue;for(r=0;r<i;r++)if(n=t.indexOf(e.charAt(r)),!(n>64)){if(n<0)return!1;o+=6}return o%8===0}function Or(e){var n,r,o=e.replace(/[\r\n=]/g,""),i=o.length,t=ue,l=0,a=[];for(n=0;n<i;n++)n%4===0&&n&&(a.push(l>>16&255),a.push(l>>8&255),a.push(l&255)),l=l<<6|t.indexOf(o.charAt(n));return r=i%4*6,r===0?(a.push(l>>16&255),a.push(l>>8&255),a.push(l&255)):r===18?(a.push(l>>10&255),a.push(l>>2&255)):r===12&&a.push(l>>4&255),new Uint8Array(a)}function _r(e){var n="",r=0,o,i,t=e.length,l=ue;for(o=0;o<t;o++)o%3===0&&o&&(n+=l[r>>18&63],n+=l[r>>12&63],n+=l[r>>6&63],n+=l[r&63]),r=(r<<8)+e[o];return i=t%3,i===0?(n+=l[r>>18&63],n+=l[r>>12&63],n+=l[r>>6&63],n+=l[r&63]):i===2?(n+=l[r>>10&63],n+=l[r>>4&63],n+=l[r<<2&63],n+=l[64]):i===1&&(n+=l[r>>2&63],n+=l[r<<4&63],n+=l[64],n+=l[64]),n}function Fr(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Qe=new w("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Cr,construct:Or,predicate:Fr,represent:_r}),Tr=Object.prototype.hasOwnProperty,kr=Object.prototype.toString;function Ir(e){if(e===null)return!0;var n=[],r,o,i,t,l,a=e;for(r=0,o=a.length;r<o;r+=1){if(i=a[r],l=!1,kr.call(i)!=="[object Object]")return!1;for(t in i)if(Tr.call(i,t))if(!l)l=!0;else return!1;if(!l)return!1;if(n.indexOf(t)===-1)n.push(t);else return!1}return!0}function Lr(e){return e!==null?e:[]}var Xe=new w("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Ir,construct:Lr}),Nr=Object.prototype.toString;function $r(e){if(e===null)return!0;var n,r,o,i,t,l=e;for(t=new Array(l.length),n=0,r=l.length;n<r;n+=1){if(o=l[n],Nr.call(o)!=="[object Object]"||(i=Object.keys(o),i.length!==1))return!1;t[n]=[i[0],o[i[0]]]}return!0}function Mr(e){if(e===null)return[];var n,r,o,i,t,l=e;for(t=new Array(l.length),n=0,r=l.length;n<r;n+=1)o=l[n],i=Object.keys(o),t[n]=[i[0],o[i[0]]];return t}var Ze=new w("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:$r,construct:Mr}),Dr=Object.prototype.hasOwnProperty;function Pr(e){if(e===null)return!0;var n,r=e;for(n in r)if(Dr.call(r,n)&&r[n]!==null)return!1;return!0}function jr(e){return e!==null?e:{}}var en=new w("tag:yaml.org,2002:set",{kind:"mapping",resolve:Pr,construct:jr}),fe=ze.extend({implicit:[We,Ve],explicit:[Qe,Xe,Ze,en]}),N=Object.prototype.hasOwnProperty,V=1,nn=2,rn=3,Q=4,oe=1,Rr=2,Ae=3,Yr=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Br=/[\x85\u2028\u2029]/,Ur=/[,\[\]\{\}]/,on=/^(?:!|!!|![a-z\-]+!)$/i,ln=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function ve(e){return Object.prototype.toString.call(e)}function F(e){return e===10||e===13}function M(e){return e===9||e===32}function O(e){return e===9||e===32||e===10||e===13}function P(e){return e===44||e===91||e===93||e===123||e===125}function Hr(e){var n;return 48<=e&&e<=57?e-48:(n=e|32,97<=n&&n<=102?n-97+10:-1)}function qr(e){return e===120?2:e===117?4:e===85?8:0}function Kr(e){return 48<=e&&e<=57?e-48:-1}function Ee(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?"\n":e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function zr(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var tn=new Array(256),an=new Array(256);for($=0;$<256;$++)tn[$]=Ee($)?1:0,an[$]=Ee($);var $;function Gr(e,n){this.input=e,this.filename=n.filename||null,this.schema=n.schema||fe,this.onWarning=n.onWarning||null,this.legacy=n.legacy||!1,this.json=n.json||!1,this.listener=n.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function sn(e,n){var r={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return r.snippet=Qn(r),new C(n,r)}function g(e,n){throw sn(e,n)}function X(e,n){e.onWarning&&e.onWarning.call(null,sn(e,n))}var we={YAML:function(n,r,o){var i,t,l;n.version!==null&&g(n,"duplication of %YAML directive"),o.length!==1&&g(n,"YAML directive accepts exactly one argument"),i=/^([0-9]+)\.([0-9]+)$/.exec(o[0]),i===null&&g(n,"ill-formed argument of the YAML directive"),t=parseInt(i[1],10),l=parseInt(i[2],10),t!==1&&g(n,"unacceptable YAML version of the document"),n.version=o[0],n.checkLineBreaks=l<2,l!==1&&l!==2&&X(n,"unsupported YAML version of the document")},TAG:function(n,r,o){var i,t;o.length!==2&&g(n,"TAG directive accepts exactly two arguments"),i=o[0],t=o[1],on.test(i)||g(n,"ill-formed tag handle (first argument) of the TAG directive"),N.call(n.tagMap,i)&&g(n,'there is a previously declared suffix for "'+i+'" tag handle'),ln.test(t)||g(n,"ill-formed tag prefix (second argument) of the TAG directive");try{t=decodeURIComponent(t)}catch(l){g(n,"tag prefix is malformed: "+t)}n.tagMap[i]=t}};function L(e,n,r,o){var i,t,l,a;if(n<r){if(a=e.input.slice(n,r),o)for(i=0,t=a.length;i<t;i+=1)l=a.charCodeAt(i),l===9||32<=l&&l<=1114111||g(e,"expected valid JSON character");else Yr.test(a)&&g(e,"the stream contains non-printable characters");e.result+=a}}function Se(e,n,r,o){var i,t,l,a;for(E.isObject(r)||g(e,"cannot merge mappings; the provided source object is unacceptable"),i=Object.keys(r),l=0,a=i.length;l<a;l+=1)t=i[l],N.call(n,t)||(n[t]=r[t],o[t]=!0)}function j(e,n,r,o,i,t,l,a,s){var c,f;if(Array.isArray(i))for(i=Array.prototype.slice.call(i),c=0,f=i.length;c<f;c+=1)Array.isArray(i[c])&&g(e,"nested arrays are not supported inside keys"),typeof i=="object"&&ve(i[c])==="[object Object]"&&(i[c]="[object Object]");if(typeof i=="object"&&ve(i)==="[object Object]"&&(i="[object Object]"),i=String(i),n===null&&(n={}),o==="tag:yaml.org,2002:merge")if(Array.isArray(t))for(c=0,f=t.length;c<f;c+=1)Se(e,n,t[c],r);else Se(e,n,t,r);else!e.json&&!N.call(r,i)&&N.call(n,i)&&(e.line=l||e.line,e.lineStart=a||e.lineStart,e.position=s||e.position,g(e,"duplicated mapping key")),i==="__proto__"?Object.defineProperty(n,i,{configurable:!0,enumerable:!0,writable:!0,value:t}):n[i]=t,delete r[i];return n}function de(e){var n;n=e.input.charCodeAt(e.position),n===10?e.position++:n===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):g(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function A(e,n,r){for(var o=0,i=e.input.charCodeAt(e.position);i!==0;){for(;M(i);)i===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),i=e.input.charCodeAt(++e.position);if(n&&i===35)do i=e.input.charCodeAt(++e.position);while(i!==10&&i!==13&&i!==0);if(F(i))for(de(e),i=e.input.charCodeAt(e.position),o++,e.lineIndent=0;i===32;)e.lineIndent++,i=e.input.charCodeAt(++e.position);else break}return r!==-1&&o!==0&&e.lineIndent<r&&X(e,"deficient indentation"),o}function ne(e){var n=e.position,r;return r=e.input.charCodeAt(n),!!((r===45||r===46)&&r===e.input.charCodeAt(n+1)&&r===e.input.charCodeAt(n+2)&&(n+=3,r=e.input.charCodeAt(n),r===0||O(r)))}function pe(e,n){n===1?e.result+=" ":n>1&&(e.result+=E.repeat("\n",n-1))}function Jr(e,n,r){var o,i,t,l,a,s,c,f,u=e.kind,m=e.result,h;if(h=e.input.charCodeAt(e.position),O(h)||P(h)||h===35||h===38||h===42||h===33||h===124||h===62||h===39||h===34||h===37||h===64||h===96||(h===63||h===45)&&(i=e.input.charCodeAt(e.position+1),O(i)||r&&P(i)))return!1;for(e.kind="scalar",e.result="",t=l=e.position,a=!1;h!==0;){if(h===58){if(i=e.input.charCodeAt(e.position+1),O(i)||r&&P(i))break}else if(h===35){if(o=e.input.charCodeAt(e.position-1),O(o))break}else{if(e.position===e.lineStart&&ne(e)||r&&P(h))break;if(F(h))if(s=e.line,c=e.lineStart,f=e.lineIndent,A(e,!1,-1),e.lineIndent>=n){a=!0,h=e.input.charCodeAt(e.position);continue}else{e.position=l,e.line=s,e.lineStart=c,e.lineIndent=f;break}}a&&(L(e,t,l,!1),pe(e,e.line-s),t=l=e.position,a=!1),M(h)||(l=e.position+1),h=e.input.charCodeAt(++e.position)}return L(e,t,l,!1),e.result?!0:(e.kind=u,e.result=m,!1)}function Wr(e,n){var r,o,i;if(r=e.input.charCodeAt(e.position),r!==39)return!1;for(e.kind="scalar",e.result="",e.position++,o=i=e.position;(r=e.input.charCodeAt(e.position))!==0;)if(r===39)if(L(e,o,e.position,!0),r=e.input.charCodeAt(++e.position),r===39)o=e.position,e.position++,i=e.position;else return!0;else F(r)?(L(e,o,i,!0),pe(e,A(e,!1,n)),o=i=e.position):e.position===e.lineStart&&ne(e)?g(e,"unexpected end of the document within a single quoted scalar"):(e.position++,i=e.position);g(e,"unexpected end of the stream within a single quoted scalar")}function Vr(e,n){var r,o,i,t,l,a;if(a=e.input.charCodeAt(e.position),a!==34)return!1;for(e.kind="scalar",e.result="",e.position++,r=o=e.position;(a=e.input.charCodeAt(e.position))!==0;){if(a===34)return L(e,r,e.position,!0),e.position++,!0;if(a===92){if(L(e,r,e.position,!0),a=e.input.charCodeAt(++e.position),F(a))A(e,!1,n);else if(a<256&&tn[a])e.result+=an[a],e.position++;else if((l=qr(a))>0){for(i=l,t=0;i>0;i--)a=e.input.charCodeAt(++e.position),(l=Hr(a))>=0?t=(t<<4)+l:g(e,"expected hexadecimal character");e.result+=zr(t),e.position++}else g(e,"unknown escape sequence");r=o=e.position}else F(a)?(L(e,r,o,!0),pe(e,A(e,!1,n)),r=o=e.position):e.position===e.lineStart&&ne(e)?g(e,"unexpected end of the document within a double quoted scalar"):(e.position++,o=e.position)}g(e,"unexpected end of the stream within a double quoted scalar")}function Qr(e,n){var r=!0,o,i,t,l=e.tag,a,s=e.anchor,c,f,u,m,h,d=Object.create(null),p,y,b,x;if(x=e.input.charCodeAt(e.position),x===91)f=93,h=!1,a=[];else if(x===123)f=125,h=!0,a={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=a),x=e.input.charCodeAt(++e.position);x!==0;){if(A(e,!0,n),x=e.input.charCodeAt(e.position),x===f)return e.position++,e.tag=l,e.anchor=s,e.kind=h?"mapping":"sequence",e.result=a,!0;r?x===44&&g(e,"expected the node content, but found ','"):g(e,"missed comma between flow collection entries"),y=p=b=null,u=m=!1,x===63&&(c=e.input.charCodeAt(e.position+1),O(c)&&(u=m=!0,e.position++,A(e,!0,n))),o=e.line,i=e.lineStart,t=e.position,R(e,n,V,!1,!0),y=e.tag,p=e.result,A(e,!0,n),x=e.input.charCodeAt(e.position),(m||e.line===o)&&x===58&&(u=!0,x=e.input.charCodeAt(++e.position),A(e,!0,n),R(e,n,V,!1,!0),b=e.result),h?j(e,a,d,y,p,b,o,i,t):u?a.push(j(e,null,d,y,p,b,o,i,t)):a.push(p),A(e,!0,n),x=e.input.charCodeAt(e.position),x===44?(r=!0,x=e.input.charCodeAt(++e.position)):r=!1}g(e,"unexpected end of the stream within a flow collection")}function Xr(e,n){var r,o,i=oe,t=!1,l=!1,a=n,s=0,c=!1,f,u;if(u=e.input.charCodeAt(e.position),u===124)o=!1;else if(u===62)o=!0;else return!1;for(e.kind="scalar",e.result="";u!==0;)if(u=e.input.charCodeAt(++e.position),u===43||u===45)oe===i?i=u===43?Ae:Rr:g(e,"repeat of a chomping mode identifier");else if((f=Kr(u))>=0)f===0?g(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):l?g(e,"repeat of an indentation width identifier"):(a=n+f-1,l=!0);else break;if(M(u)){do u=e.input.charCodeAt(++e.position);while(M(u));if(u===35)do u=e.input.charCodeAt(++e.position);while(!F(u)&&u!==0)}for(;u!==0;){for(de(e),e.lineIndent=0,u=e.input.charCodeAt(e.position);(!l||e.lineIndent<a)&&u===32;)e.lineIndent++,u=e.input.charCodeAt(++e.position);if(!l&&e.lineIndent>a&&(a=e.lineIndent),F(u)){s++;continue}if(e.lineIndent<a){i===Ae?e.result+=E.repeat("\n",t?1+s:s):i===oe&&t&&(e.result+="\n");break}for(o?M(u)?(c=!0,e.result+=E.repeat("\n",t?1+s:s)):c?(c=!1,e.result+=E.repeat("\n",s+1)):s===0?t&&(e.result+=" "):e.result+=E.repeat("\n",s):e.result+=E.repeat("\n",t?1+s:s),t=!0,l=!0,s=0,r=e.position;!F(u)&&u!==0;)u=e.input.charCodeAt(++e.position);L(e,r,e.position,!1)}return!0}function Ce(e,n){var r,o=e.tag,i=e.anchor,t=[],l,a=!1,s;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=t),s=e.input.charCodeAt(e.position);s!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,g(e,"tab characters must not be used in indentation")),!(s!==45||(l=e.input.charCodeAt(e.position+1),!O(l))));){if(a=!0,e.position++,A(e,!0,-1)&&e.lineIndent<=n){t.push(null),s=e.input.charCodeAt(e.position);continue}if(r=e.line,R(e,n,rn,!1,!0),t.push(e.result),A(e,!0,-1),s=e.input.charCodeAt(e.position),(e.line===r||e.lineIndent>n)&&s!==0)g(e,"bad indentation of a sequence entry");else if(e.lineIndent<n)break}return a?(e.tag=o,e.anchor=i,e.kind="sequence",e.result=t,!0):!1}function Zr(e,n,r){var o,i,t,l,a,s,c=e.tag,f=e.anchor,u={},m=Object.create(null),h=null,d=null,p=null,y=!1,b=!1,x;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=u),x=e.input.charCodeAt(e.position);x!==0;){if(!y&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,g(e,"tab characters must not be used in indentation")),o=e.input.charCodeAt(e.position+1),t=e.line,(x===63||x===58)&&O(o))x===63?(y&&(j(e,u,m,h,d,null,l,a,s),h=d=p=null),b=!0,y=!0,i=!0):y?(y=!1,i=!0):g(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,x=o;else{if(l=e.line,a=e.lineStart,s=e.position,!R(e,r,nn,!1,!0))break;if(e.line===t){for(x=e.input.charCodeAt(e.position);M(x);)x=e.input.charCodeAt(++e.position);if(x===58)x=e.input.charCodeAt(++e.position),O(x)||g(e,"a whitespace character is expected after the key-value separator within a block mapping"),y&&(j(e,u,m,h,d,null,l,a,s),h=d=p=null),b=!0,y=!1,i=!1,h=e.tag,d=e.result;else if(b)g(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=c,e.anchor=f,!0}else if(b)g(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=c,e.anchor=f,!0}if((e.line===t||e.lineIndent>n)&&(y&&(l=e.line,a=e.lineStart,s=e.position),R(e,n,Q,!0,i)&&(y?d=e.result:p=e.result),y||(j(e,u,m,h,d,p,l,a,s),h=d=p=null),A(e,!0,-1),x=e.input.charCodeAt(e.position)),(e.line===t||e.lineIndent>n)&&x!==0)g(e,"bad indentation of a mapping entry");else if(e.lineIndent<n)break}return y&&j(e,u,m,h,d,null,l,a,s),b&&(e.tag=c,e.anchor=f,e.kind="mapping",e.result=u),b}function ei(e){var n,r=!1,o=!1,i,t,l;if(l=e.input.charCodeAt(e.position),l!==33)return!1;if(e.tag!==null&&g(e,"duplication of a tag property"),l=e.input.charCodeAt(++e.position),l===60?(r=!0,l=e.input.charCodeAt(++e.position)):l===33?(o=!0,i="!!",l=e.input.charCodeAt(++e.position)):i="!",n=e.position,r){do l=e.input.charCodeAt(++e.position);while(l!==0&&l!==62);e.position<e.length?(t=e.input.slice(n,e.position),l=e.input.charCodeAt(++e.position)):g(e,"unexpected end of the stream within a verbatim tag")}else{for(;l!==0&&!O(l);)l===33&&(o?g(e,"tag suffix cannot contain exclamation marks"):(i=e.input.slice(n-1,e.position+1),on.test(i)||g(e,"named tag handle cannot contain such characters"),o=!0,n=e.position+1)),l=e.input.charCodeAt(++e.position);t=e.input.slice(n,e.position),Ur.test(t)&&g(e,"tag suffix cannot contain flow indicator characters")}t&&!ln.test(t)&&g(e,"tag name cannot contain such characters: "+t);try{t=decodeURIComponent(t)}catch(a){g(e,"tag name is malformed: "+t)}return r?e.tag=t:N.call(e.tagMap,i)?e.tag=e.tagMap[i]+t:i==="!"?e.tag="!"+t:i==="!!"?e.tag="tag:yaml.org,2002:"+t:g(e,'undeclared tag handle "'+i+'"'),!0}function ni(e){var n,r;if(r=e.input.charCodeAt(e.position),r!==38)return!1;for(e.anchor!==null&&g(e,"duplication of an anchor property"),r=e.input.charCodeAt(++e.position),n=e.position;r!==0&&!O(r)&&!P(r);)r=e.input.charCodeAt(++e.position);return e.position===n&&g(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(n,e.position),!0}function ri(e){var n,r,o;if(o=e.input.charCodeAt(e.position),o!==42)return!1;for(o=e.input.charCodeAt(++e.position),n=e.position;o!==0&&!O(o)&&!P(o);)o=e.input.charCodeAt(++e.position);return e.position===n&&g(e,"name of an alias node must contain at least one character"),r=e.input.slice(n,e.position),N.call(e.anchorMap,r)||g(e,'unidentified alias "'+r+'"'),e.result=e.anchorMap[r],A(e,!0,-1),!0}function R(e,n,r,o,i){var t,l,a,s=1,c=!1,f=!1,u,m,h,d,p,y;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,t=l=a=Q===r||rn===r,o&&A(e,!0,-1)&&(c=!0,e.lineIndent>n?s=1:e.lineIndent===n?s=0:e.lineIndent<n&&(s=-1)),s===1)for(;ei(e)||ni(e);)A(e,!0,-1)?(c=!0,a=t,e.lineIndent>n?s=1:e.lineIndent===n?s=0:e.lineIndent<n&&(s=-1)):a=!1;if(a&&(a=c||i),(s===1||Q===r)&&(V===r||nn===r?p=n:p=n+1,y=e.position-e.lineStart,s===1?a&&(Ce(e,y)||Zr(e,y,p))||Qr(e,p)?f=!0:(l&&Xr(e,p)||Wr(e,p)||Vr(e,p)?f=!0:ri(e)?(f=!0,(e.tag!==null||e.anchor!==null)&&g(e,"alias node should not have any properties")):Jr(e,p,V===r)&&(f=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):s===0&&(f=a&&Ce(e,y))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&g(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),u=0,m=e.implicitTypes.length;u<m;u+=1)if(d=e.implicitTypes[u],d.resolve(e.result)){e.result=d.construct(e.result),e.tag=d.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(N.call(e.typeMap[e.kind||"fallback"],e.tag))d=e.typeMap[e.kind||"fallback"][e.tag];else for(d=null,h=e.typeMap.multi[e.kind||"fallback"],u=0,m=h.length;u<m;u+=1)if(e.tag.slice(0,h[u].tag.length)===h[u].tag){d=h[u];break}d||g(e,"unknown tag !<"+e.tag+">"),e.result!==null&&d.kind!==e.kind&&g(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+d.kind+'", not "'+e.kind+'"'),d.resolve(e.result,e.tag)?(e.result=d.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):g(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||f}function ii(e){var n=e.position,r,o,i,t=!1,l;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(l=e.input.charCodeAt(e.position))!==0&&(A(e,!0,-1),l=e.input.charCodeAt(e.position),!(e.lineIndent>0||l!==37));){for(t=!0,l=e.input.charCodeAt(++e.position),r=e.position;l!==0&&!O(l);)l=e.input.charCodeAt(++e.position);for(o=e.input.slice(r,e.position),i=[],o.length<1&&g(e,"directive name must not be less than one character in length");l!==0;){for(;M(l);)l=e.input.charCodeAt(++e.position);if(l===35){do l=e.input.charCodeAt(++e.position);while(l!==0&&!F(l));break}if(F(l))break;for(r=e.position;l!==0&&!O(l);)l=e.input.charCodeAt(++e.position);i.push(e.input.slice(r,e.position))}l!==0&&de(e),N.call(we,o)?we[o](e,o,i):X(e,'unknown document directive "'+o+'"')}if(A(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,A(e,!0,-1)):t&&g(e,"directives end mark is expected"),R(e,e.lineIndent-1,Q,!1,!0),A(e,!0,-1),e.checkLineBreaks&&Br.test(e.input.slice(n,e.position))&&X(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&ne(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,A(e,!0,-1));return}if(e.position<e.length-1)g(e,"end of the stream or a document separator is expected");else return}function cn(e,n){e=String(e),n=n||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+="\n"),e.charCodeAt(0)===65279&&(e=e.slice(1)));var r=new Gr(e,n),o=e.indexOf("\0");for(o!==-1&&(r.position=o,g(r,"null byte is not allowed in input")),r.input+="\0";r.input.charCodeAt(r.position)===32;)r.lineIndent+=1,r.position+=1;for(;r.position<r.length-1;)ii(r);return r.documents}function oi(e,n,r){n!==null&&typeof n=="object"&&typeof r>"u"&&(r=n,n=null);var o=cn(e,r);if(typeof n!="function")return o;for(var i=0,t=o.length;i<t;i+=1)n(o[i])}function li(e,n){var r=cn(e,n);if(r.length!==0){if(r.length===1)return r[0];throw new C("expected a single document in the stream, but found more")}}var ti=oi,ai=li,un={loadAll:ti,load:ai},fn=Object.prototype.toString,dn=Object.prototype.hasOwnProperty,me=65279,si=9,K=10,ci=13,ui=32,fi=33,di=34,te=35,pi=37,mi=38,gi=39,hi=42,pn=44,yi=45,Z=58,xi=61,bi=62,Ai=63,vi=64,mn=91,gn=93,Ei=96,hn=123,wi=124,yn=125,S={};S[0]="\\0";S[7]="\\a";S[8]="\\b";S[9]="\\t";S[10]="\\n";S[11]="\\v";S[12]="\\f";S[13]="\\r";S[27]="\\e";S[34]='\\"';S[92]="\\\\";S[133]="\\N";S[160]="\\_";S[8232]="\\L";S[8233]="\\P";var Si=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Ci=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Oi(e,n){var r,o,i,t,l,a,s;if(n===null)return{};for(r={},o=Object.keys(n),i=0,t=o.length;i<t;i+=1)l=o[i],a=String(n[l]),l.slice(0,2)==="!!"&&(l="tag:yaml.org,2002:"+l.slice(2)),s=e.compiledTypeMap.fallback[l],s&&dn.call(s.styleAliases,a)&&(a=s.styleAliases[a]),r[l]=a;return r}function _i(e){var n,r,o;if(n=e.toString(16).toUpperCase(),e<=255)r="x",o=2;else if(e<=65535)r="u",o=4;else if(e<=4294967295)r="U",o=8;else throw new C("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+r+E.repeat("0",o-n.length)+n}var Fi=1,z=2;function Ti(e){this.schema=e.schema||fe,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=E.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Oi(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?z:Fi,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Oe(e,n){for(var r=E.repeat(" ",n),o=0,i=-1,t="",l,a=e.length;o<a;)i=e.indexOf("\n",o),i===-1?(l=e.slice(o),o=a):(l=e.slice(o,i+1),o=i+1),l.length&&l!=="\n"&&(t+=r),t+=l;return t}function ae(e,n){return"\n"+E.repeat(" ",e.indent*n)}function ki(e,n){var r,o,i;for(r=0,o=e.implicitTypes.length;r<o;r+=1)if(i=e.implicitTypes[r],i.resolve(n))return!0;return!1}function ee(e){return e===ui||e===si}function G(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==me||65536<=e&&e<=1114111}function _e(e){return G(e)&&e!==me&&e!==ci&&e!==K}function Fe(e,n,r){var o=_e(e),i=o&&!ee(e);return(r?o:o&&e!==pn&&e!==mn&&e!==gn&&e!==hn&&e!==yn)&&e!==te&&!(n===Z&&!i)||_e(n)&&!ee(n)&&e===te||n===Z&&i}function Ii(e){return G(e)&&e!==me&&!ee(e)&&e!==yi&&e!==Ai&&e!==Z&&e!==pn&&e!==mn&&e!==gn&&e!==hn&&e!==yn&&e!==te&&e!==mi&&e!==hi&&e!==fi&&e!==wi&&e!==xi&&e!==bi&&e!==gi&&e!==di&&e!==pi&&e!==vi&&e!==Ei}function Li(e){return!ee(e)&&e!==Z}function H(e,n){var r=e.charCodeAt(n),o;return r>=55296&&r<=56319&&n+1<e.length&&(o=e.charCodeAt(n+1),o>=56320&&o<=57343)?(r-55296)*1024+o-56320+65536:r}function xn(e){var n=/^\n* /;return n.test(e)}var bn=1,se=2,An=3,vn=4,D=5;function Ni(e,n,r,o,i,t,l,a){var s,c=0,f=null,u=!1,m=!1,h=o!==-1,d=-1,p=Ii(H(e,0))&&Li(H(e,e.length-1));if(n||l)for(s=0;s<e.length;c>=65536?s+=2:s++){if(c=H(e,s),!G(c))return D;p=p&&Fe(c,f,a),f=c}else{for(s=0;s<e.length;c>=65536?s+=2:s++){if(c=H(e,s),c===K)u=!0,h&&(m=m||s-d-1>o&&e[d+1]!==" ",d=s);else if(!G(c))return D;p=p&&Fe(c,f,a),f=c}m=m||h&&s-d-1>o&&e[d+1]!==" "}return!u&&!m?p&&!l&&!i(e)?bn:t===z?D:se:r>9&&xn(e)?D:l?t===z?D:se:m?vn:An}function $i(e,n,r,o,i){e.dump=function(){if(n.length===0)return e.quotingType===z?'""':"''";if(!e.noCompatMode&&(Si.indexOf(n)!==-1||Ci.test(n)))return e.quotingType===z?'"'+n+'"':"'"+n+"'";var t=e.indent*Math.max(1,r),l=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-t),a=o||e.flowLevel>-1&&r>=e.flowLevel;function s(c){return ki(e,c)}switch(Ni(n,a,e.indent,l,s,e.quotingType,e.forceQuotes&&!o,i)){case bn:return n;case se:return"'"+n.replace(/'/g,"''")+"'";case An:return"|"+Te(n,e.indent)+ke(Oe(n,t));case vn:return">"+Te(n,e.indent)+ke(Oe(Mi(n,l),t));case D:return'"'+Di(n)+'"';default:throw new C("impossible error: invalid scalar style")}}()}function Te(e,n){var r=xn(e)?String(n):"",o=e[e.length-1]==="\n",i=o&&(e[e.length-2]==="\n"||e==="\n"),t=i?"+":o?"":"-";return r+t+"\n"}function ke(e){return e[e.length-1]==="\n"?e.slice(0,-1):e}function Mi(e,n){for(var r=/(\n+)([^\n]*)/g,o=function(){var c=e.indexOf("\n");return c=c!==-1?c:e.length,r.lastIndex=c,Ie(e.slice(0,c),n)}(),i=e[0]==="\n"||e[0]===" ",t,l;l=r.exec(e);){var a=l[1],s=l[2];t=s[0]===" ",o+=a+(!i&&!t&&s!==""?"\n":"")+Ie(s,n),i=t}return o}function Ie(e,n){if(e===""||e[0]===" ")return e;for(var r=/ [^ ]/g,o,i=0,t,l=0,a=0,s="";o=r.exec(e);)a=o.index,a-i>n&&(t=l>i?l:a,s+="\n"+e.slice(i,t),i=t+1),l=a;return s+="\n",e.length-i>n&&l>i?s+=e.slice(i,l)+"\n"+e.slice(l+1):s+=e.slice(i),s.slice(1)}function Di(e){for(var n="",r=0,o,i=0;i<e.length;r>=65536?i+=2:i++)r=H(e,i),o=S[r],!o&&G(r)?(n+=e[i],r>=65536&&(n+=e[i+1])):n+=o||_i(r);return n}function Pi(e,n,r){var o="",i=e.tag,t,l,a;for(t=0,l=r.length;t<l;t+=1)a=r[t],e.replacer&&(a=e.replacer.call(r,String(t),a)),(k(e,n,a,!1,!1)||typeof a>"u"&&k(e,n,null,!1,!1))&&(o!==""&&(o+=","+(e.condenseFlow?"":" ")),o+=e.dump);e.tag=i,e.dump="["+o+"]"}function Le(e,n,r,o){var i="",t=e.tag,l,a,s;for(l=0,a=r.length;l<a;l+=1)s=r[l],e.replacer&&(s=e.replacer.call(r,String(l),s)),(k(e,n+1,s,!0,!0,!1,!0)||typeof s>"u"&&k(e,n+1,null,!0,!0,!1,!0))&&((!o||i!=="")&&(i+=ae(e,n)),e.dump&&K===e.dump.charCodeAt(0)?i+="-":i+="- ",i+=e.dump);e.tag=t,e.dump=i||"[]"}function ji(e,n,r){var o="",i=e.tag,t=Object.keys(r),l,a,s,c,f;for(l=0,a=t.length;l<a;l+=1)f="",o!==""&&(f+=", "),e.condenseFlow&&(f+='"'),s=t[l],c=r[s],e.replacer&&(c=e.replacer.call(r,s,c)),k(e,n,s,!1,!1)&&(e.dump.length>1024&&(f+="? "),f+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),k(e,n,c,!1,!1)&&(f+=e.dump,o+=f));e.tag=i,e.dump="{"+o+"}"}function Ri(e,n,r,o){var i="",t=e.tag,l=Object.keys(r),a,s,c,f,u,m;if(e.sortKeys===!0)l.sort();else if(typeof e.sortKeys=="function")l.sort(e.sortKeys);else if(e.sortKeys)throw new C("sortKeys must be a boolean or a function");for(a=0,s=l.length;a<s;a+=1)m="",(!o||i!=="")&&(m+=ae(e,n)),c=l[a],f=r[c],e.replacer&&(f=e.replacer.call(r,c,f)),k(e,n+1,c,!0,!0,!0)&&(u=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,u&&(e.dump&&K===e.dump.charCodeAt(0)?m+="?":m+="? "),m+=e.dump,u&&(m+=ae(e,n)),k(e,n+1,f,!0,u)&&(e.dump&&K===e.dump.charCodeAt(0)?m+=":":m+=": ",m+=e.dump,i+=m));e.tag=t,e.dump=i||"{}"}function Ne(e,n,r){var o,i,t,l,a,s;for(i=r?e.explicitTypes:e.implicitTypes,t=0,l=i.length;t<l;t+=1)if(a=i[t],(a.instanceOf||a.predicate)&&(!a.instanceOf||typeof n=="object"&&n instanceof a.instanceOf)&&(!a.predicate||a.predicate(n))){if(r?a.multi&&a.representName?e.tag=a.representName(n):e.tag=a.tag:e.tag="?",a.represent){if(s=e.styleMap[a.tag]||a.defaultStyle,fn.call(a.represent)==="[object Function]")o=a.represent(n,s);else if(dn.call(a.represent,s))o=a.represent[s](n,s);else throw new C("!<"+a.tag+'> tag resolver accepts not "'+s+'" style');e.dump=o}return!0}return!1}function k(e,n,r,o,i,t,l){e.tag=null,e.dump=r,Ne(e,r,!1)||Ne(e,r,!0);var a=fn.call(e.dump),s=o,c;o&&(o=e.flowLevel<0||e.flowLevel>n);var f=a==="[object Object]"||a==="[object Array]",u,m;if(f&&(u=e.duplicates.indexOf(r),m=u!==-1),(e.tag!==null&&e.tag!=="?"||m||e.indent!==2&&n>0)&&(i=!1),m&&e.usedDuplicates[u])e.dump="*ref_"+u;else{if(f&&m&&!e.usedDuplicates[u]&&(e.usedDuplicates[u]=!0),a==="[object Object]")o&&Object.keys(e.dump).length!==0?(Ri(e,n,e.dump,i),m&&(e.dump="&ref_"+u+e.dump)):(ji(e,n,e.dump),m&&(e.dump="&ref_"+u+" "+e.dump));else if(a==="[object Array]")o&&e.dump.length!==0?(e.noArrayIndent&&!l&&n>0?Le(e,n-1,e.dump,i):Le(e,n,e.dump,i),m&&(e.dump="&ref_"+u+e.dump)):(Pi(e,n,e.dump),m&&(e.dump="&ref_"+u+" "+e.dump));else if(a==="[object String]")e.tag!=="?"&&$i(e,e.dump,n,t,s);else{if(a==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new C("unacceptable kind of an object to dump "+a)}e.tag!==null&&e.tag!=="?"&&(c=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?c="!"+c:c.slice(0,18)==="tag:yaml.org,2002:"?c="!!"+c.slice(18):c="!<"+c+">",e.dump=c+" "+e.dump)}return!0}function Yi(e,n){var r=[],o=[],i,t;for(ce(e,r,o),i=0,t=o.length;i<t;i+=1)n.duplicates.push(r[o[i]]);n.usedDuplicates=new Array(t)}function ce(e,n,r){var o,i,t;if(e!==null&&typeof e=="object")if(i=n.indexOf(e),i!==-1)r.indexOf(i)===-1&&r.push(i);else if(n.push(e),Array.isArray(e))for(i=0,t=e.length;i<t;i+=1)ce(e[i],n,r);else for(o=Object.keys(e),i=0,t=o.length;i<t;i+=1)ce(e[o[i]],n,r)}function Bi(e,n){n=n||{};var r=new Ti(n);r.noRefs||Yi(e,r);var o=e;return r.replacer&&(o=r.replacer.call({"":o},"",o)),k(r,0,o,!0,!0)?r.dump+"\n":""}var Ui=Bi,Hi={dump:Ui};function ge(e,n){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+n+" instead, which is now safe by default.")}}var qi=w,Ki=De,zi=Ye,Gi=Ke,Ji=ze,Wi=fe,Vi=un.load,Qi=un.loadAll,Xi=Hi.dump,Zi=C,eo={binary:Qe,float:qe,map:Re,null:Be,pairs:Ze,set:en,timestamp:We,bool:Ue,int:He,merge:Ve,omap:Xe,seq:je,str:Pe},no=ge("safeLoad","load"),ro=ge("safeLoadAll","loadAll"),io=ge("safeDump","dump"),oo={Type:qi,Schema:Ki,FAILSAFE_SCHEMA:zi,JSON_SCHEMA:Gi,CORE_SCHEMA:Ji,DEFAULT_SCHEMA:Wi,load:Vi,loadAll:Qi,dump:Xi,YAMLException:Zi,types:eo,safeLoad:no,safeLoadAll:ro,safeDump:io},En=oo;var he=class{constructor(){}parseUserContext(n){try{if(!n)return null;let r=En.load(n);return console.log("YAML parsed successfully"),r}catch(r){return console.error("Error parsing YAML:",r),null}}countFields(n){let r=0,o=i=>{for(let[t,l]of Object.entries(i))typeof l=="object"&&l!==null&&!Array.isArray(l)?o(l):r++};return o(n),r}formatValueForEmbedding(n,r=""){if(n==null)return"";let o=r.toLowerCase();return o.includes("salary")||o.includes("compensation")?"Salary: ".concat(n,", Expected salary: ").concat(n,", Desired compensation: ").concat(n,", Annual salary: ").concat(n):o.includes("phone")?"Phone number: ".concat(n,", Contact number: ").concat(n,", Tel: ").concat(n):o.includes("visa")?"Visa required: ".concat(n,", Visa status: ").concat(n,", Work permit: ").concat(n):Array.isArray(n)?n.map(i=>this.formatValueForEmbedding(i)).join(", "):typeof n=="object"?Object.entries(n).map(([i,t])=>{if(i.startsWith("_")||t===null||t===void 0)return null;let l=this.formatValueForEmbedding(t,i);return l?"".concat(i,": ").concat(l):null}).filter(Boolean).join(", "):String(n)}async processUserContext(n,r=null){try{if(!n)return console.error("No YAML content provided"),{success:!1,error:"No YAML content provided"};let o=this.parseUserContext(n);if(!o)return console.error("Failed to parse YAML content"),{success:!1,error:"Failed to parse YAML content"};console.log("User context parsed successfully, processing fields for embeddings");let i=new TextEncoder().encode(n).length;console.log("YAML content size: ".concat(i," bytes (").concat((i/1024).toFixed(2)," KB)"));let t=this.countFields(o),l=0;console.log("Total fields to process: ".concat(t));let a=[];for(let[d,p]of Object.entries(o))if(typeof p=="object"&&p!==null&&!Array.isArray(p)){for(let[y,b]of Object.entries(p)){let x="".concat(d,".").concat(y),T=this.formatValueForEmbedding(b,y);a.push({key:x,value:T})}if(d==="personal_information"){if(p.salary&&a.push({key:"salary_information",value:"Expected salary: ".concat(p.salary,", Desired compensation: ").concat(p.salary,", Annual salary expectation: ").concat(p.salary,", Salary requirement: ").concat(p.salary,", Compensation expectation: ").concat(p.salary)}),p.phone){let y=p.phone_prefix||"";a.push({key:"contact_information",value:"Phone number: ".concat(y).concat(p.phone,", Email: ").concat(p.email||"",", Contact details: ").concat(y).concat(p.phone," and ").concat(p.email||"")})}(p.country||p.city)&&a.push({key:"location_information",value:"Located in ".concat(p.city||"",", ").concat(p.country||"",", Location: ").concat(p.city||"",", ").concat(p.country||"")})}}else{let y=this.formatValueForEmbedding(p,d);a.push({key:d,value:y})}if(console.log("Prepared ".concat(a.length," fields to process for embeddings")),o.experiences&&Array.isArray(o.experiences))try{let d=/(\d{4})\s*-\s*(Present|\d{4})/i,p="";o.experiences.forEach(y=>{y.employment_period&&(p+="".concat(y.position||"Role"," at ").concat(y.company||"Company"," (").concat(y.employment_period,"). "))}),p&&a.push({key:"experience_summary",value:"Professional experience: ".concat(p," Years of experience in software development, engineering, and related fields.")})}catch(d){console.warn("Error creating experience summary:",d)}let s=JSON.stringify(a).length;console.log("Estimated data size before embeddings: ".concat(s," bytes (").concat((s/1024).toFixed(2)," KB)"));let c=s>1e6,f=c?10:a.length;c&&console.log("Using chunking strategy for large dataset (".concat(f," fields per chunk)"));let u=5,m=Math.ceil(a.length/u);if(console.log("Processing embeddings in ".concat(m," batches of ").concat(u)),c)try{await _.clearAllData(),console.log("Cleared existing data before processing chunks")}catch(d){console.warn("Error clearing existing data:",d)}let h=0;for(let d=0;d<m;d++){let p=d*u,y=Math.min((d+1)*u,a.length),b=a.slice(p,y);console.log("Processing batch ".concat(d+1,"/").concat(m," (").concat(b.length," fields)"));let x=b.map(v=>_.addEntry(v.key,v.value)),I=(await Promise.allSettled(x)).filter(v=>v.status==="rejected"||v.status==="fulfilled"&&!v.value);if(I.length>0&&console.warn("".concat(I.length," embeddings failed in batch ").concat(d+1)),l+=b.length,r){let v=Math.round(l/t*100);r({progress:v,message:"Processing batch ".concat(d+1,"/").concat(m," (").concat(l,"/").concat(t," fields)")})}if(c&&(d+1)%Math.ceil(f/u)===0)try{console.log("Saving chunk to storage after batch ".concat(d+1,"...")),await _.saveAllEmbeddings(),console.log("Clearing memory store after saving chunk");let v=Object.keys(_.data).length;_.data={},console.log("Cleared ".concat(v," entries from memory"))}catch(v){if(console.error("Error saving chunk to storage:",v),h++,h>=3)return console.error("Multiple storage errors encountered, aborting processing"),r&&r({progress:0,message:"Error: Storage quota exceeded. Try reducing YAML complexity."}),{success:!1,error:"Storage quota exceeded",details:"The profile is too large to store with embeddings. Try simplifying your profile or using fewer fields."}}d<m-1&&await new Promise(v=>setTimeout(v,100))}console.log("Embedding generation complete, saving to storage...");try{if(Object.keys(_.data).length>0){let p=await _.saveAllEmbeddings();console.log("Save result: ".concat(p?"Success":"Failed"))}else c&&console.log("No final chunk to save (already saved in chunks)");let d=c?await _.getStoredEmbeddingsCount():Object.keys(_.data).length;console.log("Final storage contains ".concat(d," entries"))}catch(d){if(console.error("Error saving embeddings:",d),d&&d.message&&(d.message.includes("quota")||d.message.includes("QUOTA")||d.message.includes("limit")||d.message.includes("space")))return r&&r({progress:0,message:"Error: Storage quota exceeded. Try reducing YAML complexity."}),{success:!1,error:"Storage quota exceeded",details:"The profile is too large to store with embeddings. Try simplifying your profile."}}return r&&r({progress:100,message:"All fields processed"}),{success:!0,data:o}}catch(o){return console.error("Error processing user context:",o),r&&r({progress:0,message:"Error: ".concat(o.message)}),{success:!1,error:o.message}}}},wn=new he;chrome.runtime.onInstalled.addListener(()=>{console.log("Job Tracker Extension Installed")});async function lo(){try{console.log("Testing Ollama connection...");let n=await Sn("chat",{model:"qwen2.5:3b",messages:[{role:"system",content:"You are a helpful AI assistant."},{role:"user",content:"Hello, are you working?"}],stream:!1});if(n.success)return console.log("Ollama chat test successful:",n.data),{success:!0,data:{version:n.data.model,response:n.data.message.content,port:11434}};throw new Error(n.error||"Unknown error from Ollama")}catch(e){return console.error("Ollama connection failed:",e),{success:!1,error:e.message,details:e.stack,troubleshooting:"Please make sure Ollama is running on your computer. Try running 'ollama serve' in your terminal."}}}async function Sn(e,n){var r;try{console.log("Making Ollama API call to ".concat(e,":"),n);let o=11434;console.log("Using Ollama port: ".concat(o));let i=W(J({},n),{stream:!1}),t=await fetch("http://localhost:".concat(o,"/api/").concat(e),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify(i)});if(!t.ok){let s=await t.text();throw console.error("Ollama API error response:",{status:t.status,statusText:t.statusText,body:s}),new Error("HTTP error! status: ".concat(t.status,", details: ").concat(s))}let l=await t.text(),a;try{a=JSON.parse(l)}catch(s){console.warn("JSON parse error:",s.message),console.log("Response text:",l.substring(0,200)+"...");try{let c=l.match(/\{[\s\S]*\}/);if(c)a=JSON.parse(c[0]),console.log("Successfully extracted JSON from response");else throw new Error("Couldn't find valid JSON object in response")}catch(c){throw console.error("Failed to extract JSON:",c),new Error("Invalid JSON response from Ollama: ".concat(s.message))}}if(console.log("Ollama API call successful:",a),e==="chat"){if(!a||!a.message||!a.message.content)if(console.error("Unexpected chat response structure from Ollama:",a),a&&typeof a=="object")a={message:{content:((r=a.message)==null?void 0:r.content)||a.content||a.text||a.response||""||"No content found in response"},model:a.model||"unknown"},console.log("Constructed fallback response:",a);else throw new Error("Invalid chat response format from Ollama")}else if(e==="embeddings"){if(!a||!a.embedding||!Array.isArray(a.embedding))throw console.error("Unexpected embeddings response structure from Ollama:",a),new Error("Invalid embeddings response format from Ollama")}else if(!a)throw console.error("Empty response from Ollama for endpoint ".concat(e,":"),a),new Error("Invalid response format from Ollama for ".concat(e));return{success:!0,data:a}}catch(o){console.error("Ollama API call failed (".concat(e,"):"),o);let i="Please make sure Ollama is running on your computer. Try running 'ollama serve' in your terminal.";return o.name==="AbortError"?i+=" The request timed out - your model might be too large or your computer too slow.":o.message.includes("Failed to fetch")?i+=" Your computer cannot connect to Ollama. Make sure it's running and not blocked by a firewall.":(o.message.includes("Invalid response format")||o.message.includes("JSON"))&&(i+=" Ollama returned an unexpected response format. You might need to update Ollama to a newer version."),{success:!1,error:o.message,details:o.stack,troubleshooting:i}}}function Y(e,n,r){chrome.runtime.sendMessage({type:"EMBEDDING_PROGRESS",data:{progress:e,total:n,percent:Math.round(e/n*100),status:r}})}async function Cn(e){try{let r=e.substring(0,1500);console.log("Getting embeddings in background script (".concat(r.length," chars): ").concat(r.substring(0,50)).concat(r.length>50?"...":""));let o=11434,i={model:"nomic-embed-text",prompt:r,stream:!1};console.log("Ollama embedding request:",{url:"http://localhost:".concat(o,"/api/embeddings"),model:i.model,textLength:r.length,timestamp:new Date().toISOString()});let t=performance.now(),a=await(async(d,p,y=2,b=2e3)=>{let x;for(let T=0;T<=y;T++)try{console.log("Embedding API attempt ".concat(T+1,"/").concat(y+1));let I=1e4+T*5e3,v=new AbortController,On=setTimeout(()=>v.abort(),I);console.log("Request timeout set to ".concat(I,"ms"));let _n=performance.now(),B=await fetch(d,W(J({},p),{signal:v.signal})),Fn=performance.now();if(console.log("Fetch completed in ".concat((Fn-_n).toFixed(2),"ms with status ").concat(B.status)),clearTimeout(On),!B.ok){let Ln=await B.text();throw new Error("HTTP error! status: ".concat(B.status,", details: ").concat(Ln))}let Tn=performance.now(),kn=await B.json(),In=performance.now();return console.log("JSON parsing completed in ".concat((In-Tn).toFixed(2),"ms")),kn}catch(I){x=I,console.warn("Embedding fetch attempt ".concat(T+1,"/").concat(y+1," failed:"),I.message),T<y&&(console.log("Retrying in ".concat(b,"ms...")),await new Promise(v=>setTimeout(v,b)))}throw x})("http://localhost:".concat(o,"/api/embeddings"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)}),c=performance.now()-t;if(!a.embedding||!Array.isArray(a.embedding))throw console.error("Invalid embedding format in API response:",a),new Error("Invalid embedding format returned from API");console.log("Embeddings generated successfully in ".concat(c.toFixed(2),"ms")),console.log("Embedding dimensions: ".concat(a.embedding.length)),console.log("Embedding sample: [".concat(a.embedding.slice(0,3).map(d=>d.toFixed(5)).join(", "),"...]"));let f=a.embedding.map(d=>parseFloat(d.toFixed(5))),u=JSON.stringify(a.embedding).length,m=JSON.stringify(f).length,h=(100-m/u*100).toFixed(2);return console.log("Embedding size reduction: ".concat(u," \u2192 ").concat(m," bytes (").concat(h,"% reduction)")),{success:!0,data:W(J({},a),{embedding:f}),timing:{totalMs:c,timestamp:new Date().toISOString()}}}catch(n){console.error("Embeddings API call failed:",n);let r="Please make sure Ollama is running on your computer. Try running 'ollama serve' in your terminal.";return n.name==="AbortError"?r+=" The request timed out - your model might be too large or your computer too slow.":n.message&&n.message.includes("Failed to fetch")?r+=" Your computer cannot connect to Ollama. Make sure it's running and not blocked by a firewall.":n.message&&n.message.includes("invalid format")&&(r+=" The embedding model returned data in an unexpected format. You may need to update Ollama or try a different embedding model."),{success:!1,error:n.message,details:n.stack,troubleshooting:r,timestamp:new Date().toISOString()}}}var to=new U(Cn);Object.assign(_,to);async function ao(e){let n=0;for(let r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return n.toString()}async function so(){return new Promise(e=>{chrome.storage.local.get("embeddingHash",n=>{e(n.embeddingHash||"")})})}async function co(e){return new Promise(n=>{chrome.storage.local.set({embeddingHash:e},()=>{n()})})}async function uo(e){return new Promise((n,r)=>{if(!e||Object.keys(e).length===0){console.warn("No embeddings to save to storage"),n(!1);return}console.log("Saving ".concat(Object.keys(e).length," embeddings to Chrome storage"));let o={};for(let[a,s]of Object.entries(e))if(s.embedding&&Array.isArray(s.embedding)){let c=s.embedding.map(f=>parseFloat(f.toFixed(5)));o[a]={text:s.text,embedding:c}}else o[a]=s;let i=JSON.stringify(e).length,t=JSON.stringify(o).length,l=(100-t/i*100).toFixed(2);console.log("Flattened embeddings for storage: ".concat(i," bytes \u2192 ").concat(t," bytes (").concat(l,"% reduction)")),console.log("Storage payload size: ".concat(t," bytes (").concat((t/(1024*1024)).toFixed(2)," MB)")),chrome.storage.local.set({storedEmbeddings:o},()=>{if(chrome.runtime.lastError){let a=chrome.runtime.lastError;console.error("Error saving embeddings to storage:",a),a.message&&(a.message.includes("quota")||a.message.includes("QUOTA")||a.message.includes("limit")||a.message.includes("space"))&&(console.error("Storage quota exceeded. Data size: ".concat(t," bytes.")),console.error("Consider reducing the amount of data or implementing chunking.")),r(a)}else console.log("Successfully saved ".concat(Object.keys(o).length," embeddings to storage")),n(!0)})})}chrome.runtime.onMessage.addListener((e,n,r)=>{if(console.log("Received message in background script:",e),e.action==="setUserData")return console.log("Processing uploaded YAML data and generating embeddings immediately"),(async()=>{try{let o=e.yamlContent,i=await ao(o);chrome.storage.local.set({userProfile:o,profileHash:i,yamlLastUploaded:Date.now(),yamlFileName:e.fileName||"profile.yaml"},()=>{r({success:!0,message:"Profile saved, generating embeddings in background..."}),console.log("Profile saved, starting embedding generation")});let t=await so();if(i===t){console.log("Embeddings already exist for this profile, skipping generation"),Y(100,100,"Embeddings already up to date");return}let l=a=>{if(a&&typeof a.progress<"u"){let s=a.progress,c=100,f=a.message||"Processing...";Y(s,c,f)}};try{Y(0,100,"Starting embedding generation...");let a=await wn.processUserContext(o,l);console.log("Embedding generation complete:",a),a.success?(await co(i),await uo(_.data),Y(100,100,"Embeddings generated successfully!"),chrome.runtime.sendMessage({type:"EMBEDDING_COMPLETE",success:!0,message:"Embeddings generated successfully!"}),console.log("Stored embeddings and hash for future use")):(Y(0,100,"Error: ".concat(a.error||"Unknown error")),chrome.runtime.sendMessage({type:"EMBEDDING_COMPLETE",success:!1,error:a.error||"Unknown error"}))}catch(a){console.error("Error generating embeddings:",a),Y(0,100,"Error: ".concat(a.message))}}catch(o){console.error("Error in YAML processing:",o),r({success:!1,error:"Error processing YAML: "+o.message})}})(),!0;if(e.action==="testOllama")return lo().then(o=>{console.log("Sending test Ollama response:",o),r(o)}).catch(o=>{console.error("Error in test Ollama:",o),r({success:!1,error:o.message||"Unknown error",troubleshooting:"Error in background script"})}),!0;if(e.action==="callOllama"){let{endpoint:o,data:i}=e;return Sn(o,i).then(t=>{console.log("Sending Ollama API response:",t),r(t)}).catch(t=>{console.error("Error in call Ollama API:",t),r({success:!1,error:t.message||"Unknown error",troubleshooting:"Error in background script"})}),!0}if(e.action==="CONVERSATION_UPDATED")return chrome.storage.local.get(["dropdownData","conversationData"],function(o){let i=o.dropdownData||{companies:[],jobs:[],companyJobMap:{}},t=o.conversationData||{},l=e.data;if(!l||!l.company||!l.title||!l.conversation){console.log("Missing required data in conversation update");return}if(i.companies.some(a=>a.value===l.company)||i.companies.push({value:l.company,text:l.company}),i.jobs.some(a=>a.value===l.title)||i.jobs.push({value:l.title,text:l.title,company:l.company}),i.companyJobMap[l.company]||(i.companyJobMap[l.company]=[]),i.companyJobMap[l.company].some(a=>a.value===l.title)||i.companyJobMap[l.company].push({value:l.title,text:l.title}),l.conversation&&Array.isArray(l.conversation)&&l.conversation.length>0){t[l.title]||(t[l.title]=[]);let a=l.conversation.find(c=>c.role==="user"),s=!1;a&&(s=t[l.title].some(c=>{let f=c.find(u=>u.role==="user");return f&&f.content===a.content})),s?console.log("Background: Skipping duplicate conversation"):(console.log("Background: Adding new conversation"),t[l.title].push(l.conversation),chrome.storage.local.set({dropdownData:i,conversationData:t},function(){console.log("Background: Conversation data saved to storage")}))}}),r&&r({received:!0}),!1;if(e.action==="getEmbeddings"){let{text:o}=e;return console.log("Getting embeddings for text"),Cn(o).then(i=>{console.log("Sending embeddings response from background script"),r(i)}).catch(i=>{console.error("Error getting embeddings:",i),r({success:!1,error:i.message||"Unknown error",troubleshooting:"Error generating embeddings"})}),!0}});export{Cn as getEmbeddings};
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
