var Lr=Object.defineProperty,$r=Object.defineProperties;var Nr=Object.getOwnPropertyDescriptors;var ye=Object.getOwnPropertySymbols;var Mr=Object.prototype.hasOwnProperty,Pr=Object.prototype.propertyIsEnumerable;var xe=(e,r,n)=>r in e?Lr(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,J=(e,r)=>{for(var n in r||(r={}))Mr.call(r,n)&&xe(e,n,r[n]);if(ye)for(var n of ye(r))Pr.call(r,n)&&xe(e,n,r[n]);return e},W=(e,r)=>$r(e,Nr(r));var U=class{constructor(r=null){this.data={},this.directEmbeddingFunction=r,this.hasTriedLoading=!1,this.preloadEmbeddings()}async addEntry(r,n){if(!n)return!1;try{console.log("Adding entry for key: ".concat(r));let i=await this.getEmbedding(n);return i&&i.success&&i.data&&i.data.embedding?(this.data[r]={text:n,embedding:i.data.embedding},console.log("Successfully added embedding for key: ".concat(r," (Store size: ").concat(Object.keys(this.data).length,")")),!0):(console.warn("Failed to generate embedding for key: ".concat(r)),!1)}catch(i){return console.error("Error adding entry to memory store:",i),!1}}async loadStoredEmbeddings(){return this.hasTriedLoading?(console.log("Already tried loading embeddings. Current size: ".concat(Object.keys(this.data).length)),Object.keys(this.data).length>0):(console.log("Attempting to load stored embeddings from Chrome storage..."),new Promise(r=>{chrome.storage.local.get("storedEmbeddings",n=>{n.storedEmbeddings&&Object.keys(n.storedEmbeddings).length>0?(this.data=n.storedEmbeddings,console.log("Loaded embeddings from storage, found",Object.keys(this.data).length,"entries"),this.hasTriedLoading=!0,r(!0)):(console.log("No stored embeddings found in Chrome storage"),this.hasTriedLoading=!0,r(!1))})}))}flattenEmbeddingData(r){let n={};for(let[l,a]of Object.entries(r))if(a.embedding&&Array.isArray(a.embedding)){let s=a.embedding.map(c=>parseFloat(c.toFixed(5)));n[l]={text:a.text,embedding:s}}else n[l]=a;let i=JSON.stringify(r).length,o=JSON.stringify(n).length,t=(100-o/i*100).toFixed(2);return console.log("Flattened embeddings: ".concat(i," bytes \u2192 ").concat(o," bytes (").concat(t,"% reduction)")),n}async saveAllEmbeddings(){return new Promise((r,n)=>{if(Object.keys(this.data).length===0){console.warn("No embeddings to save to storage"),r(!1);return}console.log("Saving ".concat(Object.keys(this.data).length," embeddings to Chrome storage"));let i=this.flattenEmbeddingData(this.data),o=JSON.stringify(i).length;console.log("Storage payload size: ".concat(o," bytes (").concat((o/(1024*1024)).toFixed(2)," MB)")),chrome.storage.local.set({storedEmbeddings:i},()=>{if(chrome.runtime.lastError){let t=chrome.runtime.lastError;console.error("Error saving embeddings to storage:",t),t.message&&(t.message.includes("quota")||t.message.includes("QUOTA")||t.message.includes("limit")||t.message.includes("space"))&&(console.error("Storage quota exceeded. Data size: ".concat(o," bytes.")),console.error("Consider reducing the amount of data or implementing chunking.")),n(t)}else console.log("Successfully saved ".concat(Object.keys(i).length," embeddings to storage")),r(!0)})})}async search(r,n=3){if(console.log('Searching for related info: "'.concat(r,'" (top ').concat(n," results)")),Object.keys(this.data).length===0&&console.warn("Memory store is empty before loading attempt, checking storage..."),Object.keys(this.data).length===0&&!await this.loadStoredEmbeddings())return console.warn("Memory store is empty, no data to search. Check if YAML was properly loaded."),chrome.storage.local.get(null,function(t){console.log("All chrome storage items:",Object.keys(t)),console.log("Storage size:",JSON.stringify(t).length,"bytes"),t.userProfile&&console.log("User profile exists in storage but no embeddings found")}),[];let i=r.toLowerCase();if(i.includes("salary")||i.includes("compensation")||i.includes("earn")||i.includes("pay")){if(this.data.salary_information)return console.log("Found direct match for salary query"),["salary_information"];let o=Object.keys(this.data).filter(t=>t.toLowerCase().includes("salary")||this.data[t].text&&this.data[t].text.toLowerCase().includes("salary"));if(o.length>0)return console.log("Found ".concat(o.length," direct salary-related keys")),o.slice(0,n)}if(i.includes("phone")||i.includes("contact")||i.includes("call")){if(this.data.contact_information)return console.log("Found direct match for contact query"),["contact_information"];let o=Object.keys(this.data).filter(t=>t.toLowerCase().includes("phone")||t.toLowerCase().includes("contact")||t.toLowerCase().includes("email"));if(o.length>0)return console.log("Found ".concat(o.length," direct contact-related keys")),o.slice(0,n)}if((i.includes("location")||i.includes("where")||i.includes("city")||i.includes("country"))&&this.data.location_information)return console.log("Found direct match for location query"),["location_information"];if((i.includes("experience")||i.includes("years")||i.includes("work history")||i.includes("background"))&&this.data.experience_summary)return console.log("Found direct match for experience query"),["experience_summary"];try{let o=await this.getEmbedding(r);if(!o||!o.success||!o.data||!o.data.embedding)return console.error("Failed to generate embedding for search query"),[];let t=o.data.embedding,l={};for(let[s,c]of Object.entries(this.data)){let f=this.cosineSimilarity(c.embedding,t);l[s]=f}let a=Object.keys(l).sort((s,c)=>l[c]-l[s]).slice(0,n);return console.log("Found ".concat(a.length," relevant keys: ").concat(a.join(", "))),a}catch(o){return console.error("Error searching memory store:",o),[]}}cosineSimilarity(r,n){if(!r||!n||r.length!==n.length)return 0;let i=0,o=0,t=0;for(let l=0;l<r.length;l++)i+=r[l]*n[l],o+=r[l]*r[l],t+=n[l]*n[l];return o=Math.sqrt(o),t=Math.sqrt(t),o===0||t===0?0:i/(o*t)}async clearAllData(r=!0){console.log("Clearing memory store data");let n=Object.keys(this.data).length;return this.data={},this.hasTriedLoading=!1,r?(console.log("Also clearing embeddings from Chrome storage"),new Promise(i=>{chrome.storage.local.remove("storedEmbeddings",()=>{chrome.runtime.lastError?(console.error("Error clearing embeddings from storage:",chrome.runtime.lastError),i(!1)):(console.log("Successfully cleared ".concat(n," embeddings from memory and storage")),i(!0))})})):(console.log("Successfully cleared ".concat(n," embeddings from memory only")),!0)}async getStoredEmbeddingsCount(){return new Promise(r=>{chrome.storage.local.get("storedEmbeddings",n=>{if(chrome.runtime.lastError)console.error("Error getting stored embeddings count:",chrome.runtime.lastError),r(0);else if(n.storedEmbeddings){let i=Object.keys(n.storedEmbeddings).length;console.log("Found ".concat(i," embeddings in Chrome storage")),r(i)}else console.log("No embeddings found in Chrome storage"),r(0)})})}async getEmbedding(r){if(this.directEmbeddingFunction){console.log("Using direct embedding function");try{let n=performance.now(),i=await this.directEmbeddingFunction(r),o=performance.now();if(console.log("Embedding generated in ".concat((o-n).toFixed(2),"ms")),i&&i.success&&i.data&&i.data.embedding){let t=i.data.embedding;console.log("Embedding dimensions: ".concat(t.length)),console.log("Embedding sample: [".concat(t.slice(0,3).map(l=>l.toFixed(5)).join(", "),"...]"))}return i}catch(n){throw console.error("Error using direct embedding function:",n),n}}return new Promise((n,i)=>{console.log("Requesting embedding from background script for text (length: ".concat(r.length,'): "').concat(r.substring(0,50),'..."'));let o=performance.now();chrome.runtime.sendMessage({action:"getEmbeddings",text:r},t=>{let l=performance.now();if(chrome.runtime.lastError)console.error("Embedding request failed after ".concat((l-o).toFixed(2),"ms:"),chrome.runtime.lastError),i(new Error(chrome.runtime.lastError.message));else{if(console.log("Embedding received from API in ".concat((l-o).toFixed(2),"ms")),t&&t.success&&t.data&&t.data.embedding){let a=t.data.embedding;console.log("Embedding dimensions: ".concat(a.length)),console.log("Embedding sample: [".concat(a.slice(0,3).map(s=>s.toFixed(5)).join(", "),"...]"))}else console.warn("Received invalid embedding response:",t);n(t)}})})}async preloadEmbeddings(){console.log("Preloading embeddings from storage into memory...");try{let r=await this.loadStoredEmbeddings();return console.log(r?"Successfully preloaded ".concat(Object.keys(this.data).length," embeddings into memory"):"No embeddings found to preload"),r}catch(r){return console.error("Error preloading embeddings:",r),!1}}},Dr=new U,_=Dr;function Ne(e){return typeof e>"u"||e===null}function jr(e){return typeof e=="object"&&e!==null}function Rr(e){return Array.isArray(e)?e:Ne(e)?[]:[e]}function Yr(e,r){var n,i,o,t;if(r)for(t=Object.keys(r),n=0,i=t.length;n<i;n+=1)o=t[n],e[o]=r[o];return e}function Br(e,r){var n="",i;for(i=0;i<r;i+=1)n+=e;return n}function Ur(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Hr=Ne,qr=jr,Kr=Rr,zr=Br,Gr=Ur,Jr=Yr,v={isNothing:Hr,isObject:qr,toArray:Kr,repeat:zr,isNegativeZero:Gr,extend:Jr};function Me(e,r){var n="",i=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!r&&e.mark.snippet&&(n+="\n\n"+e.mark.snippet),i+" "+n):i}function q(e,r){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=r,this.message=Me(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}q.prototype=Object.create(Error.prototype);q.prototype.constructor=q;q.prototype.toString=function(r){return this.name+": "+Me(this,r)};var C=q;function ne(e,r,n,i,o){var t="",l="",a=Math.floor(o/2)-1;return i-r>a&&(t=" ... ",r=i-a+t.length),n-i>a&&(l=" ...",n=i+a-l.length),{str:t+e.slice(r,n).replace(/\t/g,"\u2192")+l,pos:i-r+t.length}}function ie(e,r){return v.repeat(" ",r-e.length)+e}function Wr(e,r){if(r=Object.create(r||null),!e.buffer)return null;r.maxLength||(r.maxLength=79),typeof r.indent!="number"&&(r.indent=1),typeof r.linesBefore!="number"&&(r.linesBefore=3),typeof r.linesAfter!="number"&&(r.linesAfter=2);for(var n=/\r?\n|\r|\0/g,i=[0],o=[],t,l=-1;t=n.exec(e.buffer);)o.push(t.index),i.push(t.index+t[0].length),e.position<=t.index&&l<0&&(l=i.length-2);l<0&&(l=i.length-1);var a="",s,c,f=Math.min(e.line+r.linesAfter,o.length).toString().length,u=r.maxLength-(r.indent+f+3);for(s=1;s<=r.linesBefore&&!(l-s<0);s++)c=ne(e.buffer,i[l-s],o[l-s],e.position-(i[l]-i[l-s]),u),a=v.repeat(" ",r.indent)+ie((e.line-s+1).toString(),f)+" | "+c.str+"\n"+a;for(c=ne(e.buffer,i[l],o[l],e.position,u),a+=v.repeat(" ",r.indent)+ie((e.line+1).toString(),f)+" | "+c.str+"\n",a+=v.repeat("-",r.indent+f+3+c.pos)+"^\n",s=1;s<=r.linesAfter&&!(l+s>=o.length);s++)c=ne(e.buffer,i[l+s],o[l+s],e.position-(i[l]-i[l+s]),u),a+=v.repeat(" ",r.indent)+ie((e.line+s+1).toString(),f)+" | "+c.str+"\n";return a.replace(/\n$/,"")}var Vr=Wr,Qr=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Xr=["scalar","sequence","mapping"];function Zr(e){var r={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(i){r[String(i)]=n})}),r}function en(e,r){if(r=r||{},Object.keys(r).forEach(function(n){if(Qr.indexOf(n)===-1)throw new C('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.options=r,this.tag=e,this.kind=r.kind||null,this.resolve=r.resolve||function(){return!0},this.construct=r.construct||function(n){return n},this.instanceOf=r.instanceOf||null,this.predicate=r.predicate||null,this.represent=r.represent||null,this.representName=r.representName||null,this.defaultStyle=r.defaultStyle||null,this.multi=r.multi||!1,this.styleAliases=Zr(r.styleAliases||null),Xr.indexOf(this.kind)===-1)throw new C('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var w=en;function be(e,r){var n=[];return e[r].forEach(function(i){var o=n.length;n.forEach(function(t,l){t.tag===i.tag&&t.kind===i.kind&&t.multi===i.multi&&(o=l)}),n[o]=i}),n}function rn(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},r,n;function i(o){o.multi?(e.multi[o.kind].push(o),e.multi.fallback.push(o)):e[o.kind][o.tag]=e.fallback[o.tag]=o}for(r=0,n=arguments.length;r<n;r+=1)arguments[r].forEach(i);return e}function le(e){return this.extend(e)}le.prototype.extend=function(r){var n=[],i=[];if(r instanceof w)i.push(r);else if(Array.isArray(r))i=i.concat(r);else if(r&&(Array.isArray(r.implicit)||Array.isArray(r.explicit)))r.implicit&&(n=n.concat(r.implicit)),r.explicit&&(i=i.concat(r.explicit));else throw new C("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(t){if(!(t instanceof w))throw new C("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(t.loadKind&&t.loadKind!=="scalar")throw new C("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(t.multi)throw new C("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),i.forEach(function(t){if(!(t instanceof w))throw new C("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var o=Object.create(le.prototype);return o.implicit=(this.implicit||[]).concat(n),o.explicit=(this.explicit||[]).concat(i),o.compiledImplicit=be(o,"implicit"),o.compiledExplicit=be(o,"explicit"),o.compiledTypeMap=rn(o.compiledImplicit,o.compiledExplicit),o};var Pe=le,De=new w("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),je=new w("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Re=new w("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Ye=new Pe({explicit:[De,je,Re]});function nn(e){if(e===null)return!0;var r=e.length;return r===1&&e==="~"||r===4&&(e==="null"||e==="Null"||e==="NULL")}function on(){return null}function ln(e){return e===null}var Be=new w("tag:yaml.org,2002:null",{kind:"scalar",resolve:nn,construct:on,predicate:ln,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function tn(e){if(e===null)return!1;var r=e.length;return r===4&&(e==="true"||e==="True"||e==="TRUE")||r===5&&(e==="false"||e==="False"||e==="FALSE")}function an(e){return e==="true"||e==="True"||e==="TRUE"}function sn(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Ue=new w("tag:yaml.org,2002:bool",{kind:"scalar",resolve:tn,construct:an,predicate:sn,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function cn(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function un(e){return 48<=e&&e<=55}function fn(e){return 48<=e&&e<=57}function dn(e){if(e===null)return!1;var r=e.length,n=0,i=!1,o;if(!r)return!1;if(o=e[n],(o==="-"||o==="+")&&(o=e[++n]),o==="0"){if(n+1===r)return!0;if(o=e[++n],o==="b"){for(n++;n<r;n++)if(o=e[n],o!=="_"){if(o!=="0"&&o!=="1")return!1;i=!0}return i&&o!=="_"}if(o==="x"){for(n++;n<r;n++)if(o=e[n],o!=="_"){if(!cn(e.charCodeAt(n)))return!1;i=!0}return i&&o!=="_"}if(o==="o"){for(n++;n<r;n++)if(o=e[n],o!=="_"){if(!un(e.charCodeAt(n)))return!1;i=!0}return i&&o!=="_"}}if(o==="_")return!1;for(;n<r;n++)if(o=e[n],o!=="_"){if(!fn(e.charCodeAt(n)))return!1;i=!0}return!(!i||o==="_")}function pn(e){var r=e,n=1,i;if(r.indexOf("_")!==-1&&(r=r.replace(/_/g,"")),i=r[0],(i==="-"||i==="+")&&(i==="-"&&(n=-1),r=r.slice(1),i=r[0]),r==="0")return 0;if(i==="0"){if(r[1]==="b")return n*parseInt(r.slice(2),2);if(r[1]==="x")return n*parseInt(r.slice(2),16);if(r[1]==="o")return n*parseInt(r.slice(2),8)}return n*parseInt(r,10)}function mn(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!v.isNegativeZero(e)}var He=new w("tag:yaml.org,2002:int",{kind:"scalar",resolve:dn,construct:pn,predicate:mn,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),gn=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function hn(e){return!(e===null||!gn.test(e)||e[e.length-1]==="_")}function yn(e){var r,n;return r=e.replace(/_/g,"").toLowerCase(),n=r[0]==="-"?-1:1,"+-".indexOf(r[0])>=0&&(r=r.slice(1)),r===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:r===".nan"?NaN:n*parseFloat(r,10)}var xn=/^[-+]?[0-9]+e/;function bn(e,r){var n;if(isNaN(e))switch(r){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(r){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(r){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(v.isNegativeZero(e))return"-0.0";return n=e.toString(10),xn.test(n)?n.replace("e",".e"):n}function An(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||v.isNegativeZero(e))}var qe=new w("tag:yaml.org,2002:float",{kind:"scalar",resolve:hn,construct:yn,predicate:An,represent:bn,defaultStyle:"lowercase"}),Ke=Ye.extend({implicit:[Be,Ue,He,qe]}),ze=Ke,Ge=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Je=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function En(e){return e===null?!1:Ge.exec(e)!==null||Je.exec(e)!==null}function vn(e){var r,n,i,o,t,l,a,s=0,c=null,f,u,m;if(r=Ge.exec(e),r===null&&(r=Je.exec(e)),r===null)throw new Error("Date resolve error");if(n=+r[1],i=+r[2]-1,o=+r[3],!r[4])return new Date(Date.UTC(n,i,o));if(t=+r[4],l=+r[5],a=+r[6],r[7]){for(s=r[7].slice(0,3);s.length<3;)s+="0";s=+s}return r[9]&&(f=+r[10],u=+(r[11]||0),c=(f*60+u)*6e4,r[9]==="-"&&(c=-c)),m=new Date(Date.UTC(n,i,o,t,l,a,s)),c&&m.setTime(m.getTime()-c),m}function wn(e){return e.toISOString()}var We=new w("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:En,construct:vn,instanceOf:Date,represent:wn});function Sn(e){return e==="<<"||e===null}var Ve=new w("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Sn}),ue="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";function Cn(e){if(e===null)return!1;var r,n,i=0,o=e.length,t=ue;for(n=0;n<o;n++)if(r=t.indexOf(e.charAt(n)),!(r>64)){if(r<0)return!1;i+=6}return i%8===0}function On(e){var r,n,i=e.replace(/[\r\n=]/g,""),o=i.length,t=ue,l=0,a=[];for(r=0;r<o;r++)r%4===0&&r&&(a.push(l>>16&255),a.push(l>>8&255),a.push(l&255)),l=l<<6|t.indexOf(i.charAt(r));return n=o%4*6,n===0?(a.push(l>>16&255),a.push(l>>8&255),a.push(l&255)):n===18?(a.push(l>>10&255),a.push(l>>2&255)):n===12&&a.push(l>>4&255),new Uint8Array(a)}function _n(e){var r="",n=0,i,o,t=e.length,l=ue;for(i=0;i<t;i++)i%3===0&&i&&(r+=l[n>>18&63],r+=l[n>>12&63],r+=l[n>>6&63],r+=l[n&63]),n=(n<<8)+e[i];return o=t%3,o===0?(r+=l[n>>18&63],r+=l[n>>12&63],r+=l[n>>6&63],r+=l[n&63]):o===2?(r+=l[n>>10&63],r+=l[n>>4&63],r+=l[n<<2&63],r+=l[64]):o===1&&(r+=l[n>>2&63],r+=l[n<<4&63],r+=l[64],r+=l[64]),r}function Fn(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Qe=new w("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Cn,construct:On,predicate:Fn,represent:_n}),Tn=Object.prototype.hasOwnProperty,kn=Object.prototype.toString;function In(e){if(e===null)return!0;var r=[],n,i,o,t,l,a=e;for(n=0,i=a.length;n<i;n+=1){if(o=a[n],l=!1,kn.call(o)!=="[object Object]")return!1;for(t in o)if(Tn.call(o,t))if(!l)l=!0;else return!1;if(!l)return!1;if(r.indexOf(t)===-1)r.push(t);else return!1}return!0}function Ln(e){return e!==null?e:[]}var Xe=new w("tag:yaml.org,2002:omap",{kind:"sequence",resolve:In,construct:Ln}),$n=Object.prototype.toString;function Nn(e){if(e===null)return!0;var r,n,i,o,t,l=e;for(t=new Array(l.length),r=0,n=l.length;r<n;r+=1){if(i=l[r],$n.call(i)!=="[object Object]"||(o=Object.keys(i),o.length!==1))return!1;t[r]=[o[0],i[o[0]]]}return!0}function Mn(e){if(e===null)return[];var r,n,i,o,t,l=e;for(t=new Array(l.length),r=0,n=l.length;r<n;r+=1)i=l[r],o=Object.keys(i),t[r]=[o[0],i[o[0]]];return t}var Ze=new w("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Nn,construct:Mn}),Pn=Object.prototype.hasOwnProperty;function Dn(e){if(e===null)return!0;var r,n=e;for(r in n)if(Pn.call(n,r)&&n[r]!==null)return!1;return!0}function jn(e){return e!==null?e:{}}var er=new w("tag:yaml.org,2002:set",{kind:"mapping",resolve:Dn,construct:jn}),fe=ze.extend({implicit:[We,Ve],explicit:[Qe,Xe,Ze,er]}),$=Object.prototype.hasOwnProperty,V=1,rr=2,nr=3,Q=4,oe=1,Rn=2,Ae=3,Yn=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Bn=/[\x85\u2028\u2029]/,Un=/[,\[\]\{\}]/,ir=/^(?:!|!!|![a-z\-]+!)$/i,or=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Ee(e){return Object.prototype.toString.call(e)}function F(e){return e===10||e===13}function M(e){return e===9||e===32}function O(e){return e===9||e===32||e===10||e===13}function D(e){return e===44||e===91||e===93||e===123||e===125}function Hn(e){var r;return 48<=e&&e<=57?e-48:(r=e|32,97<=r&&r<=102?r-97+10:-1)}function qn(e){return e===120?2:e===117?4:e===85?8:0}function Kn(e){return 48<=e&&e<=57?e-48:-1}function ve(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?"\n":e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function zn(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var lr=new Array(256),tr=new Array(256);for(N=0;N<256;N++)lr[N]=ve(N)?1:0,tr[N]=ve(N);var N;function Gn(e,r){this.input=e,this.filename=r.filename||null,this.schema=r.schema||fe,this.onWarning=r.onWarning||null,this.legacy=r.legacy||!1,this.json=r.json||!1,this.listener=r.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function ar(e,r){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=Vr(n),new C(r,n)}function g(e,r){throw ar(e,r)}function X(e,r){e.onWarning&&e.onWarning.call(null,ar(e,r))}var we={YAML:function(r,n,i){var o,t,l;r.version!==null&&g(r,"duplication of %YAML directive"),i.length!==1&&g(r,"YAML directive accepts exactly one argument"),o=/^([0-9]+)\.([0-9]+)$/.exec(i[0]),o===null&&g(r,"ill-formed argument of the YAML directive"),t=parseInt(o[1],10),l=parseInt(o[2],10),t!==1&&g(r,"unacceptable YAML version of the document"),r.version=i[0],r.checkLineBreaks=l<2,l!==1&&l!==2&&X(r,"unsupported YAML version of the document")},TAG:function(r,n,i){var o,t;i.length!==2&&g(r,"TAG directive accepts exactly two arguments"),o=i[0],t=i[1],ir.test(o)||g(r,"ill-formed tag handle (first argument) of the TAG directive"),$.call(r.tagMap,o)&&g(r,'there is a previously declared suffix for "'+o+'" tag handle'),or.test(t)||g(r,"ill-formed tag prefix (second argument) of the TAG directive");try{t=decodeURIComponent(t)}catch(l){g(r,"tag prefix is malformed: "+t)}r.tagMap[o]=t}};function L(e,r,n,i){var o,t,l,a;if(r<n){if(a=e.input.slice(r,n),i)for(o=0,t=a.length;o<t;o+=1)l=a.charCodeAt(o),l===9||32<=l&&l<=1114111||g(e,"expected valid JSON character");else Yn.test(a)&&g(e,"the stream contains non-printable characters");e.result+=a}}function Se(e,r,n,i){var o,t,l,a;for(v.isObject(n)||g(e,"cannot merge mappings; the provided source object is unacceptable"),o=Object.keys(n),l=0,a=o.length;l<a;l+=1)t=o[l],$.call(r,t)||(r[t]=n[t],i[t]=!0)}function j(e,r,n,i,o,t,l,a,s){var c,f;if(Array.isArray(o))for(o=Array.prototype.slice.call(o),c=0,f=o.length;c<f;c+=1)Array.isArray(o[c])&&g(e,"nested arrays are not supported inside keys"),typeof o=="object"&&Ee(o[c])==="[object Object]"&&(o[c]="[object Object]");if(typeof o=="object"&&Ee(o)==="[object Object]"&&(o="[object Object]"),o=String(o),r===null&&(r={}),i==="tag:yaml.org,2002:merge")if(Array.isArray(t))for(c=0,f=t.length;c<f;c+=1)Se(e,r,t[c],n);else Se(e,r,t,n);else!e.json&&!$.call(n,o)&&$.call(r,o)&&(e.line=l||e.line,e.lineStart=a||e.lineStart,e.position=s||e.position,g(e,"duplicated mapping key")),o==="__proto__"?Object.defineProperty(r,o,{configurable:!0,enumerable:!0,writable:!0,value:t}):r[o]=t,delete n[o];return r}function de(e){var r;r=e.input.charCodeAt(e.position),r===10?e.position++:r===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):g(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function A(e,r,n){for(var i=0,o=e.input.charCodeAt(e.position);o!==0;){for(;M(o);)o===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),o=e.input.charCodeAt(++e.position);if(r&&o===35)do o=e.input.charCodeAt(++e.position);while(o!==10&&o!==13&&o!==0);if(F(o))for(de(e),o=e.input.charCodeAt(e.position),i++,e.lineIndent=0;o===32;)e.lineIndent++,o=e.input.charCodeAt(++e.position);else break}return n!==-1&&i!==0&&e.lineIndent<n&&X(e,"deficient indentation"),i}function re(e){var r=e.position,n;return n=e.input.charCodeAt(r),!!((n===45||n===46)&&n===e.input.charCodeAt(r+1)&&n===e.input.charCodeAt(r+2)&&(r+=3,n=e.input.charCodeAt(r),n===0||O(n)))}function pe(e,r){r===1?e.result+=" ":r>1&&(e.result+=v.repeat("\n",r-1))}function Jn(e,r,n){var i,o,t,l,a,s,c,f,u=e.kind,m=e.result,h;if(h=e.input.charCodeAt(e.position),O(h)||D(h)||h===35||h===38||h===42||h===33||h===124||h===62||h===39||h===34||h===37||h===64||h===96||(h===63||h===45)&&(o=e.input.charCodeAt(e.position+1),O(o)||n&&D(o)))return!1;for(e.kind="scalar",e.result="",t=l=e.position,a=!1;h!==0;){if(h===58){if(o=e.input.charCodeAt(e.position+1),O(o)||n&&D(o))break}else if(h===35){if(i=e.input.charCodeAt(e.position-1),O(i))break}else{if(e.position===e.lineStart&&re(e)||n&&D(h))break;if(F(h))if(s=e.line,c=e.lineStart,f=e.lineIndent,A(e,!1,-1),e.lineIndent>=r){a=!0,h=e.input.charCodeAt(e.position);continue}else{e.position=l,e.line=s,e.lineStart=c,e.lineIndent=f;break}}a&&(L(e,t,l,!1),pe(e,e.line-s),t=l=e.position,a=!1),M(h)||(l=e.position+1),h=e.input.charCodeAt(++e.position)}return L(e,t,l,!1),e.result?!0:(e.kind=u,e.result=m,!1)}function Wn(e,r){var n,i,o;if(n=e.input.charCodeAt(e.position),n!==39)return!1;for(e.kind="scalar",e.result="",e.position++,i=o=e.position;(n=e.input.charCodeAt(e.position))!==0;)if(n===39)if(L(e,i,e.position,!0),n=e.input.charCodeAt(++e.position),n===39)i=e.position,e.position++,o=e.position;else return!0;else F(n)?(L(e,i,o,!0),pe(e,A(e,!1,r)),i=o=e.position):e.position===e.lineStart&&re(e)?g(e,"unexpected end of the document within a single quoted scalar"):(e.position++,o=e.position);g(e,"unexpected end of the stream within a single quoted scalar")}function Vn(e,r){var n,i,o,t,l,a;if(a=e.input.charCodeAt(e.position),a!==34)return!1;for(e.kind="scalar",e.result="",e.position++,n=i=e.position;(a=e.input.charCodeAt(e.position))!==0;){if(a===34)return L(e,n,e.position,!0),e.position++,!0;if(a===92){if(L(e,n,e.position,!0),a=e.input.charCodeAt(++e.position),F(a))A(e,!1,r);else if(a<256&&lr[a])e.result+=tr[a],e.position++;else if((l=qn(a))>0){for(o=l,t=0;o>0;o--)a=e.input.charCodeAt(++e.position),(l=Hn(a))>=0?t=(t<<4)+l:g(e,"expected hexadecimal character");e.result+=zn(t),e.position++}else g(e,"unknown escape sequence");n=i=e.position}else F(a)?(L(e,n,i,!0),pe(e,A(e,!1,r)),n=i=e.position):e.position===e.lineStart&&re(e)?g(e,"unexpected end of the document within a double quoted scalar"):(e.position++,i=e.position)}g(e,"unexpected end of the stream within a double quoted scalar")}function Qn(e,r){var n=!0,i,o,t,l=e.tag,a,s=e.anchor,c,f,u,m,h,d=Object.create(null),p,y,b,x;if(x=e.input.charCodeAt(e.position),x===91)f=93,h=!1,a=[];else if(x===123)f=125,h=!0,a={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=a),x=e.input.charCodeAt(++e.position);x!==0;){if(A(e,!0,r),x=e.input.charCodeAt(e.position),x===f)return e.position++,e.tag=l,e.anchor=s,e.kind=h?"mapping":"sequence",e.result=a,!0;n?x===44&&g(e,"expected the node content, but found ','"):g(e,"missed comma between flow collection entries"),y=p=b=null,u=m=!1,x===63&&(c=e.input.charCodeAt(e.position+1),O(c)&&(u=m=!0,e.position++,A(e,!0,r))),i=e.line,o=e.lineStart,t=e.position,R(e,r,V,!1,!0),y=e.tag,p=e.result,A(e,!0,r),x=e.input.charCodeAt(e.position),(m||e.line===i)&&x===58&&(u=!0,x=e.input.charCodeAt(++e.position),A(e,!0,r),R(e,r,V,!1,!0),b=e.result),h?j(e,a,d,y,p,b,i,o,t):u?a.push(j(e,null,d,y,p,b,i,o,t)):a.push(p),A(e,!0,r),x=e.input.charCodeAt(e.position),x===44?(n=!0,x=e.input.charCodeAt(++e.position)):n=!1}g(e,"unexpected end of the stream within a flow collection")}function Xn(e,r){var n,i,o=oe,t=!1,l=!1,a=r,s=0,c=!1,f,u;if(u=e.input.charCodeAt(e.position),u===124)i=!1;else if(u===62)i=!0;else return!1;for(e.kind="scalar",e.result="";u!==0;)if(u=e.input.charCodeAt(++e.position),u===43||u===45)oe===o?o=u===43?Ae:Rn:g(e,"repeat of a chomping mode identifier");else if((f=Kn(u))>=0)f===0?g(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):l?g(e,"repeat of an indentation width identifier"):(a=r+f-1,l=!0);else break;if(M(u)){do u=e.input.charCodeAt(++e.position);while(M(u));if(u===35)do u=e.input.charCodeAt(++e.position);while(!F(u)&&u!==0)}for(;u!==0;){for(de(e),e.lineIndent=0,u=e.input.charCodeAt(e.position);(!l||e.lineIndent<a)&&u===32;)e.lineIndent++,u=e.input.charCodeAt(++e.position);if(!l&&e.lineIndent>a&&(a=e.lineIndent),F(u)){s++;continue}if(e.lineIndent<a){o===Ae?e.result+=v.repeat("\n",t?1+s:s):o===oe&&t&&(e.result+="\n");break}for(i?M(u)?(c=!0,e.result+=v.repeat("\n",t?1+s:s)):c?(c=!1,e.result+=v.repeat("\n",s+1)):s===0?t&&(e.result+=" "):e.result+=v.repeat("\n",s):e.result+=v.repeat("\n",t?1+s:s),t=!0,l=!0,s=0,n=e.position;!F(u)&&u!==0;)u=e.input.charCodeAt(++e.position);L(e,n,e.position,!1)}return!0}function Ce(e,r){var n,i=e.tag,o=e.anchor,t=[],l,a=!1,s;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=t),s=e.input.charCodeAt(e.position);s!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,g(e,"tab characters must not be used in indentation")),!(s!==45||(l=e.input.charCodeAt(e.position+1),!O(l))));){if(a=!0,e.position++,A(e,!0,-1)&&e.lineIndent<=r){t.push(null),s=e.input.charCodeAt(e.position);continue}if(n=e.line,R(e,r,nr,!1,!0),t.push(e.result),A(e,!0,-1),s=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>r)&&s!==0)g(e,"bad indentation of a sequence entry");else if(e.lineIndent<r)break}return a?(e.tag=i,e.anchor=o,e.kind="sequence",e.result=t,!0):!1}function Zn(e,r,n){var i,o,t,l,a,s,c=e.tag,f=e.anchor,u={},m=Object.create(null),h=null,d=null,p=null,y=!1,b=!1,x;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=u),x=e.input.charCodeAt(e.position);x!==0;){if(!y&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,g(e,"tab characters must not be used in indentation")),i=e.input.charCodeAt(e.position+1),t=e.line,(x===63||x===58)&&O(i))x===63?(y&&(j(e,u,m,h,d,null,l,a,s),h=d=p=null),b=!0,y=!0,o=!0):y?(y=!1,o=!0):g(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,x=i;else{if(l=e.line,a=e.lineStart,s=e.position,!R(e,n,rr,!1,!0))break;if(e.line===t){for(x=e.input.charCodeAt(e.position);M(x);)x=e.input.charCodeAt(++e.position);if(x===58)x=e.input.charCodeAt(++e.position),O(x)||g(e,"a whitespace character is expected after the key-value separator within a block mapping"),y&&(j(e,u,m,h,d,null,l,a,s),h=d=p=null),b=!0,y=!1,o=!1,h=e.tag,d=e.result;else if(b)g(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=c,e.anchor=f,!0}else if(b)g(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=c,e.anchor=f,!0}if((e.line===t||e.lineIndent>r)&&(y&&(l=e.line,a=e.lineStart,s=e.position),R(e,r,Q,!0,o)&&(y?d=e.result:p=e.result),y||(j(e,u,m,h,d,p,l,a,s),h=d=p=null),A(e,!0,-1),x=e.input.charCodeAt(e.position)),(e.line===t||e.lineIndent>r)&&x!==0)g(e,"bad indentation of a mapping entry");else if(e.lineIndent<r)break}return y&&j(e,u,m,h,d,null,l,a,s),b&&(e.tag=c,e.anchor=f,e.kind="mapping",e.result=u),b}function ei(e){var r,n=!1,i=!1,o,t,l;if(l=e.input.charCodeAt(e.position),l!==33)return!1;if(e.tag!==null&&g(e,"duplication of a tag property"),l=e.input.charCodeAt(++e.position),l===60?(n=!0,l=e.input.charCodeAt(++e.position)):l===33?(i=!0,o="!!",l=e.input.charCodeAt(++e.position)):o="!",r=e.position,n){do l=e.input.charCodeAt(++e.position);while(l!==0&&l!==62);e.position<e.length?(t=e.input.slice(r,e.position),l=e.input.charCodeAt(++e.position)):g(e,"unexpected end of the stream within a verbatim tag")}else{for(;l!==0&&!O(l);)l===33&&(i?g(e,"tag suffix cannot contain exclamation marks"):(o=e.input.slice(r-1,e.position+1),ir.test(o)||g(e,"named tag handle cannot contain such characters"),i=!0,r=e.position+1)),l=e.input.charCodeAt(++e.position);t=e.input.slice(r,e.position),Un.test(t)&&g(e,"tag suffix cannot contain flow indicator characters")}t&&!or.test(t)&&g(e,"tag name cannot contain such characters: "+t);try{t=decodeURIComponent(t)}catch(a){g(e,"tag name is malformed: "+t)}return n?e.tag=t:$.call(e.tagMap,o)?e.tag=e.tagMap[o]+t:o==="!"?e.tag="!"+t:o==="!!"?e.tag="tag:yaml.org,2002:"+t:g(e,'undeclared tag handle "'+o+'"'),!0}function ri(e){var r,n;if(n=e.input.charCodeAt(e.position),n!==38)return!1;for(e.anchor!==null&&g(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),r=e.position;n!==0&&!O(n)&&!D(n);)n=e.input.charCodeAt(++e.position);return e.position===r&&g(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(r,e.position),!0}function ni(e){var r,n,i;if(i=e.input.charCodeAt(e.position),i!==42)return!1;for(i=e.input.charCodeAt(++e.position),r=e.position;i!==0&&!O(i)&&!D(i);)i=e.input.charCodeAt(++e.position);return e.position===r&&g(e,"name of an alias node must contain at least one character"),n=e.input.slice(r,e.position),$.call(e.anchorMap,n)||g(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],A(e,!0,-1),!0}function R(e,r,n,i,o){var t,l,a,s=1,c=!1,f=!1,u,m,h,d,p,y;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,t=l=a=Q===n||nr===n,i&&A(e,!0,-1)&&(c=!0,e.lineIndent>r?s=1:e.lineIndent===r?s=0:e.lineIndent<r&&(s=-1)),s===1)for(;ei(e)||ri(e);)A(e,!0,-1)?(c=!0,a=t,e.lineIndent>r?s=1:e.lineIndent===r?s=0:e.lineIndent<r&&(s=-1)):a=!1;if(a&&(a=c||o),(s===1||Q===n)&&(V===n||rr===n?p=r:p=r+1,y=e.position-e.lineStart,s===1?a&&(Ce(e,y)||Zn(e,y,p))||Qn(e,p)?f=!0:(l&&Xn(e,p)||Wn(e,p)||Vn(e,p)?f=!0:ni(e)?(f=!0,(e.tag!==null||e.anchor!==null)&&g(e,"alias node should not have any properties")):Jn(e,p,V===n)&&(f=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):s===0&&(f=a&&Ce(e,y))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&g(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),u=0,m=e.implicitTypes.length;u<m;u+=1)if(d=e.implicitTypes[u],d.resolve(e.result)){e.result=d.construct(e.result),e.tag=d.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if($.call(e.typeMap[e.kind||"fallback"],e.tag))d=e.typeMap[e.kind||"fallback"][e.tag];else for(d=null,h=e.typeMap.multi[e.kind||"fallback"],u=0,m=h.length;u<m;u+=1)if(e.tag.slice(0,h[u].tag.length)===h[u].tag){d=h[u];break}d||g(e,"unknown tag !<"+e.tag+">"),e.result!==null&&d.kind!==e.kind&&g(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+d.kind+'", not "'+e.kind+'"'),d.resolve(e.result,e.tag)?(e.result=d.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):g(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||f}function ii(e){var r=e.position,n,i,o,t=!1,l;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(l=e.input.charCodeAt(e.position))!==0&&(A(e,!0,-1),l=e.input.charCodeAt(e.position),!(e.lineIndent>0||l!==37));){for(t=!0,l=e.input.charCodeAt(++e.position),n=e.position;l!==0&&!O(l);)l=e.input.charCodeAt(++e.position);for(i=e.input.slice(n,e.position),o=[],i.length<1&&g(e,"directive name must not be less than one character in length");l!==0;){for(;M(l);)l=e.input.charCodeAt(++e.position);if(l===35){do l=e.input.charCodeAt(++e.position);while(l!==0&&!F(l));break}if(F(l))break;for(n=e.position;l!==0&&!O(l);)l=e.input.charCodeAt(++e.position);o.push(e.input.slice(n,e.position))}l!==0&&de(e),$.call(we,i)?we[i](e,i,o):X(e,'unknown document directive "'+i+'"')}if(A(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,A(e,!0,-1)):t&&g(e,"directives end mark is expected"),R(e,e.lineIndent-1,Q,!1,!0),A(e,!0,-1),e.checkLineBreaks&&Bn.test(e.input.slice(r,e.position))&&X(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&re(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,A(e,!0,-1));return}if(e.position<e.length-1)g(e,"end of the stream or a document separator is expected");else return}function sr(e,r){e=String(e),r=r||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+="\n"),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new Gn(e,r),i=e.indexOf("\0");for(i!==-1&&(n.position=i,g(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)ii(n);return n.documents}function oi(e,r,n){r!==null&&typeof r=="object"&&typeof n>"u"&&(n=r,r=null);var i=sr(e,n);if(typeof r!="function")return i;for(var o=0,t=i.length;o<t;o+=1)r(i[o])}function li(e,r){var n=sr(e,r);if(n.length!==0){if(n.length===1)return n[0];throw new C("expected a single document in the stream, but found more")}}var ti=oi,ai=li,cr={loadAll:ti,load:ai},ur=Object.prototype.toString,fr=Object.prototype.hasOwnProperty,me=65279,si=9,K=10,ci=13,ui=32,fi=33,di=34,te=35,pi=37,mi=38,gi=39,hi=42,dr=44,yi=45,Z=58,xi=61,bi=62,Ai=63,Ei=64,pr=91,mr=93,vi=96,gr=123,wi=124,hr=125,S={};S[0]="\\0";S[7]="\\a";S[8]="\\b";S[9]="\\t";S[10]="\\n";S[11]="\\v";S[12]="\\f";S[13]="\\r";S[27]="\\e";S[34]='\\"';S[92]="\\\\";S[133]="\\N";S[160]="\\_";S[8232]="\\L";S[8233]="\\P";var Si=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Ci=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Oi(e,r){var n,i,o,t,l,a,s;if(r===null)return{};for(n={},i=Object.keys(r),o=0,t=i.length;o<t;o+=1)l=i[o],a=String(r[l]),l.slice(0,2)==="!!"&&(l="tag:yaml.org,2002:"+l.slice(2)),s=e.compiledTypeMap.fallback[l],s&&fr.call(s.styleAliases,a)&&(a=s.styleAliases[a]),n[l]=a;return n}function _i(e){var r,n,i;if(r=e.toString(16).toUpperCase(),e<=255)n="x",i=2;else if(e<=65535)n="u",i=4;else if(e<=4294967295)n="U",i=8;else throw new C("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+n+v.repeat("0",i-r.length)+r}var Fi=1,z=2;function Ti(e){this.schema=e.schema||fe,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=v.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Oi(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?z:Fi,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Oe(e,r){for(var n=v.repeat(" ",r),i=0,o=-1,t="",l,a=e.length;i<a;)o=e.indexOf("\n",i),o===-1?(l=e.slice(i),i=a):(l=e.slice(i,o+1),i=o+1),l.length&&l!=="\n"&&(t+=n),t+=l;return t}function ae(e,r){return"\n"+v.repeat(" ",e.indent*r)}function ki(e,r){var n,i,o;for(n=0,i=e.implicitTypes.length;n<i;n+=1)if(o=e.implicitTypes[n],o.resolve(r))return!0;return!1}function ee(e){return e===ui||e===si}function G(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==me||65536<=e&&e<=1114111}function _e(e){return G(e)&&e!==me&&e!==ci&&e!==K}function Fe(e,r,n){var i=_e(e),o=i&&!ee(e);return(n?i:i&&e!==dr&&e!==pr&&e!==mr&&e!==gr&&e!==hr)&&e!==te&&!(r===Z&&!o)||_e(r)&&!ee(r)&&e===te||r===Z&&o}function Ii(e){return G(e)&&e!==me&&!ee(e)&&e!==yi&&e!==Ai&&e!==Z&&e!==dr&&e!==pr&&e!==mr&&e!==gr&&e!==hr&&e!==te&&e!==mi&&e!==hi&&e!==fi&&e!==wi&&e!==xi&&e!==bi&&e!==gi&&e!==di&&e!==pi&&e!==Ei&&e!==vi}function Li(e){return!ee(e)&&e!==Z}function H(e,r){var n=e.charCodeAt(r),i;return n>=55296&&n<=56319&&r+1<e.length&&(i=e.charCodeAt(r+1),i>=56320&&i<=57343)?(n-55296)*1024+i-56320+65536:n}function yr(e){var r=/^\n* /;return r.test(e)}var xr=1,se=2,br=3,Ar=4,P=5;function $i(e,r,n,i,o,t,l,a){var s,c=0,f=null,u=!1,m=!1,h=i!==-1,d=-1,p=Ii(H(e,0))&&Li(H(e,e.length-1));if(r||l)for(s=0;s<e.length;c>=65536?s+=2:s++){if(c=H(e,s),!G(c))return P;p=p&&Fe(c,f,a),f=c}else{for(s=0;s<e.length;c>=65536?s+=2:s++){if(c=H(e,s),c===K)u=!0,h&&(m=m||s-d-1>i&&e[d+1]!==" ",d=s);else if(!G(c))return P;p=p&&Fe(c,f,a),f=c}m=m||h&&s-d-1>i&&e[d+1]!==" "}return!u&&!m?p&&!l&&!o(e)?xr:t===z?P:se:n>9&&yr(e)?P:l?t===z?P:se:m?Ar:br}function Ni(e,r,n,i,o){e.dump=function(){if(r.length===0)return e.quotingType===z?'""':"''";if(!e.noCompatMode&&(Si.indexOf(r)!==-1||Ci.test(r)))return e.quotingType===z?'"'+r+'"':"'"+r+"'";var t=e.indent*Math.max(1,n),l=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-t),a=i||e.flowLevel>-1&&n>=e.flowLevel;function s(c){return ki(e,c)}switch($i(r,a,e.indent,l,s,e.quotingType,e.forceQuotes&&!i,o)){case xr:return r;case se:return"'"+r.replace(/'/g,"''")+"'";case br:return"|"+Te(r,e.indent)+ke(Oe(r,t));case Ar:return">"+Te(r,e.indent)+ke(Oe(Mi(r,l),t));case P:return'"'+Pi(r)+'"';default:throw new C("impossible error: invalid scalar style")}}()}function Te(e,r){var n=yr(e)?String(r):"",i=e[e.length-1]==="\n",o=i&&(e[e.length-2]==="\n"||e==="\n"),t=o?"+":i?"":"-";return n+t+"\n"}function ke(e){return e[e.length-1]==="\n"?e.slice(0,-1):e}function Mi(e,r){for(var n=/(\n+)([^\n]*)/g,i=function(){var c=e.indexOf("\n");return c=c!==-1?c:e.length,n.lastIndex=c,Ie(e.slice(0,c),r)}(),o=e[0]==="\n"||e[0]===" ",t,l;l=n.exec(e);){var a=l[1],s=l[2];t=s[0]===" ",i+=a+(!o&&!t&&s!==""?"\n":"")+Ie(s,r),o=t}return i}function Ie(e,r){if(e===""||e[0]===" ")return e;for(var n=/ [^ ]/g,i,o=0,t,l=0,a=0,s="";i=n.exec(e);)a=i.index,a-o>r&&(t=l>o?l:a,s+="\n"+e.slice(o,t),o=t+1),l=a;return s+="\n",e.length-o>r&&l>o?s+=e.slice(o,l)+"\n"+e.slice(l+1):s+=e.slice(o),s.slice(1)}function Pi(e){for(var r="",n=0,i,o=0;o<e.length;n>=65536?o+=2:o++)n=H(e,o),i=S[n],!i&&G(n)?(r+=e[o],n>=65536&&(r+=e[o+1])):r+=i||_i(n);return r}function Di(e,r,n){var i="",o=e.tag,t,l,a;for(t=0,l=n.length;t<l;t+=1)a=n[t],e.replacer&&(a=e.replacer.call(n,String(t),a)),(k(e,r,a,!1,!1)||typeof a>"u"&&k(e,r,null,!1,!1))&&(i!==""&&(i+=","+(e.condenseFlow?"":" ")),i+=e.dump);e.tag=o,e.dump="["+i+"]"}function Le(e,r,n,i){var o="",t=e.tag,l,a,s;for(l=0,a=n.length;l<a;l+=1)s=n[l],e.replacer&&(s=e.replacer.call(n,String(l),s)),(k(e,r+1,s,!0,!0,!1,!0)||typeof s>"u"&&k(e,r+1,null,!0,!0,!1,!0))&&((!i||o!=="")&&(o+=ae(e,r)),e.dump&&K===e.dump.charCodeAt(0)?o+="-":o+="- ",o+=e.dump);e.tag=t,e.dump=o||"[]"}function ji(e,r,n){var i="",o=e.tag,t=Object.keys(n),l,a,s,c,f;for(l=0,a=t.length;l<a;l+=1)f="",i!==""&&(f+=", "),e.condenseFlow&&(f+='"'),s=t[l],c=n[s],e.replacer&&(c=e.replacer.call(n,s,c)),k(e,r,s,!1,!1)&&(e.dump.length>1024&&(f+="? "),f+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),k(e,r,c,!1,!1)&&(f+=e.dump,i+=f));e.tag=o,e.dump="{"+i+"}"}function Ri(e,r,n,i){var o="",t=e.tag,l=Object.keys(n),a,s,c,f,u,m;if(e.sortKeys===!0)l.sort();else if(typeof e.sortKeys=="function")l.sort(e.sortKeys);else if(e.sortKeys)throw new C("sortKeys must be a boolean or a function");for(a=0,s=l.length;a<s;a+=1)m="",(!i||o!=="")&&(m+=ae(e,r)),c=l[a],f=n[c],e.replacer&&(f=e.replacer.call(n,c,f)),k(e,r+1,c,!0,!0,!0)&&(u=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,u&&(e.dump&&K===e.dump.charCodeAt(0)?m+="?":m+="? "),m+=e.dump,u&&(m+=ae(e,r)),k(e,r+1,f,!0,u)&&(e.dump&&K===e.dump.charCodeAt(0)?m+=":":m+=": ",m+=e.dump,o+=m));e.tag=t,e.dump=o||"{}"}function $e(e,r,n){var i,o,t,l,a,s;for(o=n?e.explicitTypes:e.implicitTypes,t=0,l=o.length;t<l;t+=1)if(a=o[t],(a.instanceOf||a.predicate)&&(!a.instanceOf||typeof r=="object"&&r instanceof a.instanceOf)&&(!a.predicate||a.predicate(r))){if(n?a.multi&&a.representName?e.tag=a.representName(r):e.tag=a.tag:e.tag="?",a.represent){if(s=e.styleMap[a.tag]||a.defaultStyle,ur.call(a.represent)==="[object Function]")i=a.represent(r,s);else if(fr.call(a.represent,s))i=a.represent[s](r,s);else throw new C("!<"+a.tag+'> tag resolver accepts not "'+s+'" style');e.dump=i}return!0}return!1}function k(e,r,n,i,o,t,l){e.tag=null,e.dump=n,$e(e,n,!1)||$e(e,n,!0);var a=ur.call(e.dump),s=i,c;i&&(i=e.flowLevel<0||e.flowLevel>r);var f=a==="[object Object]"||a==="[object Array]",u,m;if(f&&(u=e.duplicates.indexOf(n),m=u!==-1),(e.tag!==null&&e.tag!=="?"||m||e.indent!==2&&r>0)&&(o=!1),m&&e.usedDuplicates[u])e.dump="*ref_"+u;else{if(f&&m&&!e.usedDuplicates[u]&&(e.usedDuplicates[u]=!0),a==="[object Object]")i&&Object.keys(e.dump).length!==0?(Ri(e,r,e.dump,o),m&&(e.dump="&ref_"+u+e.dump)):(ji(e,r,e.dump),m&&(e.dump="&ref_"+u+" "+e.dump));else if(a==="[object Array]")i&&e.dump.length!==0?(e.noArrayIndent&&!l&&r>0?Le(e,r-1,e.dump,o):Le(e,r,e.dump,o),m&&(e.dump="&ref_"+u+e.dump)):(Di(e,r,e.dump),m&&(e.dump="&ref_"+u+" "+e.dump));else if(a==="[object String]")e.tag!=="?"&&Ni(e,e.dump,r,t,s);else{if(a==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new C("unacceptable kind of an object to dump "+a)}e.tag!==null&&e.tag!=="?"&&(c=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?c="!"+c:c.slice(0,18)==="tag:yaml.org,2002:"?c="!!"+c.slice(18):c="!<"+c+">",e.dump=c+" "+e.dump)}return!0}function Yi(e,r){var n=[],i=[],o,t;for(ce(e,n,i),o=0,t=i.length;o<t;o+=1)r.duplicates.push(n[i[o]]);r.usedDuplicates=new Array(t)}function ce(e,r,n){var i,o,t;if(e!==null&&typeof e=="object")if(o=r.indexOf(e),o!==-1)n.indexOf(o)===-1&&n.push(o);else if(r.push(e),Array.isArray(e))for(o=0,t=e.length;o<t;o+=1)ce(e[o],r,n);else for(i=Object.keys(e),o=0,t=i.length;o<t;o+=1)ce(e[i[o]],r,n)}function Bi(e,r){r=r||{};var n=new Ti(r);n.noRefs||Yi(e,n);var i=e;return n.replacer&&(i=n.replacer.call({"":i},"",i)),k(n,0,i,!0,!0)?n.dump+"\n":""}var Ui=Bi,Hi={dump:Ui};function ge(e,r){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+r+" instead, which is now safe by default.")}}var qi=w,Ki=Pe,zi=Ye,Gi=Ke,Ji=ze,Wi=fe,Vi=cr.load,Qi=cr.loadAll,Xi=Hi.dump,Zi=C,eo={binary:Qe,float:qe,map:Re,null:Be,pairs:Ze,set:er,timestamp:We,bool:Ue,int:He,merge:Ve,omap:Xe,seq:je,str:De},ro=ge("safeLoad","load"),no=ge("safeLoadAll","loadAll"),io=ge("safeDump","dump"),oo={Type:qi,Schema:Ki,FAILSAFE_SCHEMA:zi,JSON_SCHEMA:Gi,CORE_SCHEMA:Ji,DEFAULT_SCHEMA:Wi,load:Vi,loadAll:Qi,dump:Xi,YAMLException:Zi,types:eo,safeLoad:ro,safeLoadAll:no,safeDump:io},Er=oo;var he=class{constructor(){}parseUserContext(r){try{if(!r)return null;let n=Er.load(r);return console.log("YAML parsed successfully"),n}catch(n){return console.error("Error parsing YAML:",n),null}}countFields(r){let n=0,i=o=>{for(let[t,l]of Object.entries(o))typeof l=="object"&&l!==null&&!Array.isArray(l)?i(l):n++};return i(r),n}formatValueForEmbedding(r,n=""){if(r==null)return"";let i=n.toLowerCase();return i.includes("salary")||i.includes("compensation")?"Salary: ".concat(r,", Expected salary: ").concat(r,", Desired compensation: ").concat(r,", Annual salary: ").concat(r):i.includes("phone")?"Phone number: ".concat(r,", Contact number: ").concat(r,", Tel: ").concat(r):i.includes("visa")?"Visa required: ".concat(r,", Visa status: ").concat(r,", Work permit: ").concat(r):Array.isArray(r)?r.map(o=>this.formatValueForEmbedding(o)).join(", "):typeof r=="object"?Object.entries(r).map(([o,t])=>{if(o.startsWith("_")||t===null||t===void 0)return null;let l=this.formatValueForEmbedding(t,o);return l?"".concat(o,": ").concat(l):null}).filter(Boolean).join(", "):String(r)}async processUserContext(r,n=null){try{if(!r)return console.error("No YAML content provided"),{success:!1,error:"No YAML content provided"};let i=this.parseUserContext(r);if(!i)return console.error("Failed to parse YAML content"),{success:!1,error:"Failed to parse YAML content"};console.log("User context parsed successfully, processing fields for embeddings");let o=new TextEncoder().encode(r).length;console.log("YAML content size: ".concat(o," bytes (").concat((o/1024).toFixed(2)," KB)"));let t=this.countFields(i),l=0;console.log("Total fields to process: ".concat(t));let a=[];for(let[d,p]of Object.entries(i))if(typeof p=="object"&&p!==null&&!Array.isArray(p)){for(let[y,b]of Object.entries(p)){let x="".concat(d,".").concat(y),T=this.formatValueForEmbedding(b,y);a.push({key:x,value:T})}if(d==="personal_information"){if(p.salary&&a.push({key:"salary_information",value:"Expected salary: ".concat(p.salary,", Desired compensation: ").concat(p.salary,", Annual salary expectation: ").concat(p.salary,", Salary requirement: ").concat(p.salary,", Compensation expectation: ").concat(p.salary)}),p.phone){let y=p.phone_prefix||"";a.push({key:"contact_information",value:"Phone number: ".concat(y).concat(p.phone,", Email: ").concat(p.email||"",", Contact details: ").concat(y).concat(p.phone," and ").concat(p.email||"")})}(p.country||p.city)&&a.push({key:"location_information",value:"Located in ".concat(p.city||"",", ").concat(p.country||"",", Location: ").concat(p.city||"",", ").concat(p.country||"")})}}else{let y=this.formatValueForEmbedding(p,d);a.push({key:d,value:y})}if(console.log("Prepared ".concat(a.length," fields to process for embeddings")),i.experiences&&Array.isArray(i.experiences))try{let d=/(\d{4})\s*-\s*(Present|\d{4})/i,p="";i.experiences.forEach(y=>{y.employment_period&&(p+="".concat(y.position||"Role"," at ").concat(y.company||"Company"," (").concat(y.employment_period,"). "))}),p&&a.push({key:"experience_summary",value:"Professional experience: ".concat(p," Years of experience in software development, engineering, and related fields.")})}catch(d){console.warn("Error creating experience summary:",d)}let s=JSON.stringify(a).length;console.log("Estimated data size before embeddings: ".concat(s," bytes (").concat((s/1024).toFixed(2)," KB)"));let c=s>1e6,f=c?10:a.length;c&&console.log("Using chunking strategy for large dataset (".concat(f," fields per chunk)"));let u=5,m=Math.ceil(a.length/u);if(console.log("Processing embeddings in ".concat(m," batches of ").concat(u)),c)try{await _.clearAllData(),console.log("Cleared existing data before processing chunks")}catch(d){console.warn("Error clearing existing data:",d)}let h=0;for(let d=0;d<m;d++){let p=d*u,y=Math.min((d+1)*u,a.length),b=a.slice(p,y);console.log("Processing batch ".concat(d+1,"/").concat(m," (").concat(b.length," fields)"));let x=b.map(E=>_.addEntry(E.key,E.value)),I=(await Promise.allSettled(x)).filter(E=>E.status==="rejected"||E.status==="fulfilled"&&!E.value);if(I.length>0&&console.warn("".concat(I.length," embeddings failed in batch ").concat(d+1)),l+=b.length,n){let E=Math.round(l/t*100);n({progress:E,message:"Processing batch ".concat(d+1,"/").concat(m," (").concat(l,"/").concat(t," fields)")})}if(c&&(d+1)%Math.ceil(f/u)===0)try{console.log("Saving chunk to storage after batch ".concat(d+1,"...")),await _.saveAllEmbeddings(),console.log("Clearing memory store after saving chunk");let E=Object.keys(_.data).length;_.data={},console.log("Cleared ".concat(E," entries from memory"))}catch(E){if(console.error("Error saving chunk to storage:",E),h++,h>=3)return console.error("Multiple storage errors encountered, aborting processing"),n&&n({progress:0,message:"Error: Storage quota exceeded. Try reducing YAML complexity."}),{success:!1,error:"Storage quota exceeded",details:"The profile is too large to store with embeddings. Try simplifying your profile or using fewer fields."}}d<m-1&&await new Promise(E=>setTimeout(E,100))}console.log("Embedding generation complete, saving to storage...");try{if(Object.keys(_.data).length>0){let p=await _.saveAllEmbeddings();console.log("Save result: ".concat(p?"Success":"Failed"))}else c&&console.log("No final chunk to save (already saved in chunks)");let d=c?await _.getStoredEmbeddingsCount():Object.keys(_.data).length;console.log("Final storage contains ".concat(d," entries"))}catch(d){if(console.error("Error saving embeddings:",d),d&&d.message&&(d.message.includes("quota")||d.message.includes("QUOTA")||d.message.includes("limit")||d.message.includes("space")))return n&&n({progress:0,message:"Error: Storage quota exceeded. Try reducing YAML complexity."}),{success:!1,error:"Storage quota exceeded",details:"The profile is too large to store with embeddings. Try simplifying your profile."}}return n&&n({progress:100,message:"All fields processed"}),{success:!0,data:i}}catch(i){return console.error("Error processing user context:",i),n&&n({progress:0,message:"Error: ".concat(i.message)}),{success:!1,error:i.message}}}},vr=new he;chrome.runtime.onInstalled.addListener(()=>{console.log("Job Tracker Extension Installed")});async function lo(){try{console.log("Testing Ollama connection...");let r=await wr("chat",{model:"qwen2.5:3b",messages:[{role:"system",content:"You are a helpful AI assistant."},{role:"user",content:"Hello, are you working?"}],stream:!1});if(r.success)return console.log("Ollama chat test successful:",r.data),{success:!0,data:{version:r.data.model,response:r.data.message.content,port:11434}};throw new Error(r.error||"Unknown error from Ollama")}catch(e){return console.error("Ollama connection failed:",e),{success:!1,error:e.message,details:e.stack,troubleshooting:"Please make sure Ollama is running on your computer. Try running 'ollama serve' in your terminal."}}}async function wr(e,r){var n;try{console.log("Making Ollama API call to ".concat(e,":"),r);let i=11434;console.log("Using Ollama port: ".concat(i));let o=W(J({},r),{stream:!1}),t=await fetch("http://localhost:".concat(i,"/api/").concat(e),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify(o)});if(!t.ok){let s=await t.text();throw console.error("Ollama API error response:",{status:t.status,statusText:t.statusText,body:s}),new Error("HTTP error! status: ".concat(t.status,", details: ").concat(s))}let l=await t.text(),a;try{a=JSON.parse(l)}catch(s){console.warn("JSON parse error:",s.message),console.log("Response text:",l.substring(0,200)+"...");try{let c=l.match(/\{[\s\S]*\}/);if(c)a=JSON.parse(c[0]),console.log("Successfully extracted JSON from response");else throw new Error("Couldn't find valid JSON object in response")}catch(c){throw console.error("Failed to extract JSON:",c),new Error("Invalid JSON response from Ollama: ".concat(s.message))}}if(console.log("Ollama API call successful:",a),e==="chat"){if(!a||!a.message||!a.message.content)if(console.error("Unexpected chat response structure from Ollama:",a),a&&typeof a=="object")a={message:{content:((n=a.message)==null?void 0:n.content)||a.content||a.text||a.response||""||"No content found in response"},model:a.model||"unknown"},console.log("Constructed fallback response:",a);else throw new Error("Invalid chat response format from Ollama")}else if(e==="embeddings"){if(!a||!a.embedding||!Array.isArray(a.embedding))throw console.error("Unexpected embeddings response structure from Ollama:",a),new Error("Invalid embeddings response format from Ollama")}else if(!a)throw console.error("Empty response from Ollama for endpoint ".concat(e,":"),a),new Error("Invalid response format from Ollama for ".concat(e));return{success:!0,data:a}}catch(i){console.error("Ollama API call failed (".concat(e,"):"),i);let o="Please make sure Ollama is running on your computer. Try running 'ollama serve' in your terminal.";return i.name==="AbortError"?o+=" The request timed out - your model might be too large or your computer too slow.":i.message.includes("Failed to fetch")?o+=" Your computer cannot connect to Ollama. Make sure it's running and not blocked by a firewall.":(i.message.includes("Invalid response format")||i.message.includes("JSON"))&&(o+=" Ollama returned an unexpected response format. You might need to update Ollama to a newer version."),{success:!1,error:i.message,details:i.stack,troubleshooting:o}}}function Y(e,r,n){chrome.runtime.sendMessage({type:"EMBEDDING_PROGRESS",data:{progress:e,total:r,percent:Math.round(e/r*100),status:n}})}async function Sr(e){try{let n=e.substring(0,1500);console.log("Getting embeddings in background script (".concat(n.length," chars): ").concat(n.substring(0,50)).concat(n.length>50?"...":""));let i=11434,o={model:"nomic-embed-text",prompt:n,stream:!1};console.log("Ollama embedding request:",{url:"http://localhost:".concat(i,"/api/embeddings"),model:o.model,textLength:n.length,timestamp:new Date().toISOString()});let t=performance.now(),a=await(async(d,p,y=2,b=2e3)=>{let x;for(let T=0;T<=y;T++)try{console.log("Embedding API attempt ".concat(T+1,"/").concat(y+1));let I=1e4+T*5e3,E=new AbortController,Cr=setTimeout(()=>E.abort(),I);console.log("Request timeout set to ".concat(I,"ms"));let Or=performance.now(),B=await fetch(d,W(J({},p),{signal:E.signal})),_r=performance.now();if(console.log("Fetch completed in ".concat((_r-Or).toFixed(2),"ms with status ").concat(B.status)),clearTimeout(Cr),!B.ok){let Ir=await B.text();throw new Error("HTTP error! status: ".concat(B.status,", details: ").concat(Ir))}let Fr=performance.now(),Tr=await B.json(),kr=performance.now();return console.log("JSON parsing completed in ".concat((kr-Fr).toFixed(2),"ms")),Tr}catch(I){x=I,console.warn("Embedding fetch attempt ".concat(T+1,"/").concat(y+1," failed:"),I.message),T<y&&(console.log("Retrying in ".concat(b,"ms...")),await new Promise(E=>setTimeout(E,b)))}throw x})("http://localhost:".concat(i,"/api/embeddings"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o)}),c=performance.now()-t;if(!a.embedding||!Array.isArray(a.embedding))throw console.error("Invalid embedding format in API response:",a),new Error("Invalid embedding format returned from API");console.log("Embeddings generated successfully in ".concat(c.toFixed(2),"ms")),console.log("Embedding dimensions: ".concat(a.embedding.length)),console.log("Embedding sample: [".concat(a.embedding.slice(0,3).map(d=>d.toFixed(5)).join(", "),"...]"));let f=a.embedding.map(d=>parseFloat(d.toFixed(5))),u=JSON.stringify(a.embedding).length,m=JSON.stringify(f).length,h=(100-m/u*100).toFixed(2);return console.log("Embedding size reduction: ".concat(u," \u2192 ").concat(m," bytes (").concat(h,"% reduction)")),{success:!0,data:W(J({},a),{embedding:f}),timing:{totalMs:c,timestamp:new Date().toISOString()}}}catch(r){console.error("Embeddings API call failed:",r);let n="Please make sure Ollama is running on your computer. Try running 'ollama serve' in your terminal.";return r.name==="AbortError"?n+=" The request timed out - your model might be too large or your computer too slow.":r.message&&r.message.includes("Failed to fetch")?n+=" Your computer cannot connect to Ollama. Make sure it's running and not blocked by a firewall.":r.message&&r.message.includes("invalid format")&&(n+=" The embedding model returned data in an unexpected format. You may need to update Ollama or try a different embedding model."),{success:!1,error:r.message,details:r.stack,troubleshooting:n,timestamp:new Date().toISOString()}}}var to=new U(Sr);Object.assign(_,to);async function ao(e){let r=0;for(let n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n),r|=0;return r.toString()}async function so(){return new Promise(e=>{chrome.storage.local.get("embeddingHash",r=>{e(r.embeddingHash||"")})})}async function co(e){return new Promise(r=>{chrome.storage.local.set({embeddingHash:e},()=>{r()})})}async function uo(e){return new Promise((r,n)=>{if(!e||Object.keys(e).length===0){console.warn("No embeddings to save to storage"),r(!1);return}console.log("Saving ".concat(Object.keys(e).length," embeddings to Chrome storage"));let i={};for(let[a,s]of Object.entries(e))if(s.embedding&&Array.isArray(s.embedding)){let c=s.embedding.map(f=>parseFloat(f.toFixed(5)));i[a]={text:s.text,embedding:c}}else i[a]=s;let o=JSON.stringify(e).length,t=JSON.stringify(i).length,l=(100-t/o*100).toFixed(2);console.log("Flattened embeddings for storage: ".concat(o," bytes \u2192 ").concat(t," bytes (").concat(l,"% reduction)")),console.log("Storage payload size: ".concat(t," bytes (").concat((t/(1024*1024)).toFixed(2)," MB)")),chrome.storage.local.set({storedEmbeddings:i},()=>{if(chrome.runtime.lastError){let a=chrome.runtime.lastError;console.error("Error saving embeddings to storage:",a),a.message&&(a.message.includes("quota")||a.message.includes("QUOTA")||a.message.includes("limit")||a.message.includes("space"))&&(console.error("Storage quota exceeded. Data size: ".concat(t," bytes.")),console.error("Consider reducing the amount of data or implementing chunking.")),n(a)}else console.log("Successfully saved ".concat(Object.keys(i).length," embeddings to storage")),r(!0)})})}chrome.runtime.onMessage.addListener((e,r,n)=>{if(console.log("Received message in background script:",e),e.action==="setUserData")return console.log("Processing uploaded YAML data and generating embeddings immediately"),(async()=>{try{let i=e.yamlContent,o=await ao(i);chrome.storage.local.set({userProfile:i,profileHash:o,yamlLastUploaded:Date.now(),yamlFileName:e.fileName||"profile.yaml"},()=>{n({success:!0,message:"Profile saved, generating embeddings in background..."}),console.log("Profile saved, starting embedding generation")});let t=await so();if(o===t){console.log("Embeddings already exist for this profile, skipping generation"),Y(100,100,"Embeddings already up to date");return}let l=a=>{if(a&&typeof a.progress<"u"){let s=a.progress,c=100,f=a.message||"Processing...";Y(s,c,f)}};try{Y(0,100,"Starting embedding generation...");let a=await vr.processUserContext(i,l);console.log("Embedding generation complete:",a),a.success?(await co(o),await uo(_.data),Y(100,100,"Embeddings generated successfully!"),chrome.runtime.sendMessage({type:"EMBEDDING_COMPLETE",success:!0,message:"Embeddings generated successfully!"}),console.log("Stored embeddings and hash for future use")):(Y(0,100,"Error: ".concat(a.error||"Unknown error")),chrome.runtime.sendMessage({type:"EMBEDDING_COMPLETE",success:!1,error:a.error||"Unknown error"}))}catch(a){console.error("Error generating embeddings:",a),Y(0,100,"Error: ".concat(a.message))}}catch(i){console.error("Error in YAML processing:",i),n({success:!1,error:"Error processing YAML: "+i.message})}})(),!0;if(e.action==="testOllama")return lo().then(i=>{console.log("Sending test Ollama response:",i),n(i)}).catch(i=>{console.error("Error in test Ollama:",i),n({success:!1,error:i.message||"Unknown error",troubleshooting:"Error in background script"})}),!0;if(e.action==="callOllama"){let{endpoint:i,data:o}=e;return wr(i,o).then(t=>{console.log("Sending Ollama API response:",t),n(t)}).catch(t=>{console.error("Error in call Ollama API:",t),n({success:!1,error:t.message||"Unknown error",troubleshooting:"Error in background script"})}),!0}if(e.action==="getEmbeddings"){let{text:i}=e;return console.log("Getting embeddings for text"),Sr(i).then(o=>{console.log("Sending embeddings response from background script"),n(o)}).catch(o=>{console.error("Error getting embeddings:",o),n({success:!1,error:o.message||"Unknown error",troubleshooting:"Error generating embeddings"})}),!0}});export{Sr as getEmbeddings};
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
