var J=Object.defineProperty,W=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var j=(m,e,r)=>e in m?J(m,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[e]=r,f=(m,e)=>{for(var r in e||(e={}))F.call(e,r)&&j(m,r,e[r]);if($)for(var r of $(e))V.call(e,r)&&j(m,r,e[r]);return m},b=(m,e)=>W(m,G(e));var k=class{constructor(e){this.backgroundManager=e}async handleMessage(e,r){let{action:t}=e;switch(t){case"startAutoApply":await this.handleStartAutoApply(e,r);break;case"stopAutoApply":await this.handleStopAutoApply(e,r);break;case"getAutoApplyState":await this.handleGetAutoApplyState(e,r);break;default:r({success:!1,error:"Unknown auto-apply action"})}}async handleStartAutoApply(e,r){try{if(console.log("Starting auto apply with data:",e),!e.loginData||!e.loginData.username)throw new Error("Login data required");if(!e.aiSettings||!e.aiSettings.provider||!e.aiSettings.model)throw new Error("AI settings required");this.backgroundManager.setAutoApplyState({isRunning:!0,userData:e.loginData,aiSettings:e.aiSettings}),await this.backgroundManager.getManager("ai").testAiConnection(e.aiSettings);let s=await chrome.tabs.query({active:!0,currentWindow:!0});if(s.length===0)throw new Error("No active tab found");let a=s[0],n=a.id;if(!a.url.includes("linkedin.com"))throw new Error("Please navigate to LinkedIn jobs page first");console.log("Target tab:",{id:n,url:a.url});try{await chrome.scripting.executeScript({target:{tabId:n},files:["dist/content.bundle.js"]}),console.log("Content script injected successfully")}catch(l){console.log("Content script injection failed (might already be loaded):",l)}await new Promise(l=>setTimeout(l,500));let i=await new Promise((l,c)=>{chrome.tabs.sendMessage(n,{action:"startAutoApply",userData:e.loginData,aiSettings:e.aiSettings},g=>{chrome.runtime.lastError?c(new Error(chrome.runtime.lastError.message)):l(g)})});console.log("Content script response:",i),r({success:!0,message:"Auto apply started successfully"})}catch(t){console.error("Error starting auto apply:",t),this.backgroundManager.setAutoApplyState({isRunning:!1}),r({success:!1,error:t.message})}}async handleStopAutoApply(e,r){try{console.log("Stopping auto apply");let t=await chrome.tabs.query({active:!0,currentWindow:!0});if(t.length>0){let s=t[0].id;chrome.tabs.sendMessage(s,{action:"stopAutoApply"},a=>{chrome.runtime.lastError?(console.error("Error sending stop message to content script:",chrome.runtime.lastError),this.backgroundManager.setAutoApplyState({isRunning:!1}),r({success:!0,message:"Auto apply stopped (content script communication error)"})):a&&a.success?(console.log("Auto apply stopped successfully"),this.backgroundManager.setAutoApplyState({isRunning:!1}),r({success:!0,message:"Auto apply stopped"})):(console.error("Content script failed to stop auto apply:",a==null?void 0:a.error),this.backgroundManager.setAutoApplyState({isRunning:!1}),r({success:!0,message:"Auto apply stopped (with content script error)"}))})}else this.backgroundManager.setAutoApplyState({isRunning:!1}),r({success:!0,message:"Auto apply stopped (no active tab)"})}catch(t){console.error("Error stopping auto apply:",t),this.backgroundManager.setAutoApplyState({isRunning:!1}),r({success:!1,error:t.message})}}async handleGetAutoApplyState(e,r){let t=this.backgroundManager.getAutoApplyState();r({success:!0,isRunning:t.isRunning})}},S=k;var M=class{constructor(e){this.backgroundManager=e,this.DATABASE_AVAILABLE=!0,this.API_BASE_URL="http://localhost:3001/api"}async handleMessage(e,r){let{action:t}=e;switch(t){case"registerUser":await this.handleUserRegistration(e,r);break;case"loginUser":await this.handleUserLogin(e,r);break;case"logoutUser":await this.handleUserLogout(e,r);break;case"getUserProfile":await this.handleGetUserProfile(e,r);break;case"updateUserProfile":await this.handleUpdateUserProfile(e,r);break;case"getCurrentUser":await this.handleGetCurrentUser(e,r);break;default:r({success:!1,error:"Unknown user action"})}}async handleUserRegistration(e,r){try{if(!this.DATABASE_AVAILABLE){console.log("Database not available, using local storage fallback");let a=e.userData;if(!a||!a.username||!a.email||!a.password)throw new Error("Missing required user data (username, email, password)");let n=await chrome.storage.local.get(["users"])||{users:{}};if(n.users&&n.users[a.email])throw new Error("User with this email already exists");let i={id:"local_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),username:a.username,email:a.email,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),last_login:null,is_active:!0},l=n.users||{};l[a.email]=b(f({},i),{password_hash:"local_"+a.password}),await chrome.storage.local.set({users:l}),this.backgroundManager.setAutoApplyState({user:i}),await chrome.storage.local.set({currentUser:i,isLoggedIn:!0,userId:i.id}),console.log("User registered successfully (local):",i.id),r({success:!0,user:i});return}let t=await fetch("".concat(this.API_BASE_URL,"/users/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.userData)}),s=await t.json();if(!t.ok)throw new Error(s.error||"Registration failed");this.backgroundManager.setAutoApplyState({user:s.user}),await chrome.storage.local.set({currentUser:s.user,isLoggedIn:!0,userId:s.user.id}),console.log("User registered successfully (database):",s.user.id),r({success:!0,user:s.user})}catch(t){console.error("Error registering user:",t),r({success:!1,error:t.message})}}async handleUserLogin(e,r){try{if(!this.DATABASE_AVAILABLE){console.log("Database not available, using local storage fallback");let{email:a,password:n}=e;if(!a||!n)throw new Error("Email and password are required");let l=(await chrome.storage.local.get(["users"])).users||{},c=l[a];if(!c)throw new Error("Invalid email or password");if(c.password_hash!=="local_"+n)throw new Error("Invalid email or password");let g={id:c.id,username:c.username,email:c.email,created_at:c.created_at,updated_at:new Date().toISOString(),last_login:new Date().toISOString(),is_active:c.is_active};l[a]=b(f({},c),{last_login:g.last_login}),await chrome.storage.local.set({users:l}),this.backgroundManager.setAutoApplyState({user:g}),await chrome.storage.local.set({currentUser:g,isLoggedIn:!0,userId:g.id}),console.log("User logged in successfully (local):",g.id),r({success:!0,user:g});return}let t=await fetch("".concat(this.API_BASE_URL,"/users/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password})}),s=await t.json();if(!t.ok)throw new Error(s.error||"Login failed");this.backgroundManager.setAutoApplyState({user:s.user}),await chrome.storage.local.set({currentUser:s.user,isLoggedIn:!0,userId:s.user.id}),console.log("User logged in successfully (database):",s.user.id),r({success:!0,user:s.user})}catch(t){console.error("Error logging in user:",t),r({success:!1,error:t.message})}}async handleUserLogout(e,r){try{console.log("User logout"),this.backgroundManager.setAutoApplyState({user:null}),await chrome.storage.local.remove(["currentUser","isLoggedIn","userId"]),console.log("User logged out successfully"),r({success:!0})}catch(t){console.error("Error logging out user:",t),r({success:!1,error:t.message})}}async handleGetUserProfile(e,r){try{if(!this.DATABASE_AVAILABLE){let{userId:n}=e;if(!n)throw new Error("User ID is required");let i=await chrome.storage.local.get(["currentUser"]);if(!i.currentUser||i.currentUser.id!==n)throw new Error("User not found");let l={profile:i.currentUser,stats:{total_applications:"0",pending_applications:"0",interviews:"0",offers:"0",companies_applied_to:"0",questions_answered:"0"},resumes:[],aiSettings:[]};r({success:!0,profile:l});return}let{userId:t}=e;if(!t)throw new Error("User ID is required");let s=await fetch("".concat(this.API_BASE_URL,"/users/").concat(t,"/profile"),{method:"GET",headers:{"Content-Type":"application/json"}}),a=await s.json();if(!s.ok)throw new Error(a.error||"Failed to get user profile");r({success:!0,profile:a.profile})}catch(t){console.error("Error getting user profile:",t),r({success:!1,error:t.message})}}async handleUpdateUserProfile(e,r){try{if(!this.DATABASE_AVAILABLE){let{userId:l,updateData:c}=e;if(!l||!c)throw new Error("User ID and update data are required");let g=await chrome.storage.local.get(["currentUser"]);if(!g.currentUser||g.currentUser.id!==l)throw new Error("User not found");let u=b(f(f({},g.currentUser),c),{updated_at:new Date().toISOString()});this.backgroundManager.setAutoApplyState({user:u}),await chrome.storage.local.set({currentUser:u}),r({success:!0,user:u});return}let{userId:t,updateData:s}=e;if(!t||!s)throw new Error("User ID and update data are required");let a=await fetch("".concat(this.API_BASE_URL,"/users/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),n=await a.json();if(!a.ok)throw new Error(n.error||"Failed to update user profile");let i=this.backgroundManager.getAutoApplyState();i.user&&i.user.id===t&&(this.backgroundManager.setAutoApplyState({user:n.user}),await chrome.storage.local.set({currentUser:n.user})),r({success:!0,user:n.user})}catch(t){console.error("Error updating user profile:",t),r({success:!1,error:t.message})}}async handleGetCurrentUser(e,r){try{let t=this.backgroundManager.getAutoApplyState();if(t.user){r({success:!0,user:t.user,isLoggedIn:!0});return}let s=await chrome.storage.local.get(["currentUser","isLoggedIn"]);s.currentUser&&s.isLoggedIn?(this.backgroundManager.setAutoApplyState({user:s.currentUser}),r({success:!0,user:s.currentUser,isLoggedIn:!0})):r({success:!0,user:null,isLoggedIn:!1})}catch(t){console.error("Error getting current user:",t),r({success:!1,error:t.message})}}},P=M;var _=class{constructor(e){this.backgroundManager=e,this.OLLAMA_BASE_URL="http://localhost:11434"}async handleMessage(e,r){let{action:t}=e;switch(t){case"callOllama":await this.handleCallOllama(e,r);break;case"testOllama":case"testOllamaConnection":await this.handleTestOllama(e,r);break;case"ollamaRequest":await this.handleOllamaRequest(e,r);break;case"callOpenAI":await this.handleCallOpenAI(e,r);break;case"testOpenAI":await this.handleTestOpenAI(e,r);break;default:r({success:!1,error:"Unknown AI action"})}}async handleOllamaRequest(e,r){try{let{method:t,url:s,data:a}=e,n="".concat(this.OLLAMA_BASE_URL).concat(s),i={method:t||"GET",headers:{"Content-Type":"application/json"}};a&&(t==="POST"||t==="PUT")&&(i.body=JSON.stringify(a));let l=await fetch(n,i);if(!l.ok){r({success:!1,error:"Ollama request failed: ".concat(l.status," ").concat(l.statusText)});return}let c=await l.json();r(f({success:!0},c))}catch(t){console.error("Ollama request error:",t),r({success:!1,error:"Error connecting to Ollama. Make sure it's running on localhost:11434."})}}async handleCallOllama(e,r){try{let t=e.endpoint||"generate",s=e.data||{},a=await this.callOllamaAPI(t,s);r(a)}catch(t){r({success:!1,error:t.message})}}async handleTestOllama(e,r){try{let t=await this.testOllamaConnection();r(t)}catch(t){r({success:!1,error:t.message})}}async testAiConnection(e){if(console.log("Testing AI connection:",e),e.provider==="ollama"){let r=await this.testOllamaConnection();if(!r.success)throw new Error("Ollama connection failed: ".concat(r.error));console.log("Ollama connection successful")}else if(e.provider==="openai"){let r=await this.testOpenAIConnection(e.apiKey);if(!r.success)throw new Error("OpenAI connection failed: ".concat(r.error));console.log("OpenAI connection successful")}else{if(!e.apiKey)throw new Error("API key required for ".concat(e.provider));console.log("AI settings validated for ".concat(e.provider))}}async testOllamaConnection(){try{console.log("Testing Ollama connection...");let e={model:"qwen2.5:3b",messages:[{role:"system",content:"You are a helpful AI assistant."},{role:"user",content:"Hello, are you working?"}],stream:!1},r=await this.callOllamaAPI("chat",e);if(r.success)return console.log("Ollama chat test successful:",r.data),{success:!0,data:{provider:"ollama",version:r.data.model,response:r.data.message.content,port:11434}};throw new Error(r.error||"Unknown error from Ollama")}catch(e){return console.error("Ollama connection failed:",e),{success:!1,error:e.message,details:e.stack,troubleshooting:"Please make sure Ollama is running on your computer. Try running 'ollama serve' in your terminal."}}}async callOllamaAPI(e,r){var t,s,a,n,i,l,c,g,u,p;try{console.log("=== OLLAMA API CALL DEBUG ==="),console.log("Making Ollama API call to ".concat(e,":"),{model:r.model,prompt:((t=r.prompt)==null?void 0:t.substring(0,100))+"...",messages:((s=r.messages)==null?void 0:s.length)||0,stream:r.stream});let h=11434;console.log("Using Ollama port: ".concat(h));let A=b(f({},r),{stream:!1});console.log("Final request data:",b(f({},A),{prompt:((a=A.prompt)==null?void 0:a.substring(0,200))+(((n=A.prompt)==null?void 0:n.length)>200?"...":""),messages:(i=A.messages)==null?void 0:i.map(d=>({role:d.role,content:d.content.substring(0,200)+(d.content.length>200?"...":"")}))}));let I=await fetch("http://localhost:".concat(h,"/api/").concat(e),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify(A)});if(!I.ok){let d=await I.text();throw console.error("Ollama API error response:",{status:I.status,statusText:I.statusText,body:d}),new Error("HTTP error! status: ".concat(I.status,", details: ").concat(d))}let O=await I.text(),o;try{o=JSON.parse(O)}catch(d){console.warn("JSON parse error:",d.message),console.log("Response text:",O.substring(0,200)+"...");try{let w=O.match(/\{[\s\S]*\}/);if(w)o=JSON.parse(w[0]),console.log("Successfully extracted JSON from response");else throw new Error("Couldn't find valid JSON object in response")}catch(w){throw console.error("Failed to extract JSON:",w),new Error("Invalid JSON response from Ollama: ".concat(d.message))}}if(console.log("Ollama API call successful:",{model:o.model,response:((l=o.response)==null?void 0:l.substring(0,100))+"...",message:((g=(c=o.message)==null?void 0:c.content)==null?void 0:g.substring(0,100))+"..."}),e==="chat"){if(!o||!o.message||!o.message.content)if(console.error("Unexpected chat response structure from Ollama:",o),o&&typeof o=="object")o={message:{content:((u=o.message)==null?void 0:u.content)||o.content||o.text||o.response||""||"No content found in response"},model:o.model||"unknown"},console.log("Constructed fallback response:",o);else throw new Error("Invalid chat response format from Ollama")}else if(e==="generate"){if(!o||typeof o.response!="string")if(console.error("Unexpected generate response structure from Ollama:",o),o&&typeof o=="object")o={response:o.response||o.content||o.text||((p=o.message)==null?void 0:p.content)||""||"No response found in result",model:o.model||"unknown"},console.log("Constructed fallback generate response:",o);else throw new Error("Invalid generate response format from Ollama")}else if(e==="embeddings"){if(!o||!o.embedding||!Array.isArray(o.embedding))throw console.error("Unexpected embeddings response structure from Ollama:",o),new Error("Invalid embeddings response format from Ollama")}else if(!o)throw console.error("Empty response from Ollama for endpoint ".concat(e,":"),o),new Error("Invalid response format from Ollama for ".concat(e));return console.log("=== END OLLAMA API CALL DEBUG ==="),{success:!0,data:o}}catch(h){console.error("Ollama API call failed (".concat(e,"):"),h),console.log("=== END OLLAMA API CALL DEBUG ===");let A="Please make sure Ollama is running on your computer. Try running 'ollama serve' in your terminal.";return h.name==="AbortError"?A+=" The request timed out - your model might be too large or your computer too slow.":h.message.includes("Failed to fetch")?A+=" Your computer cannot connect to Ollama. Make sure it's running and not blocked by a firewall.":(h.message.includes("Invalid response format")||h.message.includes("JSON"))&&(A+=" Ollama returned an unexpected response format. You might need to update Ollama to a newer version."),{success:!1,error:h.message,details:h.stack,troubleshooting:A}}}async handleCallOpenAI(e,r){try{let t=e.data||{},s=await this.callOpenAIAPI(t);r(s)}catch(t){r({success:!1,error:t.message})}}async handleTestOpenAI(e,r){try{let t=this.backgroundManager.getAutoApplyState().aiSettings,s=(t==null?void 0:t.apiKey)||e.apiKey;if(!s){r({success:!1,error:"OpenAI API key is required"});return}let a=await this.testOpenAIConnection(s);r(a)}catch(t){r({success:!1,error:t.message})}}async testOpenAIConnection(e){try{console.log("Testing OpenAI connection...");let r={model:"gpt-4o-mini",messages:[{role:"system",content:"You are a helpful AI assistant."},{role:"user",content:"Hello, are you working?"}],max_tokens:50},t=await this.callOpenAIAPI(b(f({},r),{apiKey:e}));if(t.success)return console.log("OpenAI connection test successful:",t.data),{success:!0,data:{version:t.data.model,response:t.data.choices[0].message.content,provider:"openai"}};throw new Error(t.error||"Unknown error from OpenAI")}catch(r){return console.error("OpenAI connection failed:",r),{success:!1,error:r.message,details:r.stack,troubleshooting:"Please check your OpenAI API key and make sure it's valid."}}}async callOpenAIAPI(e){var r,t,s,a,n,i,l,c,g;try{console.log("=== OPENAI API CALL DEBUG ==="),console.log("Making OpenAI API call:",{model:e.model,prompt:((r=e.prompt)==null?void 0:r.substring(0,100))+"...",messages:((t=e.messages)==null?void 0:t.length)||0,max_tokens:e.max_tokens,temperature:e.temperature});let{apiKey:u,model:p,prompt:h,messages:A,max_tokens:I=1e3,temperature:O=.7}=e;if(!u)throw new Error("OpenAI API key is required");let o={model:p||"gpt-4o-mini",max_tokens:I,temperature:O};if(A)o.messages=A,console.log("Using messages format:",A);else if(h)o.messages=[{role:"user",content:h}],console.log("Converted prompt to messages format");else throw new Error("Either prompt or messages must be provided");console.log("Final request body:",b(f({},o),{messages:o.messages.map(y=>({role:y.role,content:y.content.substring(0,200)+(y.content.length>200?"...":"")}))}));let d=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(u)},body:JSON.stringify(o)});if(!d.ok){let y=await d.json().catch(()=>({}));console.error("OpenAI API error response:",{status:d.status,statusText:d.statusText,error:y});let E="HTTP error! status: ".concat(d.status);throw(s=y.error)!=null&&s.message?E=y.error.message:y.error&&(E=y.error),new Error(E)}let w=await d.json();return console.log("OpenAI API call successful:",{model:w.model,usage:w.usage,responseLength:((i=(n=(a=w.choices[0])==null?void 0:a.message)==null?void 0:n.content)==null?void 0:i.length)||0,response:((g=(c=(l=w.choices[0])==null?void 0:l.message)==null?void 0:c.content)==null?void 0:g.substring(0,100))+"..."}),console.log("=== END OPENAI API CALL DEBUG ==="),{success:!0,data:w}}catch(u){console.error("OpenAI API call failed:",u),console.log("=== END OPENAI API CALL DEBUG ===");let p="Please check your OpenAI API key and make sure it's valid.";return u.message.includes("401")?p="Your OpenAI API key is invalid. Please check your API key.":u.message.includes("429")?p="Rate limit exceeded. Please wait a moment and try again.":u.message.includes("quota")?p="You've exceeded your OpenAI API quota. Please check your billing.":u.message.includes("Failed to fetch")&&(p="Network error. Please check your internet connection."),{success:!1,error:u.message,troubleshooting:p}}}},L=_;var D=class{constructor(e){this.backgroundManager=e,this.DATABASE_AVAILABLE=!0,this.API_BASE_URL="http://localhost:3001/api"}async handleMessage(e,r){let{action:t}=e;switch(t){case"uploadResume":await this.handleResumeUpload(e,r);break;case"downloadResume":await this.handleResumeDownload(e,r);break;default:r({success:!1,error:"Unknown resume action"})}}async handleResumeUpload(e,r){try{let{userId:t,fileData:s,formData:a}=e;if(!this.DATABASE_AVAILABLE){r({success:!1,error:"Database not available"});return}if(!s||!s.buffer){r({success:!1,error:"No file data provided"});return}console.log("Upload debug - fileData.buffer type:",typeof s.buffer),console.log("Upload debug - fileData.buffer length:",s.buffer.length),console.log("Upload debug - first 10 bytes:",s.buffer.slice(0,10));let n=new FormData,i=new Uint8Array(s.buffer);console.log("Upload debug - uint8Array:",i.slice(0,10));let l=new Blob([i],{type:s.type});console.log("Upload debug - blob size:",l.size),console.log("Upload debug - blob type:",l.type);let c=new File([l],s.name,{type:s.type,lastModified:s.lastModified});console.log("Upload debug - file size:",c.size),console.log("Upload debug - file type:",c.type),n.append("resume",c),n.append("name",a.name||""),n.append("short_description",a.short_description||""),n.append("is_default",a.is_default||!1),a.structured_data&&n.append("structured_data",a.structured_data),a.formatted_text&&n.append("formatted_text",a.formatted_text),a.file_type&&n.append("file_type",a.file_type);let g=await fetch("".concat(this.API_BASE_URL,"/users/").concat(t,"/resumes/upload"),{method:"POST",body:n}),u=await g.json();if(!g.ok){r({success:!1,error:u.error||"Upload failed"});return}r(f({success:!0},u))}catch(t){console.error("Resume upload error:",t),r({success:!1,error:t.message})}}async handleResumeDownload(e,r){try{let{resumeId:t,fileName:s}=e;if(!this.DATABASE_AVAILABLE){r({success:!1,error:"Database not available"});return}let a=await fetch("".concat(this.API_BASE_URL,"/resumes/").concat(t));if(!a.ok){let p=await a.json();r({success:!1,error:p.error||"Resume not found"});return}let i=(await a.json()).resume,l="".concat(i.name,".").concat(i.extension),c=await fetch("".concat(this.API_BASE_URL,"/resumes/").concat(t,"/download"));if(!c.ok){let p=await c.json();r({success:!1,error:p.error||"Download failed"});return}let g=await c.blob(),u=new FileReader;u.onloadend=()=>{let p=u.result;chrome.downloads.download({url:p,filename:l},h=>{chrome.runtime.lastError?r({success:!1,error:chrome.runtime.lastError.message}):r({success:!0,downloadId:h})})},u.onerror=()=>{r({success:!1,error:"Failed to read file data"})},u.readAsDataURL(g)}catch(t){console.error("Resume download error:",t),r({success:!1,error:t.message})}}},T=D;var v=class{constructor(e){this.backgroundManager=e,this.DATABASE_AVAILABLE=!0,this.API_BASE_URL="http://localhost:3001/api"}async handleMessage(e,r){let{action:t}=e;switch(t){case"apiRequest":await this.handleApiRequest(e,r);break;default:r({success:!1,error:"Unknown API action"})}}async handleApiRequest(e,r){try{let{method:t,url:s,data:a}=e;if(!this.DATABASE_AVAILABLE){r({success:!1,error:"Database not available"});return}let n="".concat(this.API_BASE_URL).concat(s),i={method:t,headers:{"Content-Type":"application/json"}};a&&(t==="POST"||t==="PUT")&&(i.body=JSON.stringify(a));let l=await fetch(n,i),c=await l.json();if(!l.ok){r({success:!1,error:c.error||"API request failed"});return}r(f({success:!0},c))}catch(t){console.error("API request error:",t),r({success:!1,error:t.message})}}},x=v;var B=class{constructor(){this.isAutoApplyRunning=!1,this.currentUserData=null,this.currentAiSettings=null,this.currentUser=null,this.managers=new Map,this.initializeManagers(),this.setupMessageListener()}initializeManagers(){this.managers.set("autoApply",new S(this)),this.managers.set("user",new P(this)),this.managers.set("ai",new L(this)),this.managers.set("resume",new T(this)),this.managers.set("api",new x(this))}setupMessageListener(){chrome.runtime.onMessage.addListener((e,r,t)=>(console.log("Background received message:",e),console.log("Message sender:",r),!e||typeof e!="object"?(console.error("Invalid message received - not an object:",e),t({success:!1,error:"Invalid message: not an object"}),!0):(this.handleMessage(e,r,t),!0)))}async handleMessage(e,r,t){try{let{action:s}=e;if(!s||typeof s!="string"){console.error("Invalid message received - missing or invalid action:",e),t({success:!1,error:"Invalid message: missing or invalid action"});return}s.startsWith("startAutoApply")||s.startsWith("stopAutoApply")||s==="getAutoApplyState"?await this.managers.get("autoApply").handleMessage(e,t):s.startsWith("registerUser")||s.startsWith("loginUser")||s.startsWith("logoutUser")||s.startsWith("getUserProfile")||s.startsWith("updateUserProfile")||s==="getCurrentUser"?await this.managers.get("user").handleMessage(e,t):s.startsWith("callOllama")||s.startsWith("testOllama")||s==="ollamaRequest"||s.startsWith("callOpenAI")||s.startsWith("testOpenAI")?await this.managers.get("ai").handleMessage(e,t):s.startsWith("uploadResume")||s.startsWith("downloadResume")?await this.managers.get("resume").handleMessage(e,t):s==="apiRequest"?await this.managers.get("api").handleMessage(e,t):s==="STATUS_UPDATE"||s==="PROCESS_COMPLETE"?(console.log("Received status update:",e),t({success:!0,message:"Status update received"})):(console.warn("Unknown action received:",s),t({success:!1,error:"Unknown action: ".concat(s)}))}catch(s){console.error("Error handling message:",s),t({success:!1,error:s.message})}}getManager(e){return this.managers.get(e)}getAutoApplyState(){return{isRunning:this.isAutoApplyRunning,userData:this.currentUserData,aiSettings:this.currentAiSettings,user:this.currentUser}}setAutoApplyState(e){this.isAutoApplyRunning=e.isRunning||!1,this.currentUserData=e.userData||null,this.currentAiSettings=e.aiSettings||null,this.currentUser=e.user||null}},C=B;var U=new C,ie=U.getManager("autoApply"),ce=U.getManager("user"),ue=U.getManager("ai"),ge=U.getManager("resume"),de=U.getManager("api"),N=U;console.log("Background script loaded - Using manager system");chrome.runtime.onInstalled.addListener(()=>{console.log("Job Tracker Extension Installed"),console.log("Background managers initialized:",Object.keys(N.managers))});
