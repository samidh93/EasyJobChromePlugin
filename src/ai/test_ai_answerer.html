<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Question Answerer Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .section {
            margin-bottom: 30px;
        }
        .section h2 {
            color: #555;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        button {
            background-color: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #005a8b;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            white-space: pre-wrap;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .log {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            max-height: 200px;
            overflow-y: auto;
        }
        .options-container {
            margin: 10px 0;
        }
        .options-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .option-input {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .option-input input {
            margin-right: 10px;
            width: auto;
        }
        .sample-questions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .sample-questions button {
            background-color: #28a745;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .sample-questions button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <h1>ðŸ¤– AI Question Answerer Test</h1>
    
    <div class="container">
        <div class="section">
            <h2>1. Load User Data</h2>
            <textarea id="userData" placeholder="Paste your user data here (JSON format)...">{
  "personal_information": {
    "name": "John",
    "surname": "Doe",
    "email": "john.doe@example.com",
    "phone": "1234567890",
    "phone_prefix": "+49",
    "country": "Germany",
    "salary": "75000"
  },
  "work_experience": [
    {
      "company": "Tech Corp",
      "position": "Software Engineer",
      "duration": "2020-2023",
      "description": "Developed web applications using React and Node.js"
    }
  ],
  "skills": ["JavaScript", "React", "Node.js", "Python", "Docker"],
  "education": [
    {
      "degree": "Bachelor of Computer Science",
      "institution": "University of Technology",
      "year": "2020"
    }
  ]
}</textarea>
            <button onclick="loadUserData()">Load User Data</button>
            <div id="loadResult" class="result" style="display: none;"></div>
        </div>

        <div class="section">
            <h2>2. Test Questions</h2>
            <input type="text" id="questionInput" placeholder="Enter your question here..." value="What is your email address?">
            
            <div class="options-container">
                <label>Options (optional - one per line):</label>
                <textarea id="optionsInput" placeholder="Option 1&#10;Option 2&#10;Option 3" style="height: 80px;"></textarea>
            </div>
            
            <button onclick="answerQuestion()">Answer Question</button>
            <button onclick="testDirectAnswers()">Test Direct Answers</button>
            <button onclick="testWithOptions()">Test With Options</button>
            
            <div class="sample-questions">
                <button onclick="setQuestion('What is your email address?')">Email</button>
                <button onclick="setQuestion('What is your phone number?')">Phone</button>
                <button onclick="setQuestion('What is your first name?')">First Name</button>
                <button onclick="setQuestion('What is your last name?')">Last Name</button>
                <button onclick="setQuestion('What programming languages do you know?')">Skills</button>
                <button onclick="setQuestion('How many years of experience do you have?')">Experience</button>
            </div>
            
            <div id="answerResult" class="result" style="display: none;"></div>
        </div>

        <div class="section">
            <h2>3. Test Log</h2>
            <button onclick="clearLog()">Clear Log</button>
            <div id="testLog" class="result log" style="display: block; height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <script type="module">
        // Mock Chrome API
        window.chrome = {
            runtime: {
                sendMessage: function(message, callback) {
                    console.log('Mock Chrome API call:', message);
                    
                    // Simulate different responses based on action
                    setTimeout(() => {
                        if (message.action === 'testOllama') {
                            callback({ success: true });
                        } else if (message.action === 'callOllama') {
                            // Mock Ollama response
                            const mockResponse = {
                                response: generateMockResponse(message.data)
                            };
                            callback({ success: true, data: mockResponse });
                        } else {
                            callback({ success: false, error: 'Unknown action' });
                        }
                    }, 500); // Simulate network delay
                },
                lastError: null
            }
        };

        function generateMockResponse(requestData) {
            const prompt = requestData.prompt || '';
            console.log('Mock Ollama prompt:', prompt);
            
            // Simple mock responses based on question content
            if (prompt.includes('email')) {
                return 'john.doe@example.com';
            } else if (prompt.includes('phone')) {
                return '+491234567890';
            } else if (prompt.includes('name') && prompt.includes('first')) {
                return 'John';
            } else if (prompt.includes('name') && prompt.includes('last')) {
                return 'Doe';
            } else if (prompt.includes('programming languages') || prompt.includes('skills')) {
                return 'JavaScript, React, Node.js, Python, Docker';
            } else if (prompt.includes('experience') && prompt.includes('years')) {
                return '8';
            } else if (prompt.includes('Available Options')) {
                // Extract options from prompt
                const optionsMatch = prompt.match(/Available Options: \[(.*?)\]/);
                if (optionsMatch) {
                    const options = optionsMatch[1].split(', ').map(opt => opt.replace(/"/g, ''));
                    return options[0]; // Return first option as mock response
                }
            }
            
            return 'This is a mock response from the AI system.';
        }

        // Import and initialize AIQuestionAnswerer
        import AIQuestionAnswerer from './AIQuestionAnswerer.js';
        
        window.aiAnswerer = new AIQuestionAnswerer();
        
        // Log function
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            
            if (type === 'error') {
                console.error(message);
            } else {
                console.log(message);
            }
        }

        // Load user data
        window.loadUserData = async function() {
            const userDataText = document.getElementById('userData').value;
            const resultDiv = document.getElementById('loadResult');
            
            try {
                const userData = JSON.parse(userDataText);
                const result = await window.aiAnswerer.setUserContext(userData);
                
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = 'User data loaded successfully!';
                    log('User data loaded successfully');
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `Error: ${result.error}`;
                    log(`Error loading user data: ${result.error}`, 'error');
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `JSON Parse Error: ${error.message}`;
                log(`JSON Parse Error: ${error.message}`, 'error');
            }
            
            resultDiv.style.display = 'block';
        };

        // Answer question
        window.answerQuestion = async function() {
            const question = document.getElementById('questionInput').value;
            const optionsText = document.getElementById('optionsInput').value;
            const resultDiv = document.getElementById('answerResult');
            
            if (!question.trim()) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Please enter a question.';
                resultDiv.style.display = 'block';
                return;
            }
            
            try {
                let options = null;
                if (optionsText.trim()) {
                    options = optionsText.split('\n').map(opt => opt.trim()).filter(opt => opt);
                }
                
                log(`Asking question: "${question}"${options ? ` with options: [${options.join(', ')}]` : ''}`);
                
                const answer = await window.aiAnswerer.answerQuestion(question, options);
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `Question: ${question}\n\nAnswer: ${answer}`;
                resultDiv.style.display = 'block';
                
                log(`Answer received: "${answer}"`);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.style.display = 'block';
                log(`Error answering question: ${error.message}`, 'error');
            }
        };

        // Test direct answers
        window.testDirectAnswers = async function() {
            const questions = [
                'What is your email address?',
                'What is your phone number?',
                'What is your first name?',
                'What is your last name?',
                'What country are you from?'
            ];
            
            log('Testing direct answers...');
            
            for (const question of questions) {
                try {
                    const answer = await window.aiAnswerer.answerQuestion(question);
                    log(`Q: ${question} | A: ${answer}`);
                } catch (error) {
                    log(`Q: ${question} | ERROR: ${error.message}`, 'error');
                }
            }
        };

        // Test with options
        window.testWithOptions = async function() {
            const testsWithOptions = [
                {
                    question: 'What is your country?',
                    options: ['Deutschland (+49)', 'United States (+1)', 'United Kingdom (+44)']
                },
                {
                    question: 'What is your experience level?',
                    options: ['Junior (0-2 years)', 'Mid-level (3-5 years)', 'Senior (5+ years)']
                },
                {
                    question: 'What is your preferred work arrangement?',
                    options: ['Remote', 'On-site', 'Hybrid']
                }
            ];
            
            log('Testing questions with options...');
            
            for (const test of testsWithOptions) {
                try {
                    const answer = await window.aiAnswerer.answerQuestion(test.question, test.options);
                    log(`Q: ${test.question} | Options: [${test.options.join(', ')}] | A: ${answer}`);
                } catch (error) {
                    log(`Q: ${test.question} | ERROR: ${error.message}`, 'error');
                }
            }
        };

        // Set question
        window.setQuestion = function(question) {
            document.getElementById('questionInput').value = question;
        };

        // Clear log
        window.clearLog = function() {
            document.getElementById('testLog').textContent = '';
        };

        // Initialize
        log('AI Question Answerer Test initialized');
        log('Click "Load User Data" to start, then test questions');
    </script>
</body>
</html> 