<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Tests</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Manager Tests</h1>
    
    <div class="test-section">
        <h2>Auth Manager Tests</h2>
        <button onclick="testAuthManager()">Test Auth Manager</button>
        <button onclick="testLogin()">Test Login</button>
        <button onclick="testRegister()">Test Register</button>
        <button onclick="testLogout()">Test Logout</button>
        <div id="auth-results"></div>
    </div>

    <div class="test-section">
        <h2>Applications Manager Tests</h2>
        <button onclick="testApplicationsManager()">Test Applications Manager</button>
        <button onclick="testLoadApplications()">Test Load Applications</button>
        <button onclick="testSelectApplication()">Test Select Application</button>
        <div id="apps-results"></div>
    </div>

    <div class="test-section">
        <h2>AI Manager Tests</h2>
        <button onclick="testAiManager()">Test AI Manager</button>
        <button onclick="testLoadAiSettings()">Test Load AI Settings</button>
        <button onclick="testLoadOllamaModels()">Test Load Ollama Models</button>
        <div id="ai-results"></div>
    </div>

    <div class="test-section">
        <h2>Resume Manager Tests</h2>
        <button onclick="testResumeManager()">Test Resume Manager</button>
        <button onclick="testLoadResumes()">Test Load Resumes</button>
        <button onclick="testFormatFileSize()">Test Format File Size</button>
        <div id="resume-results"></div>
    </div>

    <script type="module">
        import { authManager, applicationsManager, aiManager, resumeManager } from './index.js';

        window.authManager = authManager;
        window.applicationsManager = applicationsManager;
        window.aiManager = aiManager;
        window.resumeManager = resumeManager;

        function addResult(containerId, message, isSuccess = true) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            div.innerHTML = `<strong>${isSuccess ? '✓' : '✗'}</strong> ${message}`;
            container.appendChild(div);
        }

        window.testAuthManager = async () => {
            const container = document.getElementById('auth-results');
            container.innerHTML = '<h3>Auth Manager Test Results:</h3>';

            try {
                // Test basic functionality
                const authState = authManager.getAuthState();
                addResult('auth-results', `Initial auth state: ${JSON.stringify(authState)}`);

                // Test loading current user
                const loadResult = await authManager.loadCurrentUser();
                addResult('auth-results', `Load current user: ${JSON.stringify(loadResult)}`, loadResult.success);

                // Test loading user data
                const userDataResult = await authManager.loadUserData();
                addResult('auth-results', `Load user data: ${JSON.stringify(userDataResult)}`, userDataResult.success);

            } catch (error) {
                addResult('auth-results', `Error: ${error.message}`, false);
            }
        };

        window.testLogin = async () => {
            const container = document.getElementById('auth-results');
            container.innerHTML = '<h3>Login Test Results:</h3>';

            try {
                const result = await authManager.login('test@example.com', 'password123');
                addResult('auth-results', `Login result: ${JSON.stringify(result)}`, result.success);
            } catch (error) {
                addResult('auth-results', `Login error: ${error.message}`, false);
            }
        };

        window.testRegister = async () => {
            const container = document.getElementById('auth-results');
            container.innerHTML = '<h3>Register Test Results:</h3>';

            try {
                const result = await authManager.register({
                    email: 'newuser@example.com',
                    password: 'password123',
                    username: 'newuser'
                });
                addResult('auth-results', `Register result: ${JSON.stringify(result)}`, result.success);
            } catch (error) {
                addResult('auth-results', `Register error: ${error.message}`, false);
            }
        };

        window.testLogout = async () => {
            const container = document.getElementById('auth-results');
            container.innerHTML = '<h3>Logout Test Results:</h3>';

            try {
                const result = await authManager.logout();
                addResult('auth-results', `Logout result: ${JSON.stringify(result)}`, result.success);
            } catch (error) {
                addResult('auth-results', `Logout error: ${error.message}`, false);
            }
        };

        window.testApplicationsManager = async () => {
            const container = document.getElementById('apps-results');
            container.innerHTML = '<h3>Applications Manager Test Results:</h3>';

            try {
                // Test basic functionality
                const appsState = applicationsManager.getApplicationsState();
                addResult('apps-results', `Initial apps state: ${JSON.stringify(appsState)}`);

                // Test getting unique companies
                const companies = applicationsManager.getUniqueCompanies();
                addResult('apps-results', `Unique companies: ${JSON.stringify(companies)}`);

                // Test getting jobs for company
                const jobs = applicationsManager.getJobsForCompany('Netflix');
                addResult('apps-results', `Jobs for Netflix: ${JSON.stringify(jobs)}`);

            } catch (error) {
                addResult('apps-results', `Error: ${error.message}`, false);
            }
        };

        window.testLoadApplications = async () => {
            const container = document.getElementById('apps-results');
            container.innerHTML = '<h3>Load Applications Test Results:</h3>';

            try {
                const result = await applicationsManager.loadApplications(1); // Test with user ID 1
                addResult('apps-results', `Load applications result: ${JSON.stringify(result)}`, result.success);
            } catch (error) {
                addResult('apps-results', `Load applications error: ${error.message}`, false);
            }
        };

        window.testSelectApplication = async () => {
            const container = document.getElementById('apps-results');
            container.innerHTML = '<h3>Select Application Test Results:</h3>';

            try {
                const result = await applicationsManager.selectApplication(1); // Test with application ID 1
                addResult('apps-results', `Select application result: ${JSON.stringify(result)}`, result.success);
            } catch (error) {
                addResult('apps-results', `Select application error: ${error.message}`, false);
            }
        };

        window.testAiManager = async () => {
            const container = document.getElementById('ai-results');
            container.innerHTML = '<h3>AI Manager Test Results:</h3>';

            try {
                // Test basic functionality
                const aiState = aiManager.getAiSettingsState();
                addResult('ai-results', `Initial AI state: ${JSON.stringify(aiState)}`);

                // Test loading AI settings
                const loadResult = await aiManager.loadAiSettings(1);
                addResult('ai-results', `Load AI settings: ${JSON.stringify(loadResult)}`, loadResult.success);

            } catch (error) {
                addResult('ai-results', `Error: ${error.message}`, false);
            }
        };

        window.testLoadAiSettings = async () => {
            const container = document.getElementById('ai-results');
            container.innerHTML = '<h3>Load AI Settings Test Results:</h3>';

            try {
                const result = await aiManager.loadAiSettings(1); // Test with user ID 1
                addResult('ai-results', `Load AI settings result: ${JSON.stringify(result)}`, result.success);
            } catch (error) {
                addResult('ai-results', `Load AI settings error: ${error.message}`, false);
            }
        };

        window.testLoadOllamaModels = async () => {
            const container = document.getElementById('ai-results');
            container.innerHTML = '<h3>Load Ollama Models Test Results:</h3>';

            try {
                const result = await aiManager.loadOllamaModels();
                addResult('ai-results', `Load Ollama models result: ${JSON.stringify(result)}`, result.success);
            } catch (error) {
                addResult('ai-results', `Load Ollama models error: ${error.message}`, false);
            }
        };

        window.testResumeManager = async () => {
            const container = document.getElementById('resume-results');
            container.innerHTML = '<h3>Resume Manager Test Results:</h3>';

            try {
                // Test basic functionality
                const resumeState = resumeManager.getResumeState();
                addResult('resume-results', `Initial resume state: ${JSON.stringify(resumeState)}`);

                // Test loading resumes
                const loadResult = await resumeManager.loadResumes(1);
                addResult('resume-results', `Load resumes: ${JSON.stringify(loadResult)}`, loadResult.success);

            } catch (error) {
                addResult('resume-results', `Error: ${error.message}`, false);
            }
        };

        window.testLoadResumes = async () => {
            const container = document.getElementById('resume-results');
            container.innerHTML = '<h3>Load Resumes Test Results:</h3>';

            try {
                const result = await resumeManager.loadResumes(1); // Test with user ID 1
                addResult('resume-results', `Load resumes result: ${JSON.stringify(result)}`, result.success);
            } catch (error) {
                addResult('resume-results', `Load resumes error: ${error.message}`, false);
            }
        };

        window.testFormatFileSize = async () => {
            const container = document.getElementById('resume-results');
            container.innerHTML = '<h3>Format File Size Test Results:</h3>';

            try {
                const sizes = [0, 1024, 1048576, 1073741824]; // 0B, 1KB, 1MB, 1GB
                sizes.forEach(size => {
                    const formatted = resumeManager.formatFileSize(size);
                    addResult('resume-results', `${size} bytes = ${formatted}`);
                });
            } catch (error) {
                addResult('resume-results', `Format file size error: ${error.message}`, false);
            }
        };

        // Add listeners to show state changes
        authManager.addListener((authState) => {
            console.log('Auth state changed:', authState);
        });

        applicationsManager.addListener((appsState) => {
            console.log('Applications state changed:', appsState);
        });

        aiManager.addListener((aiState) => {
            console.log('AI state changed:', aiState);
        });

        resumeManager.addListener((resumeState) => {
            console.log('Resume state changed:', resumeState);
        });

        console.log('Manager tests loaded successfully');
    </script>
</body>
</html> 